<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.83.1" /><link rel="canonical" type="text/html" href="/docs/book/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/book/index.xml">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Books | Cybertraining</title>
<meta name="description" content="by the Digital Science Center"><meta property="og:title" content="Books" />
<meta property="og:description" content="by the Digital Science Center" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/book/" /><meta property="og:site_name" content="Cybertraining" />

<meta itemprop="name" content="Books">
<meta itemprop="description" content="by the Digital Science Center"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Books"/>
<meta name="twitter:description" content="by the Digital Science Center"/>




<link rel="preload" href="/scss/main.min.14906261683a915cbcff6e5ba3d5abfd7d7fe6a8efa07f25b426adffcf2a49cb.css" as="style">
<link href="/scss/main.min.14906261683a915cbcff6e5ba3d5abfd7d7fe6a8efa07f25b426adffcf2a49cb.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>





  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Cybertraining</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/courses/reu2021/" ><span>2021 REU Course</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/report/2021-reu/" ><span>2021 REU Reports</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><i class='fas fa-book'></i><span class="active">Content</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/cybertraining-dsc/cybertraining-dsc.github.io/" target="_blank" ><i class='fab fa-github'></i><span>GitHub</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/book/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Books</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-b99a6cffb63733cdd376b3261c38764f">Python</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-f7087b17c29b509b6f9d9a7eca3ff8f3">Introduction to Python</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-c30e6c9733a48649f46fd4d10ab49dea">Python Installation</a></li>


    
  
    
    
	
<li>1.3: <a href="#pg-dec9441ee9947161838209b79bbfaa2c">Interactive Python</a></li>


    
  
    
    
	
<li>1.4: <a href="#pg-ff9477ccc979e5caf8526fbcf779f8e2">Editors</a></li>


    
  
    
    
	
<li>1.5: <a href="#pg-fee9682b4120ebc90d96dc4e959e857b">Google Colab</a></li>


    
  
    
    
	
<li>1.6: <a href="#pg-7fabf78b46e5bb7bd617b3e8bf1a0fe2">Language</a></li>


    
  
    
    
	
<li>1.7: <a href="#pg-32abc024da4c6b12b87aa02d11dba5a4">Cloudmesh</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.7.1: <a href="#pg-353639cc7e89960839f8ff2f993d22b0">Introduction</a></li>


    
  
    
    
	
<li>1.7.2: <a href="#pg-ddf5dd385a60a5ca754aee0d9592dd82">Installation</a></li>


    
  
    
    
	
<li>1.7.3: <a href="#pg-4ccb593cc80ca5340d22721edf0e0c81">Output</a></li>


    
  
    
    
	
<li>1.7.4: <a href="#pg-3d9c122fedd4b1b656876d03711787f9">Dictionaries</a></li>


    
  
    
    
	
<li>1.7.5: <a href="#pg-f8b6dd2bf5b1fed8cba49ac1a38d0f26">Shell</a></li>


    
  
    
    
	
<li>1.7.6: <a href="#pg-db39fc96122506a25b3122b0c3511c39">StopWatch</a></li>


    
  
    
    
	
<li>1.7.7: <a href="#pg-20eb56a5917755f4cceddff1e73648b2">Cloudmesh Command Shell</a></li>


    
  
    
    
	
<li>1.7.8: <a href="#pg-61f1bb4fd62199e3dafe6987bab0fd07">Exercises</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.8: <a href="#pg-74d6d805870b943ad628e356d63c6cd4">Data</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.8.1: <a href="#pg-d1e606b4ebb5aedc4142a66141541e1d">Data Formats</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.9: <a href="#pg-77a20c7245f87b0312b3eae603f4a4bd">Mongo</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.9.1: <a href="#pg-81edebc786d3b67bb2e60732beb21953">MongoDB in Python</a></li>


    
  
    
    
	
<li>1.9.2: <a href="#pg-556ddc00ee07c362b88260b214078022">Mongoengine</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.10: <a href="#pg-4e716d7c5c9029ad241cbb8628e64f98">Other</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.10.1: <a href="#pg-65fbb92755467a1af78398183590e7cc">Word Count with Parallel Python</a></li>


    
  
    
    
	
<li>1.10.2: <a href="#pg-c3503067c11f7abae661dfa892030f49">NumPy</a></li>


    
  
    
    
	
<li>1.10.3: <a href="#pg-1c3b9ac7e2dbf04a9c689f2c2c4b613a">Scipy</a></li>


    
  
    
    
	
<li>1.10.4: <a href="#pg-9f03f93bd79697249709db37772032c6">Scikit-learn</a></li>


    
  
    
    
	
<li>1.10.5: <a href="#pg-0026bacb1a4e3d2e6df1d11ca44f4e6c">Dask - Random Forest Feature Detection</a></li>


    
  
    
    
	
<li>1.10.6: <a href="#pg-00a632eb98f5bea1f33d0ade7f8a8fcb">Parallel Computing in Python</a></li>


    
  
    
    
	
<li>1.10.7: <a href="#pg-dcb9354b26f1bf4c30d415d41915fbfc">Dask</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.11: <a href="#pg-03f4c664d0009b8284a5bb80301fe16f">Applications</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.11.1: <a href="#pg-56e94fe9e02446d78ac431c2741f68ad">Fingerprint Matching</a></li>


    
  
    
    
	
<li>1.11.2: <a href="#pg-99965c710c9d60b5429156c532c1aaf4">NIST Pedestrian and Face Detection :o2:</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.12: <a href="#pg-8350f5dc3e9f39b8831bcc3e967f8d6a">Libraries</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.12.1: <a href="#pg-fc85ba266f91bed5504eda946d07a10f">Python Modules</a></li>


    
  
    
    
	
<li>1.12.2: <a href="#pg-bb89926756a4a91092d04169d2d0e204">Data Management</a></li>


    
  
    
    
	
<li>1.12.3: <a href="#pg-00b8f84dfd350b8688408537d374d4e8">Plotting with matplotlib</a></li>


    
  
    
    
	
<li>1.12.4: <a href="#pg-3ad7884805d6063c35681edcdc0d0556">DocOpts</a></li>


    
  
    
    
	
<li>1.12.5: <a href="#pg-81d109437a2c5c48b8238286df2d1e7f">OpenCV</a></li>


    
  
    
    
	
<li>1.12.6: <a href="#pg-638e3a65dab40f4edf73225d94be8f88">Secchi Disk</a></li>


    
  

    </ul>
    
  

    </ul>
    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-b99a6cffb63733cdd376b3261c38764f">1 - Python</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-f7087b17c29b509b6f9d9a7eca3ff8f3">1.1 - Introduction to Python</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<hr>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/images/learning.png" alt=""> <strong>Learning Objectives</strong></p>
<ul>
<li>Learn quickly Python under the assumption you know a programming language</li>
<li>Work with modules</li>
<li>Understand docopts and cmd</li>
<li>Conduct some Python examples to refresh your Python knowledge</li>
<li>Learn about the <code>map</code> function in Python</li>
<li>Learn how to start subprocesses and redirect their output</li>
<li>Learn more advanced constructs such as multiprocessing and Queues</li>
<li>Understand why we do not use <code>anaconda</code></li>
<li>Get familiar with <code>venv</code></li>
</ul>
<hr>
<p>Portions of this lesson have been adapted from the <a href="https://docs.python.org/2/tutorial/">official Python
Tutorial</a> copyright <a href="http://www.python.org/">Python
Software Foundation</a>.</p>
<p>Python is an easy-to-learn programming language. It has efficient
high-level data structures and a simple but effective approach to
object-oriented programming. Python&rsquo;s simple syntax and dynamic typing,
together with its interpreted nature, make it an ideal language for
scripting and rapid application development in many areas on most
platforms. The Python interpreter and the extensive standard library are
freely available in source or binary form for all major platforms from
the Python Web site, <a href="https://www.python.org/">https://www.python.org/</a>, and may be freely
distributed. The same site also contains distributions of and pointers
to many free third-party Python modules, programs and tools, and
additional documentation. The Python interpreter can be extended with
new functions and data types implemented in C or C++ (or other languages
callable from C). Python is also suitable as an extension language for
customizable applications.</p>
<p>Python is an interpreted, dynamic, high-level programming language
suitable for a wide range of applications.</p>
<p>The philosophy of Python is summarized in <a href="https://www.python.org/dev/peps/pep-0020/">The Zen of
Python</a> as follows:</p>
<ul>
<li>Explicit is better than implicit</li>
<li>Simple is better than complex</li>
<li>Complex is better than complicated</li>
<li>Readability counts</li>
</ul>
<p>The main features of Python are:</p>
<ul>
<li>Use of indentation whitespace to indicate blocks</li>
<li>Object orient paradigm</li>
<li>Dynamic typing</li>
<li>Interpreted runtime</li>
<li>Garbage collected memory management</li>
<li>a large standard library</li>
<li>a large repository of third-party libraries</li>
</ul>
<p>Python is used by many companies and is applied for web development,
scientific computing, embedded applications, artificial intelligence,
software development, and information security, to name a few.</p>
<p>The material collected here introduces the reader to the basic concepts
and features of the Python language and system. After you have worked
through the material you will be able to:</p>
<ul>
<li>use Python</li>
<li>use the interactive Python interface</li>
<li>understand the basic syntax of Python</li>
<li>write and run Python programs</li>
<li>have an overview of the standard library</li>
<li>install Python libraries using venv for multi-Python interpreter development.</li>
</ul>
<p>This book does not attempt to be comprehensive and cover every
single feature, or even every commonly used feature. Instead, it
introduces many of Python&rsquo;s most noteworthy features and will give you
a good idea of the language&rsquo;s flavor and style. After reading it, you
will be able to read and write Python modules and programs, and you will
be ready to learn more about the various Python library modules.</p>
<p>In order to conduct this lesson you need</p>
<ul>
<li>A computer with Python 3.8.1</li>
<li>Familiarity with command line usage</li>
<li>A text editor such as <a href="https://www.jetbrains.com/pycharm/">PyCharm</a>,
emacs, vi, or others. You should identify which works best for you
and set it up.</li>
</ul>
<h2 id="references">References</h2>
<p>Some important additional information can be found on the following Web
pages.</p>
<ul>
<li><a href="https://www.python.org/">Python</a></li>
<li><a href="https://pip.pypa.io/en/stable/">Pip</a></li>
<li><a href="https://virtualenv.pypa.io/en/stable/">Virtualenv</a></li>
<li><a href="http://www.numpy.org/">NumPy</a></li>
<li><a href="https://scipy.org/">SciPy</a></li>
<li><a href="http://matplotlib.org/">Matplotlib</a></li>
<li><a href="http://pandas.pydata.org/">Pandas</a></li>
<li><a href="https://github.com/pyenv/pyenv">pyenv</a></li>
<li><a href="https://github.com/pyenv/pyenv">PyCharm</a></li>
</ul>
<p>Python module of the week is a Web site that provides a number of short
examples on how to use some elementary python modules. Not all modules
are equally useful and you should decide if there are better
alternatives. However, for beginners, this site provides a number of good
examples</p>
<ul>
<li>Python 2: <a href="https://pymotw.com/2/">https://pymotw.com/2/</a></li>
<li>Python 3: <a href="https://pymotw.com/3/">https://pymotw.com/3/</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c30e6c9733a48649f46fd4d10ab49dea">1.2 - Python Installation</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<hr>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/images/learning.png" alt=""> <strong>Learning Objectives</strong></p>
<ul>
<li>Learn how to install Python.</li>
<li>Find additional information about Python.</li>
<li>Make sure your Computer supports Python.</li>
</ul>
<hr>
<p>In this section, we explain how to install python 3.8 on a computer.
Likely much of the code will work with earlier versions, but we do
the development in Python on the newest version of Python available at
<a href="https://www.python.org/downloads">https://www.python.org/downloads</a> .</p>
<h2 id="hardware">Hardware</h2>
<p>Python does not require any special hardware. We have installed Python
not only on PC&rsquo;s and Laptops but also on Raspberry PI&rsquo;s and Lego
Mindstorms.</p>
<p>However, there are some things to consider. If you use many programs on
your desktop and run them all at the same time, you will find that in
up-to-date operating systems, you will find yourself quickly out of
memory. This is especially true if you use editors such as PyCharm, which we highly recommend. Furthermore, as you likely have lots of disk
access, make sure to use a fast HDD or better an SSD.</p>
<p>A typical modern developer PC or Laptop has <em>16GB RAM</em> and an <em>SSD</em>. You
can certainly do Python on a $35-$55 Raspberry PI, but you probably will not
be able to run PyCharm. There are many alternative editors with less
memory footprint available.</p>
<h2 id="python-39">Python 3.9</h2>
<p>Here we discuss how to install Python 3.9 or newer on your operating system. It
is typically advantageous to use a newer version of python so you can leverage
the latest features. Please be aware that many operating systems come with
older versions that may or may not work for you. YOu always can start with the
version that is installed and if you run into issues update later.</p>
<h3 id="python-39-on-macos">Python 3.9 on macOS</h3>
<p>You want a number of useful tools on your macOS. This includes git, make, and a c compiler. All this can be installed with Xcode which is
available from</p>
<ul>
<li><a href="https://apps.apple.com/us/app/xcode/id497799835">https://apps.apple.com/us/app/xcode/id497799835</a></li>
</ul>
<p>Once you have installed it, you need to install macOS XCode command-line
tools:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ xcode-select --install
</code></pre></div><p>The easiest installation of Python is to use the installation from
<a href="https://www.python.org/downloads">https://www.python.org/downloads</a>. Please, visit the page and follow the
instructions to install the python <code>.pkg</code> file. After this install, you have
python3 available from the command line.</p>
<h3 id="python-39-on-macos-via-homebrew">Python 3.9 on macOS via Homebrew</h3>
<p>Homebrew may not provide you with the newest version, so we recommend
using the install from python.org if you can.</p>
<p>An alternative installation is provided from Homebrew. To use this
install method, you need to install Homebrew first. Start the process by
installing Python 3 using <code>homebrew</code>. Install <code>homebrew</code> using the
instruction in their <a href="https://brew.sh/#install">web page</a>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ /usr/bin/ruby -e <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</code></pre></div><p>Then you should be able to install Python using:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew install python
</code></pre></div><h2 id="python-39-on-ubuntu-2004">Python 3.9 on Ubuntu 20.04</h2>
<p>The default version of Python on Ubuntu 20.04 is 3.8. However, you can benefit
from newer version while either installing them through python.org or adding
them as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt-get update
$ sudo apt install software-properties-common
$ sudo add-apt-repository ppa:deadsnakes/ppa -y
$ sudo apt-get install python3.9 python3-dev -y
</code></pre></div><p>Now you can verify the version with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3.9 --version
</code></pre></div><p>which should be <code>3.9.5</code> or newer.</p>
<p>Now we will create a new virtual environment:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3.9 -m venv --without-pip ~/ENV3
</code></pre></div><p>Now you must edit the <code>~/.bashrc</code> file and add the following line at the end:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">alias</span> <span style="color:#000">ENV3</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;source ~/ENV3/bin/activate&#34;</span>
ENV3
</code></pre></div><p>Now activate the virtual environment using:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">source</span> ~/.bashrc
</code></pre></div><p>You can install the pip for the virtual environment with the commands:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl <span style="color:#4e9a06">&#34;https://bootstrap.pypa.io/get-pip.py&#34;</span> -o <span style="color:#4e9a06">&#34;get-pip.py&#34;</span>
$ python get-pip.py
$ rm get-pip.py
$ pip install -U pip
</code></pre></div><h2 id="prerequisite-windows-10">Prerequisite Windows 10</h2>
<p>Python 3.9.5 can be installed on Windows 10 using:
<a href="https://www.python.org/downloads">https://www.python.org/downloads</a></p>
<p>Let us assume you choose the Web-based installer than you click on the
file in the edge browser (make sure the account you use has
administrative privileges). Follow the instructions that the installer
gives. Important is that you select at one point <code>[x] Add to Path</code>.
There will be an empty checkmark about this that you will click on.</p>
<p>Once it is installed chose a terminal and execute</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python --version
</code></pre></div><p>However, if you have installed conda for some reason, you need to read up on
how to install 3.9.5 Python in conda or identify how to run conda and
python.org at the same time. We often see others are giving the wrong
installation instructions. Please also be aware that when you uninstall conda
it is not sufficient t just delete it. You will have t make sure that you usnet
the system variables automatically set at install time. THi includes.
modifications on Linux and or Mac in .zprofile, .bashrc and .bash_profile. In
windows, PATH and other environment variables may have been modified.</p>
<h3 id="python-in-the-linux-subsystem">Python in the Linux Subsystem</h3>
<p>An alternative is to use Python from within the Linux Subsystem. But
that has some limitations, and you will need to explore how to access the
file system in the subsystem to have a smooth integration between your
Windows host so you can, for example, use PyCharm.</p>
<p>To activate the Linux Subsystem, please follow the instructions at</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a></li>
</ul>
<p>A suitable distribution would be</p>
<ul>
<li><a href="https://www.microsoft.com/en-us/p/ubuntu-1804-lts/9n9tngvndl3q?activetab=pivot:overviewtab">https://www.microsoft.com/en-us/p/ubuntu-1804-lts/9n9tngvndl3q?activetab=pivot:overviewtab</a></li>
</ul>
<p>However, as it may use an older version of Python, you may want to update
it as previously discussed</p>
<h2 id="using-venv">Using venv</h2>
<p>This step is needed if you have not yet already installed a
<code>venv</code> for Python to make sure you are not interfering with your system
python. Not using a venv could have catastrophic consequences and the
destruction of your operating system tools if they really on Python. The
use of <code>venv</code> is simple. For our purposes we assume that you use the
directory:</p>
<pre><code>~/ENV3
</code></pre>
<p>Follow these steps first:</p>
<p>First cd to your home directory. Then execute</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 -m venv  ~/ENV3
$ <span style="color:#204a87">source</span> ~/ENV3/bin/activate
</code></pre></div><p>You can add at the end of your <code>.bashrc</code> (ubuntu) or <code>.bash_profile</code> or
.zprofile` (macOS) file the line</p>
<p>If you like to activate it when you start a new terminal, please add
this line to your <code>.bashrc</code> or <code>.bash_profile</code> or .zprofile` file.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">source</span> ~/ENV3/bin/activate
</code></pre></div><p>so the environment is always loaded. Now you are ready to install
Cloudmesh.</p>
<p>Check if you have the right version of Python installed with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python --version
</code></pre></div><p>To make sure you have an up to date version of pip issue the command</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install pip -U
</code></pre></div><h2 id="install-python-39-via-anaconda">Install Python 3.9 via Anaconda</h2>
<p>We are not recommending ether to use conda or anaconda. If you do
so, it is your responsibility to update the information in this
section in regards to it.</p>
<p>:o2: We will check your python installation, and if
you use conda and anaconda you need to work on completing this section.</p>
<h3 id="download-conda-installer">Download <code>conda</code> installer</h3>
<p>Miniconda is recommended here. Download an installer for Windows, macOS,
and Linux from this page: <a href="https://docs.conda.io/en/latest/miniconda.html">https://docs.conda.io/en/latest/miniconda.html</a></p>
<h3 id="install-conda">Install <code>conda</code></h3>
<p>Follow instructions to install <code>conda</code> for your operating systems:</p>
<ul>
<li>Windows. <a href="https://conda.io/projects/conda/en/latest/user-guide/install/windows.html">https://conda.io/projects/conda/en/latest/user-guide/install/windows.html</a></li>
<li>macOS. <a href="https://conda.io/projects/conda/en/latest/user-guide/install/macos.html">https://conda.io/projects/conda/en/latest/user-guide/install/macos.html</a></li>
<li>Linux. <a href="https://conda.io/projects/conda/en/latest/user-guide/install/linux.html">https://conda.io/projects/conda/en/latest/user-guide/install/linux.html</a></li>
</ul>
<h3 id="install-python-via-conda">Install Python via <code>conda</code></h3>
<p>To install Python 3.9.5 in a virtual environment with conda please use</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">cd</span> ~
$ conda create -n ENV3 <span style="color:#000">python</span><span style="color:#ce5c00;font-weight:bold">=</span>3.9.5
$ conda activate ENV3
$ conda install -c anaconda pip
$ conda deactivate ENV3
</code></pre></div><p>It is very important to make sure you have a newer version of pip installed.
After you installed and created the ENV3 you need to activate it. This
can be done with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ conda activate ENV3
</code></pre></div><p>If you like to activate it when you start a new terminal, please add
this line to your <code>.bashrc</code> or <code>.bash_profile</code></p>
<p>If you use zsh please add it to <code>.zprofile</code> instead.</p>
<h2 id="version-test">Version test</h2>
<p>Regardless of which version you install, you must do a version test to make
sure you have the correct python and pip versions:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python --version
$ pip --version
</code></pre></div><p>If you installed everything correctly you should see</p>
<pre><code>Python 3.9.5
pip 21.1.2
</code></pre>
<p>or newer.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dec9441ee9947161838209b79bbfaa2c">1.3 - Interactive Python</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>Python can be used interactively. You can enter the interactive mode by
entering the interactive loop by executing the command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python
</code></pre></div><p>You will see something like the following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a40000">$</span> <span style="color:#000">python</span>
<span style="color:#000">Python</span> <span style="color:#0000cf;font-weight:bold">3.9</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">v3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#0000cf;font-weight:bold">9.5</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000">a7dcbdb13</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">May</span>  <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#0000cf;font-weight:bold">2021</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">17</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">02</span><span style="color:#000;font-weight:bold">)</span> 
<span style="color:#000;font-weight:bold">[</span><span style="color:#000">Clang</span> <span style="color:#0000cf;font-weight:bold">6.0</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">clang</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">600.0</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#0000cf;font-weight:bold">57</span><span style="color:#000;font-weight:bold">)]</span> <span style="color:#000">on</span> <span style="color:#000">darwin</span>
<span style="color:#000">Type</span> <span style="color:#4e9a06">&#34;help&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;copyright&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;credits&#34;</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#4e9a06">&#34;license&#34;</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">more</span> <span style="color:#000">information</span><span style="color:#ce5c00;font-weight:bold">.</span>
<span style="color:#ce5c00;font-weight:bold">&gt;&gt;&gt;</span>
</code></pre></div><p>The <code>&gt;&gt;&gt;</code> is the prompt used by the interpreter. This is similar to bash
where commonly <code>$</code> is used.</p>
<p>Sometimes it is convenient to show the prompt when illustrating an
example. This is to provide some context for what we are doing. If you
are following along you will not need to type in the prompt.</p>
<p>This interactive python process does the following:</p>
<ul>
<li><em>read</em> your input commands</li>
<li><em>evaluate</em> your command</li>
<li><em>print</em> the result of the evaluation</li>
<li><em>loop</em> back to the beginning.</li>
</ul>
<p>This is why you may see the interactive loop referred to as a <strong>REPL</strong>:
<strong>R</strong>ead-<strong>E</strong>valuate-<strong>P</strong>rint-<strong>L</strong>oop.</p>
<h2 id="repl-read-eval-print-loop">REPL (Read Eval Print Loop)</h2>
<p>There are many different types beyond what we have seen so far, such as
<strong>dictionaries</strong>s, <strong>list</strong>s, <strong>set</strong>s. One handy way of using the
interactive python is to get the type of a value using type():</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">type</span> <span style="color:#4e9a06">&#39;int&#39;</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
<span style="color:#ce5c00;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;hello&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">type</span> <span style="color:#4e9a06">&#39;str&#39;</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
<span style="color:#ce5c00;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3.14</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">type</span> <span style="color:#4e9a06">&#39;float&#39;</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
</code></pre></div><p>You can also ask for help about something using help():</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#000">help</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#000">help</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#000">help</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Using help() opens up a help message within a pager. To navigate you can
use the spacebar to go down a page w to go up a page, the arrow keys to
go up/down line-by-line, or q to exit.</p>
<h2 id="interpreter">Interpreter</h2>
<p>Although the interactive mode provides a convenient tool to test
things out you will see quickly that for our class we want to use the
python interpreter from the command line. Let us assume the program is
called <code>prg.py</code>. Once you have written it in that file you simply can call it with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python prg.py
</code></pre></div><p>It is important to name the program with meaningful names.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ff9477ccc979e5caf8526fbcf779f8e2">1.4 - Editors</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>This section is meant to give an overview of the Python editing tools
needed for completing this course. There are many other alternatives;
however, we do recommend using PyCharm.</p>
<h2 id="pycharm">PyCharm</h2>
<p>PyCharm is an Integrated Development Environment (IDE) used for
programming in Python. It provides code analysis, a graphical debugger,
an integrated unit tester, and integration with git.</p>
<p><a href="https://youtu.be/X8ZpbZweJcw"><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/images/video.png" alt="Video"> Python 8:56 Pycharm</a></p>
<p>[Video</p>
<h2 id="python-in-45-minutes">Python in 45 minutes</h2>
<p>Next is an additional community YouTube video about the Python
programming language. Naturally, there are many alternatives to this
video, but it is probably a good start. It also uses PyCharm
which we recommend.</p>
<p><a href="https://www.youtube.com/watch?v=N4mEzFDjqtA"><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/images/video.png" alt="Video"> Python 43:16 PyCharm</a></p>
<p>[Video</p>
<p>How much you want to understand Python is a bit up to you.
While it is good to know classes and inheritance, you may be able
to get away without using it for this class. However, we do recommend
that you learn it.</p>
<p>PyCharm Installation:</p>
<p>Method 1: Download and install it from the PyCharm website. This is easy and if
no automated install is required we recommend this method. Students and
teachers can apply for a free professional version. Please note that Jupyter
notebooks can only be viewed in the professional version.</p>
<p>Method 2: PyCharm Installation on ubuntu using umake</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a40000">$</span> <span style="color:#000">sudo</span> <span style="color:#000">add</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">apt</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">repository</span> <span style="color:#000">ppa</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">ubuntu</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">desktop</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">ubuntu</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">make</span>
<span style="color:#a40000">$</span> <span style="color:#000">sudo</span> <span style="color:#000">apt</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">get</span> <span style="color:#000">update</span>
<span style="color:#a40000">$</span> <span style="color:#000">sudo</span> <span style="color:#000">apt</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">get</span> <span style="color:#000">install</span> <span style="color:#000">ubuntu</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">make</span>
</code></pre></div><p>Once the <code>umake</code> command is installed, use the next command to install PyCharm community edition:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a40000">$</span> <span style="color:#000">umake</span> <span style="color:#000">ide</span> <span style="color:#000">pycharm</span>
</code></pre></div><p>If you want to remove PyCharm installed using umake command, use this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a40000">$</span> <span style="color:#000">umake</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">r</span> <span style="color:#000">ide</span> <span style="color:#000">pycharm</span>
</code></pre></div><p>Method 2: PyCharm installation on ubuntu using PPA</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a40000">$</span> <span style="color:#000">sudo</span> <span style="color:#000">add</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">apt</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">repository</span> <span style="color:#000">ppa</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">mystic</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">mirage</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">pycharm</span>
<span style="color:#a40000">$</span> <span style="color:#000">sudo</span> <span style="color:#000">apt</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">get</span> <span style="color:#000">update</span>
<span style="color:#a40000">$</span> <span style="color:#000">sudo</span> <span style="color:#000">apt</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">get</span> <span style="color:#000">install</span> <span style="color:#000">pycharm</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">community</span>
</code></pre></div><p>PyCharm also has a Professional (paid) version that can be installed
using the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a40000">$</span> <span style="color:#000">sudo</span> <span style="color:#000">apt</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">get</span> <span style="color:#000">install</span> <span style="color:#000">pycharm</span>
</code></pre></div><p>Once installed, go to your VM dashboard and search for PyCharm.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fee9682b4120ebc90d96dc4e959e857b">1.5 - Google Colab</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>In this section, we are going to introduce you, how to use Google Colab
to run deep learning models.</p>
<h2 id="introduction-to-google-colab">Introduction to Google Colab</h2>
<p>This video contains the introduction to Google Colab. In this section we
will be learning how to start a Google Colab project.</p>
<p><a href="https://drive.google.com/file/d/1vz2_VaXCAae-9luzcrIuP_ugMmKJIy7w/view?usp=sharing"><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/google-colab/images/colab-1.png" alt="Video">{width=&ldquo;20%&quot;}</a></p>
<p>[Video</p>
<h2 id="programming-in-google-colab">Programming in Google Colab</h2>
<p>In this video, we will learn how to create a simple, Colab Notebook.</p>
<p>Required Installations</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install numpy
</code></pre></div><p><a href="https://drive.google.com/file/d/18mGVxgydx1TDdb4AYD8qb1To8rkSLS-H/view?usp=sharing"><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/google-colab/images/colab-2.png" alt="Video">{width=&ldquo;20%&quot;}</a></p>
<p>[Video</p>
<h2 id="benchmarking-in-google-colab-with-cloudmesh">Benchmarking in Google Colab with Cloudmesh</h2>
<p>In this video, we learn how to do a basic benchmark with Cloudmesh tools.
Cloudmesh StopWatch will be used in this tutorial.</p>
<p>Required Installations</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install numpy
pip install cloudmesh-installer
pip install cloudmesh-common
</code></pre></div><p><a href="https://drive.google.com/file/d/1Ujs0XjzCTwZgmx-ADM5zx9cS5iplXfIu/view?usp=sharing"><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/google-colab/images/colab-3.png" alt="Video">{width=&ldquo;20%&quot;}</a></p>
<p>[Video</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7fabf78b46e5bb7bd617b3e8bf1a0fe2">1.6 - Language</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<h2 id="statements-and-strings">Statements and Strings</h2>
<p>Let us explore the syntax of Python while starting with a print statement</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello world from Python!&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>This will print on the terminal</p>
<pre><code>Hello world from Python!
</code></pre>
<p>The print function was given a <strong>string</strong> to process. A string is a
sequence of characters. A <strong>character</strong> can be an alphabetic (A through
Z, lower and upper case), numeric (any of the digits), white space
(spaces, tabs, newlines, etc), syntactic directives (comma, colon,
quotation, exclamation, etc), and so forth. A string is just a sequence
of the character and typically indicated by surrounding the characters
in double-quotes.</p>
<p>Standard output is discussed in the <a href="#linux">Section Linux</a>.</p>
<p>So, what happened when you pressed Enter? The interactive Python program
read the line <code>print (&quot;Hello world from Python!&quot;)</code>, split it into the
print statement and the <code>&quot;Hello world from Python!&quot;</code> string, and then
executed the line, showing you the output.</p>
<h2 id="comments">Comments</h2>
<p>Comments in Python are followed by a <code>#</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># This is a comment</span>
</code></pre></div><h2 id="variables">Variables</h2>
<p>You can store data into a <strong>variable</strong> to access it later. For instance:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">hello</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;Hello world from Python!&#39;</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">hello</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>This will print again</p>
<pre><code>Hello world from Python!
</code></pre>
<h2 id="data-types">Data Types</h2>
<h3 id="booleans">Booleans</h3>
<p>A <strong>boolean</strong> is a value that can have the values <code>True</code> or <code>False</code>. You
can combine booleans with <strong>boolean operators</strong> such as <code>and</code> and <code>or</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># True</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># False</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">False</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># False</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># True</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># True</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">False</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># False</span>
</code></pre></div><h3 id="numbers">Numbers</h3>
<p>The interactive interpreter can also be used as a calculator. For
instance, say we wanted to compute a multiple of 21:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">21</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># 42</span>
</code></pre></div><p>We saw here the print statement again. We passed in the result of the
operation 21 * 2. An <strong>integer</strong> (or <strong>int</strong>) in Python is a numeric
value without a fractional component (those are called <strong>floating
point</strong> numbers, or <strong>float</strong> for short).</p>
<p>The mathematical operators compute the related mathematical operation to
the provided numbers. Some operators are:</p>
<p>Operator   Function</p>
<hr>
<p>*         multiplication<br>
/          division      <br>
+         addition      <br>
-         subtraction   <br>
**       exponent</p>
<p>Exponentiation $x^y$ is written as x**y is x to the yth power.</p>
<p>You can combine <strong>float</strong>s and <strong>int</strong>s:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3.14</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">42</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">11</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># 13.9890909091</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># 8</span>
</code></pre></div><p>Note that <strong>operator precedence</strong> is important. Using parenthesis to
indicate affect the order of operations gives a difference results, as
expected:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3.14</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">42</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">11</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># 11.42</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">5.0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># 6.2</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">5.0</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># -0.6</span>
</code></pre></div><h2 id="module-management">Module Management</h2>
<p>A module allows you to logically organize your Python code. Grouping
related code into a module makes the code easier to understand and use.
A module is a Python object with arbitrarily named attributes that you
can bind and reference. A module is a file consisting of Python code. A
module can define functions, classes, and variables. A module can also
include runnable code.</p>
<h3 id="import-statement">Import Statement</h3>
<p>When the interpreter encounters an import statement, it imports the
module if the module is present in the search path. A search path is a
list of directories that the interpreter searches before importing a
module. The from&hellip;import Statement Python&rsquo;s from statement lets you
import specific attributes from a module into the current namespace. It
is preferred to use for each import its own line such as:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib</span>
</code></pre></div><p>When the interpreter encounters an import statement, it imports the
module if the module is present in the search path. A search path is a
list of directories that the interpreter searches before importing a
module.</p>
<h3 id="the-from--import-statement">The from &hellip; import Statement</h3>
<p>Python&rsquo;s from statement lets you import specific attributes from a
module into the current namespace. The from &hellip; import has the following
syntax:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datetime</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datetime</span>
</code></pre></div><h2 id="date-time-in-python">Date Time in Python</h2>
<p>The <code>datetime</code> module supplies classes for manipulating dates and times in
both simple and complex ways. While date and time arithmetic is
supported, the focus of the implementation is on efficient attribute
extraction for output formatting and manipulation. For related
functionality, see also the time and calendar modules.</p>
<p>The import Statement You can use any Python source file as a module by
executing an import statement in some other Python source file.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datetime</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datetime</span>
</code></pre></div><p>This module offers a generic date/time string parser which is able to
parse most known formats to represent a date and/or time.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">dateutil.parser</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">parse</span>
</code></pre></div><p>pandas is an open-source Python library for data analysis that needs to
be imported.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pandas</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">pd</span>
</code></pre></div><p>Create a string variable with the class start time</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">fall_start</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;08-21-2018&#39;</span>
</code></pre></div><p>Convert the string to datetime format</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strptime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fall_start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;%m-</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">-%Y&#39;</span><span style="color:#000;font-weight:bold">)</span> \<span style="color:#8f5902;font-style:italic">#</span>
<span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">datetime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2017</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">21</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Creating a list of strings as dates</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">class_dates</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;8/25/2017&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/1/2017&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/8/2017&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/15/2017&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/22/2017&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/29/2017&#39;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>Convert Class_dates strings into <code>datetime</code> format and save the list into
variable a</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strptime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;%m/</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">/%Y&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">x</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">class_dates</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>Use parse() to attempt to auto-convert common string formats. Parser
must be a string or character stream, not list.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fall_start</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># datetime.datetime(2017, 8, 21, 0, 0)</span>
</code></pre></div><p>Use parse() on every element of the Class_dates string.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">[</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">x</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">class_dates</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># [datetime.datetime(2017, 8, 25, 0, 0),</span>
<span style="color:#8f5902;font-style:italic">#  datetime.datetime(2017, 9, 1, 0, 0),</span>
<span style="color:#8f5902;font-style:italic">#  datetime.datetime(2017, 9, 8, 0, 0),</span>
<span style="color:#8f5902;font-style:italic">#  datetime.datetime(2017, 9, 15, 0, 0),</span>
<span style="color:#8f5902;font-style:italic">#  datetime.datetime(2017, 9, 22, 0, 0),</span>
<span style="color:#8f5902;font-style:italic">#  datetime.datetime(2017, 9, 29, 0, 0)]</span>
</code></pre></div><p>Use parse, but designate that the day is first.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">parse</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">fall_start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dayfirst</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># datetime.datetime(2017, 8, 21, 0, 0)</span>
</code></pre></div><p>Create a <code>dataframe</code>. A DataFrame is a tabular data structure comprised of
rows and columns, akin to a spreadsheet, database table. DataFrame is a
group of Series objects that share an index (the column names).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pandas</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">pd</span>
<span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#39;dates&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;8/25/2017 18:47:05.069722&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/1/2017 18:47:05.119994&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/8/2017 18:47:05.178768&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/15/2017 18:47:05.230071&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/22/2017 18:47:05.230071&#39;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;9/29/2017 18:47:05.280592&#39;</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#4e9a06">&#39;complete&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]}</span>
<span style="color:#000">df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DataFrame</span><span style="color:#000;font-weight:bold">(</span>
  <span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#000">columns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;dates&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;complete&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">df</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">#                  dates  complete</span>
<span style="color:#8f5902;font-style:italic">#  0  8/25/2017 18:47:05.069722 1</span>
<span style="color:#8f5902;font-style:italic">#  1   9/1/2017 18:47:05.119994 0</span>
<span style="color:#8f5902;font-style:italic">#  2   9/8/2017 18:47:05.178768 1</span>
<span style="color:#8f5902;font-style:italic">#  3  9/15/2017 18:47:05.230071 1</span>
<span style="color:#8f5902;font-style:italic">#  4  9/22/2017 18:47:05.230071 0</span>
<span style="color:#8f5902;font-style:italic">#  5  9/29/2017 18:47:05.280592 1</span>
</code></pre></div><p>Convert <code>df[`date`]</code> from string to datetime</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pandas</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">pd</span>
<span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">to_datetime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;dates&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#8f5902;font-style:italic"># 0   2017-08-25 18:47:05.069722</span>
<span style="color:#8f5902;font-style:italic"># 1   2017-09-01 18:47:05.119994</span>
<span style="color:#8f5902;font-style:italic"># 2   2017-09-08 18:47:05.178768</span>
<span style="color:#8f5902;font-style:italic"># 3   2017-09-15 18:47:05.230071</span>
<span style="color:#8f5902;font-style:italic"># 4   2017-09-22 18:47:05.230071</span>
<span style="color:#8f5902;font-style:italic"># 5   2017-09-29 18:47:05.280592</span>
<span style="color:#8f5902;font-style:italic"># Name: dates, dtype: datetime64[ns]</span>
</code></pre></div><h2 id="control-statements">Control Statements</h2>
<h3 id="comparison">Comparison</h3>
<p>Computer programs do not only execute instructions. Occasionally, a
choice needs to be made. Such as a choice is based on a condition.
Python has several conditional operators:</p>
<p>Operator   Function</p>
<hr>
<p>&gt;         greater than<br>
&lt;         smaller than<br>
==         equals      <br>
!=         is not</p>
<p>Conditions are always combined with variables. A program can make a
choice using the if keyword. For example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Guess x:&#34;</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">:</span>
   <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Correct!&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>In this example, <em>You guessed correctly!</em> will only be printed if the
variable x equals four. Python can also execute
multiple conditions using the <code>elif</code> and <code>else</code> keywords.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Guess x:&#34;</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Correct!&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Wrong, but close!&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Wrong, way off!&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="iteration">Iteration</h3>
<p>To repeat code, the <code>for</code> keyword can be used. For example, to display the
numbers from 1 to 10, we could write something like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">11</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Hello!&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The second argument to the <code>range</code>, <em>11</em>, is not inclusive, meaning that the
loop will only get to <em>10</em> before it finishes. Python itself starts
counting from 0, so this code will also work:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>In fact, the range function defaults to starting value of <em>0</em>, so it
is equivalent to:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>We can also nest loops inside each other:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39; &#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>In this case, we have two nested loops. The code will iterate over the
entire coordinate range (0,0) to (9,9)</p>
<h2 id="datatypes">Datatypes</h2>
<h3 id="lists">Lists</h3>
<p>see: <a href="https://www.tutorialspoint.com/python/python_lists.htm">https://www.tutorialspoint.com/python/python_lists.htm</a></p>
<p>Lists in Python are ordered sequences of elements, where each element
can be accessed using a 0-based index.</p>
<p>To define a list, you simply list its elements between square brackets
&lsquo;[ ]':</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
  <span style="color:#4e9a06">&#39;Albert&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;Jane&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;Liz&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;John&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;Abby&#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># access the first element of the list</span>
<span style="color:#000">names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># &#39;Albert&#39;</span>
<span style="color:#8f5902;font-style:italic"># access the third element of the list</span>
<span style="color:#000">names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># &#39;Liz&#39;</span>
</code></pre></div><p>You can also use a negative index if you want to start counting elements
from the end of the list. Thus, the last element has index <em>-1</em>, the
second before the last element has index <em>-2</em> and so on:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># access the last element of the list</span>
<span style="color:#000">names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># &#39;Abby&#39;</span>
<span style="color:#8f5902;font-style:italic"># access the second last element of the list</span>
<span style="color:#000">names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># &#39;John&#39;</span>
</code></pre></div><p>Python also allows you to take whole slices of the list by specifying a
beginning and end of the slice separated by a colon</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># the middle elements, excluding first and last</span>
<span style="color:#000">names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># [&#39;Jane&#39;, &#39;Liz&#39;, &#39;John&#39;]</span>
</code></pre></div><p>As you can see from the example, the starting index in the slice
is inclusive and the ending one, exclusive.</p>
<p>Python provides a variety of methods for manipulating the members of a
list.</p>
<p>You can add elements with append&rsquo;:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Liz&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">names</span>
<span style="color:#8f5902;font-style:italic"># [&#39;Albert&#39;, &#39;Jane&#39;, &#39;Liz&#39;,</span>
<span style="color:#8f5902;font-style:italic">#  &#39;John&#39;, &#39;Abby&#39;, &#39;Liz&#39;]</span>
</code></pre></div><p>As you can see, the elements in a list need not be unique.</p>
<p>Merge two lists with &lsquo;extend&rsquo;:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">extend</span><span style="color:#000;font-weight:bold">([</span><span style="color:#4e9a06">&#39;Lindsay&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Connor&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#000">names</span>
<span style="color:#8f5902;font-style:italic"># [&#39;Albert&#39;, &#39;Jane&#39;, &#39;Liz&#39;, &#39;John&#39;,</span>
<span style="color:#8f5902;font-style:italic">#  &#39;Abby&#39;, &#39;Liz&#39;, &#39;Lindsay&#39;, &#39;Connor&#39;]</span>
</code></pre></div><p>Find the index of the first occurrence of an element with &lsquo;index&rsquo;:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">index</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Liz&#39;</span><span style="color:#000;font-weight:bold">)</span> \<span style="color:#8f5902;font-style:italic"># 2</span>
</code></pre></div><p>Remove elements by value with &lsquo;remove&rsquo;:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">remove</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Abby&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">names</span>
<span style="color:#8f5902;font-style:italic"># [&#39;Albert&#39;, &#39;Jane&#39;, &#39;Liz&#39;, &#39;John&#39;,</span>
<span style="color:#8f5902;font-style:italic">#  &#39;Liz&#39;, &#39;Lindsay&#39;, &#39;Connor&#39;]</span>
</code></pre></div><p>Remove elements by index with &lsquo;pop&rsquo;:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># &#39;Jane&#39;</span>
<span style="color:#000">names</span>
<span style="color:#8f5902;font-style:italic"># [&#39;Albert&#39;, &#39;Liz&#39;, &#39;John&#39;,</span>
<span style="color:#8f5902;font-style:italic">#  &#39;Liz&#39;, &#39;Lindsay&#39;, &#39;Connor&#39;]</span>
</code></pre></div><p>Notice that pop returns the element being removed, while remove does
not.</p>
<p>If you are familiar with stacks from other programming languages, you
can use insert and &lsquo;pop&rsquo;:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">insert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Lincoln&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">names</span>
<span style="color:#8f5902;font-style:italic"># [&#39;Lincoln&#39;, &#39;Albert&#39;, &#39;Liz&#39;,</span>
<span style="color:#8f5902;font-style:italic">#  &#39;John&#39;, &#39;Liz&#39;, &#39;Lindsay&#39;, &#39;Connor&#39;]</span>
<span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#8f5902;font-style:italic"># &#39;Connor&#39;</span>
<span style="color:#000">names</span>
<span style="color:#8f5902;font-style:italic"># [&#39;Lincoln&#39;, &#39;Albert&#39;, &#39;Liz&#39;,</span>
<span style="color:#8f5902;font-style:italic">#  &#39;John&#39;, &#39;Liz&#39;, &#39;Lindsay&#39;]</span>
</code></pre></div><p>The Python documentation contains a <a href="">full list of list operations</a>.</p>
<p>To go back to the range function you used earlier, it simply creates a
list of numbers:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
<span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># [2, 4, 6, 8]</span>
</code></pre></div><h3 id="sets">Sets</h3>
<p>Python lists can contain duplicates as you saw previously:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Albert&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Jane&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Liz&#39;</span><span style="color:#000;font-weight:bold">,</span>
         <span style="color:#4e9a06">&#39;John&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Abby&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Liz&#39;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>When we do not want this to be the case, we can use a
<a href="https://docs.python.org/2/library/stdtypes.html#set">set</a>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">unique_names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">unique_names</span>
<span style="color:#8f5902;font-style:italic"># set([&#39;Lincoln&#39;, &#39;John&#39;, &#39;Albert&#39;, &#39;Liz&#39;, &#39;Lindsay&#39;])</span>
</code></pre></div><p>Keep in mind that the <em>set</em> is an unordered collection of objects, thus
we can not access them by index:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">unique_names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># Traceback (most recent call last):</span>
<span style="color:#8f5902;font-style:italic">#   File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;</span>
<span style="color:#8f5902;font-style:italic">#   TypeError: &#39;set&#39; object does not support indexing</span>
</code></pre></div><p>However, we can convert a set to a list easily:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">unique_names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">unique_names</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">unique_names</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">`Lincoln&#39;, `</span><span style="color:#000">John</span><span style="color:#4e9a06">&#39;, `Albert&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`Liz&#39;, `</span><span style="color:#000">Lindsay</span><span style="color:#4e9a06">&#39;]</span>
<span style="color:#000">unique_names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># `Lincoln&#39;</span>
</code></pre></div><p>Notice that in this case, the order of elements in the new list matches
the order in which the elements were displayed when we create the set.
We had</p>
<p><code>set(['Lincoln', 'John', 'Albert', 'Liz', 'Lindsay'])</code></p>
<p>and now we have</p>
<p><code>['Lincoln', 'John', 'Albert', 'Liz', 'Lindsay'])</code></p>
<p>You should not assume this is the case in general. That is, do not make
any assumptions about the order of elements in a set when it is
converted to any type of sequential data structure.</p>
<p>You can change a set&rsquo;s contents using the add, remove and update methods
which correspond to the append, remove and extend methods in a list. In
addition to these, <em>set</em> objects support the operations you may be
familiar with from mathematical sets: <em>union</em>, <em>intersection</em>,
<em>difference</em>, as well as operations to check containment. You can read
about this in the <a href="https://docs.python.org/2/library/stdtypes.html#set">Python documentation for
sets</a>.</p>
<h3 id="removal-and-testing-for-membership-in-sets">Removal and Testing for Membership in Sets</h3>
<p>One important advantage of a <code>set</code> over a <code>list</code> is that <strong>access to
elements is fast</strong>. If you are familiar with different data structures
from a Computer Science class, the Python list is implemented by an
array, while the set is implemented by a hash table.</p>
<p>We will demonstrate this with an example. Let us say we have a list and a
set of the same number of elements (approximately 100 thousand):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">timeit</span>
<span style="color:#000">nums_set</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">set</span><span style="color:#000;font-weight:bold">([</span><span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">randint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">maxint</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)])</span>
<span style="color:#000">nums_list</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nums_set</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nums_set</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># 100000</span>
</code></pre></div><p>We will use the <a href="https://docs.python.org/2/library/timeit.html">timeit</a>
Python module to time 100 operations that test for the existence of a
member in either the list or set:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">timeit</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timeit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;random.randint(0, sys.maxint) in nums&#39;</span><span style="color:#000;font-weight:bold">,</span>
              <span style="color:#000">setup</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;import random; nums=</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nums_set</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">number</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># 0.0004038810729980469</span>
<span style="color:#000">timeit</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">timeit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;random.randint(0, sys.maxint) in nums&#39;</span><span style="color:#000;font-weight:bold">,</span>
              <span style="color:#000">setup</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;import random; nums=</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nums_list</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">number</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># 0.398054122924804</span>
</code></pre></div><p>The exact duration of the operations on your system will be different,
but the takeaway will be the same: searching for an element in a set is
orders of magnitude faster than in a list. This is important to keep in
mind when you work with large amounts of data.</p>
<h3 id="dictionaries">Dictionaries</h3>
<p>One of the very important data structures in python is a dictionary also
referred to as <code>dict</code>.</p>
<p>A dictionary represents a key value store:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">computer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;mycomputer&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;memory&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;kind&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Laptop&#39;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;computer[&#39;name&#39;]: &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">computer</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#8f5902;font-style:italic"># computer[&#39;name&#39;]:  mycomputer</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;computer[&#39;memory&#39;]: &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">computer</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;memory&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#8f5902;font-style:italic"># computer[&#39;Age&#39;]:  16</span>
</code></pre></div><p>A convenient for to print by named attributes is</p>
<pre><code>print(&quot;{name} {memory}'.format(**computer))
</code></pre>
<p>This form of printing with the format statement and a reference to data
increases the readability of the print statements.</p>
<p>You can delete elements with the following commands:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">del</span> <span style="color:#000">computer</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#8f5902;font-style:italic"># remove entry with key &#39;name&#39;</span>
<span style="color:#8f5902;font-style:italic"># computer</span>
<span style="color:#8f5902;font-style:italic"># </span>
<span style="color:#000">computer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">clear</span><span style="color:#000;font-weight:bold">()</span>     <span style="color:#8f5902;font-style:italic"># remove all entries in dict</span>
<span style="color:#8f5902;font-style:italic"># computer</span>
<span style="color:#8f5902;font-style:italic"># </span>
<span style="color:#204a87;font-weight:bold">del</span> <span style="color:#000">computer</span>         <span style="color:#8f5902;font-style:italic"># delete entire dictionary</span>
<span style="color:#8f5902;font-style:italic"># computer</span>
<span style="color:#8f5902;font-style:italic"># Traceback (most recent call last):</span>
<span style="color:#8f5902;font-style:italic">#  File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;</span>
<span style="color:#8f5902;font-style:italic">#  NameError: name &#39;computer&#39; is not defined</span>
</code></pre></div><p>You can iterate over a dict:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">computer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;mycomputer&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;memory&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;kind&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Laptop&#39;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">item</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">computer</span><span style="color:#000;font-weight:bold">:</span>
  <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">computer</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#8f5902;font-style:italic"># name mycomputer</span>
<span style="color:#8f5902;font-style:italic"># memory 16</span>
<span style="color:#8f5902;font-style:italic"># kind laptop</span>
</code></pre></div><h3 id="dictionary-keys-and-values">Dictionary Keys and Values</h3>
<p>You can retrieve both the keys and values of a dictionary using the
keys() and values() methods of the dictionary, respectively:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">computer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">keys</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#8f5902;font-style:italic"># [&#39;name&#39;, &#39;memory&#39;, &#39;kind&#39;]</span>
<span style="color:#000">computer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">values</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#8f5902;font-style:italic"># [&#39;mycomputer&#39;, &#39;memory&#39;, &#39;kind&#39;]</span>
</code></pre></div><p>Both methods return lists. Please remember howver that the keys and
order in which the elements are returned are not necessarily the same.
It is important to keep this in
mind:</p>
<blockquote>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/images/warning.png" alt=""> *You cannot</p>
</blockquote>
<p>![</p>
<blockquote>
<p>make any assumptions about the order in which
the elements of a dictionary will be returned by the keys() and
values() methods*.</p>
</blockquote>
<p>However, you can assume that if you call <code>keys()</code> and <code>values()</code> in
sequence, the order of elements will at least correspond in both
methods.</p>
<h3 id="counting-with-dictionaries">Counting with Dictionaries</h3>
<p>One application of dictionaries that frequently comes up is counting the
elements in a sequence. For example, say we have a sequence of coin
flips:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
<span style="color:#000">die_rolls</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
  <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">choice</span><span style="color:#000;font-weight:bold">([</span><span style="color:#4e9a06">&#39;heads&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;tails&#39;</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># die_rolls</span>
<span style="color:#8f5902;font-style:italic"># [&#39;heads&#39;, &#39;tails&#39;, &#39;heads&#39;,</span>
<span style="color:#8f5902;font-style:italic">#  &#39;tails&#39;, &#39;heads&#39;, &#39;heads&#39;,</span>
   <span style="color:#4e9a06">&#39;tails&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;heads&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;heads&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;heads&#39;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>The actual list die_rolls will likely be different when you execute
this on your computer since the outcomes of the die rolls are random.</p>
<p>To compute the probabilities of heads and tails, we could count how many
heads and tails we have in the list:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">counts</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;heads&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;tails&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">}</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">outcome</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">die_rolls</span><span style="color:#000;font-weight:bold">:</span>
   <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">outcome</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">counts</span>
   <span style="color:#000">counts</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">outcome</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Probability of heads: </span><span style="color:#4e9a06">%.2f</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">counts</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;heads&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">die_rolls</span><span style="color:#000;font-weight:bold">)))</span>
<span style="color:#8f5902;font-style:italic"># Probability of heads: 0.70</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Probability of tails: </span><span style="color:#4e9a06">%.2f</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">counts</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;tails&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">counts</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">values</span><span style="color:#000;font-weight:bold">())))</span>
<span style="color:#8f5902;font-style:italic"># Probability of tails: 0.30</span>
</code></pre></div><p>In addition to how we use the dictionary counts to count the elements of
coin_flips, notice a couple of things about this example:</p>
<ol>
<li>
<p>We used the assert outcome in the <code>count</code> statement. The assert statement
in Python allows you to easily insert debugging statements in your
code to help you discover errors more quickly. assert statements are
executed whenever the internal Python <code>__debug__</code> variable is set
to True, which is always the case unless you start Python with the
-O option which allows you to run <em>optimized</em> Python.</p>
</li>
<li>
<p>When we computed the probability of tails, we used the built-in <code>sum</code> function, which allowed us to quickly find the total number of coin flips. The <code>sum</code> is one of many built-in functions you can <a href="https://docs.python.org/2/library/functions.html">read about
here</a>.</p>
</li>
</ol>
<h2 id="functions">Functions</h2>
<p>You can reuse code by putting it inside a function that you can call in
other parts of your programs. Functions are also a good way of grouping
code that logically belongs together in one coherent whole. A function
has a unique name in the program. Once you call a function, it will
execute its body which consists of one or more lines of code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">check_triangle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">):</span>
<span style="color:#204a87;font-weight:bold">return</span> \
    <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">and</span> \
    <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">and</span> \
    <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">check_triangle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>The def keyword tells Python we are defining a function. As part of the
definition, we have the function name, check_triangle, and the
parameters of the function &ndash; variables that will be populated when the function is called.</p>
<p>We call the function with arguments 4, 5, and 6, which are passed in
order into the parameters a, b, and c. A function can be called several
times with varying parameters. There is no limit to the number of
function calls.</p>
<p>It is also possible to store the output of a function in a variable, so
it can be reused.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">check_triangle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">):</span>
  <span style="color:#204a87;font-weight:bold">return</span> \
     <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">and</span> \
     <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">and</span> \
     <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">check_triangle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="classes">Classes</h2>
<p>A class is an encapsulation of data and the processes that work on them.
The data is represented in member variables, and the processes are
defined in the methods of the class (methods are functions inside the
class). For example, let&rsquo;s see how to define a Triangle class:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Triangle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>

  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">length</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">width</span><span style="color:#000;font-weight:bold">,</span>
               <span style="color:#000">height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">angle1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">angle2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">angle3</span><span style="color:#000;font-weight:bold">):</span>
     <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_sides_ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">length</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">width</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">height</span><span style="color:#000;font-weight:bold">):</span>
         <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The sides of the triangle are invalid.&#39;</span><span style="color:#000;font-weight:bold">)</span>
     <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_angles_ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">angle1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">angle2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">angle3</span><span style="color:#000;font-weight:bold">):</span>
         <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The angles of the triangle are invalid.&#39;</span><span style="color:#000;font-weight:bold">)</span>

     <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_length</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">length</span>
     <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">width</span>
     <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_height</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">height</span>

     <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_angle1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">angle1</span>
     <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_angle2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">angle2</span>
     <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_angle3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">angle3</span>

 <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_sides_ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">):</span>
     <span style="color:#204a87;font-weight:bold">return</span> \
         <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">and</span> \
         <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">and</span> \
         <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">)</span>

 <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_angles_ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">):</span>
     <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">180</span>

<span style="color:#000">triangle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Triangle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">35</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">65</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">80</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Python has full object-oriented programming (OOP) capabilities, however
we can not cover all of them in this section, so if you need more
information please refer to the
<a href="https://docs.python.org/2.7/tutorial/classes.html">Python docs on classes and
OOP</a>.</p>
<h2 id="modules">Modules</h2>
<p>Now write this simple program and save it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello Cloud!&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>As a check, make sure the file contains the expected contents on the
command line:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat hello.py
print<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello Cloud!&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</code></pre></div><p>To execute your program pass the file as a parameter to the python
command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python hello.py
Hello Cloud!
</code></pre></div><p>Files in which Python code is stored are called <strong>module</strong>s. You can
execute a Python module from the command line like you just did, or you
can import it in other Python code using the import statement.</p>
<p>Let us write a more involved Python program that will receive as input
the lengths of the three sides of a triangle, and will output whether
they define a valid triangle. A triangle is valid if the length of each
side is less than the sum of the lengths of the other two sides and
greater than the difference of the lengths of the other two sides.:</p>
<pre><code>&quot;&quot;&quot;Usage: check_triangle.py [-h] LENGTH WIDTH HEIGHT

Check if a triangle is valid.

Arguments:
  LENGTH     The length of the triangle.
  WIDTH      The width of the triangle.
  HEIGHT     The height of the triangle.

Options:
-h --help
&quot;&quot;&quot;
from docopt import docopt

if __name__ == '__main__':
  arguments = docopt(__doc__)
  a, b, c = int(arguments['LENGTH']),
            int(arguments['WIDTH']),
            int(arguments['HEIGHT'])
  valid_triangle = \
      a &lt; b + c and a &gt; abs(b - c) and \
      b &lt; a + c and b &gt; abs(a - c) and \
      c &lt; a + b and c &gt; abs(a - b)
  print('Triangle with sides %d, %d and %d is valid: %r' % (
      a, b, c, valid_triangle
  ))
</code></pre>
<p>Assuming we save the program in a file called <code>check_triangle.py</code>, we can
run it like so:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python check_triangle.py <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#0000cf;font-weight:bold">6</span>
Triangle with sides 4, 5, and <span style="color:#0000cf;font-weight:bold">6</span> is valid: True
</code></pre></div><p>Let us break this down a bit.</p>
<ol>
<li>We&rsquo;ve defined a boolean expression that tells us if the sides that were input define a valid triangle. The result of the expression is stored in the valid_triangle variable. inside are true, and False
otherwise.</li>
<li>We&rsquo;ve used the backslash symbol <code>\</code> to format our code nicely. The
backslash simply indicates that the current line is being continued
on the next line.</li>
<li>When we run the program, we do the check if <code>__name__ ==     '__main__'</code>. <code>__name__</code> is an internal Python variable that
allows us to tell whether the current file is being run from the
command line (value <code>__name__</code>), or is being imported by a module
(the value will be the name of the module). Thus, with this statement, we arre just making sure the program is being run by the command line.</li>
<li>We are using the <code>docopt</code> module to handle command line arguments. The
advantage of using this module is that it generates a usage help
statement for the program and enforces command line arguments
automatically. All of this is done by parsing the docstring at the
top of the file.</li>
<li>In the print function, we are using <a href="https://docs.python.org/2/library/string.html#format-string-syntax">Python&rsquo;s string formatting
capabilities</a>
to insert values into the string we are displaying.</li>
</ol>
<h2 id="lambda-expressions">Lambda Expressions</h2>
<p>As opposed to normal functions in Python which are defined using the <code>def</code>
keyword, lambda functions in Python are anonymous functions that do not have a
name and are defined using the <code>lambda</code> keyword. The generic syntax of a lambda function is in the form of <code>lambda arguments: expression</code>, as shown in the following
example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">greeter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Hello </span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">!&#39;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">greeter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Albert&#39;</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>As you could probably guess, the result is:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">Hello</span> <span style="color:#000">Albert</span><span style="color:#a40000">!</span>
</code></pre></div><p>Now consider the following examples:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">power2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">**</span> <span style="color:#0000cf;font-weight:bold">2</span>
</code></pre></div><p>The <code>power2</code> function defined in the expression, is equivalent to the
following definition:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">power2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">**</span> <span style="color:#0000cf;font-weight:bold">2</span>
</code></pre></div><p>Lambda functions are useful when you need a function for a short period. Note that they can also be very useful when passed as an argument with
other built-in functions that take a function as an argument, e.g. <code>filter()</code> and
<code>map()</code>. In the next example, we show how a lambda function can be combined with
the <code>filer</code> function. Consider the array <code>all_names</code> which contains five words
that rhyme together. We want to filter the words that contain the word
<code>name</code>. To achieve this, we pass the function <code>lambda x: 'name' in x</code> as the
first argument. This lambda function returns <code>True</code> if the word <code>name</code> exists as
a substring in the string <code>x</code>. The second argument of <code>filter</code> function is the
array of names, i.e. <code>all_names</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">all_names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;surname&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;rename&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;nickname&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;acclaims&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;defame&#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">filtered_names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;name&#39;</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">all_names</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">filtered_names</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># [&#39;surname&#39;, &#39;rename&#39;, &#39;nickname&#39;]</span>
</code></pre></div><p>As you can see, the names are successfully filtered as we expected.</p>
<p>In Python, the filter function returns a filter object or the iterator
which gets lazily evaluated which means neither we can access the
elements of the filter object with index nor we can use <code>len()</code> to find
the length of the filter object.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">list_a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">filter_obj</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">list_a</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># Convert the filer obj to a list</span>
<span style="color:#000">even_num</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">filter_obj</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">even_num</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># Output: [2, 4]</span>
</code></pre></div><p>In Python, we can have a small usually a single linear anonymous function called Lambda function which can have any number of arguments
just like a normal function but with only one expression with no
return statement. The result of this expression can be applied to a
value.</p>
<p>Basic Syntax:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">arguments</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">expression</span>
</code></pre></div><p>For example, a function in python</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">multiply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">b</span>

<span style="color:#8f5902;font-style:italic">#call the function</span>
<span style="color:#000">multiply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic">#outputs: 15</span>
</code></pre></div><p>The same function can be written as Lambda function. This function named as
multiply is having 2 arguments and returns their multiplication.</p>
<p>Lambda equivalent for this function would be:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">multiply</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Lambda</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">b</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">multiply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#8f5902;font-style:italic"># outputs: 15</span>
</code></pre></div><p>Here a and b are the 2 arguments and a*b is the expression whose value
is returned as an output.</p>
<p>Also, we don&rsquo;t need to assign the Lambda function to a variable.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">a</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">b</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Lambda functions are mostly passed as a parameter to a function which
expects a function objects like in map or filter.</p>
<h3 id="map">map</h3>
<p>The basic syntax of the map function is</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">function_object</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">iterable1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">iterable2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>map functions expect a function object and any number of iterable like a list or dictionary. It executes the function_object for each
element in the sequence and returns a list of the elements modified by
the function object.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">multiply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">2</span>

<span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">multiply2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#8f5902;font-style:italic"># Output [4, 8, 12, 16]</span>
</code></pre></div><p>If we want to write the same function using Lambda</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#8f5902;font-style:italic"># Output [4, 8, 12, 16]</span>
</code></pre></div><h3 id="dictionary">dictionary</h3>
<p>Now, let us see how we can iterate over a dictionary using map and lambda
Let us say we have a dictionary object</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">dict_movies</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;movie&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;avengers&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;comic&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;marvel&#39;</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;movie&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;superman&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;comic&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;dc&#39;</span><span style="color:#000;font-weight:bold">}]</span>
</code></pre></div><p>We can iterate over this dictionary and read the elements of it using
map and lambda functions in following way:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;movie&#39;</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">dict_movies</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Output: [&#39;avengers&#39;, &#39;superman&#39;]</span>
<span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;comic&#39;</span><span style="color:#000;font-weight:bold">],</span>  <span style="color:#000">dict_movies</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># Output: [&#39;marvel&#39;, &#39;dc&#39;]</span>
<span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;movie&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;avengers&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dict_movies</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># Output: [True, False]</span>
</code></pre></div><p>In Python3, map function returns an iterator or map object which gets
lazily evaluated which means neither we can access the elements of the
map object with index nor we can use len() to find the length of the
map object. We can force convert the map output i.e. the map object
to list as shown next:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">map_output</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">map_output</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic"># Output: map object: &lt;map object at 0x04D6BAB0&gt;</span>
<span style="color:#000">list_map_output</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">map_output</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">list_map_output</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># Output: [2, 4, 6, 8]</span>
</code></pre></div><h2 id="iterators">Iterators</h2>
<p>In Python, an iterator protocol is defined using two methods:
<code>__iter()__</code> and <code>next()</code>. The former returns the iterator object and
latter returns the next element of a sequence. Some advantages of
iterators are as follows:</p>
<ul>
<li>Readability</li>
<li>Supports sequences of infinite length</li>
<li>Saving resources</li>
</ul>
<p>There are several built-in objects in Python which implement iterator
protocol, e.g. string, list, dictionary. In the following example, we
create a new class that follows the iterator protocol. We then use the
class to generate <code>log2</code> of numbers:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">math</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">log2</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LogTwo</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#4e9a06">&#34;Implements an iterator of log two&#34;</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">last</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">last</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">last</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__iter__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">current_num</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__next__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">current_num</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">last</span><span style="color:#000;font-weight:bold">:</span>
            <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">log2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">current_num</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">current_num</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span>
        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
            <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">StopIteration</span>

<span style="color:#000">L</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LogTwo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">iter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">L</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">next</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">next</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">next</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">next</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>As you can see, we first create an instance of the class and assign
its <code>__iter()__</code> function to a variable called <code>i</code>. Then by calling
the <code>next()</code> function four times, we get the following output:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python iterator.py
0.0
1.0
1.584962500721156
2.0
</code></pre></div><p>As you probably noticed, the lines are <code>log2()</code> of 1, 2, 3, 4 respectively.</p>
<h2 id="generators">Generators</h2>
<p>Before we go to Generators, please understand Iterators. Generators
are also Iterators but they can only be iterated over once. That is
because generators do not store the values in memory instead they
generate the values on the go. If we want to print those values then
we can either simply iterate over them or use the for loop.</p>
<h3 id="generators-with-function">Generators with function</h3>
<p>For example, we have a function named as multiplyBy10 which prints all
the input numbers multiplied by 10.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">multiplyBy10</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
   <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:bold">:</span>
      <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
   <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span>

<span style="color:#000">new_numbers</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">multiplyBy10</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">new_numbers</span>  <span style="color:#8f5902;font-style:italic">#Output: [10, 20, 30, 40 ,50]</span>
</code></pre></div><p>Now, if we want to use Generators here then we will make the following changes.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">multiplyBy10</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:bold">:</span>
      <span style="color:#204a87;font-weight:bold">yield</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">new_numbers</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">multiplyBy10</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">new_numbers</span>  <span style="color:#8f5902;font-style:italic">#Output: Generators object</span>
</code></pre></div><p>In Generators, we use yield() function in place of return(). So when
we try to print new_numbers list now, it just prints Generators
object. The reason for this is because Generators do not hold any value
in memory, it yields one result at a time. So essentially it is just
waiting for us to ask for the next result. To print the next result we
can just say print next(new_numbers) , so how it is working is its
reading the first value and squaring it and yielding out value 1. Also
in this case, we can just print next(new_numbers) 5 times to print all
numbers and if we do it for the 6th time then we will get an error
StopIteration which means Generators has exhausted its limit and it
has no 6th element to print.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span> <span style="color:#204a87">next</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">new_numbers</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic">#Output: 1</span>
</code></pre></div><h3 id="generators-using-for-loop">Generators using for loop</h3>
<p>If we now want to print the complete list of squared values then we
can just do:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">multiplyBy10</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:bold">:</span>
      <span style="color:#204a87;font-weight:bold">yield</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">new_numbers</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">multiplyBy10</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">num</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">new_numbers</span><span style="color:#000;font-weight:bold">:</span>
   <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">num</span>
</code></pre></div><p>The output will be:</p>
<pre><code>10
20
30
40
50
</code></pre>
<h3 id="generators-with-list-comprehension">Generators with List Comprehension</h3>
<p>Python has something called List Comprehension, if we use this then we
can replace the complete function def with just:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">new_numbers</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">x</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]]</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">new_numbers</span>  <span style="color:#8f5902;font-style:italic">#Output: [10, 20, 30, 40 ,50]</span>
</code></pre></div><p>Here the point to note is square brackets [] in line 1 is very
important. If we change it to () then again we will start getting
Generators object.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">new_numbers</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">x</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">new_numbers</span>  <span style="color:#8f5902;font-style:italic">#Output: Generators object</span>
</code></pre></div><p>We can get the individual elements again from Generators if we do a
for loop over <code>new_numbers</code>, as we did previously. Alternatively, we
can convert it into a list and then print it.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">new_numbers</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">x</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">new_numbers</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic">#Output: [10, 20, 30, 40 ,50]</span>
</code></pre></div><p>But here if we convert this into a list then we lose on performance,
which we will just see next.</p>
<h3 id="why-use-generators">Why use Generators?</h3>
<p>Generators are better with Performance because it does not hold the
values in memory and here with the small examples we provide it is not a
big deal since we are dealing with a small amount of data but just
consider a scenario where the records are in millions of data set. And
if we try to convert millions of data elements into a list then that
will make an impact on memory and performance because
everything will in memory.</p>
<p>Let us see an example of how Generators help in Performance. First,
without Generators, normal function taking 1 million records and
returns the result[people] for 1 million.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;John&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Jack&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Adam&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Steve&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Rick&#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">majors</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Math&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;CompScience&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;Arts&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;Business&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;Economics&#39;</span><span style="color:#000;font-weight:bold">]</span>

<span style="color:#8f5902;font-style:italic"># prints the memory before we run the function</span>
<span style="color:#000">memory</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mem_profile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">memory_usage_resource</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#4e9a06">&#39;Memory (Before): {memory}Mb&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">people_list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">people</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
   <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">people</span><span style="color:#000;font-weight:bold">):</span>
      <span style="color:#000">person</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;id&#39;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#39;name&#39;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">choice</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">),</span>
            <span style="color:#4e9a06">&#39;major&#39;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">randon</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">choice</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">majors</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000;font-weight:bold">}</span>
      <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#000;font-weight:bold">)</span>
   <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span>

<span style="color:#000">t1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">clock</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">people</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">people_list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10000000</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">t2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">clock</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># prints the memory after we run the function</span>
<span style="color:#000">memory</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mem_profile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">memory_usage_resource</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#4e9a06">&#39;Memory (After): {memory}Mb&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Took {time} seconds&#39;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">t2</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">t1</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#8f5902;font-style:italic">#Output</span>
<span style="color:#000">Memory</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">Before</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000">Mb</span>
<span style="color:#000">Memory</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">After</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#0000cf;font-weight:bold">318</span><span style="color:#000">Mb</span>
<span style="color:#000">Took</span> <span style="color:#0000cf;font-weight:bold">1.2</span> <span style="color:#000">seconds</span>
</code></pre></div><p>I am just giving approximate values to compare it with the next execution
but we just try to run it we will see a serious consumption of memory
with a good amount of time taken.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;John&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Jack&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Adam&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Steve&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Rick&#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">majors</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Math&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;CompScience&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;Arts&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;Business&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#4e9a06">&#39;Economics&#39;</span><span style="color:#000;font-weight:bold">]</span>

<span style="color:#8f5902;font-style:italic"># prints the memory before we run the function</span>
<span style="color:#000">memory</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mem_profile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">memory_usage_resource</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#4e9a06">&#39;Memory (Before): {memory}Mb&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">people_generator</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">people</span><span style="color:#000;font-weight:bold">):</span>
   <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">xrange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">people</span><span style="color:#000;font-weight:bold">):</span>
      <span style="color:#000">person</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;id&#39;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#39;name&#39;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">choice</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">),</span>
            <span style="color:#4e9a06">&#39;major&#39;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000">randon</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">choice</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">majors</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">}</span>
      <span style="color:#204a87;font-weight:bold">yield</span> <span style="color:#000">person</span>

<span style="color:#000">t1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">clock</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">people</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">people_list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10000000</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">t2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">clock</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># prints the memory after we run the function</span>
<span style="color:#000">memory</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mem_profile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">memory_usage_resource</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#4e9a06">&#39;Memory (After): {memory}Mb&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Took {time} seconds&#39;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">t2</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">t1</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#8f5902;font-style:italic">#Output</span>
<span style="color:#000">Memory</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">Before</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000">Mb</span>
<span style="color:#000">Memory</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">After</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000">Mb</span>
<span style="color:#000">Took</span> <span style="color:#0000cf;font-weight:bold">0.01</span> <span style="color:#000">seconds</span>
</code></pre></div><p>Now after running the same code using Generators, we will see a
significant amount of performance boost with almost 0 Seconds. And
the reason behind this is that in the case of Generators, we do not keep
anything in memory so the system just reads 1 at a time and yields that.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-32abc024da4c6b12b87aa02d11dba5a4">1.7 - Cloudmesh</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-353639cc7e89960839f8ff2f993d22b0">1.7.1 - Introduction</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<hr>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/cloudmesh/images/learning.png" alt=""> <strong>Learning Objectives</strong></p>
<ul>
<li>Introduction to the cloudmesh API</li>
<li>Using cmd5 via cms</li>
<li>Introduction to cloudmesh convenience API for output, dotdict, shell, stopwatch,
benchmark management</li>
<li>Creating your own cms commands</li>
<li>Cloudmesh configuration file</li>
<li>Cloudmesh inventory</li>
</ul>
<hr>
<p>In this chapter, we like to introduce you to cloudmesh which provides you
with a number of convenient methods to interface with the local system,
but also with cloud services. We will start while focussing on some
simple APIs and then gradually introduce the cloudmesh shell which not
only provides a shell but also a command line interface so you can use
cloudmesh from a terminal. This dual ability is quite useful as we can
write cloudmesh scripts, but can also invoke the functionality from the
terminal. This is quite an important distinction from other tools
that only allow command line interfaces.</p>
<p>Moreover, we also show you that it is easy to create new commands and add
them dynamically to the cloudmesh shell via simple pip installs.</p>
<p>Cloudmesh is an evolving project and you have the opportunity to improve
if you see some features missing.</p>
<p>The manual of cloudmesh can be found at</p>
<ul>
<li><a href="https://cloudmesh.github.io/cloudmesh-manual">https://cloudmesh.github.io/cloudmesh-manual</a></li>
</ul>
<p>The API documentation is located at</p>
<ul>
<li><a href="https://cloudmesh.github.io/cloudmesh-manual/api/index.html#cloudmesh-api">https://cloudmesh.github.io/cloudmesh-manual/api/index.html#cloudmesh-api</a></li>
</ul>
<p>We will initially focus on a subset of this functionality.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ddf5dd385a60a5ca754aee0d9592dd82">1.7.2 - Installation</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>The installation of cloudmesh is simple and can technically be done via pip
by a user. However you are not a user, you are a developer. Cloudmesh is
distributed in different topical repositories and in order for
developers to easily interact with them we have written a convenient
<code>cloudmesh-installer</code> program.</p>
<p>As a developer, you must also use a python virtual environment to avoid
affecting your system-wide Python installation. This can be achieved while
using Python3 from python.org or via conda. However, we do recommend that you use
python.org as this is the vanilla python that most developers in the
world use. Conda is often used by users of Python if they do not need to
use bleeding-edge but older prepackaged Python tools and libraries.</p>
<h2 id="prerequisite">Prerequisite</h2>
<p>We require you to create a python virtual environment and activate it.
How to do this was discussed in sec. <strong>¿sec:python-install?</strong>. Please create the
ENV3 environment. Please activate it.</p>
<h2 id="basic-install">Basic Install</h2>
<p>Cloudmesh can install for developers a number of <code>bundles</code>. A bundle is
a set of git repositories that are needed for a particular install. For
us, we are mostly interested in the bundles <code>cms</code>, <code>cloud</code>, <code>storage</code>. We
will introduce you to other bundles throughout this documentation.</p>
<p>If you like to find out more about the details of this you can look at
<a href="https://pypi.org/project/cloudmesh-installer/">cloudmesh-installer</a>
which will be regularly updated.</p>
<p>To make use of the bundle and the easy installation for developers please
install the cloudmesh-installer via pip, but make sure you do this in a
python virtual env as discussed previously. If not you may impact your
system negatively. Please note that we are not responsible for fixing
your computer. Naturally, you can also use a virtual machine, if you prefer.
It is also important that we create a uniform development environment. In
our case, we create an empty directory called <code>cm</code> in which we place the
bundle.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir cm
$ <span style="color:#204a87">cd</span> cm
$ pip install cloudmesh-installer
</code></pre></div><p>To see the bundle you can use</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cloudmesh-installer bundles
</code></pre></div><p>We will start with the basic cloudmesh functionality at this time and
only install the shell and some common APIs.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cloudmesh-installer git clone cms
$ cloudmesh-installer install cms
</code></pre></div><p>These commands download and install cloudmesh shell into your
environment. It is important that you use the <code>-e</code> flag</p>
<p>To see if it works you can use the command</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cms <span style="color:#204a87">help</span>
</code></pre></div><p>You will see an output. If this does not work for you, and you can not
figure out the issue, please contact us so we can identify what went
wrong.</p>
<p>For more information, please visit our
<a href="https://cloudmesh.github.io/cloudmesh-manual/installation/install.html#source-installation-for-developers">Installation Instructions for Developers</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4ccb593cc80ca5340d22721edf0e0c81">1.7.3 - Output</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>Cloudmesh provides a number of convenient API&rsquo;s to make the output easier
or more fanciful.</p>
<p>These API&rsquo;s include</p>
<ul>
<li><a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html#module-cloudmesh.common.console">Console</a></li>
<li><a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=banner#cloudmesh.common.util.banner">Banner</a></li>
<li><a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=heading#cloudmesh.common.util.HEADING">Heading</a></li>
<li><a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=verbose#cloudmesh.common.debug.VERBOSE">VERBOSE</a></li>
</ul>
<h2 id="console">Console</h2>
<p>Print is the usual function to output to the terminal. However, often we
like to have colored output that helps us in the notification to the
user. For this reason, we have a simple <code>Console</code> class that has several
built-in features. You can even switch and define your own color
schemes.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.console</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Console</span>

<span style="color:#000">msg</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;my message&#34;</span>
<span style="color:#000">Console</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">msg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># prins a green message</span>
<span style="color:#000">Console</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">msg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># prins a red message proceeded with ERROR</span>
<span style="color:#000">Console</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">msg</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">msg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># prins a regular black message</span>
</code></pre></div><p>In case of the error message we also have convenient flags that allow us
to include the traceback in the output.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">Console</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">msg</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">traceflag</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The prefix can be switched on and off with the <code>prefix</code> flag, while the
<code>traceflag</code> switches on and of if the trace should be set.</p>
<p>The verbosity of the output is controlled via variables that are stored
in the <code>~/.cloudmesh</code> directory.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.variables</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Variables</span>

<span style="color:#000">variables</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Variables</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#000">variables</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;debug&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">True</span>
<span style="color:#000">variables</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;trace&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">True</span>
<span style="color:#000">variables</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;verbose&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10</span>
</code></pre></div><p>For more features, see API: <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html#module-cloudmesh.common.console">Console</a></p>
<h2 id="banner">Banner</h2>
<p>In case you need a banner you can do this with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.util</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">banner</span>

<span style="color:#000">banner</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;my text&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>For more features, see API: <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=banner#cloudmesh.common.util.banner">Banner</a></p>
<h2 id="heading">Heading</h2>
<p>A particularly useful function is <code>HEADING()</code> which prints the method name.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.util</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">HEADING</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Example</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">doit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">HEADING</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The invocation of the <code>HEADING()</code> function doit prints a banner with the name
information. The reason we did not do it as a decorator is that you can
place the <code>HEADING()</code> function in an arbitrary location of the method body.</p>
<p>For more features, see API: <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=heading#cloudmesh.common.util.HEADING">Heading</a></p>
<h2 id="verbose">VERBOSE</h2>
<p><em>Note: VERBOSE is not supported in jupyter notebooks</em></p>
<p>VERBOSE is a very useful method allowing you to print a
dictionary. Not only will it print the dict, but it will also provide
you with the information in which file it is used and which line
number. It will even print the name of the <code>dict</code> that you use in your
code.</p>
<p>To use this you will have to enable the debugging methods for
cloudmesh as discussed in sec. 1.1</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.debug</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">VERBOSE</span>

<span style="color:#000">m</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;key&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">VERBOSE</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">m</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>For more features, please see <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=verbose#cloudmesh.common.debug.VERBOSE">VERBOSE</a></p>
<h2 id="using-print-and-pprint">Using print and pprint</h2>
<p>In many cases, it may be sufficient to use <code>print</code> and <code>pprint</code> for
debugging. However, as the code is big and you may forget where you placed
print statements or the print statements may have been added by others, we
recommend that you use the VERBOSE function. If you use <code>print</code> or <code>pprint</code>
we recommend using a unique prefix, such as:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">pprint</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pprint</span>

<span style="color:#000">d</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;sample&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">}</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;MYDEBUG:&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">pprint</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">d</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># or with print</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;MYDEBUG:&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">d</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3d9c122fedd4b1b656876d03711787f9">1.7.4 - Dictionaries</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<h2 id="dotdict">Dotdict</h2>
<p>For simple dictionaries we sometimes like to simplify the notation with a <code>.</code> instead of using the <code>[]</code>:</p>
<p>You can achieve this with <code>dotdict</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.dotdict</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">dotdict</span>

<span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Gregor&#34;</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dotdict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Now you can either call</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>or</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">name</span>
</code></pre></div><p>This is especially useful in if conditions as it may be easier to read and write</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">name</span> <span style="color:#204a87;font-weight:bold">is</span> <span style="color:#4e9a06">&#34;Gregor&#34;</span><span style="color:#000;font-weight:bold">:</span>

    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is quite readable&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>and is the same as</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#204a87;font-weight:bold">is</span> <span style="color:#4e9a06">&#34;Gregor&#34;</span><span style="color:#000;font-weight:bold">:</span>

    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;this is quite readable&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>For more features, see API: <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=dotdict#module-cloudmesh.common.dotdict">dotdict</a></p>
<h2 id="flatdict">FlatDict</h2>
<p>In some cases, it is useful to be able to flatten out dictionaries that
contain dicts within dicts. For this, we can use <code>FlatDict</code>.</p>
<pre><code>from cloudmesh.common.Flatdict import FlatDict

data = {
    &quot;name&quot;: &quot;Gregor&quot;,
    &quot;address&quot;: {
        &quot;city&quot;: &quot;Bloomington&quot;,
        &quot;state&quot;: &quot;IN&quot;

    }
}

flat = FlatDict(data, sep=&quot;.&quot;)
</code></pre>
<p>This will be converted to a dict with the following structure.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">flat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Gregor&#34;</span>
    <span style="color:#4e9a06">&#34;address.city&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bloomington&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;address.state&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;IN&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>With <code>sep</code> you can change the sepaerator between the nested dict
attributes. For more features, see API:
<a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=flatdict#module-cloudmesh.common.FlatDict">dotdict</a></p>
<h2 id="printing-dicts">Printing Dicts</h2>
<p>In case we want to print dicts and lists of dicts in various formats, we
have included a simple <code>Printer</code> that can print a dict in yaml, json,
table, and csv format.</p>
<p>The function can even guess from the passed parameters what the input format is
and uses the appropriate internal function.</p>
<p>A common example is</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">pprint</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pprint</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.Printer</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Printer</span>

<span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Gregor&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;street&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Funny Lane 11&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;city&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Cloudville&#34;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Albert&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;street&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Memory Lane 1901&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;city&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Cloudnine&#34;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">]</span>


<span style="color:#000">pprint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">table</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Printer</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">flatwrite</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span>
                          <span style="color:#000">sort_keys</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">],</span>
                          <span style="color:#000">order</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;address.street&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;address.city&#34;</span><span style="color:#000;font-weight:bold">],</span>
                          <span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;Name&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Street&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;City&#34;</span><span style="color:#000;font-weight:bold">],</span>
                          <span style="color:#000">output</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;table&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">table</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>For more features, see API: <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=flatdict#module-cloudmesh.common.Printer">Printer</a></p>
<p>More examples are available in the source code as <a href="https://github.com/cloudmesh/cloudmesh-common/tree/master/tests">tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f8b6dd2bf5b1fed8cba49ac1a38d0f26">1.7.5 - Shell</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>Python provides a sophisticated method for starting background processes.
However, in many cases, it is quite complex to interact with it. It also
does not provide convenient wrappers that we can use to start them in a
pythonic fashion. For this reason, we have written a primitive <code>Shell</code>
class that provides just enough functionality to be useful in many
cases.</p>
<p>Let us review some examples where <code>result</code> is set to the
output of the command being executed.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.Shell</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Shell</span>

<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Shell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">execute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;pwd&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Shell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">execute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;ls&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;-l&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;-a&#34;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Shell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">execute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;ls&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;-l -a&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>For many common commands, we provide built-in functions. For example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Shell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ls</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;-aux&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Shell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ls</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;-a&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;-u&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;-x&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Shell</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pwd</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The list includes (naturally the commands that must be available on your OS.
If the shell command is not available on your OS, please help us
improving the code to either provide functions that work on your OS or
develop with us platform-independent functionality of a subset of the
functionality for the shell command that we may benefit from.</p>
<ul>
<li><code>VBoxManage(cls, *args)</code></li>
<li><code>bash(cls, *args)</code></li>
<li><code>blockdiag(cls, *args)</code></li>
<li><code>brew(cls, *args)</code></li>
<li><code>cat(cls, *args)</code></li>
<li><code>check_output(cls, *args, **kwargs)</code></li>
<li><code>check_python(cls)</code></li>
<li><code>cm(cls, *args)</code></li>
<li><code>cms(cls, *args)</code></li>
<li><code>command_exists(cls, name)</code></li>
<li><code>dialog(cls, *args)</code></li>
<li><code>edit(filename)</code></li>
<li><code>execute(cls,*args)</code></li>
<li><code>fgrep(cls, *args)</code></li>
<li><code>find_cygwin_executables(cls)</code></li>
<li><code>find_lines_with(cls, lines, what)</code></li>
<li><code>get_python(cls)</code></li>
<li><code>git(cls, *args)</code></li>
<li><code>grep(cls, *args)</code></li>
<li><code>head(cls, *args)</code></li>
<li><code>install(cls, name)</code></li>
<li><code>install(cls, name)</code></li>
<li><code>keystone(cls, *args)</code></li>
<li><code>kill(cls, *args)</code></li>
<li><code>live(cls, command, cwd=None)</code></li>
<li><code>ls(cls, *args)</code></li>
<li><code>mkdir(cls, directory)</code></li>
<li><code>mongod(cls, *args)</code></li>
<li><code>nosetests(cls, *args)</code></li>
<li><code>nova(cls, *args)</code></li>
<li><code>operating_system(cls)</code></li>
<li><code>pandoc(cls, *args)</code></li>
<li><code>ping(cls, host=None, count=1)</code></li>
<li><code>pip(cls, *args)</code></li>
<li><code>ps(cls, *args)</code></li>
<li><code>pwd(cls, *args)</code></li>
<li><code>rackdiag(cls, *args)</code></li>
<li><code>remove_line_with(cls, lines, what)</code></li>
<li><code>rm(cls, *args)</code></li>
<li><code>rsync(cls, *args)</code></li>
<li><code>scp(cls, *args)</code></li>
<li><code>sh(cls, *args)</code></li>
<li><code>sort(cls, *args)</code></li>
<li><code>ssh(cls, *args)</code></li>
<li><code>sudo(cls, *args)</code></li>
<li><code>tail(cls, *args)</code></li>
<li><code>terminal(cls, command='pwd')</code></li>
<li><code>terminal_type(cls)</code></li>
<li><code>unzip(cls, source_filename, dest_dir)</code></li>
<li><code>vagrant(cls, *args)</code></li>
<li><code>version(cls, name)</code></li>
<li><code>which(cls, command)</code></li>
</ul>
<p>For more features, please see <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=shell#module-cloudmesh.common.Shell">Shell</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-db39fc96122506a25b3122b0c3511c39">1.7.6 - StopWatch</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>Often you find yourself in a situation where you like to measure the
time between two events. We provide a simple <code>StopWatch</code> that allows
you not only to measure a number of times but also to print them out in
a convenient format.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.StopWatch</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">StopWatch</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">time</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sleep</span>


<span style="color:#000">StopWatch</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">StopWatch</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">StopWatch</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>To print, you can simply also use:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">StopWatch</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">benchmark</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>For more features, please see <a href="https://cloudmesh.github.io/cloudmesh-manual/api/cloudmesh.common.html?highlight=stopwatch#module-cloudmesh.common.StopWatch">StopWatch</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-20eb56a5917755f4cceddff1e73648b2">1.7.7 - Cloudmesh Command Shell</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<h2 id="cmd5">CMD5</h2>
<p>Python&rsquo;s CMD (<a href="https://docs.python.org/2/library/cmd.html">https://docs.python.org/2/library/cmd.html</a>) is a very
useful package to create command line shells. However, it does not allow
the dynamic integration of newly defined commands. Furthermore,
additions to CMD need to be done within the same source tree. To
simplify developing commands by a number of people and to have a dynamic
plugin mechanism, we developed cmd5. It is a rewrite of our earlier
efforts in cloudmesh client and cmd3.</p>
<h3 id="resources">Resources</h3>
<p>The source code for cmd5 is located in GitHub:</p>
<ul>
<li><a href="https://github.com/cloudmesh/cmd5">https://github.com/cloudmesh/cmd5</a></li>
</ul>
<p>We have discussed in sec. <strong>¿sec:cloudmesh-cms-install?</strong> how to install cloudmesh
as a developer and have access to the source code in a directory called
<code>cm</code>. As you read this document we assume you are a developer and can
skip the next section.</p>
<h3 id="installation-from-source">Installation from source</h3>
<p>WARNING: DO NOT EXECUTE THIS IF YOU ARE A DEVELOPER OR YOUR ENVIRONMENT
WILL NOT PROPERLY WORK. YOU LIKELY HAVE ALREADY INSTALLED CMD5 IF YOU
USED THE CLOUDMESH INSTALLER.</p>
<p>However, if you are a user of cloudmesh you can install it with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install cloudmesh-cmd5
</code></pre></div><h3 id="execution">Execution</h3>
<p>To run the shell you can activate it with the cms command. cms stands
for cloudmesh shell:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">(</span>ENV2<span style="color:#ce5c00;font-weight:bold">)</span> $ cms
</code></pre></div><p>It will print the banner and enter the shell:</p>
<pre><code>+-------------------------------------------------------+
|   ____ _                 _                     _      |
|  / ___| | ___  _   _  __| |_ __ ___   ___  ___| |__   |
| | |   | |/ _ \| | | |/ _` | '_ ` _ \ / _ \/ __| '_ \  |
| | |___| | (_) | |_| | (_| | | | | | |  __/\__ \ | | | |
|  \____|_|\___/ \__,_|\__,_|_| |_| |_|\___||___/_| |_| |
+-------------------------------------------------------+
|                  Cloudmesh CMD5 Shell                 |
+-------------------------------------------------------+

cms&gt;
</code></pre>
<p>To see the list of commands you can say:</p>
<pre><code>cms&gt; help
</code></pre>
<p>To see the manual page for a specific command, please use:</p>
<pre><code>help COMMANDNAME
</code></pre>
<h3 id="create-your-own-extension">Create your own Extension</h3>
<p>One of the most important features of CMD5 is its ability to extend it
with new commands. This is done via packaged namespaces. We recommend
you name it cloudmesh-mycommand, where mycommand is the name of the
command that you like to create. This can easily be done while using the
sys* cloudmesh command (we suggest you use a different name than
<code>gregor</code> maybe your firstname):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cms sys <span style="color:#204a87">command</span> generate gregor
</code></pre></div><p>It will download a template from cloudmesh called <code>cloudmesh-bar</code> and
generate a new directory <code>cloudmesh-gregor</code> with all the needed files
to create your own command and register it dynamically with cloudmesh.
All you have to do is to <code>cd</code> into the directory and install the code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">cd</span> cloudmesh-gregor
$ python setup.py install
<span style="color:#8f5902;font-style:italic"># pip install .</span>
</code></pre></div><p>Adding your command is easy. It is important that all objects are
defined in the command itself and that no global variables be used to allow each shell command to stand alone. Naturally, you should
develop API libraries outside of the cloudmesh shell command and reuse
them to keep the command code as small as possible. We place
the command in:</p>
<pre><code>cloudmsesh/mycommand/command/gregor.py
</code></pre>
<p>Now you can go ahead and modify your command in that directory. It will
look similar to (if you used the command name <code>gregor</code>):</p>
<pre><code>from cloudmesh.shell.command import command
from cloudmesh.shell.command import PluginCommand

class GregorCommand(PluginCommand):

    @command
    def do_gregor(self, args, arguments):
        &quot;&quot;&quot;
        ::
          Usage:
                gregor -f FILE
                gregor list
          This command does some useful things.
          Arguments:
              FILE   a file name
          Options:
              -f      specify the file
        &quot;&quot;&quot;
        print(arguments)
        if arguments.FILE:
           print(&quot;You have used file: &quot;, arguments.FILE)
        return &quot;&quot;
</code></pre>
<p>An important difference to other CMD solutions is that our commands can
leverage (besides the standard definition), <code>docopts</code> as a way to define
the manual page. This allows us to use arguments as dict and use simple
if conditions to interpret the command. Using <code>docopts</code> has the advantage
that contributors are forced to think about the command and its options
and document them from the start. Previously we did not use but argparse
and click. However, we noticed that for our contributors both systems
lead to commands that were either not properly documented or the
developers delivered ambiguous commands that resulted in confusion and
wrong usage by subsequent users. Hence, we do recommend that you use
docopts for documenting cmd5 commands. The transformation is enabled by
the @command decorator that generates a manual page and creates a
proper help message for the shell automatically. Thus there is no need
to introduce a separate help method as would normally be needed in CMD
while reducing the effort it takes to contribute new commands in a
dynamic fashion.</p>
<h3 id="bug-quotes">Bug: Quotes</h3>
<p>We have one bug in cmd5 that relates to the use of quotes on the commandline</p>
<p>For example, you need to say</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cms gregor -f <span style="color:#4e9a06">\&#34;</span>file name with spaces<span style="color:#4e9a06">\&#34;</span>
</code></pre></div><p>If you like to help us fix this that would be great. it requires the use
of <a href="https://docs.python.org/3/library/shlex.html">shlex</a>. Unfortunately,
we did not yet time to fix this &ldquo;feature.&rdquo;</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-61f1bb4fd62199e3dafe6987bab0fd07">1.7.8 - Exercises</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>When doing your assignment, make sure you label the programs
appropriately with comments that clearly identify the assignment.
Place all assignments in a folder on GitHub named &ldquo;cloudmesh-exercises&rdquo;</p>
<p>For example, name the program solving E.Cloudmesh.Common.1
<code>e-cloudmesh-1.py</code> and so on. For more complex assignments you can name
them as you like, as long as in the file you have a comment such as</p>
<p><code># fa19-516-000 E.Cloudmesh.Common.1</code></p>
<p>at the beginning of the file. Please <strong>do not store</strong> any screenshots in your GitHub repository of your working program.</p>
<h2 id="cloudmesh-common">Cloudmesh Common</h2>
<p>E.Cloudmesh.Common.1</p>
<blockquote>
<p>Develop a program that demonstrates the use of <code>banner</code>,
<code>HEADING</code>, and <code>VERBOSE</code>.</p>
</blockquote>
<p>E.Cloudmesh.Common.2</p>
<blockquote>
<p>Develop a program that demonstrates the use of <code>dotdict</code>.</p>
</blockquote>
<p>E.Cloudmesh.Common.3</p>
<blockquote>
<p>Develop a program that demonstrates the use of <code>FlatDict</code>.</p>
</blockquote>
<p>E.Cloudmesh.Common.4</p>
<blockquote>
<p>Develop a program that demonstrates the use of <code>cloudmesh.common.Shell</code>.</p>
</blockquote>
<p>E.Cloudmesh.Common.5</p>
<blockquote>
<p>Develop a program that demonstrates the use of <code>cloudmesh.common.StopWatch</code>.</p>
</blockquote>
<h2 id="cloudmesh-shell">Cloudmesh Shell</h2>
<p>E.Cloudmesh.Shell.1</p>
<blockquote>
<p>Install cmd5 and the command <code>cms</code> on your computer.</p>
</blockquote>
<p>E. Cloudmesh.Shell.2</p>
<blockquote>
<p>Write a new command with your <code>firstname</code> as the command name.</p>
</blockquote>
<p>E.Cloudmesh.Shell.3</p>
<blockquote>
<p>Write a new command and experiment with docopt syntax and argument
interpretation of the dict with if conditions.</p>
</blockquote>
<p>E.Cloudmesh.Shell.4</p>
<blockquote>
<p>If you have useful extensions that you like us to add by default,
please work with us.</p>
</blockquote>
<p>E.Cloudmesh.Shell.5</p>
<blockquote>
<p>At this time one needs to quote in some commands the <code>&quot;</code> in the
shell command line. Develop and test code that fixes this.</p>
</blockquote>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-74d6d805870b943ad628e356d63c6cd4">1.8 - Data</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-d1e606b4ebb5aedc4142a66141541e1d">1.8.1 - Data Formats</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<h2 id="yaml">YAML</h2>
<p>The term <em>YAML</em> stand for &ldquo;YAML Ainot Markup Language.&rdquo; According to the
Web Page at</p>
<ul>
<li><a href="http://yaml.org/">http://yaml.org/</a></li>
</ul>
<p>&ldquo;YAML is a human friendly data serialization standard for all
programming languages.&rdquo; There are multiple versions of YAML existing and
one needs to take care of that your software supports the right version.
The current version is YAML 1.2.</p>
<p>YAML is often used for configuration and in many cases can also be used
as XML replacement. Important is tat YAM in contrast to XML removes the
tags while replacing them with indentation. This has naturally the
advantage that it is mor easily to read, however, the format is strict
and needs to adhere to proper indentation. Thus it is important that you
check your YAML files for correctness, either by writing for example a
python program that read your yaml file, or an online YAML checker such
as provided at</p>
<ul>
<li><a href="http://www.yamllint.com/">http://www.yamllint.com/</a></li>
</ul>
<p>An example on how to use yaml in python is provided in our next example.
Please note that YAML is a superset of JSON. Originally YAML was
designed as a markup language. However as it is not document oriented
but data oriented it has been recast and it does no longer classify
itself as markup language.</p>
<pre><code>import os
import sys
import yaml

try:
    yamlFilename = os.sys.argv[1]
    yamlFile = open(yamlFilename, &quot;r&quot;)
except:
    print(&quot;filename does not exist&quot;)
    sys.exit()
try:
   yaml.load(yamlFile.read())
except:
   print(&quot;YAML file is not valid.&quot;)
</code></pre>
<p>Resources:</p>
<ul>
<li><a href="http://yaml.org/">http://yaml.org/</a></li>
<li><a href="https://en.wikipedia.org/wiki/YAML">https://en.wikipedia.org/wiki/YAML</a></li>
<li><a href="http://www.yamllint.com/">http://www.yamllint.com/</a></li>
</ul>
<h2 id="json">JSON</h2>
<p>The term JSON stand for <em>JavaScript Object Notation</em>. It is targeted as
an open-standard file format that emphasizes on integration of
human-readable text to transmit data objects. The data objects contain
attribute value pairs. Although it originates from JavaScript, the
format itself is language independent. It uses brackets to allow
organization of the data. PLease note that YAML is a superset of JSON
and not all YAML documents can be converted to JSON. Furthermore JSON
does not support comments. For these reasons we often prefer to us YAMl
instead of JSON. However JSON data can easily be translated to YAML as
well as XML.</p>
<p>Resources:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/JSON">https://en.wikipedia.org/wiki/JSON</a></li>
<li><a href="https://www.json.org/">https://www.json.org/</a></li>
</ul>
<h2 id="xml">XML</h2>
<p>XML stands for <em>Extensible Markup Language</em>. XML allows to define
documents with the help of a set of rules in order to make it machine
readable. The emphasize here is on machine readable as document in XML
can become quickly complex and difficult to understand for humans. XML is
used for documents as well as data structures.</p>
<p>A tutorial about XML is available at</p>
<ul>
<li><a href="https://www.w3schools.com/xml/default.asp">https://www.w3schools.com/xml/default.asp</a></li>
</ul>
<p>Resources:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/XML">https://en.wikipedia.org/wiki/XML</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-77a20c7245f87b0312b3eae603f4a4bd">1.9 - Mongo</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-81edebc786d3b67bb2e60732beb21953">1.9.1 - MongoDB in Python</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<hr>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/data/images/learning.png" alt=""> <strong>Learning Objectives</strong></p>
<ul>
<li>Introduction to basic MongoDB knowledge</li>
<li>Use of MongoDB via PyMongo</li>
<li>Use of MongoEngine MongoEngine and Object-Document mapper,</li>
<li>Use of Flask-Mongo</li>
</ul>
<hr>
<p>In today&rsquo;s era, NoSQL databases have developed an enormous potential
to process the unstructured data efficiently. Modern information is
complex, extensive, and may not have pre-existing relationships. With
the advent of the advanced search engines, machine learning, and
Artificial Intelligence, technology expectations to process, store, and
analyze such data have grown tremendously [@www-upwork]. The NoSQL
database engines such as MongoDB, Redis, and Cassandra have successfully
overcome the traditional relational database challenges such as
scalability, performance, unstructured data growth, agile sprint cycles,
and growing needs of processing data in real-time with minimal hardware
processing power [@www-guru99]. The NoSQL databases are a new generation
of engines that do not necessarily require SQL language and are sometimes
also called <em>Not Only SQL</em> databases. However, most of them support
various third-party open connectivity drivers that can map NoSQL queries
to SQL&rsquo;s. It would be safe to say that although NoSQL databases are
still far from replacing the relational databases, they are adding an
immense value when used in hybrid IT environments in conjunction with
relational databases, based on the application specific needs
[@www-guru99]. We will be covering the MongoDB technology,
its driver PyMongo, its object-document mapper MongoEngine, and the
Flask-PyMongo micro-web framework that make MongoDB more attractive
and user-friendly.</p>
<h2 id="cloudmesh-mongodb-usage-quickstart">Cloudmesh MongoDB Usage Quickstart</h2>
<p>Before you read on we like you to read this quickstart. The easiest way
for many of the activities we do to interact with MongoDB is to use
our cloudmesh functionality. This prelude section is not intended to
describe all the details, but get you started quickly while leveraging cloudmesh</p>
<p>This is done via the cloudmesh cmd5 and the cloudmesh_community/cm
code:</p>
<ul>
<li><a href="https://cloudmesh-community.github.io/cm/">https://cloudmesh-community.github.io/cm/</a></li>
</ul>
<p>To install mongo on for example macOS you can use</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cms admin mongo install
</code></pre></div><p>To start, stop and see the status of mongo you can use</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cms admin mongo start
$ cms admin mongo stop
$ cms admin mongo status
</code></pre></div><p>To add an object to Mongo, you simply have to define a dict with
predefined values for <code>kind</code> and <code>cloud</code>. In future such attributes
can be passed to the function to determine the MongoDB collection.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.mongo.DataBaseDecorator</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">DatabaseUpdate</span>

<span style="color:#5c35cc;font-weight:bold">@DatabaseUpdate</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test</span><span style="color:#000;font-weight:bold">():</span>
  <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;kind&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;cloud&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;testcloud&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;hello&#34;</span>
  <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">data</span>

<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">test</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>When you invoke the function it will automatically store the
information into MongoDB. Naturally this requires that the
<code>~/.cloudmesh/cloudmesh.yaml</code> file is properly configured.</p>
<h2 id="mongodb">MongoDB</h2>
<p>Today MongoDB is one of leading NoSQL database which is fully capable
of handling dynamic changes, processing large volumes of complex and
unstructured data, easily using object-oriented programming features;
as well as distributed system challenges [@www-mongodb]. At its core,
MongoDB is an open source, cross-platform, document database mainly
written in C++ language.</p>
<h3 id="installation">Installation</h3>
<p>MongoDB can be installed on various Unix Platforms, including Linux,
Ubuntu, Amazon Linux, etc [@www-digitaloceaninst]. This section focuses
on installing MongoDB on Ubuntu 18.04 Bionic Beaver used as a standard
OS for a virtual machine used as a part of Big Data Application Class
during the 2018 Fall semester.</p>
<h4 id="installation-procedure">Installation procedure</h4>
<p>Before installing, it is recommended to configure the non-root user and
provide the administrative privileges to it, in order to be able to
perform general MongoDB admin tasks. This can be accomplished by login
as the root user in the following manner [@www-digitaloceanprep].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ adduser mongoadmin
$ usermod -aG sudo sammy
</code></pre></div><p>When logged in as a regular user, one can perform actions with superuser
privileges by typing <em>sudo</em> before each command [@www-digitaloceanprep].</p>
<p>Once the user set up is completed, one can login as a regular user (mongoadmin)
and use the following instructions to install MongoDB.</p>
<p>To update the Ubuntu packages to the most recent versions, use the next command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt update
</code></pre></div><p>To install the MongoDB package:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt install -y mongodb
</code></pre></div><p>To check the service and database status:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo systemctl status mongodb
</code></pre></div><p>Verifying the status of a successful MongoDB installation can be confirmed
with an output similar to this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongodb.service - An object/document-oriented database
    Loaded: loaded <span style="color:#ce5c00;font-weight:bold">(</span>/lib/systemd/system/mongodb.service<span style="color:#000;font-weight:bold">;</span> enabled<span style="color:#000;font-weight:bold">;</span> vendor preset: enabled<span style="color:#ce5c00;font-weight:bold">)</span>
    Active: **active** <span style="color:#ce5c00;font-weight:bold">(</span>running<span style="color:#ce5c00;font-weight:bold">)</span> since Sat 2018-11-15 07:48:04 UTC<span style="color:#000;font-weight:bold">;</span> 2min 17s ago
      Docs: man:mongod<span style="color:#ce5c00;font-weight:bold">(</span>1<span style="color:#ce5c00;font-weight:bold">)</span>
  Main PID: <span style="color:#0000cf;font-weight:bold">2312</span> <span style="color:#ce5c00;font-weight:bold">(</span>mongod<span style="color:#ce5c00;font-weight:bold">)</span>
     Tasks: <span style="color:#0000cf;font-weight:bold">23</span> <span style="color:#ce5c00;font-weight:bold">(</span>limit: 1153<span style="color:#ce5c00;font-weight:bold">)</span>
    CGroup: /system.slice/mongodb.service
           └─2312 /usr/bin/mongod --unixSocketPrefix<span style="color:#ce5c00;font-weight:bold">=</span>/run/mongodb --config /etc/mongodb.conf
</code></pre></div><p>To verify the configuration, more specifically the installed version, server,
and port, use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongo --eval <span style="color:#4e9a06">&#39;db.runCommand({ connectionStatus: 1 })&#39;</span>
</code></pre></div><p>Similarly, to restart MongoDB, use the following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo systemctl restart mongodb
</code></pre></div><p>To allow access to MongoDB from an outside hosted server one can use the
following command which opens the fire-wall connections [@www-digitaloceaninst].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo ufw allow from your_other_server_ip/32 to any port <span style="color:#0000cf;font-weight:bold">27017</span>
</code></pre></div><p>Status can be verified by using:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo ufw status
</code></pre></div><p>Other MongoDB configurations can be edited through the <em>/etc/mongodb.conf</em>
files such as port and hostnames, file paths.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo nano /etc/mongodb.conf
</code></pre></div><p>Also, to complete this step, a server&rsquo;s IP address must be added to the
bindIP value [@www-digitaloceaninst].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#000">logappend</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>

  <span style="color:#000">bind_ip</span> <span style="color:#ce5c00;font-weight:bold">=</span> 127.0.0.1,your_server_ip
  *port <span style="color:#ce5c00;font-weight:bold">=</span> 27017*
</code></pre></div><p>MongoDB is now listening for a remote connection that can be accessed
by anyone with appropriate credentials [@www-digitaloceaninst].</p>
<h3 id="collections-and-documents">Collections and Documents</h3>
<p>Each database within Mongo environment contains collections which in
turn contain documents. Collections and documents are analogous to
tables and rows respectively to the relational databases. The document
structure is in a key-value form which allows storing of complex data
types composed out of field and value pairs. Documents are objects
which correspond to native data types in many programming languages,
hence a well defined, embedded document can help reduce expensive
joins and improve query performance. The <code>_id</code> field helps to identify
each document uniquely [@www-guru99].</p>
<p>MongoDB offers flexibility to write records that are not restricted by
column types. The data storage approach is flexible as it allows one
to store data as it grows and to fulfill varying needs of applications
and/or users. It supports JSON like binary points known as BSON where
data can be stored without specifying the type of data. Moreover, it
can be distributed to multiple machines at high speed. It includes a
sharding feature that partitions and spreads the data out across
various servers. This makes MongoDB an excellent choice for cloud data
processing. Its utilities can load high volumes of data at high speed
which ultimately provides greater flexibility and availability in a
cloud-based environment [@www-upwork].</p>
<p>The dynamic schema structure within MongoDB allows easy testing of the
small sprints in the Agile project management life cycles and research
projects that require frequent changes to the data structure with
minimal downtime. Contrary to this flexible process, modifying the
data structure of relational databases can be a very tedious process
[@www-upwork].</p>
<h4 id="collection-example">Collection example</h4>
<p>The following collection example for a person named <em>Albert</em> includes
additional information such as age, status, and group
[@www-mongocollection].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
 <span style="color:#a40000">name:</span> <span style="color:#204a87;font-weight:bold">&#34;Albert&#34;</span>
 <span style="color:#a40000">age</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;21&#34;</span>
 <span style="color:#a40000">status</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Open&#34;</span>
 <span style="color:#a40000">group</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;AI&#34;</span> <span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Machine Learning&#34;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="document-structure">Document structure</h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
   <span style="color:#a40000">field1:</span> <span style="color:#a40000">value1,</span>
   <span style="color:#a40000">field2:</span> <span style="color:#a40000">value2,</span>
   <span style="color:#a40000">field3:</span> <span style="color:#a40000">value3,</span>
   <span style="color:#a40000">...</span>
   <span style="color:#a40000">fieldN:</span> <span style="color:#a40000">valueN</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="collection-operations">Collection Operations</h4>
<p>If collection does not exists, MongoDB database will create a collection
by default.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; db.myNewCollection1.insertOne<span style="color:#ce5c00;font-weight:bold">(</span> <span style="color:#ce5c00;font-weight:bold">{</span> x: <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">)</span>
&gt; db.myNewCollection2.createIndex<span style="color:#ce5c00;font-weight:bold">(</span> <span style="color:#ce5c00;font-weight:bold">{</span> y: <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">)</span>
</code></pre></div><h3 id="mongodb-querying">MongoDB Querying</h3>
<p>The data retrieval patterns, the frequency of data manipulation
statements such as insert, updates, and deletes may demand for the use
of indexes or incorporating the sharding feature to improve query
performance and efficiency of MongoDB environment [@www-guru99]. One
of the significant difference between relational databases and NoSQL
databases are joins. In the relational database, one can combine
results from two or more tables using a common column, often called as
<em>key</em>. The native table contains the <em>primary key</em> column while the
referenced table contains a <em>foreign key</em>. This mechanism allows one
to make changes in a single row instead of changing all rows in the
referenced table. This action is referred to as
<em>normalization</em>. MongoDB is a document database and mainly contains
denormalized data which means the data is repeated instead of indexed
over a specific key. If the same data is required in more than one
table, it needs to be repeated. This constraint has been eliminated in
MongoDB&rsquo;s new version 3.2. The new release introduced a <em>$lookup</em>
feature which more likely works as a left-outer-join. Lookups are
restricted to aggregated functions which means that data usually need
some type of filtering and grouping operations to be conducted
beforehand. For this reason, joins in MongoDB require more complicated
querying compared to the traditional relational database
joins. Although at this time, <em>lookups</em> are still very far from
replacing <em>joins</em>, this is a prominent feature that can resolve some
of the relational data challenges for MongoDB
[@www-sitepoint]. MongoDB queries support regular expressions as well
as range asks for specific fields that eliminate the need of returning
entire documents [@www-guru99]. MongoDB collections do not enforce
document structure like SQL databases which is a compelling
feature. However, it is essential to keep in mind the needs of the
applications[@www-upwork].</p>
<h4 id="mongo-queries-examples">Mongo Queries examples</h4>
<p>The queries can be executed from Mongo shell as well as through
scripts.</p>
<p>To query the data from a MongoDB collection, one would use MongoDB&rsquo;s
<em>find()</em> method.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; db.COLLECTION_NAME.find<span style="color:#ce5c00;font-weight:bold">()</span>
</code></pre></div><p>The output can be formatted by using the <em>pretty()</em> command.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; db.mycol.find<span style="color:#ce5c00;font-weight:bold">()</span>.pretty<span style="color:#ce5c00;font-weight:bold">()</span>
</code></pre></div><p>The MongoDB insert statements can be performed in the following manner:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; db.COLLECTION_NAME.insert<span style="color:#ce5c00;font-weight:bold">(</span>document<span style="color:#ce5c00;font-weight:bold">)</span>
</code></pre></div><blockquote>
<p>&ldquo;The <em>$lookup</em> command performs a left-outer-join to an unsharded
collection in the same database to filter in documents from the
<em>joined</em> collection for processing&rdquo; [@www-mongodblookup].</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a40000">$</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#a40000">$lookup:</span>
      <span style="color:#a40000">{</span>
        <span style="color:#a40000">from:</span> <span style="color:#a40000">&lt;collection</span> <span style="color:#a40000">to</span> <span style="color:#a40000">join&gt;,</span>
        <span style="color:#a40000">localField:</span> <span style="color:#a40000">&lt;field</span> <span style="color:#a40000">from</span> <span style="color:#a40000">the</span> <span style="color:#a40000">input</span> <span style="color:#a40000">documents&gt;,</span>
        <span style="color:#a40000">foreignField:</span> <span style="color:#a40000">&lt;field</span> <span style="color:#a40000">from</span> <span style="color:#a40000">the</span> <span style="color:#a40000">documents</span> <span style="color:#a40000">of</span> <span style="color:#a40000">the</span> <span style="color:#204a87;font-weight:bold">&#34;from&#34;</span> <span style="color:#a40000">collection&gt;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#a40000">as:</span> <span style="color:#a40000">&lt;output</span> <span style="color:#a40000">array</span> <span style="color:#a40000">field&gt;</span>
      <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#a40000">}</span>
</code></pre></div><p>This operation is equivalent to the following SQL operation:</p>
<pre><code> $ SELECT *, &lt;output array field&gt;
   FROM collection
   WHERE &lt;output array field&gt; IN (SELECT *
                               FROM &lt;collection to join&gt;
                               WHERE &lt;foreignField&gt; = &lt;collection.localField&gt;);`
</code></pre>
<p>To perform a Like Match (Regex), one would use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; db.products.find<span style="color:#ce5c00;font-weight:bold">(</span> <span style="color:#ce5c00;font-weight:bold">{</span> sku: <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#000">$regex</span>: /789$/ <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">)</span>
</code></pre></div><h3 id="mongodb-basic-functions">MongoDB Basic Functions</h3>
<p>When it comes to the technical elements of MongoDB, it posses a
rich interface for importing and storage of external data in various
formats. By using the Mongo <em>Import/Export</em> tool, one can easily
transfer contents from JSON, CSV, or TSV files into a database. MongoDB
supports CRUD (create, read, update, delete) operations efficiently
and has detailed documentation available on the product website.
It can also query the geospatial data, and it is capable of storing
geospatial data in GeoJSON objects. The <em>aggregation</em> operation of
the MongoDB process data records and returns computed results. MongoDB
aggregation framework is modeled on the concept of data pipelines
[@www-mongoexportimport].</p>
<h4 id="importexport-functions-examples">Import/Export functions examples</h4>
<p>To import JSON documents, one would use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongoimport --db users --collection contacts --file contacts.json
</code></pre></div><p>The CSV import uses the input file name to import a collection, hence,
the collection name is optional [@www-mongoexportimport].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongoimport --db users --type csv --headerline --file /opt/backups/contacts.csv
</code></pre></div><blockquote>
<p>&ldquo;<em>Mongoexport</em> is a utility that produces a JSON or CSV export of data stored
in a MongoDB instance&rdquo; [@www-mongoexportimport].</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongoexport --db <span style="color:#204a87">test</span> --collection traffic --out traffic.json
</code></pre></div><h3 id="security-features">Security Features</h3>
<p>Data security is a crucial aspect of the enterprise infrastructure management
and is the reason why MongoDB provides various security features such as
ole based access control, numerous authentication options, and encryption.
It supports mechanisms such as SCRAM, LDAP, and Kerberos authentication.
The administrator can create role/collection-based access control; also
roles can be predefined or custom. MongoDB can audit activities such
as DDL, CRUD statements, authentication and authorization operations
[@www-mongosecurity].</p>
<h4 id="collection-based-access-control-example">Collection based access control example</h4>
<p>A user defined role can contain the following privileges [@www-mongosecurity].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ privileges: <span style="color:#ce5c00;font-weight:bold">[</span>
   <span style="color:#ce5c00;font-weight:bold">{</span> resource: <span style="color:#ce5c00;font-weight:bold">{</span> db: <span style="color:#4e9a06">&#34;products&#34;</span>, collection: <span style="color:#4e9a06">&#34;inventory&#34;</span> <span style="color:#ce5c00;font-weight:bold">}</span>, actions: <span style="color:#ce5c00;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;find&#34;</span>, <span style="color:#4e9a06">&#34;update&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">}</span>,
   <span style="color:#ce5c00;font-weight:bold">{</span> resource: <span style="color:#ce5c00;font-weight:bold">{</span> db: <span style="color:#4e9a06">&#34;products&#34;</span>, collection: <span style="color:#4e9a06">&#34;orders&#34;</span> <span style="color:#ce5c00;font-weight:bold">}</span>,  actions: <span style="color:#ce5c00;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;find&#34;</span> <span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">}</span>
 <span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><h3 id="mongodb-cloud-service">MongoDB Cloud Service</h3>
<p>In regards to the cloud technologies, MongoDB also offers fully automated
cloud service called <em>Atlas</em> with competitive pricing options. Mongo Atlas
Cloud interface offers interactive GUI for managing cloud resources and
deploying applications quickly. The service is equipped with geographically
distributed instances to ensure no single point failure. Also, a well-rounded
performance monitoring interface allows users to promptly detect anomalies and
generate index suggestions to optimize the performance and reliability of the
database. Global technology leaders such as Google, Facebook, eBay, and Nokia
are leveraging MongoDB and <em>Atlas</em> cloud services making MongoDB one of the most
popular choices among the NoSQL databases [@www-mongoatlas].</p>
<h2 id="pymongo">PyMongo</h2>
<p>PyMongo is the official Python driver or distribution that allows work
with a NoSQL type database called <em>MongoDB</em> [@api-mongodb-com-api]. The
first version of the driver was developed in 2009 [@www-pymongo-blog],
only two years after the development of MongoDB was started. This driver
allows developers to combine both Python&rsquo;s versatility and MongoDB&rsquo;s
flexible schema nature into successful applications. Currently, this
driver supports MongoDB versions 2.6, 3.0, 3.2, 3.4, 3.6, and 4.0
[@www-github]. MongoDB and Python represent a compatible fit considering
that BSON (binary JSON) used in this NoSQL database is very similar
to Python dictionaries, which makes the collaboration between the two
even more appealing [@www-mongodb-slideshare]. For this reason, dictionaries
are the recommended tools to be used in PyMongo when representing
documents [@www-gearheart].</p>
<h3 id="installation-1">Installation</h3>
<p>Prior to being able to exploit the benefits of Python and MongoDB
simultaneously, the PyMongo distribution must be installed using
<em>pip</em>. To install it on all platforms, the following command should
be used [@www-api-mongodb-installation]:</p>
<p><code>$ python -m pip install pymongo</code></p>
<p>Specific versions of PyMongo can be installed with command lines
such as in our example where the 3.5.1 version is installed
[@www-api-mongodb-installation].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m pip install <span style="color:#000">pymongo</span><span style="color:#ce5c00;font-weight:bold">==</span>3.5.1
</code></pre></div><p>A single line of code can be used to upgrade the driver as well
[@www-api-mongodb-installation].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m pip install --upgrade pymongo
</code></pre></div><p>Furthermore, the installation process can be completed with
the help of the <em>easy_install</em> tool, which requires users to use
the following command [@www-api-mongodb-installation].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m easy_install pymongo
</code></pre></div><p>To do an upgrade of the driver using this tool, the following
command is recommended [@www-api-mongodb-installation]:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m easy_install -U pymongo
</code></pre></div><p>There are many other ways of installing PyMongo directly from
the source, however, they require for C extension dependencies
to be installed prior to the driver installation step, as they
are the ones that skim through the sources on GitHub and use
the most up-to-date links to install the driver
[@www-api-mongodb-installation].</p>
<p>To check if the installation was completed accurately, the
following command is used in the Python console
[@www-realpython].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">import pymongo
</code></pre></div><p>If the command returns zero exceptions within the Python
shell, one can consider for the PyMongo installation to
have been completed successfully.</p>
<h3 id="dependencies">Dependencies</h3>
<p>The PyMongo driver has a few dependencies that should
be taken into consideration prior to its usage. Currently,
it supports CPython 2.7, 3.4+, PyPy, and PyPy 3.5+
interpreters [@www-github]. An optional dependency that
requires some additional components to be installed is
the GSSAPI authentication [@www-github]. For the Unix based
machines, it requires <em>pykerberos</em>, while for the Windows
machines <em>WinKerberos</em> is needed to fullfill this requirement
[@www-github]. The automatic installation of this dependency
can be done simultaneously with the driver installation, in
the following manner:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m pip install pymongo<span style="color:#ce5c00;font-weight:bold">[</span>gssapi<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Other third-party dependencies such as <em>ipaddress</em>, <em>certifi</em>,
or <em>wincerstore</em> are necessary for connections with help of
TLS/SSL and can also be simultaneously installed along with the
driver installation [@www-github].</p>
<h3 id="running-pymongo-with-mongo-deamon">Running PyMongo with Mongo Deamon</h3>
<p>Once PyMongo is installed, the Mongo deamon can be run with a
very simple command in a new terminal window [@www-realpython].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mongod
</code></pre></div><h3 id="connecting-to-a-database-using-mongoclient">Connecting to a database using MongoClient</h3>
<p>In order to be able to establish a connection with a database,
a MongoClient class needs to be imported, which sub-sequentially
allows the MongoClient object to communicate with the database
[@www-realpython].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">pymongo</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">MongoClient</span>
<span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MongoClient</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>This command allows a connection with a default, local host
through port 27017, however, depending on the programming
requirements, one can also specify those by listing them in the
client instance or use the same information via the Mongo URI
format [@www-realpython].</p>
<h3 id="accessing-databases">Accessing Databases</h3>
<p>Since MongoClient plays a server role, it can be used to access
any desired databases in an easy way. To do that, one can use two
different approaches. The first approach would be doing this via
the <em>attribute</em> method where the name of the desired database is
listed as an attribute, and the second approach, which would
include a dictionary-style access [@www-realpython]. For example,
to access a database called <em>cloudmesh_community</em>, one would use
the following commands for the attribute and for the dictionary
method, respectively.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh_community</span>
<span style="color:#000">db</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cloudmesh_community&#39;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><h3 id="creating-a-database">Creating a Database</h3>
<p>Creating a database is a straight forward process. First, one must
create a MongoClient object and specify the connection (IP address)
as well as the name of the database they are trying to create
[@www-w3schools]. The example of this command is presented in the
followng section:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pymongo</span>
<span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pymongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">MongoClient</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;mongodb://localhost:27017/&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">db</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cloudmesh&#39;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><h3 id="inserting-and-retrieving-documents-querying">Inserting and Retrieving Documents (Querying)</h3>
<p>Creating documents and storing data using PyMongo is equally easy
as accessing and creating databases. In order to add new data, a
collection must be specified first. In this example, a decision is
made to use the <em>cloudmesh</em> group of documents.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">cloudmesh</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh</span>
</code></pre></div><p>Once this step is completed, data may be inserted using the
<em>insert_one()</em> method, which means that only one document is
being created. Of course, insertion of multiple documents at
the same time is possible as well with use of the <em>insert_many()</em>
method [@www-realpython]. An example of this method is as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">course_info</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
     <span style="color:#4e9a06">&#39;course&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Big Data Applications and Analytics&#39;</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#4e9a06">&#39;instructor&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39; Gregor von Laszewski&#39;</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#4e9a06">&#39;chapter&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;technologies&#39;</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cloudmesh</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">insert_one</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">course_info</span><span style="color:#000;font-weight:bold">)</span><span style="color:#a40000">`</span>
</code></pre></div><p>Another example of this method would be to create a collection.
If we wanted to create a collection of students in the
<em>cloudmesh_community</em>, we would do it in the following manner:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">student</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;John&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;st_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">52642</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Mercedes&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;st_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5717</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Anna&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;st_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5654</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Greg&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;st_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5423</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Amaya&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;st_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3540</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Cameron&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;st_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2343</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Bozer&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;st_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">4143</span><span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Cody&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;price&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2165</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span>

<span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MongoClient</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;mongodb://localhost:27017/&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">client</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">db</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh</span>
    <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">students</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">insert_many</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">student</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Retrieving documents is equally simple as creating them. The
<em>find_one()</em> method can be used to retrieve one document
[@www-realpython]. An implementation of this method is given
in the following example.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">gregors_course</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cloudmesh</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find_one</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#39;instructor&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#39;Gregor von Laszewski&#39;</span><span style="color:#000;font-weight:bold">})</span>
</code></pre></div><p>Similarly, to retieve multiple documents, one would use the
<em>find()</em> method instead of the <em>find_one()</em>. For example, to
find all courses thought by professor von Laszewski, one would
use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">gregors_course</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cloudmesh</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#39;instructor&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#39;Gregor von Laszewski&#39;</span><span style="color:#000;font-weight:bold">})</span>
</code></pre></div><p>One thing that users should be cognizant of when using the <em>find()</em>
method is that it does not return results in an array format but
as a <em>cursor</em> object, which is a combination of methods that work
together to help with data querying [@www-realpython]. In order to
return individual documents, iteration over the result must be
completed [@www-realpython].</p>
<h3 id="limiting-results">Limiting Results</h3>
<p>When it comes to working with large databases it is always useful to
limit the number of query results. PyMongo supports this option
with its <em>limit()</em> method [@www-w3schools]. This method takes in one
parameter which specifies the number of documents to be returned
[@www-w3schools]. For example, if we had a collection with a large
number of cloud technologies as individual documents, one could
modify the query results to return only the top 10 technologies.
To do this, the following example could be utilized:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pymongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">MongoClient</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;mongodb://localhost:27017/&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">db</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cloudmesh&#39;</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">col</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">db</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;technologies&#39;</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">topten</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">col</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">limit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="updating-collection">Updating Collection</h3>
<p>Updating documents is very similar to inserting and retrieving
the same. Depending on the number of documents to be updated,
one would use the <em>update_one()</em> or <em>update_many()</em> method
[@www-w3schools]. Two parameters need to be passed in the
<em>update_one()</em> method for it to successfully execute. The
first argument is the query object that specifies the document
to be changed, and the second argument is the object that
specifies the new value in the document. An example of
the <em>update_one()</em> method in action is the following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">myquery</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#39;course&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Big Data Applications and Analytics&#39;</span> <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">newvalues</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#39;$set&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#39;course&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Cloud Computing&#39;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Updating all documents that fall under the same criteria can be
done with the <em>update_many</em> method [@www-w3schools]. For example,
to update all documents in which course title starts with letter
<em>B</em> with a different instructor information, we would do the
following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pymongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">MongoClient</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;mongodb://localhost:27017/&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">db</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cloudmesh&#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">col</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">db</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;courses&#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">query</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#39;course&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#39;$regex&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;^B&#39;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">newvalues</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#39;$set&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#39;instructor&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;Gregor von Laszewski&#39;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000">edited</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">col</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">update_many</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">query</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">newvalues</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="counting-documents">Counting Documents</h3>
<p>Counting documents can be done with one simple operation called
<em>count_documents()</em> instead of using a full query
[@www-pymongo-tutorial]. For example, we can count the documents
in the <em>cloudmesh_commpunity</em> by using the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">cloudmesh</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">count_documents</span><span style="color:#000;font-weight:bold">({})</span>
</code></pre></div><p>To create a more specific count, one would use a command similar
to this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">cloudmesh</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">count_documents</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#39;author&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;von Laszewski&#39;</span><span style="color:#000;font-weight:bold">})</span>
</code></pre></div><p>This technology supports some more advanced querying options as
well. Those advanced queries allow one to add certain contraints
and narrow down the results even more. For example, to get the
courses thought by professor von Laszewski after a certain date,
one would use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">d</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">datetime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2017</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">11</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">course</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">cloudmesh</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#39;date&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;$lt&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">d</span><span style="color:#000;font-weight:bold">}})</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;author&#39;</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">pprint</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pprint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">course</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="indexing">Indexing</h3>
<p>Indexing is a very important part of querying. It can greately
improve query performance but also add functionality and aide in
storing documents [@www-pymongo-tutorial].</p>
<blockquote>
<p>&ldquo;To create a unique index on a key that rejects documents whose
value for that key already exists in the index&rdquo;
[@www-pymongo-tutorial].</p>
</blockquote>
<p>We need to firstly create the index in the following manner:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">profiles</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_index</span><span style="color:#000;font-weight:bold">([(</span><span style="color:#4e9a06">&#39;user_id&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">pymongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ASCENDING</span><span style="color:#000;font-weight:bold">)],</span>
<span style="color:#000">unique</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87">sorted</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">profiles</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">index_information</span><span style="color:#000;font-weight:bold">()))</span>
</code></pre></div><p>This command acutally creates two different indexes. The first
one is the *_id* , created by MongoDB automatically, and the
second one is the <em>user_id</em>, created by the user.</p>
<p>The purpose of those indexes is to cleverly prevent future
additions of invalid <em>user_ids</em> into a collection.</p>
<h3 id="sorting">Sorting</h3>
<p>Sorting on the server-side is also avaialable via MongoDB.
The PyMongo <em>sort()</em> method is equivalent to the SQL
<em>order by</em> statement and it can be performed as <em>pymongo.ascending</em>
and <em>pymongo.descending</em> [@book-ohiggins]. This method is much
more efficient as it is being completed on the server-side,
compared to the sorting completed on the client side. For example,
to return all users with first name <em>Gregor</em> sorted in descending
order by birthdate we would use a command such as this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">users</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cloudmesh</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">users</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#39;firstname&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#39;Gregor&#39;</span><span style="color:#000;font-weight:bold">})</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sort</span><span style="color:#000;font-weight:bold">((</span><span style="color:#4e9a06">&#39;dateofbirth&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">pymongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DESCENDING</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">user</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">users</span><span style="color:#000;font-weight:bold">:</span>
   <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;email&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="aggregation">Aggregation</h3>
<p>Aggregation operations are used to process given data and produce
summarized results. Aggregation operations collect data from a number
of documents and provide collective results by grouping data. PyMongo
in its documentation offers a separate framework that supports data
aggregation. This aggregation framework can be used to</p>
<blockquote>
<p>&ldquo;provide projection capabilities to reshape the returned data&rdquo;
[@www-mongo-aggregation].</p>
</blockquote>
<p>In the aggregation pipeline, documents pass through multiple pipeline
stages which convert documents into result data. The basic pipeline
stages include filters. Those filters act like document transformation
by helping change the document output form. Other pipelines help group
or sort documents with specific fields. By using native operations from
MongoDB, the pipeline operators are efficient in aggregating results.</p>
<p>The <em>addFields</em> stage is used to add new fields into documents. It
reshapes each document in stream, similarly to the <em>project</em> stage.
The output document will contain existing fields from input documents
and the newly added fields @www-docs-mongodb]. The following example
shows how to add <em>student details</em> into a document.</p>
<pre><code>  db.cloudmesh_community.aggregate([
 {
        $addFields: {
        &quot;document.StudentDetails&quot;: {
        $concat:['$document.student.FirstName', '$document.student.LastName']
            }
        }
    } ])
</code></pre>
<p>The <em>bucket</em> stage is used to categorize incoming documents
into groups based on specified expressions. Those groups are
called <em>buckets</em> [@www-docs-mongodb]. The following example shows
the <em>bucket</em> stage in action.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">([</span>
<span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$group&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;city&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$city&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;age&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;$let&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;vars&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
 <span style="color:#4e9a06">&#34;age&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$subtract&#34;</span> <span style="color:#000;font-weight:bold">:[{</span> <span style="color:#4e9a06">&#34;$year&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">new</span> <span style="color:#000">Date</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">},{</span> <span style="color:#4e9a06">&#34;$year&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$birthDay&#34;</span> <span style="color:#000;font-weight:bold">}]</span> <span style="color:#000;font-weight:bold">}},</span>
        <span style="color:#4e9a06">&#34;in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
          <span style="color:#4e9a06">&#34;$switch&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;branches&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
              <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;case&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$lt&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;$$age&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">20</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;then&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#000;font-weight:bold">},</span>
              <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;case&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$lt&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;$$age&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">30</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;then&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">20</span> <span style="color:#000;font-weight:bold">},</span>
              <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;case&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$lt&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;$$age&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">40</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;then&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">30</span> <span style="color:#000;font-weight:bold">},</span>
              <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;case&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$lt&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;$$age&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">50</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;then&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">40</span> <span style="color:#000;font-weight:bold">},</span>
              <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;case&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$lt&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;$$age&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">200</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;then&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">50</span> <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">}</span>  <span style="color:#000;font-weight:bold">}</span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#4e9a06">&#34;count&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;$sum&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">}}})</span>
</code></pre></div><p>In the <em>bucketAuto</em> stage, the boundaries are automatically
determined in an attempt to evenly distribute documents into
a specified number of buckets. In the following operation,
input documents are grouped into four buckets according to
the values in the price field [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">artwork</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span>
  <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#a40000">$</span><span style="color:#000">bucketAuto</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">groupBy</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$price&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">buckets</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">4</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">}</span>
 <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>collStats</em> stage returns statistics regarding a collection
or view [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">matrices</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">collStats</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">latencyStats</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">histograms</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">true</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>
 <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>count</em> stage passes a document to the next stage that
contains the number documents that were input to the stage
[@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">scores</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>  <span style="color:#000;font-weight:bold">[</span>    <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#a40000">$</span><span style="color:#000">match</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>        <span style="color:#000">score</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>          <span style="color:#a40000">$</span><span style="color:#000">gt</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">80</span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>  <span style="color:#000;font-weight:bold">},</span>
 <span style="color:#000;font-weight:bold">{</span>      <span style="color:#a40000">$</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;passing_scores&#34;</span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">])</span>
</code></pre></div><p>The <em>facet</em> stage helps process multiple aggregation pipelines
in a single stage [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">artwork</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#a40000">$</span><span style="color:#000">facet</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>  <span style="color:#4e9a06">&#34;categorizedByTags&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>   <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">unwind</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$tags&#34;</span> <span style="color:#000;font-weight:bold">},</span>
       <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">sortByCount</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$tags&#34;</span> <span style="color:#000;font-weight:bold">}</span>  <span style="color:#000;font-weight:bold">],</span>  <span style="color:#4e9a06">&#34;categorizedByPrice&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
       <span style="color:#ce5c00;font-weight:bold">//</span> <span style="color:#000">Filter</span> <span style="color:#000">out</span> <span style="color:#000">documents</span> <span style="color:#000">without</span> <span style="color:#000">a</span> <span style="color:#000">price</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_id</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span>
       <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">match</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">price</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">exists</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">bucket</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">groupBy</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$price&#34;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#000">boundaries</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>  <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">150</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">200</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">300</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">400</span> <span style="color:#000;font-weight:bold">],</span>
          <span style="color:#000">default</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Other&#34;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#000">output</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;count&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">},</span>
            <span style="color:#4e9a06">&#34;titles&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$title&#34;</span> <span style="color:#000;font-weight:bold">}</span>
          <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>        <span style="color:#000;font-weight:bold">}],</span> <span style="color:#4e9a06">&#34;categorizedByYears(Auto)&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">bucketAuto</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">groupBy</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$year&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">buckets</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#000;font-weight:bold">}</span>
      <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]}}])</span>
</code></pre></div><p>The <em>geoNear</em> stage returns an ordered stream of documents
based on the proximity to a geospatial point. The output documents
include an additional distance field and can include a location
identifier field [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">places</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">([</span>
 <span style="color:#000;font-weight:bold">{</span>    <span style="color:#a40000">$</span><span style="color:#000">geoNear</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#000">near</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Point&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">coordinates</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">73.99279</span> <span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">40.719296</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000">distanceField</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dist.calculated&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#000">maxDistance</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#000">query</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;public&#34;</span> <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000">includeLocs</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dist.location&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#000">num</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#000">spherical</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">true</span>
   <span style="color:#000;font-weight:bold">}</span>  <span style="color:#000;font-weight:bold">}])</span>
</code></pre></div><p>The <em>graphLookup</em> stage performs a recursive search on a
collection. To each output document, it adds a new array field
that contains the traversal results of the recursive search
for that document [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">travelers</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span>
 <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#a40000">$</span><span style="color:#000">graphLookup</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
       <span style="color:#000">from</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;airports&#34;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">startWith</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$nearestAirport&#34;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">connectFromField</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;connects&#34;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">connectToField</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;airport&#34;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">maxDepth</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">depthField</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;numConnections&#34;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#204a87;font-weight:bold">as</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;destinations&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
 <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>group</em> stage consumes the document data per each
distinct group. It has a RAM limit of 100 MB. If the
stage exceeds this limit, the <em>group</em> produces an
error [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sales</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
 <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#a40000">$</span><span style="color:#000">group</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
         <span style="color:#000">_id</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">month</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">month</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$date&#34;</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#000">day</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">dayOfMonth</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$date&#34;</span> <span style="color:#000;font-weight:bold">},</span>
         <span style="color:#000">year</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">year</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$date&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">},</span>
         <span style="color:#000">totalPrice</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">multiply</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;$price&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;$quantity&#34;</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">},</span>
         <span style="color:#000">averageQuantity</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">avg</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$quantity&#34;</span> <span style="color:#000;font-weight:bold">},</span>
         <span style="color:#000">count</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#204a87">sum</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">}</span>
       <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
 <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>indexStats</em> stage returns statistics regarding
the use of each index for a collection [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">orders</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">indexStats</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>limit</em> stage is used for controlling the number of
documents passed to the next stage in the pipeline
[@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">article</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
  <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">limit</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>listLocalSessions</em> stage gives the session information
currently connected to mongos or mongod instance
[@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span>  <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">listLocalSessions</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">allUsers</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">true</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>listSessions</em> stage lists out all session that have
been active long enough to propagate to the <em>system.sessions</em>
collection [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> <span style="color:#000">use</span> <span style="color:#000">config</span>
 <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">system</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sessions</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span>  <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">listSessions</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">allUsers</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">true</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>lookup</em> stage is useful for performing outer joins to
other collections in the same database [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">{</span>
   <span style="color:#a40000">$</span><span style="color:#000">lookup</span><span style="color:#000;font-weight:bold">:</span>
     <span style="color:#000;font-weight:bold">{</span>
       <span style="color:#000">from</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">collection</span> <span style="color:#000">to</span> <span style="color:#000">join</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">localField</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">field</span> <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">the</span> <span style="color:#000">input</span> <span style="color:#000">documents</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">foreignField</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">field</span> <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">the</span> <span style="color:#000">documents</span> <span style="color:#000">of</span> <span style="color:#000">the</span> <span style="color:#4e9a06">&#34;from&#34;</span> <span style="color:#000">collection</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#204a87;font-weight:bold">as</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">output</span> <span style="color:#000">array</span> <span style="color:#000">field</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
     <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>The <em>match</em> stage is used to filter the document stream.
Only matching documents pass to next stage [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">articles</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">match</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">author</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dave&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>project</em> stage is used to reshape the documents by
adding or deleting the fields.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">books</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">project</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">title</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">,</span> <span style="color:#000">author</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>redact</em> stage reshapes stream documents by restricting
information using information stored in documents themselves
[@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">accounts</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
  <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">match</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">status</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;A&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#a40000">$</span><span style="color:#000">redact</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#a40000">$</span><span style="color:#000">cond</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
          <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">eq</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;$level&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">},</span>
          <span style="color:#000">then</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$$PRUNE&#34;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$$DESCEND&#34;</span>
        <span style="color:#000;font-weight:bold">}</span>      <span style="color:#000;font-weight:bold">}</span>    <span style="color:#000;font-weight:bold">}</span>  <span style="color:#000;font-weight:bold">]);</span>
</code></pre></div><p>The <em>replaceRoot</em> stage is used to replace a document with
a specified embedded document [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">produce</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span>
   <span style="color:#000;font-weight:bold">{</span>
     <span style="color:#a40000">$</span><span style="color:#000">replaceRoot</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">newRoot</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$in_stock&#34;</span> <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>sample</em> stage is used to sample out data by randomly
selecting number of documents form input [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">users</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
   <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">sample</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>skip</em> stage skips specified initial number of documents
and passes remaining documents to the pipeline [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">article</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
   <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">skip</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">);</span>
</code></pre></div><p>The <em>sort</em> stage is useful while reordering document stream
by a specified sort key [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> <span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">users</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">sort</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">age</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">posts</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
 <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>sortByCounts</em> stage groups the incoming documents
based on a specified expression value and counts documents
in each distinct group [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exhibits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span>
<span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">unwind</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$tags&#34;</span> <span style="color:#000;font-weight:bold">},</span>  <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">sortByCount</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$tags&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>unwind</em> stage deconstructs an array field from the
input documents to output a document for each element [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">inventory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">unwind</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$sizes&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">inventory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">unwind</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">path</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$sizes&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The <em>out</em> stage is used to write aggregation pipeline results
into a collection. This stage should be the last stage of a
pipeline [@www-docs-mongodb].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">books</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">aggregate</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">[</span>
                  <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">group</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">_id</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$author&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">books</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">push</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;$title&#34;</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">},</span>
                      <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">out</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;authors&#34;</span> <span style="color:#000;font-weight:bold">}</span>
                  <span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Another option from the <em>aggregation operations</em> is the Map/Reduce
framework, which essentially includes two different functions,
<em>map</em> and <em>reduce</em>. The first one provides the key value pair for
each tag in the array, while the latter one</p>
<blockquote>
<p>&ldquo;sums over all of the emitted values for a given key&rdquo;
[@www-mongo-aggregation].</p>
</blockquote>
<p>The last step in the Map/Reduce process it to call the
<em>map_reduce()</em> function and iterate over the results
[@www-mongo-aggregation]. The Map/Reduce operation provides
result data in a collection or returns results in-line. One
can perform subsequent operations with the same input collection
if the output of the same is written to a collection
[@www-docs-map-reduce]. An operation that produces results
in a in-line form must provide results with in the BSON
document size limit. The current limit for a BSON document is
16 MB. These types of operations are not supported by views
[@www-docs-map-reduce]. The PyMongo&rsquo;s API supports all
features of the MongoDB&rsquo;s Map/Reduce engine [@www-api-map-reduce].
Moreover, Map/Reduce has the ability to get more detailed results
by passing <em>full_response=True</em> argument to the <em>map_reduce()</em>
function [@www-api-map-reduce].</p>
<h3 id="deleting-documents-from-a-collection">Deleting Documents from a Collection</h3>
<p>The deletion of documents with PyMongo is fairly straight
forward. To do so, one would use the <em>remove()</em> method of
the PyMongo Collection object [@book-ohiggins]. Similarly
to the reads and updates, specification of documents to be
removed is a must. For example, removal of the entire
document collection with a score of 1, would required one
to use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">cloudmesh</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">users</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">remove</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#34;score&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">safe</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">})</span>
</code></pre></div><p>The <em>safe</em> parameter set to <em>True</em> ensures the operation was
completed [@book-ohiggins].</p>
<h3 id="copying-a-database">Copying a Database</h3>
<p>Copying databases within the same mongod instance or between
different mongod servers is made possible with the <em>command()</em>
method after connecting to the desired mongod instance
[@www-pymongo-documentation-copydb]. For example, to copy the
<em>cloudmesh</em> database and name the new database <em>cloudmesh_copy</em>,
one would use the <em>command()</em> method in the following manner:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">admin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">command</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;copydb&#39;</span><span style="color:#000;font-weight:bold">,</span>
                         <span style="color:#000">fromdb</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cloudmesh&#39;</span><span style="color:#000;font-weight:bold">,</span>
                         <span style="color:#000">todb</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cloudmesh_copy&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>There are two ways to copy a database between servers. If a
server is not password-prodected, one would not need to
pass in the credentials nor to authenticate to the admin
database [@www-pymongo-documentation-copydb]. In that case,
to copy a database one would use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">admin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">command</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;copydb&#39;</span><span style="color:#000;font-weight:bold">,</span>
                         <span style="color:#000">fromdb</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cloudmesh&#39;</span><span style="color:#000;font-weight:bold">,</span>
                         <span style="color:#000">todb</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cloudmesh_copy&#39;</span><span style="color:#000;font-weight:bold">,</span>
                         <span style="color:#000">fromhost</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;source.example.com&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>On the other hand, if the server where we are copying the
database to is protected, one would use this command instead:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MongoClient</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;target.example.com&#39;</span><span style="color:#000;font-weight:bold">,</span>
                     <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;administrator&#39;</span><span style="color:#000;font-weight:bold">,</span>
                     <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;pwd&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">admin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">command</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;copydb&#39;</span><span style="color:#000;font-weight:bold">,</span>
                     <span style="color:#000">fromdb</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cloudmesh&#39;</span><span style="color:#000;font-weight:bold">,</span>
                     <span style="color:#000">todb</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cloudmesh_copy&#39;</span><span style="color:#000;font-weight:bold">,</span>
                     <span style="color:#000">fromhost</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;source.example.com&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="pymongo-strengths">PyMongo Strengths</h3>
<p>One of PyMongo strengths is that allows document creation and
querying natively</p>
<blockquote>
<p>&ldquo;through the use of existing language features such as nested
dictionaries and lists&rdquo; [@book-ohiggins].</p>
</blockquote>
<p>For moderately experienced Python developers, it is very easy to
learn it and quickly feel comfortable with it.</p>
<blockquote>
<p>&ldquo;For these reasons, MongoDB and Python make a powerful
combination for rapid, iterative development of horizontally
scalable backend applications&rdquo; [@book-ohiggins].</p>
</blockquote>
<p>According to [@book-ohiggins], MongoDB is very applicable
to modern applications, which makes PyMongo equally valuable
[@book-ohiggins].</p>
<h2 id="mongoengine">MongoEngine</h2>
<blockquote>
<p>&ldquo;MongoEngine is an Object-Document Mapper, written in Python
for working with MongoDB&rdquo; [@www-docs-mongoengine].</p>
</blockquote>
<p>It is actually a library that allows a more advanced communication
with MongoDB compared to PyMongo. As MongoEngine is technically
considered to be an object-document mapper(ODM), it can also be
considered to be</p>
<blockquote>
<p>&ldquo;equivalent to a SQL-based object relational mapper(ORM)&rdquo;
[@www-realpython].</p>
</blockquote>
<p>The primary technique why one would use an ODM includes
<em>data conversion</em> between computer systems that are not
compatible with each other [@www-wikiodm]. For the purpose of
converting data to the appropriate form, a <em>virtual object
database</em> must be created within the utilized programming
language [@www-wikiodm]. This library is also used to define
schemata for documents within MongoDB, which ultimately helps
with minimizing coding errors as well defining methods
on existing fields [@www-mongoengine-schema]. It is also
very beneficial to the overall workflow as it tracks changes
made to the documents and aids in the document saving process
[@www-mongoengine-instances].</p>
<h3 id="installation-2">Installation</h3>
<p>The installation process for this technology is fairly simple
as it is considered to be a library. To install it, one would
use the following command [@www-installing]:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install mongoengine
</code></pre></div><p>A <em>bleeding-edge</em> version of MongoEngine can be installed directly
from GitHub by first cloning the repository on the local machine,
virtual machine, or cloud.</p>
<h3 id="connecting-to-a-database-using-mongoengine">Connecting to a database using MongoEngine</h3>
<p>Once installed, MongoEngine needs to be connected to an
instance of the mongod, similarly to PyMongo [@www-connecting].
The <em>connect()</em> function must be used to successfully
complete this step and the argument that must be used in
this function is the name of the desired database [@www-connecting].
Prior to using this function, the function name needs
to be imported from the MongoEngine library.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mongoengine</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">connect</span>
<span style="color:#000">connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;cloudmesh_community&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Similarly to the MongoClient, MongoEngine uses the local
host and port 27017 by default, however, the <em>connect()</em>
function also allows specifying other hosts and port
arguments as well [@www-connecting].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">connect<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;cloudmesh_community&#39;</span>, <span style="color:#000">host</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;196.185.1.62&#39;</span>, <span style="color:#000">port</span><span style="color:#ce5c00;font-weight:bold">=</span>16758<span style="color:#ce5c00;font-weight:bold">)</span>
</code></pre></div><p>Other types of connections are also supported (i.e. URI)
and they can be completed by providing the URI in the
<em>connect()</em> function [@www-connecting].</p>
<h3 id="querying-using-mongoengine">Querying using MongoEngine</h3>
<p>To query MongoDB using MongoEngine an <em>objects attribute</em>
is used, which is, technically, a part of the document
class [@www-querying]. This attribute is called the
<em>QuerySetManager</em> which in return</p>
<blockquote>
<p>&ldquo;creates a new <em>QuerySet</em> object on access&rdquo; [@www-querying].</p>
</blockquote>
<p>To be able to access individual documents from a database,
this object needs to be iterated over. For example, to
return/print all students in the <em>cloudmesh_community</em> object
(database), the following command would be used.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">user</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#000;font-weight:bold">:</span>
   <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">student</span>
</code></pre></div><p>MongoEngine also has a capability of query filtering
which means that a keyword can be used within the called
<em>QuerySet</em> object to retrieve specific information
[@www-querying]. Let us say one would like to iterate over
<em>cloudmesh_community</em> students that are natives of Indiana.
To achieve this, one would use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">indy_students</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;IN&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>This library also allows the use of all operators except
for the equality operator in its queries, and moreover,
has the capability of handling <em>string queries</em>, <em>geo queries</em>,
<em>list querying</em>, and querying of the raw PyMongo queries
[@www-querying].</p>
<p>The string queries are useful in performing text operations
in the conditional queries. A query to find a document exactly
matching and with state <em>ACTIVE</em> can be performed in the
following manner:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exact</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;ACTIVE&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The query to retrieve document data for names that start with
a case sensitive <em>AL</em> can be written as:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">Name</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">startswith</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;AL&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>To perform an exact same query for the non-key-sensitive <em>AL</em> one
would use the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">Name</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">istartswith</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;AL&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The MongoEngine allows data extraction of geographical locations
by using Geo queries. The <em>geo_within</em> operator checks if a
geometry is within a polygon.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#000;font-weight:bold">(</span>
            <span style="color:#000">point__geo_within</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[[[</span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">41</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]]])</span>
  <span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#000;font-weight:bold">(</span>
            <span style="color:#000">point__geo_within</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Polygon&#34;</span><span style="color:#000;font-weight:bold">,</span>
                 <span style="color:#4e9a06">&#34;coordinates&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[[[</span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">41</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]]]})</span>
</code></pre></div><p>The list query looks up the documents where the specified fields
matches exactly to the given value. To match all pages that have
the word <em>coding</em> as an item in the <em>tags</em> list one would use
the following query:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Page</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Document</span><span style="color:#000;font-weight:bold">):</span>
     <span style="color:#000">tags</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ListField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">())</span>

  <span style="color:#000">Page</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tags</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;coding&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Overall, it would be safe to say that MongoEngine has good
compatibility with Python. It provides different functions
to utilize Python easily with MongoDBand which makes this
pair even more attractive to application developers.</p>
<h2 id="flask-pymongo">Flask-PyMongo</h2>
<blockquote>
<p>&ldquo;Flask is a micro-web framework written in Python&rdquo;
[@www-flask-framework].</p>
</blockquote>
<p>It was developed after Django, and it is very pythonic
in nature which implies that it is explicitly the targeting
the Python user community. It is lightweight as it does not
require additional tools or libraries and hence is classified
as a Micro-Web framework. It is often used with MongoDB using
PyMongo connector, and it treats data within MongoDB as searchable
Python dictionaries. The applications such as Pinterest, LinkedIn,
and the community web page for Flask are using the Flask framework.
Moreover, it supports various features such as the RESTful request
dispatching, secure cookies, Google app engine compatibility, and
integrated support for unit testing, etc [@www-flask-framework].
When it comes to connecting to a database, the connection details
for MongoDB can be passed as a variable or configured in PyMongo
constructor with additional arguments such as username and password,
if required. It is important that versions of both Flask and MongoDB
are compatible with each other to avoid functionality breaks
[@www-flask-pymongo].</p>
<h3 id="installation-3">Installation</h3>
<p>Flask-PyMongo can be installed with an easy command such as this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install Flask-PyMongo
</code></pre></div><p>PyMongo can be added in the following manner:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">flask</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Flask</span>
  <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">flask_pymongo</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PyMongo</span>
  <span style="color:#000">app</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Flask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">__name__</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">app</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">config</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;MONGO_URI&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;mongodb://localhost:27017/cloudmesh_community&#34;</span>
  <span style="color:#000">mongo</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PyMongo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">app</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="configuration">Configuration</h3>
<p>There are two ways to configure Flask-PyMongo. The first way
would be to pass a MongoDB URI to the PyMongo constructor,
while the second way would be to</p>
<blockquote>
<p>&ldquo;assign it to the MONGO_URI Flask confiuration variable&rdquo;
[@www-flask-pymongo].</p>
</blockquote>
<h3 id="connection-to-multiple-databasesservers">Connection to multiple databases/servers</h3>
<p>Multiple PyMongo instances can be used to connect to multiple
databases or database servers. To achieve this, once would
use a command similar to the following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#000">app</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Flask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">__name__</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">mongo1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PyMongo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">app</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">uri</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mongodb://localhost:27017/cloudmesh_community_one&#34;</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">mongo2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PyMongo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">app</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">uri</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mongodb://localhost:27017/cloudmesh_community_two&#34;</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">mongo3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PyMongo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">app</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">uri</span><span style="color:#ce5c00;font-weight:bold">=</span>
        <span style="color:#4e9a06">&#34;mongodb://another.host:27017/cloudmesh_community_Three&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="flask-pymongo-methods">Flask-PyMongo Methods</h3>
<p>Flask-PyMongo provides helpers for some common tasks.
One of them is the <em>Collection.find_one_or_404</em> method
shown in the following example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  <span style="color:#5c35cc;font-weight:bold">@app.route</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/user/&lt;username&gt;&#34;</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">user_profile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">username</span><span style="color:#000;font-weight:bold">):</span>
      <span style="color:#000">user</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh_community</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find_one_or_404</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#34;_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">username</span><span style="color:#000;font-weight:bold">})</span>
      <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">render_template</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user.html&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>This method is very similar to the MongoDB&rsquo;s <em>find_one()</em>
method, however, instead of returning <em>None</em> it causes
a <em>404 Not Found HTTP</em> status [@www-flask-pymongo].</p>
<p>Similarly, the <em>PyMongo.send_file</em> and <em>PyMongo.save_file</em>
methods work on the file-like objects and save them to GridFS
using the given file name [@www-flask-pymongo].</p>
<h3 id="additional-libraries">Additional Libraries</h3>
<p>Flask-MongoAlchemy and Flask-MongoEngine are the additional
libraries that can be used to connect to a MongoDB database
while using enhanced features with the Flask app. The
Flask-MongoAlchemy is used as a proxy between Python and
MongoDB to connect. It provides an option such as server or
database based authentication to connect to MongoDB. While the
default is set server based, to use a database-based authentication,
the config value <em>MONGOALCHEMY_SERVER_AUTH</em> parameter must be
set to <em>False</em> [@www-pythonhosted-MongoAlchemy].</p>
<p>Flask-MongoEngine is the Flask extension that provides
integration with the MongoEngine. It handles connection
management for the apps. It can be installed through <em>pip</em> and
set up very easily as well. The default configuration
is set to the local host and port 27017. For the custom port
and in cases where MongoDB is running on another server, the host
and port must be explicitly specified in connect strings within
the <em>MONGODB_SETTINGS</em> dictionary with <em>app.config</em>, along with
the database username and password, in cases where a database
authentication is enabled. The URI style connections are also
supported and supply the URI as the host in the <em>MONGODB_SETTINGS</em>
dictionary with <em>app.config</em>. There are various custom query sets
that are available within Flask-Mongoengine that are attached to
Mongoengine&rsquo;s default queryset [@www-flask-mongoengine].</p>
<h3 id="classes-and-wrappers">Classes and Wrappers</h3>
<p>Attributes such as <em>cx</em> and <em>db</em> in the PyMongo objects are
the ones that help provide access to the MongoDB server
[@www-flask-pymongo]. To achieve this, one must pass the
Flask app to the constructor or call <em>init_app()</em> [@www-flask-pymongo].</p>
<blockquote>
<p>&ldquo;Flask-PyMongo wraps PyMongo&rsquo;s MongoClient, Database, and
Collection classes, and overrides their attribute and item
accessors&rdquo; [@www-flask-pymongo].</p>
</blockquote>
<p>This type of wrapping allows Flask-PyMongo to add methods to
<em>Collection</em> while at the same time allowing a MongoDB-style
dotted expressions in the code [@www-flask-pymongo].</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cx</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">db</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mongo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">db</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cloudmesh_community</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Flask-PyMongo creates connectivity between Python and Flask
using a MongoDB database and supports</p>
<blockquote>
<p>&ldquo;extensions that can add application features as if they were
implemented in Flask itself&rdquo; [@www-wiki-flask],</p>
</blockquote>
<p>hence, it can be used as an additional Flask functionality in
Python code. The extensions are there for the purpose of
supporting form validations, authentication technologies,
object-relational mappers and framework related tools which
ultimately adds a lot of strength to this micro-web framework
[@www-wiki-flask]. One of the main reasons and benefits why it is
frequently used with MongoDB is its capability of adding more
control over databases and history [@www-wiki-flask].</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-556ddc00ee07c362b88260b214078022">1.9.2 - Mongoengine</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<h2 id="introduction">Introduction</h2>
<p>MongoEngine is a document mapper for working with mongoldb with
python. To be able to use mongo engine MongodD should be already
installed and running.</p>
<h2 id="install-and-connect">Install and connect</h2>
<p>Mongoengine can be installed by running:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    $ pip install mongo engine
</code></pre></div><p>This will install six, pymongo and mongoengine.</p>
<p>To connect to mongoldb use connect () function by specifying mongoldb
instance name. You don&rsquo;t need to go to mongo shell but this can be
done from unix shell or cmd line. In this case we are connecting to a
database named student_db.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mongo</span> <span style="color:#000">engine</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">connect</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">‘</span><span style="color:#000">student_db</span><span style="color:#a40000">’</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>If mongodb is running on a port different from default port , port
number and host need to be specified. If mongoldb needs
authentication username and password need to be specified.</p>
<h2 id="basics">Basics</h2>
<p>Mongodb does not enforce schemas. Comparing to RDBMS, Row in mongoldb
is called a &ldquo;document&rdquo; and table can be compared to <em>Collection</em>.
Defining a schema is helpful as it minimizes coding error&rsquo;s. To define
a schema we create a class that inherits from document.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">mongoengine</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Student</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Document</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">first_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">last_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>:o2: TODO: Can you fix the code sections and look at the examples we
provided.</p>
<p>Fields are not mandatory but if needed, set the required keyword
argument to True. There are multiple values available for field
types. Each field can be customized by by keyword argument. If each
student is sending text messages to Universities central database ,
these can be stored using Mongodb. Each text can have different data
types, some might have images or some might have url&rsquo;s. So we can
create a class text and link it to student by using Reference field
(similar to foreign key in RDBMS).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Text</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Document</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">title</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">required</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">author</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ReferenceField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Student</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">meta</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;allow_inheritance&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">OnlyText</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Text</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">content</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ImagePost</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Text</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">image_path</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LinkPost</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Text</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">link_url</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>MongoDb supports adding tags to individual texts rather then storing
them separately and then having them referenced.Similarly Comments can
also be stored directly in a Text.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Text</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Document</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">title</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">required</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">author</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ReferenceField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">User</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">tags</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ListField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">StringField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">comments</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ListField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">EmbeddedDocumentField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Comment</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>For accessing data: if we need to get titles.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">text</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">OnlyText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Searching texts with tags.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">text</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">Text</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">objects</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tags</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;mongodb&#39;</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4e716d7c5c9029ad241cbb8628e64f98">1.10 - Other</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-65fbb92755467a1af78398183590e7cc">1.10.1 - Word Count with Parallel Python</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>We will demonstrate Python&rsquo;s <code>multiprocessing</code> API for parallel
computation by writing a program that counts how many times each word in
a collection of documents appear.</p>
<h2 id="generating-a-document-collection">Generating a Document Collection</h2>
<p>Before we begin, let us write a script that will generate document
collections by specifying the number of documents and the number of
words per document. This will make benchmarking straightforward.</p>
<p>To keep it simple, the vocabulary of the document collection will
consist of random numbers rather than the words of an actual language:</p>
<pre><code>'''Usage: generate_nums.py [-h] NUM_LISTS INTS_PER_LIST MIN_INT MAX_INT DEST_DIR

Generate random lists of integers and save them
as 1.txt, 2.txt, etc.

Arguments:
   NUM_LISTS      The number of lists to create.
   INTS_PER_LIST  The number of integers in each list.
   MIN_NUM        Each generated integer will be &gt;= MIN_NUM.
   MAX_NUM        Each generated integer will be &lt;= MAX_NUM.
   DEST_DIR       A directory where the generated numbers will be stored.

Options:
  -h --help
'''

import os, random, logging
from docopt import docopt


def generate_random_lists(num_lists,
                          ints_per_list, min_int, max_int):
    return [[random.randint(min_int, max_int) \
        for i in range(ints_per_list)] for i in range(num_lists)]


if __name__ == '__main__':
   args = docopt(__doc__)
   num_lists, ints_per_list, min_int, max_int, dest_dir = [
      int(args['NUM_LISTS']),
      int(args['INTS_PER_LIST']),
      int(args['MIN_INT']),
      int(args['MAX_INT']),
      args['DEST_DIR']
   ]

   if not os.path.exists(dest_dir):
      os.makedirs(dest_dir)

   lists = generate_random_lists(num_lists,
                                 ints_per_list,
                                 min_int,
                                 max_int)
   curr_list = 1
   for lst in lists:
      with open(os.path.join(dest_dir, '%d.txt' % curr_list), 'w') as f:
     f.write(os.linesep.join(map(str, lst)))
  curr_list += 1
   logging.debug('Numbers written.')
</code></pre>
<p>Notice that we are using the
<a href="https://pypi.python.org/pypi/docopt">docopt</a> module that you should be
familiar with from the Section [Python DocOpts](#s-python-docopts}
to make the script easy to run from the command line.</p>
<p>You can generate a document collection with this script as follows:</p>
<pre><code>python generate_nums.py 1000 10000 0 100 docs-1000-10000
</code></pre>
<h2 id="serial-implementation">Serial Implementation</h2>
<p>A first serial implementation of wordcount is straightforward:</p>
<pre><code>'''Usage: wordcount.py [-h] DATA_DIR

Read a collection of .txt documents and count how many times each word
appears in the collection.

Arguments:
  DATA_DIR  A directory with documents (.txt files).

Options:
  -h --help
'''

import os, glob, logging
from docopt import docopt

logging.basicConfig(level=logging.DEBUG)


def wordcount(files):
   counts = {}
   for filepath in files:
      with open(filepath, 'r') as f:
     words = [word.strip() for word in f.read().split()]
     for word in words:
        if word not in counts:
           counts[word] = 0
        counts[word] += 1
   return counts


if __name__ == '__main__':
   args = docopt(__doc__)
   if not os.path.exists(args['DATA_DIR']):
      raise ValueError('Invalid data directory: %s' % args['DATA_DIR'])

   counts = wordcount(glob.glob(os.path.join(args['DATA_DIR'], '*.txt')))
   logging.debug(counts)
</code></pre>
<h2 id="serial-implementation-using-map-and-reduce">Serial Implementation Using map and reduce</h2>
<p>We can improve the serial implementation in anticipation of parallelizing
the program by making use of Python&rsquo;s <code>map</code> and <code>reduce</code> functions.</p>
<p>In short, you can use <code>map</code> to apply the same function to the members of
a collection. For example, to convert a list of numbers to strings, you
could do:</p>
<pre><code>import random
nums = [random.randint(1, 2) for _ in range(10)]
print(nums)
[2, 1, 1, 1, 2, 2, 2, 2, 2, 2]
print(map(str, nums))
['2', '1', '1', '1', '2', '2', '2', '2', '2', '2']
</code></pre>
<p>We can use reduce to apply the same function cumulatively to the items
of a sequence. For example, to find the total of the numbers in our
list, we could use <code>reduce</code> as follows:</p>
<pre><code>def add(x, y):
    return x + y

print(reduce(add, nums))
17
</code></pre>
<p>We can simplify this even more by using a lambda function:</p>
<pre><code>print(reduce(lambda x, y: x + y, nums))
17
</code></pre>
<p>You can read more about <a href="https://docs.python.org/2.7/tutorial/controlflow.html#lambda-expressions">Python&rsquo;s lambda function in the
docs</a>.</p>
<p>With this in mind, we can reimplement the wordcount example as follows:</p>
<pre><code>'''Usage: wordcount_mapreduce.py [-h] DATA_DIR

Read a collection of .txt documents and count how
many times each word
appears in the collection.

Arguments:
   DATA_DIR  A directory with documents (.txt files).

Options:
   -h --help
'''

import os, glob, logging
from docopt import docopt

logging.basicConfig(level=logging.DEBUG)

def count_words(filepath):
   counts = {}
   with open(filepath, 'r') as f:
      words = [word.strip() for word in f.read().split()]

  for word in words:
     if word not in counts:
        counts[word] = 0
     counts[word] += 1
  return counts


def merge_counts(counts1, counts2):
   for word, count in counts2.items():
      if word not in counts1:
     counts1[word] = 0
  counts1[word] += counts2[word]
   return counts1


if __name__ == '__main__':
   args = docopt(__doc__)
   if not os.path.exists(args['DATA_DIR']):
      raise ValueError('Invalid data directory: %s' % args['DATA_DIR'])

      per_doc_counts = map(count_words,
                           glob.glob(os.path.join(args['DATA_DIR'],
                           '*.txt')))
   counts = reduce(merge_counts, [{}] + per_doc_counts)
   logging.debug(counts)
</code></pre>
<h2 id="parallel-implementation">Parallel Implementation</h2>
<p>Drawing on the previous implementation using <code>map</code> and <code>reduce</code>, we can
parallelize the implementation using Python&rsquo;s <code>multiprocessing</code> API:</p>
<pre><code>'''Usage: wordcount_mapreduce_parallel.py [-h] DATA_DIR NUM_PROCESSES

Read a collection of .txt documents and count, in parallel, how many
times each word appears in the collection.

Arguments:
   DATA_DIR       A directory with documents (.txt files).
   NUM_PROCESSES  The number of parallel processes to use.

Options:
   -h --help
'''

import os, glob, logging
from docopt import docopt
from wordcount_mapreduce import count_words, merge_counts
from multiprocessing import Pool

logging.basicConfig(level=logging.DEBUG)

if __name__ == '__main__':
   args = docopt(__doc__)
   if not os.path.exists(args['DATA_DIR']):
      raise ValueError('Invalid data directory: %s' % args['DATA_DIR'])
   num_processes = int(args['NUM_PROCESSES'])

   pool = Pool(processes=num_processes)

   per_doc_counts = pool.map(count_words,
                             glob.glob(os.path.join(args['DATA_DIR'],
                             '*.txt')))
   counts = reduce(merge_counts, [{}] + per_doc_counts)
   logging.debug(counts)
</code></pre>
<h2 id="benchmarking">Benchmarking</h2>
<p>To time each of the examples, enter it into its own Python file
and use Linux&rsquo;s <code>time</code> command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">time</span> python wordcount.py docs-1000-10000
</code></pre></div><p>The output contains the real run time and the user run time. real is
wall clock time - time from start to finish of the call. user is the
amount of CPU time spent in user-mode code (outside the kernel) within
the process, that is, only actual CPU time used in executing the
process.</p>
<h2 id="excersises">Excersises</h2>
<p>E.python.wordcount.1:</p>
<blockquote>
<p>Run the three different programs (serial, serial w/ map and reduce,
parallel) and answer the following questions:</p>
<ol>
<li>Is there any performance difference between the different versions
of the program?</li>
<li>Does user time significantly differ from real time for any of the
versions of the program?</li>
<li>Experiment with different numbers of processes for the parallel
example, starting with 1. What is the performance gain when you goal
from 1 to 2 processes? From 2 to 3? When do you stop seeing
improvement? (this will depend on your machine architecture)</li>
</ol>
</blockquote>
<h2 id="references">References</h2>
<ul>
<li><a href="http://book.pythontips.com/en/latest/map_filter.html">Map, Filter and Reduce</a></li>
<li><a href="https://docs.python.org/2/library/multiprocessing.html">multiprocessing API</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c3503067c11f7abae661dfa892030f49">1.10.2 - NumPy</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>NumPy is a popular library that is used by many other Python
packages such as Pandas, SciPy, and scikit-learn. It provides a
fast, simple-to-use way of interacting with numerical data
organized in vectors and matrices. In this section, we will
provide a short introduction to NumPy.</p>
<h2 id="installing-numpy">Installing NumPy</h2>
<p>The most common way of installing NumPy, if it wasn&rsquo;t included
with your Python installation, is to install it via pip:</p>
<pre><code>$ pip install numpy
</code></pre>
<p>If NumPy has already been installed, you can update to the most
recent version using:</p>
<pre><code>$ pip install -U numpy
</code></pre>
<p>You can verify that NumPy is installed by trying to use it in
a Python program:</p>
<pre><code>import numpy as np
</code></pre>
<p>Note that, by convention, we import NumPy using the alias &lsquo;np&rsquo; -
whenever you see &lsquo;np&rsquo; sprinkled in example Python code, it&rsquo;s a
good bet that it is using NumPy.</p>
<h2 id="numpy-basics">NumPy Basics</h2>
<p>At its core, NumPy is a container for n-dimensional data. Typically,
1-dimensional data is called an array and 2-dimensional data is called
a matrix. Beyond 2-dimensions would be considered a multidimensional
array. Examples, where you&rsquo;ll encounter these dimensions, may include:</p>
<ul>
<li>1 Dimensional: time-series data such as audio, stock prices, or a single observation in a dataset.</li>
<li>2 Dimensional: connectivity data between network nodes, user-product
recommendations, and database tables.</li>
<li>3+ Dimensional: network latency between nodes over time, video
(RGB+time), and version-controlled datasets.</li>
</ul>
<p>All of these data can be placed into NumPy&rsquo;s array object, just
with varying dimensions.</p>
<h2 id="data-types-the-basic-building-blocks">Data Types: The Basic Building Blocks</h2>
<p>Before we delve into arrays and matrices, we will start with
the most basic element of those: a single value. NumPy can
represent data utilizing many different standard datatypes such
as uint8 (an 8-bit <strong>u</strong>signed <strong>int</strong>eger), float64 (a 64-bit
float), or str (a string). An exhaustive listing can be found at:</p>
<ul>
<li><a href="https://docs.scipy.org/doc/numpy-1.15.0/user/basics.types.html">https://docs.scipy.org/doc/numpy-1.15.0/user/basics.types.html</a></li>
</ul>
<p>Before moving on, it is important to know about the tradeoff
made when using different datatypes. For example, a uint8 can
only contain values between 0 and 255. This, however, contrasts
with float64 which can express any value from +/- 1.80e+308. So
why wouldn&rsquo;t we just always use float64s? Though they allow us
to be more expressive in terms of numbers, they also consume
more memory. If we were working with a 12-megapixel image,
for example, storing that image using uint8 values would require
3000 * 4000 * 8 = 96 million bits, or 91.55 MB of memory. If we
were to store the same image utilizing float64, our image would
consume 8 times as much memory: 768 million bits or 732.42 MB.
It is important to use the right data type for the job to avoid
consuming unnecessary resources or slowing down processing.</p>
<p>Finally, while NumPy will conveniently convert between datatypes,
one must be aware of overflows when using smaller data types.
For example:</p>
<pre><code>a = np.array([6], dtype=np.uint8)
print(a)
&gt;&gt;&gt;[6]
a = a + np.array([7], dtype=np.uint8)
print(a)
&gt;&gt;&gt;[13]
a = a + np.array([245], dtype=np.uint8)
print(a)
&gt;&gt;&gt;[2]
</code></pre>
<p>In this example, it makes sense that 6+7=13. But how does
13+245=2? Put simply, the object type (uint8) simply ran out of
space to store the value and wrapped back around to the beginning.
An 8-bit number is only capable of storing 2^8, or 256, unique values.
An operation that results in a value above that range will &lsquo;overflow&rsquo;
and cause the value to wrap back around to zero. Likewise, anything
below that range will &lsquo;underflow&rsquo; and wrap back around to the end.
In our example, 13+245 became 258, which was too large to store in 8
bits and wrapped back around to 0 and ended up at 2.</p>
<p>NumPy will, generally, try to avoid this situation by dynamically
retyping to whatever datatype will support the result:</p>
<pre><code>a = a + 260
print(test)
&gt;&gt;&gt;[262]
</code></pre>
<p>Here, our addition caused our array, &lsquo;a,&rsquo; to be upscaled to use
uint16 instead of uint8. Finally, NumPy offers convenience functions
akin to Python&rsquo;s range() function to create arrays of sequential
numbers:</p>
<pre><code>X = np.arange(0.2,1,.1)
print(X)
&gt;&gt;&gt;array([0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9], dtype=float32)
</code></pre>
<p>We can use this function to also generate parameters spaces that can
be iterated on:</p>
<pre><code>P = 10.0 ** np.arange(-7,1,1)
print(P)

for x,p in zip(X,P):
    print('%f, %f' % (x, p))
</code></pre>
<h2 id="arrays-stringing-things-together">Arrays: Stringing Things Together</h2>
<p>With our knowledge of datatypes in hand, we can begin to explore
arrays. Simply put, arrays can be thought of as a sequence of
values (not neccesarily numbers). Arrays are 1 dimensional and can
be created and accessed simply:</p>
<pre><code>a = np.array([1, 2, 3])
print(type(a))
&gt;&gt;&gt;&lt;class 'numpy.ndarray'&gt;
print(a)
&gt;&gt;&gt;[1 2 3]
print(a.shape)
&gt;&gt;&gt;(3,)
a[0]
&gt;&gt;&gt;1
</code></pre>
<p>Arrays (and, later, matrices) are zero-indexed. This makes it
convenient when, for example, using Python&rsquo;s range() function
to iterate through an array:</p>
<pre><code>for i in range(3):
    print(a[i])
&gt;&gt;&gt;1
&gt;&gt;&gt;2
&gt;&gt;&gt;3
</code></pre>
<p>Arrays are, also, mutable and can be changed easily:</p>
<pre><code>a[0] = 42
print(a)
&gt;&gt;&gt;array([42, 2, 3])
</code></pre>
<p>NumPy also includes incredibly powerful broadcasting features. This
makes it very simple to perform mathematical operations on arrays
that also makes intuitive sense:</p>
<pre><code>a * 3
&gt;&gt;&gt;array([3, 6, 9])
a**2
&gt;&gt;&gt;array([1, 4, 9], dtype=int32)
</code></pre>
<p>Arrays can also interact with other arrays:</p>
<pre><code>b = np.array([2, 3, 4])
print(a * b)
&gt;&gt;&gt;array([ 2,  6, 12])
</code></pre>
<p>In this example, the result of multiplying together two
arrays is to take the element-wise product while multiplying by a
constant will multiply each element in the array by that constant.
NumPy supports all of the basic mathematical operations: addition,
subtraction, multiplication, division, and powers. It also includes
an extensive suite of mathematical functions, such as log() and max(),
which are covered later.</p>
<h2 id="matrices-an-array-of-arrays">Matrices: An Array of Arrays</h2>
<p>Matrices can be thought of as an extension of arrays - rather than
having one dimension, matrices have 2 (or more). Much like arrays,
matrices can be created easily within NumPy:</p>
<pre><code>m = np.array([[1, 2], [3, 4]])
print(m)
&gt;&gt;&gt;[[1 2]
&gt;&gt;&gt; [3 4]]
</code></pre>
<p>Accessing individual elements is similar to how we did it for arrays.
We simply need to pass in a number of arguments equal to the number
of dimensions:</p>
<pre><code>m[1][0]
&gt;&gt;&gt;3
</code></pre>
<p>In this example, our first index selected the row and the second selected
the column - giving us our result of 3. Matrices can be extending out
to any number of dimensions by simply using more indices to access
specific elements (though use-cases beyond 4 may be somewhat rare).</p>
<p>Matrices support all of the normal mathematial functions such as
+, -, *, and /. A special note: the * operator will result
in an element-wise multiplication. Using @ or np.matmul() for matrix
multiplication:</p>
<pre><code>print(m-m)
print(m*m)
print(m/m)
</code></pre>
<p>More complex mathematical functions can typically be found within
the NumPy library itself:</p>
<pre><code>print(np.sin(x))
print(np.sum(x))
</code></pre>
<p>A full listing can be found at:
<a href="https://docs.scipy.org/doc/numpy/reference/routines.math.html">https://docs.scipy.org/doc/numpy/reference/routines.math.html</a></p>
<h2 id="slicing-arrays-and-matrices">Slicing Arrays and Matrices</h2>
<p>As one can imagine, accessing elements one-at-a-time is both slow
and can potentially require many lines of code to iterate over
every dimension in the matrix. Thankfully, NumPy incorporate a very
powerful slicing engine that allows us to access ranges of elements
easily:</p>
<pre><code>m[1, :]
&gt;&gt;&gt;array([3, 4])
</code></pre>
<p>The &lsquo;:&rsquo; value tells NumPy to select all elements in the given
dimension. Here, we&rsquo;ve requested all elements in the first row. We
can also use indexing to request elements within a given range:</p>
<pre><code>a = np.arange(0, 10, 1)
print(a)
&gt;&gt;&gt;[0 1 2 3 4 5 6 7 8 9]
a[4:8]
&gt;&gt;&gt;array([4, 5, 6, 7])
</code></pre>
<p>Here, we asked NumPy to give us elements 4 through 7 (ranges in Python
are inclusive at the start and non-inclusive at the end). We can even
go backwards:</p>
<pre><code>a[-5:]
&gt;&gt;&gt;array([5, 6, 7, 8, 9])
</code></pre>
<p>In the previous example, the negative value is asking NumPy to return
the last 5 elements of the array. Had the argument been &lsquo;:-5,&rsquo; NumPy
would&rsquo;ve returned everything BUT the last five elements:</p>
<pre><code>a[:-5]
&gt;&gt;&gt;array([0, 1, 2, 3, 4])
</code></pre>
<p>Becoming more familiar with NumPy&rsquo;s accessor conventions will allow
you write more efficient, clearer code as it is easier to read a
simple one-line accessor than it is a multi-line, nested loop when
extracting values from an array or matrix.</p>
<h2 id="useful-functions">Useful Functions</h2>
<p>The NumPy library provides several convenient mathematical functions
that users can use. These functions provide several advantages
to code written by users:</p>
<ul>
<li>They are open source typically have multiple contributors checking
for errors.</li>
<li>Many of them utilize a C interface and will run much faster than
native Python code.</li>
<li>They&rsquo;re written to very flexible.</li>
</ul>
<p>NumPy arrays and matrices contain many useful aggregating functions
such as max(), min(), mean(), etc These functions are usually able
to run an order of magnitude faster than looping through the object,
so it&rsquo;s important to understand what functions are available to
avoid &lsquo;reinventing the wheel.&rsquo; In addition, many of the functions
are able to sum or average across axes, which make them extremely
useful if your data has inherent grouping. To return to a previous
example:</p>
<pre><code>m = np.array([[1, 2], [3, 4]])
print(m)
&gt;&gt;&gt;[[1 2]
&gt;&gt;&gt; [3 4]]
m.sum()
&gt;&gt;&gt;10
m.sum(axis=1)
&gt;&gt;&gt;[3, 7]
m.sum(axis=0)
&gt;&gt;&gt;[4, 6]
</code></pre>
<p>In this example, we created a 2x2 matrix containing the numbers
1 through 4. The sum of the matrix returned the element-wise addition
of the entire matrix. Summing across axis 0 (rows) returned a new array
with the element-wise addition across each row. Likewise, summing across
axis 1 (columns) returned the columnar summation.</p>
<h2 id="linear-algebra">Linear Algebra</h2>
<p>Perhaps one of the most important uses for NumPy is its robust support
for Linear Algebra functions. Like the aggregation functions described
in the previous section, these functions are optimized to be much faster
than user implementations and can utilize processesor level features to
provide very quick computations. These functions can be accessed very
easily from the NumPy package:</p>
<pre><code>a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])
print(np.matmul(a, b))
&gt;&gt;&gt;[[19 22]
    [43 50]]
</code></pre>
<p>Included in within np.linalg are functions for calculating the
Eigendecomposition of square matrices and symmetric matrices. Finally,
to give a quick example of how easy it is to implement algorithms in
NumPy, we can easily use it to calculate the cost and gradient when
using simple Mean-Squared-Error (MSE):</p>
<pre><code>cost = np.power(Y - np.matmul(X, weights)), 2).mean(axis=1)
gradient = np.matmul(X.T, np.matmul(X, weights) - y)
</code></pre>
<p>Finally, more advanced functions are easily available to users via the
linalg library of NumPy as:</p>
<pre><code>from numpy import linalg

A = np.diag((1,2,3))

w,v = linalg.eig(A)

print ('w =', w)
print ('v =', v)
</code></pre>
<h2 id="numpy-resources">NumPy Resources</h2>
<ul>
<li><a href="https://docs.scipy.org/doc/numpy">https://docs.scipy.org/doc/numpy</a></li>
<li><a href="http://cs231n.github.io/python-numpy-tutorial/#numpy">http://cs231n.github.io/python-numpy-tutorial/#numpy</a></li>
<li><a href="https://docs.scipy.org/doc/numpy-1.15.1/reference/routines.linalg.html">https://docs.scipy.org/doc/numpy-1.15.1/reference/routines.linalg.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Mean_squared_error">https://en.wikipedia.org/wiki/Mean_squared_error</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1c3b9ac7e2dbf04a9c689f2c2c4b613a">1.10.3 - Scipy</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>SciPy is a library built around NumPy and has a number of off-the-shelf
algorithms and operations implemented. These include algorithms from
calculus (such as integration), statistics, linear algebra,
image-processing, signal processing, machine learning.</p>
<p>To achieve this, SciPy bundles a number of useful open-source software
for mathematics, science, and engineering. It includes the following
packages:</p>
<dl>
<dt>NumPy,</dt>
<dd>
<p>for managing N-dimensional arrays</p>
</dd>
<dt>SciPy library,</dt>
<dd>
<p>to access fundamental scientific computing capabilities</p>
</dd>
<dt>Matplotlib,</dt>
<dd>
<p>to conduct 2D plotting</p>
</dd>
<dt>IPython,</dt>
<dd>
<p>for an Interactive console (see jupyter)</p>
</dd>
<dt>Sympy,</dt>
<dd>
<p>for symbolic mathematics</p>
</dd>
<dt>pandas,</dt>
<dd>
<p>for providing data structures and analysis</p>
</dd>
</dl>
<h2 id="introduction">Introduction</h2>
<p>First, we add the usual scientific computing modules with the typical
abbreviations, including sp for scipy. We could invoke scipy&rsquo;s
statistical package as sp.stats, but for the sake of laziness, we
abbreviate that too.</p>
<pre><code>import numpy as np # import numpy
import scipy as sp # import scipy
from scipy import stats # refer directly to stats rather than sp.stats
import matplotlib as mpl # for visualization
from matplotlib import pyplot as plt # refer directly to pyplot
                                     # rather than mpl.pyplot
</code></pre>
<p>Now we create some random data to play with. We generate 100 samples
from a Gaussian distribution centered at zero.</p>
<pre><code>s = sp.randn(100)
</code></pre>
<p>How many elements are in the set?</p>
<pre><code>print ('There are',len(s),'elements in the set')
</code></pre>
<p>What is the mean (average) of the set?</p>
<pre><code>print ('The mean of the set is',s.mean())
</code></pre>
<p>What is the minimum of the set?</p>
<pre><code>print ('The minimum of the set is',s.min())
</code></pre>
<p>What is the maximum of the set?</p>
<pre><code>print ('The maximum of the set is',s.max())
</code></pre>
<p>We can use the scipy functions too. What&rsquo;s the median?</p>
<pre><code>print ('The median of the set is',sp.median(s))
</code></pre>
<p>What about the standard deviation and variance?</p>
<pre><code>print ('The standard deviation is',sp.std(s),
       'and the variance is',sp.var(s))
</code></pre>
<p>Isn&rsquo;t the variance the square of the standard deviation?</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The square of the standard deviation is&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">std</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>How close are the measures? The differences are close as the following
calculation shows</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The difference is&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">std</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">sp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">var</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">)))</span>

    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;And in decimal form, the difference is </span><span style="color:#4e9a06">%0.16f</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span>
           <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">std</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">sp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">var</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">))))</span>
</code></pre></div><p>How does this look as a histogram? See Figure 1, Figure 2, Figure 3</p>
<pre><code>plt.hist(s) # yes, one line of code for a histogram
plt.show()
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_23_0.png" alt="Figure 1: Histogram 1"></p>
<p>Figure 1: Histogram 1</p>
<p>Let us add some titles.</p>
<pre><code>plt.clf() # clear out the previous plot

plt.hist(s)
plt.title(&quot;Histogram Example&quot;)
plt.xlabel(&quot;Value&quot;)
plt.ylabel(&quot;Frequency&quot;)

plt.show()
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_25_0.png" alt="Figure 2: Histogram 2"></p>
<p>Figure 2: Histogram 2</p>
<p>Typically we do not include titles when we prepare images for inclusion
in LaTeX. There we use the caption to describe what the figure is about.</p>
<pre><code>plt.clf() # clear out the previous plot

plt.hist(s)
plt.xlabel(&quot;Value&quot;)
plt.ylabel(&quot;Frequency&quot;)

plt.show()
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_27_0.png" alt="Figure 3: Histogram 3"></p>
<p>Figure 3: Histogram 3</p>
<p>Let us try out some linear regression or curve fitting. See @#fig:scipy-output_30_0</p>
<pre><code>import random

def F(x):
    return 2*x - 2

def add_noise(x):
    return x + random.uniform(-1,1)

X = range(0,10,1)

Y = []
for i in range(len(X)):
    Y.append(add_noise(X[i]))

plt.clf() # clear out the old figure
plt.plot(X,Y,'.')
plt.show()
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_30_0.png" alt="Figure 4: Result 1"></p>
<p>Figure 4: Result 1</p>
<p>Now let&rsquo;s try linear regression to fit the curve.</p>
<pre><code>m, b, r, p, est_std_err = stats.linregress(X,Y)
</code></pre>
<p>What is the slope and y-intercept of the fitted curve?</p>
<pre><code>print ('The slope is',m,'and the y-intercept is', b)

def Fprime(x): # the fitted curve
    return m*x + b
</code></pre>
<p>Now let&rsquo;s see how well the curve fits the data. We&rsquo;ll call the fitted
curve F'.</p>
<pre><code>X = range(0,10,1)

Yprime = []
for i in range(len(X)):
    Yprime.append(Fprime(X[i]))

plt.clf() # clear out the old figure

# the observed points, blue dots
plt.plot(X, Y, '.', label='observed points')

# the interpolated curve, connected red line
plt.plot(X, Yprime, 'r-', label='estimated points')

plt.title(&quot;Linear Regression Example&quot;) # title
plt.xlabel(&quot;x&quot;) # horizontal axis title
plt.ylabel(&quot;y&quot;) # vertical axis title
# legend labels to plot
plt.legend(['obsered points', 'estimated points'])

# comment out so that you can save the figure
#plt.show()
</code></pre>
<p>To save images into a PDF file for inclusion into LaTeX documents you
can save the images as follows. Other formats such as png are also
possible, but the quality is naturally not sufficient for inclusion in
papers and documents. For that, you certainly want to use PDF. The save
of the figure has to occur before you use the <code>show()</code> command. See Figure 5</p>
<pre><code>plt.savefig(&quot;regression.pdf&quot;, bbox_inches='tight')

plt.savefig('regression.png')

plt.show()
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_40_0.png" alt="Figure 5: Result 2"></p>
<p>Figure 5: Result 2</p>
<h2 id="references">References</h2>
<p>For more information about SciPy we recommend that you visit the
following link</p>
<p><a href="https://www.scipy.org/getting-started.html#learning-to-work-with-scipy">https://www.scipy.org/getting-started.html#learning-to-work-with-scipy</a></p>
<p>Additional material and inspiration for this section are from</p>
<ul>
<li>[<img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png" alt="No">] &ldquo;Getting Started guide&rdquo; <a href="https://www.scipy.org/getting-started.html">https://www.scipy.org/getting-started.html</a></li>
</ul>
<p>[![No</p>
<ul>
<li>[<img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png" alt="No">] Prasanth. &ldquo;Simple statistics with SciPy.&rdquo; Comfort at 1 AU. February</li>
</ul>
<p>[![No
28, 2011.
<a href="https://oneau.wordpress.com/2011/02/28/simple-statistics-with-scipy/">https://oneau.wordpress.com/2011/02/28/simple-statistics-with-scipy/</a>.</p>
<ul>
<li>[<img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png" alt="No">] SciPy Cookbook. Lasted updated: 2015.</li>
</ul>
<p>[![No
<a href="http://scipy-cookbook.readthedocs.io/">http://scipy-cookbook.readthedocs.io/</a>.</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png" alt="No"> create bibtex entries</p>
<p>No</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9f03f93bd79697249709db37772032c6">1.10.4 - Scikit-learn</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<hr>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/learning.png" alt=""> <strong>Learning Objectives</strong></p>
<ul>
<li>Exploratory data analysis</li>
<li>Pipeline to prepare data</li>
<li>Full learning pipeline</li>
<li>Fine tune the model</li>
<li>Significance tests</li>
</ul>
<hr>
<h2 id="introduction-to-scikit-learn">Introduction to Scikit-learn</h2>
<p>Scikit learn is a Machine Learning specific library used in Python. Library can be used for data mining and analysis. It is built on top of NumPy, matplotlib and SciPy. Scikit Learn features Dimensionality reduction, clustering, regression and classification algorithms.
It also features model selection using grid search, cross validation and metrics.</p>
<p>Scikit learn also enables users to preprocess the data which can then be used for machine learning using modules like preprocessing and feature extraction.</p>
<p>In this section we demonstrate how simple it is to use k-means in
scikit learn.</p>
<h2 id="installation">Installation</h2>
<p>If you already have a working installation of numpy and scipy, the
easiest way to install scikit-learn is using pip</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a40000">$</span> <span style="color:#000">pip</span> <span style="color:#000">install</span> <span style="color:#000">numpy</span>
<span style="color:#a40000">$</span> <span style="color:#000">pip</span> <span style="color:#000">install</span> <span style="color:#000">scipy</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">U</span>
<span style="color:#a40000">$</span> <span style="color:#000">pip</span> <span style="color:#000">install</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">U</span> <span style="color:#000">scikit</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">learn</span>
</code></pre></div><h2 id="supervised-learning">Supervised Learning</h2>
<p>Supervised Learning is used in machine learning when we already know a set of output predictions based on input characteristics and based on that we need to predict the target for a new input. Training data is used to train the model which then can be used to predict the output from a bounded set.</p>
<p>Problems can be of two types</p>
<ol>
<li>Classification : Training data belongs to three or four classes/categories and based on the label we want to predict
the class/category for the unlabeled data.</li>
<li>Regression : Training data consists of vectors without any corresponding target values. Clustering can be used for
these type of datasets to determine discover groups of similar examples. Another way is density
estimation which determine the distribution of data within the input space. Histogram is the most basic form.</li>
</ol>
<h2 id="unsupervised-learning">Unsupervised Learning</h2>
<p>Unsupervised Learning is used in machine learning when we have the training set available but without any corresponding target. The outcome of the problem is to discover groups within the provided input. It can be done in many ways.</p>
<p>Few of them are listed here</p>
<ol>
<li>Clustering : Discover groups of similar characteristics.</li>
<li>Density Estimation : Finding the distribution of data within the provided input or changing the data from a high
dimensional space to two or three dimension.</li>
</ol>
<h2 id="building-a-end-to-end-pipeline-for-supervised-machine-learning-using-scikit-learn">Building a end to end pipeline for Supervised machine learning using Scikit-learn</h2>
<p>A data pipeline is a set of processing components that are sequenced to produce
meaningful data. Pipelines are commonly used in Machine learning, since there is
lot of data transformation and manipulation that needs to be applied to make
data useful for machine learning. All components are sequenced in a way that the
output of one component becomes input for the next and each of the component is
self contained. Components interact with each other using data.</p>
<p>Even if a component breaks, the downstream component can run normally using the
last output. Sklearn provide the ability to build pipelines that can be
transformed and modeled for machine learning.</p>
<h2 id="steps-for-developing-a-machine-learning-model">Steps for developing a machine learning model</h2>
<ol>
<li>Explore the domain space</li>
<li>Extract the problem definition</li>
<li>Get the data that can be used to make the system learn to solve the problem
definition.</li>
<li>Discover and Visualize the data to gain insights</li>
<li>Feature engineering and prepare the data</li>
<li>Fine tune your model</li>
<li>Evaluate your solution using metrics</li>
<li>Once proven launch and maintain the model.</li>
</ol>
<h2 id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>Example project = Fraud detection system</p>
<p>First step is to load the data into a dataframe in order for a proper analysis
to be done on the attributes.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;dataset/data_file.csv&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">head</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>Perform the basic analysis on the data shape and null value information.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">())</span>
<span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">isnull</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">values</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">any</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>Here is the example of few of the visual data analysis methods.</p>
<h3 id="bar-plot">Bar plot</h3>
<p>A bar chart or graph is a graph with rectangular bars or bins that are used to plot
categorical values. Each bar in the graph represents a categorical variable and the
height of the bar is proportional to the value represented by it.</p>
<p>Bar graphs are used:</p>
<p>To make comparisons between variables
To visualize any trend in the data, i.e., they show the dependence of one variable on another
Estimate values of a variable</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ylabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Transactions&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xlabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Type&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">type</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value_counts</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bar</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-barplot.png" alt="Figure 1: Example of scikit-learn barplots"></p>
<p>Figure 1: Example of scikit-learn barplots</p>
<h3 id="correlation-between-attributes">Correlation between attributes</h3>
<p>Attributes in a dataset can be related based on differnt aspects.</p>
<p>Examples include attributes dependent on another or could be loosely or tightly coupled. Also example includes two variables can be associated with a third one.</p>
<p>In order to understand the relationship between attributes, correlation represents the best visual way to get an insight. Positive correlation meaning both attributes moving into the same direction. Negative correlation refers to opposte directions. One attributes values increase results in value decrease for other. Zero correlation is when the attributes are unrelated.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># compute the correlation matrix</span>
<span style="color:#000">corr</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">corr</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># generate a mask for the lower triangle</span>
<span style="color:#000">mask</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">zeros_like</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">corr</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dtype</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bool</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">mask</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">triu_indices_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mask</span><span style="color:#000;font-weight:bold">)]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">True</span>

<span style="color:#8f5902;font-style:italic"># set up the matplotlib figure</span>
<span style="color:#000">f</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ax</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subplots</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">figsize</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">18</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">18</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#8f5902;font-style:italic"># generate a custom diverging color map</span>
<span style="color:#000">cmap</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sns</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">diverging_palette</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">220</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">as_cmap</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># draw the heatmap with the mask and correct aspect ratio</span>
<span style="color:#000">sns</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">heatmap</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">corr</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mask</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">mask</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cmap</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">cmap</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vmax</span><span style="color:#ce5c00;font-weight:bold">=.</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#000">square</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#000">linewidths</span><span style="color:#ce5c00;font-weight:bold">=.</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cbar_kws</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;shrink&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000">ax</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">ax</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-correlationanalysis.png" alt="Figure 2: scikit-learn correlation array"></p>
<p>Figure 2: scikit-learn correlation array</p>
<h3 id="histogram-analysis-of-dataset-attributes">Histogram Analysis of dataset attributes</h3>
<p>A histogram consists of a set of counts that represent the number of times some event occurred.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">matplotlib</span> <span style="color:#000">inline</span>
<span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">hist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bins</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">figsize</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-histograms.png" alt="Figure 3: scikit-learn"></p>
<p>Figure 3: scikit-learn</p>
<h3 id="box-plot-analysis">Box plot Analysis</h3>
<p>Box plot analysis is useful in detecting whether a distribution is skewed and detect outliers in the data.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">fig</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">axs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subplots</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">figsize</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000">tmp</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">type</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;TRANSFER&#39;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000;font-weight:bold">:]</span>

<span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sns</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">boxplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;isFlaggedFraud&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;amount&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">tmp</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ax</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">axs</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#000">axs</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_yscale</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;log&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sns</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">boxplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;isFlaggedFraud&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;oldbalanceDest&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">tmp</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ax</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">axs</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#000">axs</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ylim</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.5e8</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sns</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">boxplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;isFlaggedFraud&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;oldbalanceOrg&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">tmp</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ax</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">axs</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#000">axs</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ylim</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3e7</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000">d</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sns</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">regplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;oldbalanceOrg&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;amount&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">tmp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#000">tmp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">isFlaggedFraud</span> <span style="color:#ce5c00;font-weight:bold">==</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000;font-weight:bold">:],</span> <span style="color:#000">ax</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">axs</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-boxplot.png" alt="Figure 4: scikit-learn"></p>
<p>Figure 4: scikit-learn</p>
<h3 id="scatter-plot-analysis">Scatter plot Analysis</h3>
<p>The scatter plot displays values of two numerical variables as Cartesian coordinates.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">figure</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">figsize</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000">sns</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pairplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[[</span><span style="color:#4e9a06">&#39;amount&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;oldbalanceOrg&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;oldbalanceDest&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;isFraud&#39;</span><span style="color:#000;font-weight:bold">]],</span> <span style="color:#000">hue</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;isFraud&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-scatterplot.png" alt="Figure 5: scikit-learn scatter plots"></p>
<p>Figure 5: scikit-learn scatter plots</p>
<h2 id="data-cleansing---removing-outliers">Data Cleansing - Removing Outliers</h2>
<p>If the transaction amount is lower than 5 percent of the all the transactions
AND does not exceed USD 3000, we will exclude it from our analysis to reduce
Type 1 costs If the transaction amount is higher than 95 percent of all the
transactions AND exceeds USD 500000, we will exclude it from our analysis, and
use a blanket review process for such transactions (similar to isFlaggedFraud
column in original dataset) to reduce Type 2 costs</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">low_exclude</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">minimum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fin_samp_data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">amount</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">quantile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.05</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">3000</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">high_exclude</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">maximum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fin_samp_data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">amount</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">quantile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.95</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">500000</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic">###Updating Data to exclude records prone to Type 1 and Type 2 costs</span>
<span style="color:#000">low_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">fin_samp_data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">fin_samp_data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">amount</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">low_exclude</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">low_data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">low_data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">amount</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">high_exclude</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><h2 id="pipeline-creation">Pipeline Creation</h2>
<p>Machine learning pipeline is used to help automate machine learning workflows. They operate by enabling a sequence of data to be transformed and correlated together in a model that can be tested and evaluated to achieve an outcome, whether positive or negative.</p>
<h3 id="defining-dataframeselector-to-separate-numerical-and-categorical-attributes">Defining DataFrameSelector to separate Numerical and Categorical attributes</h3>
<p>Sample function to seperate out Numerical and categorical attributes.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.base</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">BaseEstimator</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">TransformerMixin</span>

<span style="color:#8f5902;font-style:italic"># Create a class to select numerical or categorical columns</span>
<span style="color:#8f5902;font-style:italic"># since Scikit-Learn doesn&#39;t handle DataFrames yet</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">DataFrameSelector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">BaseEstimator</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">TransformerMixin</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attribute_names</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">attribute_names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attribute_names</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">X</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">X</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">X</span><span style="color:#000;font-weight:bold">[</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">attribute_names</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">values</span>
</code></pre></div><h3 id="feature-creation--additional-feature-engineering">Feature Creation / Additional Feature Engineering</h3>
<p>During EDA we identified that there are transactions where the balances do not
tally after the transaction is completed.We believe this could potentially be
cases where fraud is occurring. To account for this error in the transactions,
we define two new features&quot;errorBalanceOrig&quot; and &ldquo;errorBalanceDest,&rdquo; calculated
by adjusting the amount with the before and after balances for the Originator
and Destination accounts.</p>
<p>Below, we create a function that allows us to create these features in a
pipeline.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.base</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">BaseEstimator</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">TransformerMixin</span>

<span style="color:#8f5902;font-style:italic"># column index</span>
<span style="color:#000">amount_ix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">oldbalanceOrg_ix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">newbalanceOrig_ix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">oldbalanceDest_ix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">newbalanceDest_ix</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">CombinedAttributesAdder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">BaseEstimator</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">TransformerMixin</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#8f5902;font-style:italic"># no *args or **kargs</span>
        <span style="color:#204a87;font-weight:bold">pass</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">X</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span>  <span style="color:#8f5902;font-style:italic"># nothing else to do</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">X</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">errorBalanceOrig</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">X</span><span style="color:#000;font-weight:bold">[:,</span><span style="color:#000">newbalanceOrig_ix</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span>  <span style="color:#000">X</span><span style="color:#000;font-weight:bold">[:,</span><span style="color:#000">amount_ix</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">-</span>  <span style="color:#000">X</span><span style="color:#000;font-weight:bold">[:,</span><span style="color:#000">oldbalanceOrg_ix</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">errorBalanceDest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">X</span><span style="color:#000;font-weight:bold">[:,</span><span style="color:#000">oldbalanceDest_ix</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span>  <span style="color:#000">X</span><span style="color:#000;font-weight:bold">[:,</span><span style="color:#000">amount_ix</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">-</span>  <span style="color:#000">X</span><span style="color:#000;font-weight:bold">[:,</span><span style="color:#000">newbalanceDest_ix</span><span style="color:#000;font-weight:bold">]</span>

        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">c_</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">X</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">errorBalanceOrig</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">errorBalanceDest</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><h2 id="creating-training-and-testing-datasets">Creating Training and Testing datasets</h2>
<p>Training set includes the set of input examples that the model will be fit into or trained on by adjusting the parameters.
Testing dataset is critical to test the generalizability of the model . By using this set, we can get the working accuracy of our model.</p>
<p>Testing set should not be exposed to model unless model training has not been completed. This way the results from testing will be more reliable.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.model_selection</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">train_test_split</span>
<span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">train_test_split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">test_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0.30</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">random_state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">stratify</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">y</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="creating-pipeline-for-numerical-and-categorical-attributes">Creating pipeline for numerical and categorical attributes</h2>
<p>Identifying columns with Numerical and Categorical characteristics.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">X_train_num</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">[[</span><span style="color:#4e9a06">&#34;amount&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#34;oldbalanceOrg&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;newbalanceOrig&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;oldbalanceDest&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;newbalanceDest&#34;</span><span style="color:#000;font-weight:bold">]]</span>
<span style="color:#000">X_train_cat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">[[</span><span style="color:#4e9a06">&#34;type&#34;</span><span style="color:#000;font-weight:bold">]]</span>
<span style="color:#000">X_model_col</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;amount&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#34;oldbalanceOrg&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;newbalanceOrig&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;oldbalanceDest&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;newbalanceDest&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#34;type&#34;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.pipeline</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Pipeline</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.preprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">StandardScaler</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.preprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Imputer</span>

<span style="color:#000">num_attribs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_num</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">cat_attribs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_cat</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">num_pipeline</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Pipeline</span><span style="color:#000;font-weight:bold">([</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;selector&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DataFrameSelector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">num_attribs</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;attribs_adder&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">CombinedAttributesAdder</span><span style="color:#000;font-weight:bold">()),</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;std_scaler&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">StandardScaler</span><span style="color:#000;font-weight:bold">())</span>
    <span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">cat_pipeline</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Pipeline</span><span style="color:#000;font-weight:bold">([</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;selector&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DataFrameSelector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cat_attribs</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;cat_encoder&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">CategoricalEncoder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">encoding</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;onehot-dense&#34;</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000;font-weight:bold">])</span>
</code></pre></div><h2 id="selecting-the-algorithm-to-be-applied">Selecting the algorithm to be applied</h2>
<p>Algorithim selection primarily depends on the objective you are trying to solve and what kind of dataset is available. There are differnt type of algorithms which can be applied and we will look into few of them here.</p>
<h3 id="linear-regression">Linear Regression</h3>
<p>This algorithm can be applied when you want to compute some continuous value. To predict some future value of a process which is currently running, you can go with regression algorithm.</p>
<p>Examples where linear regression can used are :</p>
<ol>
<li>Predict the time taken to go from one place to another</li>
<li>Predict the sales for a future month</li>
<li>Predict sales data and improve yearly projections.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.linear_model</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">LinearRegression</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.preprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">StandardScaler</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">time</span>
<span style="color:#000">scl</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StandardScaler</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">X_train_std</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scl</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit_transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">X_test_std</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scl</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">start</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">lin_reg</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LinearRegression</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">lin_reg</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_std</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic">#SKLearn&#39;s linear regression</span>
<span style="color:#000">y_train_pred</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">lin_reg</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_std</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">train_time</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">start</span>
</code></pre></div><h3 id="logistic-regression">Logistic Regression</h3>
<p>This algorithm can be used to perform binary classification. It can be used if you want a probabilistic framework.
Also in case you expect to receive more training data in the future that you want to be able to quickly incorporate into your model.</p>
<ol>
<li>Customer churn prediction.</li>
<li>Credit Scoring &amp; Fraud Detection which is our example problem which we are trying to solve in this chapter.</li>
<li>Calculating the effectiveness of marketing campaigns.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.linear_model</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">LogisticRegression</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.model_selection</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">train_test_split</span>

<span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">train_test_split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">stratify</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">train_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">subsample_rate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">random_state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">train_test_split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">stratify</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">train_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">subsample_rate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">random_state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">model_lr_sklearn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LogisticRegression</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">multi_class</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;multinomial&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">C</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1e6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">solver</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;sag&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max_iter</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">model_lr_sklearn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">y_pred_test</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model_lr_sklearn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">acc</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">accuracy_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred_test</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">results</span><span style="color:#000;font-weight:bold">)]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;LR Sklearn&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">acc</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)]</span>
<span style="color:#000">results</span>
</code></pre></div><h3 id="decision-trees">Decision trees</h3>
<p>Decision trees handle feature interactions and they&rsquo;re non-parametric. Doesnt support online learning and the entire tree needs to be rebuild when new traning dataset comes in. Memory consumption is very high.</p>
<p>Can be used for the following cases</p>
<ol>
<li>Investment decisions</li>
<li>Customer churn</li>
<li>Banks loan defaulters</li>
<li>Build vs Buy decisions</li>
<li>Sales lead qualifications</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.tree</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">DecisionTreeRegressor</span>
<span style="color:#000">dt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DecisionTreeRegressor</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">start</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">dt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_std</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">y_train_pred</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_std</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">train_time</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">start</span>

<span style="color:#000">start</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">y_test_pred</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test_std</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">test_time</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">start</span>
</code></pre></div><h3 id="k-means">K Means</h3>
<p>This algorithm is used when we are not aware of the labels and one needs to be created based on the features of objects. Example will be to divide a group of people into differnt subgroups based on common theme or attribute.</p>
<p>The main disadvantage of K-mean is that you need to know exactly the number of clusters or groups which is required. It takes a lot of iteration to come up with the best K.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.neighbors</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">KNeighborsClassifier</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.model_selection</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">train_test_split</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">GridSearchCV</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">PredefinedSplit</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.metrics</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">accuracy_score</span>

<span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">train_test_split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">stratify</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">train_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">subsample_rate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">random_state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">train_test_split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">stratify</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">train_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">subsample_rate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">random_state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">model_knn_sklearn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">KNeighborsClassifier</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n_jobs</span><span style="color:#ce5c00;font-weight:bold">=-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">model_knn_sklearn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">y_pred_test</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model_knn_sklearn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">acc</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">accuracy_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred_test</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">results</span><span style="color:#000;font-weight:bold">)]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;KNN Arbitary Sklearn&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">acc</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)]</span>
<span style="color:#000">results</span>
</code></pre></div><h3 id="support-vector-machines">Support Vector Machines</h3>
<p>SVM is a supervised ML technique and used for pattern recognition and classification problems when your data has exactly two classes.
Its popular in text classification problems.</p>
<p>Few cases where SVM can be used is</p>
<ol>
<li>Detecting persons with common diseases.</li>
<li>Hand-written character recognition</li>
<li>Text categorization</li>
<li>Stock market price prediction</li>
</ol>
<h3 id="naive-bayes">Naive Bayes</h3>
<p>Naive Bayes is used for large datasets.This algoritm works well even when we have a limited CPU and memory available. This works by calculating bunch of counts. It requires less training data. The algorthim cant learn interation between features.</p>
<p>Naive Bayes can be used in real-world applications such as:</p>
<ol>
<li>Sentiment analysis and text classification</li>
<li>Recommendation systems like Netflix, Amazon</li>
<li>To mark an email as spam or not spam</li>
<li>Face recognition</li>
</ol>
<h3 id="random-forest">Random Forest</h3>
<p>Ranmdon forest is similar to Decision tree. Can be used for both regression and classification problems with large data sets.</p>
<p>Few case where it can be applied.</p>
<ol>
<li>Predict patients for high risks.</li>
<li>Predict parts failures in manufacturing.</li>
<li>Predict loan defaulters.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.ensemble</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">RandomForestRegressor</span>
<span style="color:#000">forest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">RandomForestRegressor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n_estimators</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">400</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">criterion</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;mse&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">random_state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_jobs</span><span style="color:#ce5c00;font-weight:bold">=-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">start</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">forest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_std</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">y_train_pred</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">forest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train_std</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">train_time</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">start</span>

<span style="color:#000">start</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">y_test_pred</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">forest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test_std</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">test_time</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">start</span>
</code></pre></div><h3 id="neural-networks">Neural networks</h3>
<p>Neural network works based on weights of connections between neurons. Weights are trained and based on that the neural network can be utilized to predict the class or a quantity. They are resource and memory intensive.</p>
<p>Few cases where it can be applied.</p>
<ol>
<li>Applied to unsupervised learning tasks, such as feature extraction.</li>
<li>Extracts features from raw images or speech with much less human intervention</li>
</ol>
<h3 id="deep-learning-using-keras">Deep Learning using Keras</h3>
<p>Keras is most powerful and easy-to-use Python libraries for developing and evaluating deep learning models. It has the efficient numerical computation libraries Theano and TensorFlow.</p>
<h3 id="xgboost">XGBoost</h3>
<p>XGBoost stands for eXtreme Gradient Boosting.
XGBoost is an implementation of gradient boosted decision trees designed for speed and performance. It is engineered for efficiency of compute time and memory resources.</p>
<h2 id="scikit-cheat-sheet">Scikit Cheat Sheet</h2>
<p>Scikit learning has put a very indepth and well explained flow chart to help you choose the right algorithm that I find very handy.</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-cheatsheet.png" alt="Figure 6: scikit-learn"></p>
<p>Figure 6: scikit-learn</p>
<h2 id="parameter-optimization">Parameter Optimization</h2>
<p>Machine learning models are parameterized so that their behavior can be tuned for a given problem. These models can have many parameters and finding the best combination of parameters can be treated as a search problem.</p>
<p>A parameter is a configurationthat is part of the model and values can be derived from the given data.</p>
<ol>
<li>Required by the model when making predictions.</li>
<li>Values define the skill of the model on your problem.</li>
<li>Estimated or learned from data.</li>
<li>Often not set manually by the practitioner.</li>
<li>Often saved as part of the learned model.</li>
</ol>
<h3 id="hyperparameter-optimizationtuning-algorithms">Hyperparameter optimization/tuning algorithms</h3>
<p>Grid search is an approach to hyperparameter tuning that will methodically build and evaluate a model for each combination of algorithm parameters specified in a grid.</p>
<p>Random search provide a statistical distribution for each hyperparameter from which values may be randomly sampled.</p>
<h2 id="experiments-with-keras-deep-learning-xgboost-and-svm-svc-compared-to-logistic-regressionbaseline">Experiments with Keras (deep learning), XGBoost, and SVM (SVC) compared to Logistic Regression(Baseline)</h2>
<h3 id="creating-a-parameter-grid">Creating a parameter grid</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">grid_param</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#000;font-weight:bold">[{</span>   <span style="color:#8f5902;font-style:italic">#LogisticRegression</span>
                   <span style="color:#4e9a06">&#39;model__penalty&#39;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#4e9a06">&#39;l1&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;l2&#39;</span><span style="color:#000;font-weight:bold">],</span>
                   <span style="color:#4e9a06">&#39;model__C&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0.01</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">]</span>
                <span style="color:#000;font-weight:bold">}],</span>

                <span style="color:#000;font-weight:bold">[{</span><span style="color:#8f5902;font-style:italic">#keras</span>
                    <span style="color:#4e9a06">&#39;model__optimizer&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">optimizer</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#4e9a06">&#39;model__loss&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">loss</span>
                <span style="color:#000;font-weight:bold">}],</span>

                <span style="color:#000;font-weight:bold">[{</span>  <span style="color:#8f5902;font-style:italic">#SVM</span>
                   <span style="color:#4e9a06">&#39;model__C&#39;</span> <span style="color:#000;font-weight:bold">:[</span><span style="color:#0000cf;font-weight:bold">0.01</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">],</span>
                   <span style="color:#4e9a06">&#39;model__gamma&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span>
                   <span style="color:#4e9a06">&#39;model__max_iter&#39;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
                <span style="color:#000;font-weight:bold">}],</span>

                <span style="color:#000;font-weight:bold">[{</span>   <span style="color:#8f5902;font-style:italic">#XGBClassifier</span>
                    <span style="color:#4e9a06">&#39;model__min_child_weight&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">],</span>
                    <span style="color:#4e9a06">&#39;model__gamma&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">],</span>
                    <span style="color:#4e9a06">&#39;model__subsample&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0.6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.8</span><span style="color:#000;font-weight:bold">],</span>
                    <span style="color:#4e9a06">&#39;model__colsample_bytree&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0.6</span><span style="color:#000;font-weight:bold">],</span>
                    <span style="color:#4e9a06">&#39;model__max_depth&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span>

                <span style="color:#000;font-weight:bold">}]</span>
            <span style="color:#000;font-weight:bold">]</span>
</code></pre></div><h3 id="implementing-grid-search-with-models-and-also-creating-metrics-from-each-of-the-model">Implementing Grid search with models and also creating metrics from each of the model.</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">Pipeline</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">memory</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#000">steps</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#4e9a06">&#39;preparation&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">FeatureUnion</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n_jobs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#000">transformer_list</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#4e9a06">&#39;num_pipeline&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Pipeline</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">memory</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#000">steps</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#4e9a06">&#39;selector&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DataFrameSelector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">attribute_names</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;amount&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;oldbalanceOrg&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;newbalanceOrig&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;oldbalanceDest&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;newbalanceDest&#39;</span><span style="color:#000;font-weight:bold">])),</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;attribs_adder&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">CombinedAttributesAdder</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000">penalty</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;l2&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">random_state</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">solver</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;warn&#39;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#000">tol</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0.0001</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">verbose</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">warm_start</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">))])</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.metrics</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mean_squared_error</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.metrics</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">classification_report</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.metrics</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">f1_score</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">xgboost.sklearn</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">XGBClassifier</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.svm</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">SVC</span>

<span style="color:#000">test_scores</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
<span style="color:#8f5902;font-style:italic">#Machine Learning Algorithm (MLA) Selection and Initialization</span>
<span style="color:#000">MLA</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000">linear_model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">LogisticRegression</span><span style="color:#000;font-weight:bold">(),</span>
        <span style="color:#000">keras_model</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">SVC</span><span style="color:#000;font-weight:bold">(),</span>
        <span style="color:#000">XGBClassifier</span><span style="color:#000;font-weight:bold">()</span>

      <span style="color:#000;font-weight:bold">]</span>

<span style="color:#8f5902;font-style:italic">#create table to compare MLA metrics</span>
<span style="color:#000">MLA_columns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Name&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Score&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Accuracy_Score&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;ROC_AUC_score&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;final_rmse&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Classification_error&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Recall_Score&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Precision_Score&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;mean_test_score&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;mean_fit_time&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;F1_Score&#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">MLA_compare</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DataFrame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">columns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MLA_columns</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">Model_Scores</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DataFrame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">columns</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Name&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Score&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">row_index</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">alg</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">MLA</span><span style="color:#000;font-weight:bold">:</span>

    <span style="color:#8f5902;font-style:italic">#set name and parameters</span>
    <span style="color:#000">MLA_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">alg</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__class__</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__name__</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Name&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MLA_name</span>
    <span style="color:#8f5902;font-style:italic">#MLA_compare.loc[row_index, &#39;Parameters&#39;] = str(alg.get_params())</span>


    <span style="color:#000">full_pipeline_with_predictor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Pipeline</span><span style="color:#000;font-weight:bold">([</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;preparation&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">full_pipeline</span><span style="color:#000;font-weight:bold">),</span>  <span style="color:#8f5902;font-style:italic"># combination of numerical and categorical pipelines</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;model&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">alg</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">])</span>

    <span style="color:#000">grid_search</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">GridSearchCV</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">full_pipeline_with_predictor</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">grid_param</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">cv</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">verbose</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">scoring</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;f1&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">return_train_score</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">grid_search</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">X_model_col</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">y_pred</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">grid_search</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Accuracy_Score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">accuracy_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;ROC_AUC_score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">roc_auc_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">),</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">grid_search</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">),</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">negative_mse</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">grid_search</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">best_score_</span>
    <span style="color:#000">scores</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sqrt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">negative_mse</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">final_mse</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean_squared_error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">final_rmse</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sqrt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">final_mse</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;final_rmse&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">final_rmse</span>

    <span style="color:#000">confusion_matrix_var</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">confusion_matrix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">TP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">confusion_matrix_var</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">TN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">confusion_matrix_var</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">FP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">confusion_matrix_var</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">FN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">confusion_matrix_var</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Classification_error&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(((</span><span style="color:#000">FP</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">FN</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">TP</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">TN</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">FP</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">FN</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Recall_Score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">recall_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Precision_Score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">precision_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;F1_Score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f1_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span>


    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;mean_test_score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">grid_search</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cv_results_</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;mean_test_score&#39;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">MLA_compare</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;mean_fit_time&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">grid_search</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cv_results_</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;mean_fit_time&#39;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#000">Model_Scores</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;MLA Name&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MLA_name</span>
    <span style="color:#000">Model_Scores</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loc</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">row_index</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;ML Score&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">roc_auc_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_pred</span><span style="color:#000;font-weight:bold">),</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#8f5902;font-style:italic">#Collect Mean Test scores for statistical significance test</span>
    <span style="color:#000">test_scores</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">grid_search</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cv_results_</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;mean_test_score&#39;</span><span style="color:#000;font-weight:bold">])</span>
    <span style="color:#000">row_index</span><span style="color:#ce5c00;font-weight:bold">+=</span><span style="color:#0000cf;font-weight:bold">1</span>
</code></pre></div><h3 id="results-table-from-the-model-evaluation-with-metrics">Results table from the Model evaluation with metrics.</h3>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-results.png" alt="Figure 7: scikit-learn"></p>
<p>Figure 7: scikit-learn</p>
<h3 id="roc-auc-score">ROC AUC Score</h3>
<p>AUC - ROC curve is a performance measurement for classification problem at various thresholds settings. ROC is a probability curve and AUC represents degree or measure of separability. It tells how much model is capable of distinguishing between classes. Higher the AUC, better the model is at predicting 0s as 0s and 1s as 1s.</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-rocauccurve.png" alt="Figure 8: scikit-learn"></p>
<p>Figure 8: scikit-learn</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-rocauc.png" alt="Figure 9: scikit-learn"></p>
<p>Figure 9: scikit-learn</p>
<h2 id="k-means-in-scikit-learn">K-means in scikit learn.</h2>
<h3 id="import">Import</h3>
<h2 id="k-means-algorithm">K-means Algorithm</h2>
<p>In this section we demonstrate how simple it is to use k-means in scikit learn.</p>
<h3 id="import-1">Import</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">time</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">time</span>
    <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
    <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>
    <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">metrics</span>
    <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.cluster</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">KMeans</span>
    <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.datasets</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">load_digits</span>
    <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.decomposition</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PCA</span>
    <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.preprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">scale</span>
</code></pre></div><h3 id="create-samples">Create samples</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">seed</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">digits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">load_digits</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scale</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">digits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="create-samples-1">Create samples</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">seed</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">digits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">load_digits</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scale</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">digits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">n_samples</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_features</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span>
    <span style="color:#000">n_digits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">unique</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">digits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">target</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">digits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">target</span>

    <span style="color:#000">sample_size</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">300</span>

    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;n_digits: </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">, </span><span style="color:#4e9a06">\t</span><span style="color:#4e9a06"> n_samples </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">, </span><span style="color:#4e9a06">\t</span><span style="color:#4e9a06"> n_features </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_samples</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_features</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">79</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#4e9a06">&#39;_&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;</span><span style="color:#4e9a06">% 9s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#4e9a06">&#39;init&#39;</span> <span style="color:#4e9a06">&#39;    time  inertia    homo   compl  v-meas     ARI AMI  silhouette&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;n_digits: </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">, </span><span style="color:#4e9a06">\t</span><span style="color:#4e9a06"> n_samples </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">, </span><span style="color:#4e9a06">\t</span><span style="color:#4e9a06"> n_features </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span>
          <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_samples</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_features</span><span style="color:#000;font-weight:bold">))</span>


    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">79</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#4e9a06">&#39;_&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;</span><span style="color:#4e9a06">% 9s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#4e9a06">&#39;init&#39;</span>
          <span style="color:#4e9a06">&#39;    time  inertia    homo   compl  v-meas     ARI AMI  silhouette&#39;</span><span style="color:#000;font-weight:bold">)</span>


    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">bench_k_means</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">estimator</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">t0</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;</span><span style="color:#4e9a06">% 9s</span><span style="color:#4e9a06">   </span><span style="color:#4e9a06">%.2f</span><span style="color:#4e9a06">s    </span><span style="color:#4e9a06">%i</span><span style="color:#4e9a06">   </span><span style="color:#4e9a06">%.3f</span><span style="color:#4e9a06">   </span><span style="color:#4e9a06">%.3f</span><span style="color:#4e9a06">   </span><span style="color:#4e9a06">%.3f</span><span style="color:#4e9a06">   </span><span style="color:#4e9a06">%.3f</span><span style="color:#4e9a06">   </span><span style="color:#4e9a06">%.3f</span><span style="color:#4e9a06">    </span><span style="color:#4e9a06">%.3f</span><span style="color:#4e9a06">&#39;</span>
              <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">t0</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">inertia_</span><span style="color:#000;font-weight:bold">,</span>
                 <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">homogeneity_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">labels</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">labels_</span><span style="color:#000;font-weight:bold">),</span>
                 <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">completeness_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">labels</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">labels_</span><span style="color:#000;font-weight:bold">),</span>
                 <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">v_measure_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">labels</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">labels_</span><span style="color:#000;font-weight:bold">),</span>
                 <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">adjusted_rand_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">labels</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">labels_</span><span style="color:#000;font-weight:bold">),</span>
                 <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">adjusted_mutual_info_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">labels</span><span style="color:#000;font-weight:bold">,</span>  <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">labels_</span><span style="color:#000;font-weight:bold">),</span>

                 <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">silhouette_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">labels_</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">metric</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;euclidean&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sample_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">sample_size</span><span style="color:#000;font-weight:bold">)))</span>

    <span style="color:#000">bench_k_means</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">KMeans</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;k-means++&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_clusters</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;k-means++&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">bench_k_means</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">KMeans</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;random&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_clusters</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;random&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>

                 <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">silhouette_score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">estimator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">labels_</span><span style="color:#000;font-weight:bold">,</span>
                                          <span style="color:#000">metric</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;euclidean&#39;</span><span style="color:#000;font-weight:bold">,</span>
                                          <span style="color:#000">sample_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">sample_size</span><span style="color:#000;font-weight:bold">)))</span>

    <span style="color:#000">bench_k_means</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">KMeans</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;k-means++&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_clusters</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span>
                  <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;k-means++&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">bench_k_means</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">KMeans</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;random&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_clusters</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span>
                  <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;random&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>


    <span style="color:#8f5902;font-style:italic"># in this case the seeding of the centers is deterministic, hence we run the</span>
    <span style="color:#8f5902;font-style:italic"># kmeans algorithm only once with n_init=1</span>
    <span style="color:#000">pca</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PCA</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n_components</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">bench_k_means</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">KMeans</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">pca</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">components_</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">n_clusters</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;PCA-based&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">79</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#4e9a06">&#39;_&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="visualize">Visualize</h3>
<p>See Figure 10</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#000">bench_k_means</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">KMeans</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">pca</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">components_</span><span style="color:#000;font-weight:bold">,</span>
                         <span style="color:#000">n_clusters</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span>
                  <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;PCA-based&#34;</span><span style="color:#000;font-weight:bold">,</span>
                  <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">79</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#4e9a06">&#39;_&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="visualize-1">Visualize</h3>
<p>See Figure 10</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#000">reduced_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PCA</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n_components</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit_transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">kmeans</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">KMeans</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;k-means++&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_clusters</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">n_digits</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n_init</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">kmeans</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">reduced_data</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#8f5902;font-style:italic"># Step size of the mesh. Decrease to increase the quality of the VQ.</span>
    <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#0000cf;font-weight:bold">02</span>     <span style="color:#8f5902;font-style:italic"># point in the mesh [x_min, x_max]x[y_min, y_max].</span>

    <span style="color:#8f5902;font-style:italic"># Plot the decision boundary. For that, we will assign a color to each</span>
    <span style="color:#000">x_min</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x_max</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">reduced_data</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">reduced_data</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
    <span style="color:#000">y_min</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_max</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">reduced_data</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">reduced_data</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
    <span style="color:#000">xx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">yy</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">meshgrid</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">arange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_min</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x_max</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">arange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_min</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_max</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">))</span>

    <span style="color:#8f5902;font-style:italic"># Obtain labels for each point in mesh. Use last trained model.</span>
    <span style="color:#000">Z</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">kmeans</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">c_</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">xx</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ravel</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">yy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ravel</span><span style="color:#000;font-weight:bold">()])</span>

    <span style="color:#8f5902;font-style:italic"># Put the result into a color plot</span>
    <span style="color:#000">Z</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Z</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reshape</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xx</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">figure</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">clf</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Z</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">interpolation</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;nearest&#39;</span><span style="color:#000;font-weight:bold">,</span>
               <span style="color:#000">extent</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xx</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">xx</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">yy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">yy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">()),</span>
               <span style="color:#000">cmap</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Paired</span><span style="color:#000;font-weight:bold">,</span>
               <span style="color:#000">aspect</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;auto&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">origin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;lower&#39;</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">reduced_data</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">reduced_data</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#4e9a06">&#39;k.&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">markersize</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#8f5902;font-style:italic"># Plot the centroids as a white X</span>
    <span style="color:#000">centroids</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">kmeans</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cluster_centers_</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">scatter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">centroids</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">centroids</span><span style="color:#000;font-weight:bold">[:,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span>
                <span style="color:#000">marker</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;x&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">s</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">169</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">linewidths</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">color</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;w&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">zorder</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;K-means clustering on the digits dataset (PCA-reduced data)</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#39;</span>
              <span style="color:#4e9a06">&#39;Centroids are marked with white cross&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xlim</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_min</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x_max</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ylim</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_min</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_max</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xticks</span><span style="color:#000;font-weight:bold">(())</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">yticks</span><span style="color:#000;font-weight:bold">(())</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-k-means_10_0.png" alt="Figure 10: Result"></p>
<p>Figure 10: Result</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0026bacb1a4e3d2e6df1d11ca44f4e6c">1.10.5 - Dask - Random Forest Feature Detection</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<h2 id="setup">Setup</h2>
<p>First we need our tools. pandas gives us the DataFrame, very similar
to R&rsquo;s DataFrames. The DataFrame is a structure that allows us to
work with our data more easily. It has nice features for slicing
and transformation of data, and easy ways to do basic statistics.</p>
<p>numpy has some very handy functions that work on DataFrames.</p>
<h2 id="dataset">Dataset</h2>
<p>We are using a dataset about the wine quality dataset, archived at UCI&rsquo;s Machine Learning Repository (<a href="http://archive.ics.uci.edu/ml/index.php)">http://archive.ics.uci.edu/ml/index.php)</a>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pandas</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">pd</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
</code></pre></div><p>Now we will load our data. pandas makes it easy!</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># red wine quality data, packed in a DataFrame</span>
<span style="color:#000">red_df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;winequality-red.csv&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sep</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;;&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">index_col</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># white wine quality data, packed in a DataFrame</span>
<span style="color:#000">white_df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;winequality-white.csv&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sep</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;;&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">index_col</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># rose? other fruit wines? plum wine? :(</span>
</code></pre></div><p>Like in R, there is a .describe() method that gives basic statistics for every column in the dataset.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># for red wines</span>
<span style="color:#000">red_df</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">describe</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><div>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;style&gt;
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
&lt;/style&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr style=&quot;text-align: right;&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>fixed acidity</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>volatile acidity</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>citric acid</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>residual sugar</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>chlorides</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>free sulfur dioxide</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>total sulfur dioxide</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>density</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>pH</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>sulphates</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>alcohol</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>quality</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>count</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>mean</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.319637</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.527821</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.270976</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.538806</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.087467</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>15.874922</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>46.467792</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.996747</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.311113</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.658149</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.422983</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.636023</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>std</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.741096</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.179060</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.194801</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.409928</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.047065</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.460157</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>32.895324</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.001887</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.154386</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.169507</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.065668</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.807569</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>min</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4.600000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.120000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.900000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.012000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.990070</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.740000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.330000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.400000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>25%</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.100000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.390000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.090000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.900000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.070000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>22.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.995600</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.210000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.550000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.500000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>50%</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.900000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.520000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.260000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.200000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.079000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>38.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.996750</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.310000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.620000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.200000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>75%</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.200000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.640000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.420000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.600000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.090000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>21.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>62.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.997835</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.400000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.730000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>11.100000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>max</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>15.900000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.580000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>15.500000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.611000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>72.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>289.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.003690</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4.010000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.900000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/table&gt;
</code></pre></div>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># for white wines</span>
<span style="color:#000">white_df</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">describe</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><div>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;style&gt;
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
&lt;/style&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr style=&quot;text-align: right;&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>fixed acidity</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>volatile acidity</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>citric acid</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>residual sugar</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>chlorides</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>free sulfur dioxide</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>total sulfur dioxide</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>density</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>pH</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>sulphates</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>alcohol</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>quality</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>count</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>mean</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.854788</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.278241</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.334192</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.391415</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.045772</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>35.308085</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>138.360657</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.994027</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.188267</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.489847</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.514267</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.877909</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>std</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.843868</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.100795</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.121020</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.072058</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.021848</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>17.007137</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>42.498065</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.002991</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.151001</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.114126</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.230621</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.885639</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>min</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.800000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.080000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.600000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.009000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.987110</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.720000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.220000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>25%</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.300000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.210000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.270000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.700000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.036000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>23.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>108.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.991723</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.090000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.410000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.500000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>50%</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.800000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.260000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.320000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.200000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.043000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>34.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>134.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.993740</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.180000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.470000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.400000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>75%</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.300000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.320000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.390000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.900000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.050000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>46.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>167.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.996100</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.280000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.550000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>11.400000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>max</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.200000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.100000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.660000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>65.800000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.346000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>289.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>440.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.038980</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.820000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.080000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.200000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.000000</p>
<pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/table&gt;
</code></pre></div>
<p>Sometimes it is easier to understand the data visually. A histogram of
the white wine quality <em>data citric</em> acid samples is shown next. You
can of course visualize other columns' data or other datasets. Just
replace the DataFrame and column name (see Figure 1).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">extract_col</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">df</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">col_name</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">col_name</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">col</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">extract_col</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_df</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;citric acid&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># can replace with another dataframe or column</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">hist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">col</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic">#TODO: add axes and such to set a good example</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/random-forest/images/random-forest_11_0.png" alt="Figure 1: Histogram"></p>
<p>Figure 1: Histogram</p>
<h2 id="detecting-features">Detecting Features</h2>
<p>Let us try out a some elementary machine learning models. These models
are not always for prediction. They are also useful to find what
features are most predictive of a variable of interest. Depending
on the classifier you use, you may need to transform the data
pertaining to that variable.</p>
<h3 id="data-preparation">Data Preparation</h3>
<p>Let us assume we want to study what features are most correlated
with pH. pH of course is real-valued, and continuous. The classifiers
we want to use usually need labeled or integer data. Hence, we will
transform the pH data, assigning wines with pH higher than average
as <code>hi</code> (more basic or alkaline) and wines with pH lower than
average as <code>lo</code> (more acidic).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># refresh to make Jupyter happy</span>
<span style="color:#000">red_df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;winequality-red.csv&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sep</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;;&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">index_col</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">white_df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;winequality-white.csv&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sep</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;;&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">index_col</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic">#TODO: data cleansing functions here, e.g. replacement of NaN</span>

<span style="color:#8f5902;font-style:italic"># if the variable you want to predict is continuous, you can map ranges of values</span>
<span style="color:#8f5902;font-style:italic"># to integer/binary/string labels</span>

<span style="color:#8f5902;font-style:italic"># for example, map the pH data to &#39;hi&#39; and &#39;lo&#39; if a pH value is more than or</span>
<span style="color:#8f5902;font-style:italic"># less than the mean pH, respectively</span>
<span style="color:#000">M</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">red_df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;pH&#39;</span><span style="color:#000;font-weight:bold">]))</span> <span style="color:#8f5902;font-style:italic"># expect inelegant code in these mappings</span>
<span style="color:#000">Lf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">p</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">p</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">M</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#4e9a06">&#39;lo&#39;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">p</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#000">M</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#4e9a06">&#39;hi&#39;</span> <span style="color:#8f5902;font-style:italic"># some C-style hackery</span>

<span style="color:#8f5902;font-style:italic"># create the new classifiable variable</span>
<span style="color:#000">red_df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;pH-hi-lo&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Lf</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87">list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">red_df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;pH&#39;</span><span style="color:#000;font-weight:bold">]))</span>

<span style="color:#8f5902;font-style:italic"># and remove the predecessor</span>
<span style="color:#204a87;font-weight:bold">del</span> <span style="color:#000">red_df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;pH&#39;</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>Now we specify which dataset and variable you want to predict by
assigning vlues to <code>SELECTED_DF</code> and <code>TARGET_VAR</code>, respectively.</p>
<p>We like to keep a parameter file where we specify data sources
and such. This lets me create generic analytics code that is easy
to reuse.</p>
<p>After we have specified what dataset we want to study, we split
the training and test datasets. We then scale (normalize) the data,
which makes most classifiers run better.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.model_selection</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">train_test_split</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.preprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">StandardScaler</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">metrics</span>

<span style="color:#8f5902;font-style:italic"># make selections here without digging in code</span>
<span style="color:#000">SELECTED_DF</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">red_df</span> <span style="color:#8f5902;font-style:italic"># selected dataset</span>
<span style="color:#000">TARGET_VAR</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;pH-hi-lo&#39;</span> <span style="color:#8f5902;font-style:italic"># the predicted variable</span>

<span style="color:#8f5902;font-style:italic"># generate nameless data structures</span>
<span style="color:#000">df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SELECTED_DF</span>
<span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">TARGET_VAR</span><span style="color:#000;font-weight:bold">])</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ravel</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#204a87;font-weight:bold">del</span> <span style="color:#000">df</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">TARGET_VAR</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#8f5902;font-style:italic"># no cheating</span>

<span style="color:#8f5902;font-style:italic">#TODO: data cleansing function calls here</span>

<span style="color:#8f5902;font-style:italic"># split datasets for training and testing</span>
<span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y_test</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">train_test_split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">df</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">target</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">test_size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># set up the scaler</span>
<span style="color:#000">scaler</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StandardScaler</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">scaler</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># apply the scaler</span>
<span style="color:#000">X_train</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scaler</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">X_test</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">scaler</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Now we pick a classifier. As you can see, there are many to try
out, and even more in scikit-learn&rsquo;s documentation and many
examples and tutorials. Random Forests are data science workhorses.
They are the go-to method for most data scientists. Be careful
relying on them though&ndash;they tend to overfit. We try to avoid
overfitting by separating the training and test datasets.</p>
<h2 id="random-forest">Random Forest</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># pick a classifier</span>

<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.tree</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">DecisionTreeClassifier</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">DecisionTreeRegressor</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">ExtraTreeClassifier</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">ExtraTreeRegressor</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sklearn.ensemble</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">RandomForestClassifier</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">ExtraTreesClassifier</span>

<span style="color:#000">clf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">RandomForestClassifier</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>Now we will test it out with the default parameters.</p>
<p>Note that this code is boilerplate. You can use it interchangeably for most scikit-learn models.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># test it out</span>

<span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">clf</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_train</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">y_train</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">pred</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">clf</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">predict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">conf_matrix</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">metrics</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">confusion_matrix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">pred</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">var_score</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">clf</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">score</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">X_test</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">y_test</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># the results</span>
<span style="color:#000">importances</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">clf</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">feature_importances_</span>
<span style="color:#000">indices</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">argsort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">importances</span><span style="color:#000;font-weight:bold">)[::</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>Now output the results. For Random Forests, we get a feature ranking.
Relative importances usually exponentially decay. The first few
highly-ranked features are usually the most important.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># for the sake of clarity</span>
<span style="color:#000">num_features</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">X_train</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">features</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">df</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">columns</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">],</span><span style="color:#000">indices</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">feature_importances</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">importances</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">],</span><span style="color:#000">indices</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">print</span> <span style="color:#4e9a06">&#39;Feature ranking:</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#39;</span>

<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">num_features</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">feature_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">features</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">feature_importance</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">feature_importances</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#4e9a06">&#39;</span><span style="color:#4e9a06">%s%f</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">feature_name</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ljust</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">feature_importance</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><pre><code>Feature ranking:

fixed acidity                 0.269778
citric acid                   0.171337
density                       0.089660
volatile acidity              0.088965
chlorides                     0.082945
alcohol                       0.080437
total sulfur dioxide          0.067832
sulphates                     0.047786
free sulfur dioxide           0.042727
residual sugar                0.037459
quality                       0.021075
</code></pre>
<p>Sometimes it&rsquo;s easier to visualize. We&rsquo;ll use a bar chart. See Figure 2</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">clf</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">num_features</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">feature_importances</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xticks</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">num_features</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">features</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">rotation</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">90</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ylabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;relative importance (a.u.)&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Relative importances of most predictive features&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/random-forest/images/random-forest_26_0.png" alt="Figure 2: Result"></p>
<p>Figure 2: Result</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">dask.dataframe</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">dd</span>

<span style="color:#000">red_df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;winequality-red.csv&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sep</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;;&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">white_df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;winequality-white.csv&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sep</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;;&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">header</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="acknowledgement">Acknowledgement</h2>
<p>This notebook was developed by Juliette Zerick and Gregor von Laszewski</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-00a632eb98f5bea1f33d0ade7f8a8fcb">1.10.6 - Parallel Computing in Python</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>In this module, we will review the available Python modules that can be
used for parallel computing. Parallel computing can be in the form of
either multi-threading or multi-processing. In multi-threading
approach, the threads run in the same shared memory heap whereas in
case of multi-processing, the memory heaps of processes are separate
and independent, therefore the communication between the processes are
a little bit more complex.</p>
<h2 id="multi-threading-in-python">Multi-threading in Python</h2>
<p>Threading in Python is perfect for I/O operations where the process is
expected to be idle regularly, e.g. web scraping. This is a very
useful feature because several applications and scripts might spend the
majority of their runtime waiting for network or data I/O. In
several cases, e.g. web scraping, the resources, i.e. downloading from
different websites, are most of the time-independent. Therefore the
processor can download in parallel and join the result at the end.</p>
<h3 id="thread-vs-threading"><code>Thread</code> vs <code>Threading</code></h3>
<p>There are two built-in modules in Python that are related to
threading, namely <code>thread</code> and <code>threading</code>. The former module is
deprecated for some time in <code>Python 2</code>, and in <code>Python 3</code> it is renamed
to <code>_thread</code> for the sake of backward incompatibilities. The
<code>_thread</code> module provides low-level threading API for multi-threading
in Python, whereas the module <code>threading</code> builds a high-level
threading interface on top of it.</p>
<p>The <code>Thread()</code> is the main method of the <code>threading</code> module, the two
important arguments of which are <code>target</code>, for specifying the callable
object, and <code>args</code> to pass the arguments for the target callable. We
illustrate these in the following example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">threading</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">hello_thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">thread_num</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello from Thread &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">thread_num</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">thread_num</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">t</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">threading</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">hello_thread</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">thread_num</span><span style="color:#000;font-weight:bold">,))</span>
        <span style="color:#000">t</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>This is the output of the previous example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">In</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]:</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">run</span> <span style="color:#000">threading</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">py</span>
<span style="color:#000">Hello</span> <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">Thread</span>  <span style="color:#0000cf;font-weight:bold">0</span>
<span style="color:#000">Hello</span> <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">Thread</span>  <span style="color:#0000cf;font-weight:bold">1</span>
<span style="color:#000">Hello</span> <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">Thread</span>  <span style="color:#0000cf;font-weight:bold">2</span>
<span style="color:#000">Hello</span> <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">Thread</span>  <span style="color:#0000cf;font-weight:bold">3</span>
<span style="color:#000">Hello</span> <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">Thread</span>  <span style="color:#0000cf;font-weight:bold">4</span>
</code></pre></div><p>In case you are not familiar with the <code>if __name__ == '__main__:'</code>
statement, what it does is making sure that the code nested
under this condition will be run only if you run your module as a
program and it will not run in case your module is imported into another
file.</p>
<h3 id="locks">Locks</h3>
<p>As mentioned prior, the memory space is shared between the
threads. This is at the same time beneficial and problematic: it is
beneficial in a sense that the communication between the threads
becomes easy, however, you might experience a strange outcome if you let
several threads change the same variable without caution, e.g. thread 2
changes variable <code>x</code> while thread 1 is working with it. This is when
<code>lock</code> comes into play. Using <code>lock</code>, you can allow only one thread to
work with a variable. In other words, only a single thread can hold
the <code>lock</code>. If the other threads need to work with that variable, they
have to wait until the other thread is done and the variable is
&ldquo;unlocked.&rdquo;</p>
<p>We illustrate this with a simple example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">threading</span>

<span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
<span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter 1 incremented the counter by 1&#34;</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Counter is </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer2</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter 2 incremented the counter by 1&#34;</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Counter is now </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">)</span>


<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">t1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">threading</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">t2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">threading</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer2</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">t1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">t2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>Suppose we want to print multiples of 3 between 1 and 12, i.e. 3, 6, 9
and 12. For the sake of argument, we try to do this using 2 threads
and a nested for loop. Then we create a global variable called counter
and we initialize it with 0. Then whenever each of the <code>incrementer1</code>
or <code>incrementer2</code> functions are called, the <code>counter</code> is incremented
by 3 twice (counter is incremented by 6 in each function call). If you
run the previous code, you should be really lucky if you get the
following as part of your output:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Counter is now <span style="color:#0000cf;font-weight:bold">3</span>
Counter is now <span style="color:#0000cf;font-weight:bold">6</span>
Counter is now <span style="color:#0000cf;font-weight:bold">9</span>
Counter is now <span style="color:#0000cf;font-weight:bold">12</span>
</code></pre></div><p>The reason is the conflict that happens between threads
while incrementing the <code>counter</code> in the nested for loop. As you
probably noticed, the first level for loop is equivalent to adding 3
to the counter and the conflict that might happen is not effective on
that level but the nested for loop. Accordingly, the output of the
previous code is different in every run. This is an example output:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 lock_example.py
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">4</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">8</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">10</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">12</span>
</code></pre></div><p>We can fix this issue using a <code>lock</code>: whenever one of the function is
going to increment the value by 3, it will <code>acquire()</code> the lock and
when it is done the function will <code>release()</code> the lock. This mechanism
is illustrated in the following code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">threading</span>

<span style="color:#000">increment_by_3_lock</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">threading</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Lock</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
<span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">acquire</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter 1 incremented the counter by 1&#34;</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Counter is </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">release</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer2</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">acquire</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter 2 incremented the counter by 1&#34;</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Counter is </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">release</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">t1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">threading</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">t2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">threading</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer2</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">t1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">t2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>No matter how many times you run this code, the output would always be
in the correct order:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 lock_example.py
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">3</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">1</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">6</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">9</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Greeter <span style="color:#0000cf;font-weight:bold">2</span> incremented the counter by <span style="color:#0000cf;font-weight:bold">1</span>
Counter is <span style="color:#0000cf;font-weight:bold">12</span>
</code></pre></div><p>Using the <code>Threading</code> module increases both the overhead associated
with thread management as well as the complexity of the program and
that is why in many situations, employing <code>multiprocessing</code> module
might be a better approach.</p>
<h2 id="multi-processing-in-python">Multi-processing in Python</h2>
<p>We already mentioned that multi-threading might not be sufficient in
many applications and we might need to use <code>multiprocessing</code> sometimes,
or better to say most of the time. That is why we are dedicating this
subsection to this particular module. This module provides you with an
API for spawning processes the way you spawn threads using <code>threading</code>
module. Moreover, some functionalities are not even
available in <code>threading</code> module, e.g. the <code>Pool</code> class which allows
you to run a batch of jobs using a <em>pool</em> of worker processes.</p>
<h3 id="process">Process</h3>
<p>Similar to <code>threading</code> module which was employing <code>thread</code> (aka
<code>_thread</code>) under the hood, <code>multiprocessing</code> employs the <code>Process</code>
class. Consider the following example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">multiprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Process</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">greeter</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">proc_idx</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getpid</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Process {0}: Hello {1}!&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">proc_idx</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">name_list</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Harry&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;George&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Dirk&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;David&#39;</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">process_list</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">name_idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name_list</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">current_process</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">greeter</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">,))</span>
        <span style="color:#000">process_list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">current_process</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">current_process</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">process</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">process_list</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">process</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>In this example, after importing the <code>Process</code> module we created a
<code>greeter()</code> function that takes a <code>name</code> and greets that person. It
also prints the <code>pid</code> (process identifier) of the process that is
running it. Note that we used the <code>os</code> module to get the <code>pid</code>. In the
bottom of the code after checking the <code>__name__='__main__'</code> condition,
we create a series of <code>Process</code>es and <code>start</code> them. Finally in the
last for loop and using the <code>join</code> method, we tell Python to wait for
the processes to terminate. This is one of the possible outputs of the
code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 process_example.py
Process 23451: Hello Harry!
Process 23452: Hello George!
Process 23453: Hello Dirk!
Process 23454: Hello David!
</code></pre></div><h3 id="pool">Pool</h3>
<p>Consider the <code>Pool</code> class as a pool of worker processes. There are
several ways for assigning jobs to the <code>Pool</code> class and we will
introduce the most important ones in this section. These methods are
categorized as <code>blocking</code> or <code>non-blocking. The former means that after calling the API, it blocks the thread/process until it has the result or answer ready and the control returns only when the call completes. In the</code>non-blockin` on the other hand, the control returns
immediately.</p>
<h4 id="synchronous-poolmap">Synchronous <code>Pool.map()</code></h4>
<p>We illustrate the <code>Pool.map</code> method by re-implementing our previous
greeter example using <code>Pool.map</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">multiprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Pool</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">greeter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">pid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getpid</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Process {0}: Hello {1}!&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pid</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Jenna&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;David&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Marry&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Ted&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Jerry&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Tom&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Justin&#39;</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">pool</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Pool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">processes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">sync_map</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pool</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">greeter</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Done!&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>As you can see, we have seven names here but we do not want to
dedicate each greeting to a separate process. Instead, we do the whole
job of &ldquo;greeting seven people&rdquo; using &ldquo;two processes.&rdquo; We create a pool
of 3 processes with <code>Pool(processes=3)</code> syntax and then we map an
iterable called <code>names</code> to the <code>greeter</code> function using
<code>pool.map(greeter,names)</code>. As we expected, the greetings in the
output will be printed from three different processes:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python poolmap_example.py
Process 30585: Hello Jenna!
Process 30586: Hello David!
Process 30587: Hello Marry!
Process 30585: Hello Ted!
Process 30585: Hello Jerry!
Process 30587: Hello Tom!
Process 30585: Hello Justin!
Done!
</code></pre></div><p>Note that <code>Pool.map()</code> is in <code>blocking</code> category and does not return
the control to your script until it is done calculating the
results. That is why <code>Done!</code> is printed after all of the greetings are
over.</p>
<h4 id="asynchronous-poolmap_async">Asynchronous <code>Pool.map_async()</code></h4>
<p>As the name implies, you can use the <code>map_async</code> method, when you want
assign many function calls to a pool of worker processes
asynchronously. Note that unlike <code>map</code>, the order of the results is
not guaranteed (as oppose to <code>map</code>) and the control is returned
immediately. We now implement the previous example using <code>map_async</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">multiprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Pool</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">greeter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">pid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getpid</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Process {0}: Hello {1}!&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pid</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Jenna&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;David&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Marry&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Ted&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Jerry&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Tom&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Justin&#39;</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">pool</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Pool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">processes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">async_map</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pool</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">map_async</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">greeter</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Done!&#34;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">async_map</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">wait</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>As you probably noticed, the only difference (clearly apart from the
<code>map_async</code> method name) is calling the <code>wait()</code> method in the last
line. The <code>wait()</code> method tells your script to wait for the result of
<code>map_async</code> before terminating:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python poolmap_example.py
Done!
Process 30740: Hello Jenna!
Process 30741: Hello David!
Process 30740: Hello Ted!
Process 30742: Hello Marry!
Process 30740: Hello Jerry!
Process 30741: Hello Tom!
Process 30742: Hello Justin!
</code></pre></div><p>Note that the order of the results are not preserved. Moreover,
<code>Done!</code> is printer before any of the results, meaning that if we do
not use the <code>wait()</code> method, you probably will not see the result at
all.</p>
<h3 id="locks-1">Locks</h3>
<p>The way <code>multiprocessing</code> module implements locks is almost identical
to the way the <code>threading</code> module does. After importing <code>Lock</code> from
<code>multiprocessing</code> all you need to do is to <code>acquire</code> it, do some
computation and then <code>release</code> the lock. We will clarify the use of
<code>Lock</code> by providing an example in next section about process
communication.</p>
<h3 id="process-communication">Process Communication</h3>
<p>Process communication in <code>multiprocessing</code> is one of the most
important, yet complicated, features for better use of this module. As
oppose to <code>threading</code>, the <code>Process</code> objects will not have access to
any shared variable by default, i.e. no shared memory space between
the processes by default. This effect is illustrated in the following
example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">multiprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Lock</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Value</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">time</span>

<span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
<span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter1: Counter is </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer2</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#204a87;font-weight:bold">global</span> <span style="color:#000">counter</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter2: Counter is </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">)</span>


<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>

    <span style="color:#000">t1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer1</span> <span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">t2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer2</span> <span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">t1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">t2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>Probably you already noticed that this is almost identical to our
example in <code>threading</code> section. Now, take a look at the strange
output:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python communication_example.py
Greeter1: Counter is <span style="color:#0000cf;font-weight:bold">3</span>
Greeter1: Counter is <span style="color:#0000cf;font-weight:bold">6</span>
Greeter2: Counter is <span style="color:#0000cf;font-weight:bold">3</span>
Greeter2: Counter is <span style="color:#0000cf;font-weight:bold">6</span>
</code></pre></div><p>As you can see, it is as if the processes does not see each
other. Instead of having two processes one counting to 6 and the other
counting from 6 to 12, we have two processes counting to 6.</p>
<p>Nevertheless, there are several ways that <code>Process</code>es from
<code>multiprocessing</code> can communicate with each other, including <code>Pipe</code>,
<code>Queue</code>, <code>Value</code>, <code>Array</code> and <code>Manager</code>. <code>Pipe</code> and <code>Queue</code> are
appropriate for inter-process message passing. To be more specific,
<code>Pipe</code> is useful for process-to-process scenarios while <code>Queue</code> is
more appropriate for process<strong>es</strong>-toprocess<strong>es</strong> ones. <code>Value</code> and
<code>Array</code> are both used to provide synchronized access to a shared
data (very much like shared memory) and <code>Managers</code> can be used on
different data types. In the following sub-sections, we cover both
<code>Value</code> and <code>Array</code> since they are both lightweight, yet useful,
approach.</p>
<h4 id="value">Value</h4>
<p>The following example re-implements the broken example in the previous
section. We fix the strange output, by using both <code>Lock</code> and <code>Value</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">multiprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Lock</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Value</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">time</span>

<span style="color:#000">increment_by_3_lock</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Lock</span><span style="color:#000;font-weight:bold">()</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">acquire</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.1</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter1: Counter is </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">release</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">acquire</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.05</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter2: Counter is </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">release</span><span style="color:#000;font-weight:bold">()</span>


<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>

    <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Value</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;i&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">t1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">,))</span>
    <span style="color:#000">t2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer2</span> <span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">,))</span>
    <span style="color:#000">t2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">t1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>The usage of <code>Lock</code> object in this example is identical to the example
in <code>threading</code> section. The usage of <code>counter</code> is on the other hand
the novel part. First, note that counter is not a global variable
anymore and instead it is a <code>Value</code> which returns a <code>ctypes</code> object
allocated from a shared memory between the processes. The first
argument <code>'i'</code> indicates a signed integer, and the second argument
defines the initialization value. In this case we are assigning a
signed integer in the shared memory initialized to size 0 to the
<code>counter</code> variable. We then modified our two functions and pass this
<em>shared</em> variable as an argument. Finally, we change the way we
increment the <code>counter</code> since the counter is not a Python integer anymore
but a <code>ctypes</code> signed integer where we can access its value using the
<code>value</code> attribute. The output of the code is now as we expected:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python mp_lock_example.py
Greeter2: Counter is <span style="color:#0000cf;font-weight:bold">3</span>
Greeter2: Counter is <span style="color:#0000cf;font-weight:bold">6</span>
Greeter1: Counter is <span style="color:#0000cf;font-weight:bold">9</span>
Greeter1: Counter is <span style="color:#0000cf;font-weight:bold">12</span>
</code></pre></div><p>The last example related to parallel processing, illustrates the use
of both <code>Value</code> and <code>Array</code>, as well as a technique to pass multiple
arguments to a function. Note that the <code>Process</code> object does not
accept multiple arguments for a function and therefore we need this or
similar techniques for passing multiple arguments. Also, this
technique can also be used when you want to pass multiple arguments to
<code>map</code> or <code>map_async</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">multiprocessing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Lock</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Array</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">time</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">ctypes</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">c_char_p</span>


<span style="color:#000">increment_by_3_lock</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Lock</span><span style="color:#000;font-weight:bold">()</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">counter_and_names</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">=</span>  <span style="color:#000">counter_and_names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">counter_and_names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">acquire</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.1</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">name_idx</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#ce5c00;font-weight:bold">//</span><span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter1: Greeting {0}! Counter is {1}&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">name_idx</span><span style="color:#000;font-weight:bold">],</span><span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">))</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">release</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">incrementer2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">counter_and_names</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">=</span>  <span style="color:#000">counter_and_names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">counter_and_names</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">j</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">acquire</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span>
            <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.05</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">name_idx</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#ce5c00;font-weight:bold">//</span><span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greeter2: Greeting {0}! Counter is {1}&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">name_idx</span><span style="color:#000;font-weight:bold">],</span><span style="color:#000">counter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">))</span>
        <span style="color:#000">increment_by_3_lock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">release</span><span style="color:#000;font-weight:bold">()</span>


<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">counter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Value</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;i&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Array</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">c_char_p</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">names</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;James&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Tom&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Sam&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Larry&#39;</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">t1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">),))</span>
    <span style="color:#000">t2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">target</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">incrementer2</span> <span style="color:#000;font-weight:bold">,</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">counter</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">),))</span>
    <span style="color:#000">t2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">t1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>In this example, we created a <code>multiprocessing.Array()</code> object and
assigned it to a variable called <code>names</code>. As we mentioned before, the
first argument is the <code>ctype</code> data type and since we want to create an
array of strings with a length of 4 (second argument), we imported the
<code>c_char_p</code> and passed it as the first argument.</p>
<p>Instead of passing the arguments separately, we merged both the
<code>Value</code> and <code>Array</code> objects in a tuple and passed the tuple to the
functions. We then modified the functions to unpack the objects in the
first two lines in both functions. Finally, we changed the print
statement in a way that each process greets a particular name. The
output of the example is:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 mp_lock_example.py
Greeter2: Greeting James! Counter is <span style="color:#0000cf;font-weight:bold">3</span>
Greeter2: Greeting Tom! Counter is <span style="color:#0000cf;font-weight:bold">6</span>
Greeter1: Greeting Sam! Counter is <span style="color:#0000cf;font-weight:bold">9</span>
Greeter1: Greeting Larry! Counter is <span style="color:#0000cf;font-weight:bold">12</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dcb9354b26f1bf4c30d415d41915fbfc">1.10.7 - Dask</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>Dask is a python-based parallel computing library for
analytics. Parallel computing is a type of computation in which many
calculations or the execution of processes are carried out
simultaneously. Large problems can often be divided into smaller ones,
which can then be solved concurrently.</p>
<p>Dask is composed of two components:</p>
<ol>
<li><em>Dynamic task scheduling optimized for computation.</em> This is similar to Airflow, Luigi, Celery, or Make, but optimized for interactive computational workloads.</li>
<li><em>Big Data collections</em> like parallel arrays, dataframes, and lists that extend common interfaces like NumPy, Pandas, or Python iterators to larger-than-memory or distributed environments. These
parallel collections run on top of the dynamic task schedulers.</li>
</ol>
<p>Dask emphasizes the following virtues:</p>
<ul>
<li><em>Familiar</em>: Provides parallelized NumPy array and Pandas DataFrame
objects.</li>
<li><em>Flexible</em>: Provides a task scheduling interface for more custom
workloads and integration with other projects.</li>
<li><em>Native</em>: Enables distributed computing in Pure Python with access
to the PyData stack.</li>
<li><em>Fast</em>: Operates with low overhead, low latency, and minimal
serialization necessary for fast numerical algorithms</li>
<li><em>Scales up</em>: Runs resiliently on clusters with 1000s of cores</li>
<li><em>Scales down</em>: Trivial to set up and run on a laptop in a single
process</li>
<li><em>Responsive</em>: Designed with interactive computing in mind it
provides rapid feedback and diagnostics to aid humans</li>
</ul>
<p>The section is structured in a number of subsections addressing the
following topics:</p>
<dl>
<dt>Foundations:</dt>
<dd>
<p>an explanation of what Dask is, how it works, and how to use lower
level primitives to set up computations. Casual users may wish to
skip this section, although we consider it useful knowledge for all
users.</p>
</dd>
<dt>Distributed Features:</dt>
<dd>
<p>information on running Dask on the distributed scheduler, which
enables scale-up to distributed settings and enhanced monitoring of
task operations. The distributed scheduler is now generally the
recommended engine for executing task work, even on single
workstations or laptops.</p>
</dd>
<dt>Collections:</dt>
<dd>
<p>convenient abstractions giving a familiar feel to big data.</p>
</dd>
<dt>Bags:</dt>
<dd>
<p>Python iterators with a functional paradigm, such as found in
func/iter-tools and toolz - generalize lists/generators to big data;
this will seem very familiar to users of PySpark&rsquo;s RDD</p>
</dd>
<dt>Array:</dt>
<dd>
<p>massive multi-dimensional numerical data, with Numpy functionality</p>
</dd>
<dt>Dataframe:</dt>
<dd>
<p>massive tabular data, with Pandas functionality</p>
</dd>
</dl>
<h2 id="how-dask-works">How Dask Works</h2>
<p>Dask is a computation tool for larger-than-memory datasets, parallel
execution or delayed/background execution.</p>
<p>We can summarize the basics of Dask as follows:</p>
<ul>
<li>process data that does not fit into memory by breaking it into
blocks and specifying task chains</li>
<li>parallelize execution of tasks across cores and even nodes of a
cluster</li>
<li>move computation to the data rather than the other way around, to
minimize communication overheads</li>
</ul>
<p>We use for-loops to build basic tasks, Python iterators, and the Numpy
(array) and Pandas (dataframe) functions for multi-dimensional or
tabular data, respectively.</p>
<p>Dask allows us to construct a prescription for the calculation we want
to carry out. A module named Dask.delayed lets us parallelize custom
code. It is useful whenever our problem doesn&rsquo;t quite fit a high-level
parallel object like dask.array or dask.dataframe but could still
benefit from parallelism. Dask.delayed works by delaying our function
evaluations and putting them into a dask graph. Here is a small
example:</p>
<pre><code>from dask import delayed

@delayed
def inc(x):
    return x + 1

@delayed
def add(x, y):
    return x + y
</code></pre>
<p>Here we have used the delayed annotation to show that we want these
functions to operate lazily - to save the set of inputs and execute
only on demand.</p>
<h2 id="dask-bag">Dask Bag</h2>
<p>Dask-bag excels in processing data that can be represented as a
sequence of arbitrary inputs. We&rsquo;ll refer to this as &ldquo;messy&rdquo; data,
because it can contain complex nested structures, missing fields,
mixtures of data types, etc. The functional programming style fits
very nicely with standard Python iteration, such as can be found in
the itertools module.</p>
<p>Messy data is often encountered at the beginning of data processing
pipelines when large volumes of raw data are first consumed. The
initial set of data might be JSON, CSV, XML, or any other format that
does not enforce strict structure and datatypes. For this reason, the
initial data massaging and processing is often done with Python lists,
dicts, and sets.</p>
<p>These core data structures are optimized for general-purpose storage
and processing. Adding streaming computation with iterators/generator
expressions or libraries like itertools or toolz let us process large
volumes in a small space. If we combine this with parallel processing
then we can churn through a fair amount of data.</p>
<p>Dask.bag is a high level Dask collection to automate common workloads
of this form. In a nutshell</p>
<pre><code>dask.bag = map, filter, toolz + parallel execution
</code></pre>
<p>You can create a Bag from a Python sequence, from files, from data on
S3, etc.</p>
<pre><code># each element is an integer
import dask.bag as db
b = db.from_sequence([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])

# each element is a text file of JSON lines
import os
b = db.read_text(os.path.join('data', 'accounts.*.json.gz'))

# Requires `s3fs` library
# each element is a remote CSV text file
b = db.read_text('s3://dask-data/nyc-taxi/2015/yellow_tripdata_2015-01.csv')
</code></pre>
<p>Bag objects hold the standard functional API found in projects like
the Python standard library, toolz, or pyspark, including map, filter,
groupby, etc.</p>
<p>As with Array and DataFrame objects, operations on Bag objects create
new bags. Call the .compute() method to trigger execution.</p>
<pre><code>def is_even(n):
    return n % 2 == 0

b = db.from_sequence([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
c = b.filter(is_even).map(lambda x: x ** 2)
c

# blocking form: wait for completion (which is very fast in this case)
c.compute()
</code></pre>
<p>For more details on Dask Bag check <a href="https://dask.pydata.org/en/latest/bag.html">https://dask.pydata.org/en/latest/bag.html</a></p>
<h2 id="concurrency-features">Concurrency Features</h2>
<p>Dask supports a real-time task framework that extends Python&rsquo;s
concurrent.futures interface. This interface is good for arbitrary
task scheduling, like dask.delayed, but is immediate rather than lazy,
which provides some more flexibility in situations where the
computations may evolve. These features depend on the second-generation task scheduler found in dask.distributed (which, despite
its name, runs very well on a single machine).</p>
<p>Dask allows us to simply construct graphs of tasks with
dependencies. We can find that graphs can also be created
automatically for us using functional, Numpy, or Pandas syntax on data
collections. None of this would be very useful if there weren&rsquo;t also
a way to execute these graphs, in a parallel and memory-aware
way. Dask comes with four available schedulers:</p>
<ul>
<li><code>dask.threaded.get</code>: a scheduler backed by a thread pool</li>
<li><code>dask.multiprocessing.get</code>: a scheduler backed by a process pool</li>
<li><code>dask.async.get_sync</code>: a synchronous scheduler, good for debugging</li>
<li><code>distributed.Client.get</code>: a distributed scheduler for executing graphs on multiple machines.</li>
</ul>
<p>Here is a simple program for dask.distributed library:</p>
<pre><code>from dask.distributed import Client
client = Client('scheduler:port')

futures = []
for fn in filenames:
    future = client.submit(load, fn)
    futures.append(future)

summary = client.submit(summarize, futures)
summary.result()
</code></pre>
<p>For more details on Concurrent Features by Dask check
<a href="https://dask.pydata.org/en/latest/futures.html">https://dask.pydata.org/en/latest/futures.html</a></p>
<h2 id="dask-array">Dask Array</h2>
<p>Dask arrays implement a subset of the NumPy interface on large arrays
using blocked algorithms and task scheduling. These behave like numpy
arrays, but break a massive job into tasks that are then executed by a
scheduler. The default scheduler uses threading but you can also use
multiprocessing or distributed or even serial processing (mainly for
debugging). You can tell the dask array how to break the data into
chunks for processing.</p>
<pre><code>import dask.array as da
f = h5py.File('myfile.hdf5')
x = da.from_array(f['/big-data'], chunks=(1000, 1000))
x - x.mean(axis=1).compute()
</code></pre>
<p>For more details on Dask Array check <a href="https://dask.pydata.org/en/latest/array.html">https://dask.pydata.org/en/latest/array.html</a></p>
<h2 id="dask-dataframe">Dask DataFrame</h2>
<p>A Dask DataFrame is a large parallel dataframe composed of many
smaller Pandas dataframes, split along the index. These pandas
dataframes may live on disk for larger-than-memory computing on a
single machine, or on many different machines in a
cluster. Dask.dataframe implements a commonly used subset of the
Pandas interface including elementwise operations, reductions,
grouping operations, joins, timeseries algorithms, and more. It copies
the Pandas interface for these operations exactly and so should be
very familiar to Pandas users. Because Dask.dataframe operations
merely coordinate Pandas operations they usually exhibit similar
performance characteristics as are found in Pandas. To run the
following code, save &lsquo;student.csv&rsquo; file in your machine.</p>
<pre><code>import pandas as pd
df = pd.read_csv('student.csv')
d = df.groupby(df.HID).Serial_No.mean()
print(d)

ID
101     1
102     2
104     3
105     4
106     5
107     6
109     7
111     8
201     9
202    10
Name: Serial_No, dtype: int64

import dask.dataframe as dd
df = dd.read_csv('student.csv')
dt = df.groupby(df.HID).Serial_No.mean().compute()
print (dt)

ID
101     1.0
102     2.0
104     3.0
105     4.0
106     5.0
107     6.0
109     7.0
111     8.0
201     9.0
202    10.0
Name: Serial_No, dtype: float64
</code></pre>
<p>For more details on Dask DataFrame check <a href="https://dask.pydata.org/en/latest/dataframe.html">https://dask.pydata.org/en/latest/dataframe.html</a></p>
<h2 id="dask-dataframe-storage">Dask DataFrame Storage</h2>
<p>Efficient storage can dramatically improve performance, particularly
when operating repeatedly from disk.</p>
<p>Decompressing text and parsing CSV files is expensive. One of the most
effective strategies with medium data is to use a binary storage
format like HDF5.</p>
<pre><code># be sure to shut down other kernels running distributed clients
from dask.distributed import Client
client = Client()
</code></pre>
<p>Create data if we don&rsquo;t have any</p>
<pre><code>from prep import accounts_csvs
accounts_csvs(3, 1000000, 500)
</code></pre>
<p>First we read our csv data as before.</p>
<p>CSV and other text-based file formats are the most common storage for
data from many sources, because they require minimal pre-processing,
can be written line-by-line and are human-readable. Since Pandas'
read_csv is well-optimized, CSVs are a reasonable input, but far from
optimized, since reading required extensive text parsing.</p>
<pre><code>import os
filename = os.path.join('data', 'accounts.*.csv')
filename

import dask.dataframe as dd
df_csv = dd.read_csv(filename)
df_csv.head()
</code></pre>
<p>HDF5 and netCDF are binary array formats very commonly used in the
scientific realm.</p>
<p>Pandas contains a specialized HDF5 format, HDFStore. The
dd.DataFrame.to_hdf method works exactly like the pd.DataFrame.to_hdf
method.</p>
<pre><code>target = os.path.join('data', 'accounts.h5')
target

%time df_csv.to_hdf(target, '/data')

df_hdf = dd.read_hdf(target, '/data')
df_hdf.head()
</code></pre>
<p>For more information on Dask DataFrame Storage, click <a href="http://dask.pydata.org/en/latest/dataframe-create.html">http://dask.pydata.org/en/latest/dataframe-create.html</a></p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://dask.pydata.org/en/latest/">https://dask.pydata.org/en/latest/</a></li>
<li><a href="http://matthewrocklin.com/blog/work/2017/10/16/streaming-dataframes-1">http://matthewrocklin.com/blog/work/2017/10/16/streaming-dataframes-1</a></li>
<li><a href="http://people.duke.edu/~ccc14/sta-663-2017/18A_Dask.html">http://people.duke.edu/~ccc14/sta-663-2017/18A_Dask.html</a></li>
<li><a href="https://www.kdnuggets.com/2016/09/introducing-dask-parallel-programming.html">https://www.kdnuggets.com/2016/09/introducing-dask-parallel-programming.html</a></li>
<li><a href="https://pypi.python.org/pypi/dask/">https://pypi.python.org/pypi/dask/</a></li>
<li><a href="https://www.hdfgroup.org/2015/03/hdf5-as-a-zero-configuration-ad-hoc-scientific-database-for-python/">https://www.hdfgroup.org/2015/03/hdf5-as-a-zero-configuration-ad-hoc-scientific-database-for-python/</a></li>
<li><a href="https://github.com/dask/dask-tutorial">https://github.com/dask/dask-tutorial</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-03f4c664d0009b8284a5bb80301fe16f">1.11 - Applications</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-56e94fe9e02446d78ac431c2741f68ad">1.11.1 - Fingerprint Matching</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<hr>
<blockquote>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/fingerprint/images/warning.png" alt="Warning"> Please note that NIST has temporarily removed the</p>
</blockquote>
<p>![Warning</p>
<blockquote>
<h2 id="if-you-have-one-please-notify-us">Fingerprint data set. We, unfortunately, do not have a copy of the dataset.
If you have one, please notify us</h2>
</blockquote>
<p>Python is a flexible and popular language for running data analysis
pipelines. In this section, we will implement a solution for
fingerprint matching.</p>
<h2 id="overview">Overview</h2>
<p>Fingerprint recognition refers to the automated method for verifying a
match between two fingerprints and that is used to identify individuals
and verify their identity. Fingerprints (Figure 1) are the most widely
used form of biometric used to identify individuals.</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/fingerprint/images/fingerprints.png" alt="Figure 1: Fingerprints"></p>
<p>Figure 1: Fingerprints</p>
<p>The automated fingerprint matching generally required the detection of
different fingerprint features (aggregate characteristics of ridges, and
minutia points) and then the use of fingerprint matching algorithm,
which can do both one-to-one and one-to-many matching operations.
Based on the number of matches a proximity score (distance or
similarity) can be calculated.</p>
<p>We use the following NIST dataset for the study:</p>
<p>Special Database 14 - NIST Mated Fingerprint Card Pairs 2.
(<a href="http://www.nist.gov/itl/iad/ig/special_dbases.cfm">http://www.nist.gov/itl/iad/ig/special\_dbases.cfm</a>)</p>
<h2 id="objectives">Objectives</h2>
<p>Match the fingerprint images from a probe set to a gallery set and
report the match scores.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>For this work we will use the following algorithms:</p>
<ul>
<li>MINDTCT: The NIST minutiae detector, which automatically locates and records ridge ending and bifurcations in a fingerprint image.
(<a href="http://www.nist.gov/itl/iad/ig/nbis.cfm">http://www.nist.gov/itl/iad/ig/nbis.cfm</a>)</li>
<li>BOZORTH3: A NIST fingerprint matching algorithm, which is a minutiae-based fingerprint-matching algorithm. It can do both one-to-one and one-to-many matching operations.
(<a href="http://www.nist.gov/itl/iad/ig/nbis.cfm">http://www.nist.gov/itl/iad/ig/nbis.cfm</a>)</li>
</ul>
<p>In order to follow along, you must have the NBIS tools which provide
<code>mindtct</code> and <code>bozorth3</code> installed. If you are on Ubuntu 16.04 Xenial,
the following steps will accomplish this:</p>
<pre><code>$ sudo apt-get update -qq
$ sudo apt-get install -y build-essential cmake unzip
$ wget &quot;http://nigos.nist.gov:8080/nist/nbis/nbis_v5_0_0.zip&quot;
$ unzip -d nbis nbis_v5_0_0.zip
$ cd nbis/Rel_5.0.0
$ ./setup.sh /usr/local --without-X11
$ sudo make
</code></pre>
<h2 id="implementation">Implementation</h2>
<ol>
<li>Fetch the fingerprint images from the web</li>
<li>Call out to external programs to prepare and compute the match
scored</li>
<li>Store the results in a database</li>
<li>Generate a plot to identify likely matches.</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">urllib</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">zipfile</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">hashlib</span>
</code></pre></div><p>we will be interacting with the operating system and manipulating files
and their pathnames.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os.path</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sys</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">shutil</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">tempfile</span>
</code></pre></div><p>Some general useful utilities</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">itertools</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">functools</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">types</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">pprint</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pprint</span>
</code></pre></div><p>Using the <code>attrs</code> library provides some nice shortcuts to defining
objects</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">attr</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sys</span>
</code></pre></div><p>we will be randomly dividing the entire dataset, based on user input,
into the probe and gallery stets</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">random</span>
</code></pre></div><p>we will need to call out to the NBIS software. we will also be using
multiple processes to take advantage of all the cores on our machine</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">subprocess</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">multiprocessing</span>
</code></pre></div><p>As for plotting, we will use <code>matplotlib</code>, though there are many
alternatives.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pandas</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">pd</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
</code></pre></div><p>Finally, we will write the results to a database.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sqlite3</span>
</code></pre></div><h2 id="utility-functions">Utility functions</h2>
<p>Next, we will define some utility functions:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">take</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">iterable</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#4e9a06">&#34;Returns a generator of the first **n** elements of an iterable&#34;</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">itertools</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">islice</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">iterable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n</span> <span style="color:#000;font-weight:bold">)</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">zipWith</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">function</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">iterables</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#4e9a06">&#34;Zip a set of **iterables** together and apply **function** to each tuple&#34;</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">group</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">itertools</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">izip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">iterables</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">yield</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">group</span><span style="color:#000;font-weight:bold">)</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">uncurry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">function</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#4e9a06">&#34;Transforms an N-arry **function** so that it accepts a single parameter of an N-tuple&#34;</span>
    <span style="color:#5c35cc;font-weight:bold">@functools.wraps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">function</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">wrapper</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">wrapper</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">fetch_url</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">url</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sha256</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;.&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">checksum_blocksize</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dryRun</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#4e9a06">&#34;&#34;&#34;Download a url.
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">    :param url: the url to the file on the web
</span><span style="color:#4e9a06">    :param sha256: the SHA-256 checksum. Used to determine if the file was previously downloaded.
</span><span style="color:#4e9a06">    :param prefix: directory to save the file
</span><span style="color:#4e9a06">    :param checksum_blocksize: blocksize to used when computing the checksum
</span><span style="color:#4e9a06">    :param dryRun: boolean indicating that calling this function should do nothing
</span><span style="color:#4e9a06">    :returns: the local path to the downloaded file
</span><span style="color:#4e9a06">    :rtype:
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">    &#34;&#34;&#34;</span>

    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exists</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">makedirs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">basename</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">url</span><span style="color:#000;font-weight:bold">))</span>

    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">dryRun</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">local</span>

    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exists</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">local</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Verifying checksum&#39;</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">chk</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">hashlib</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sha256</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">local</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;rb&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">:</span>
            <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">:</span>
                <span style="color:#000">bits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">fd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">checksum_blocksize</span><span style="color:#000;font-weight:bold">)</span>
                <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">bits</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">break</span>
                <span style="color:#000">chk</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">update</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bits</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">sha256</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">chk</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">hexdigest</span><span style="color:#000;font-weight:bold">():</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">local</span>

    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Downloading&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">url</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">report</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sofar</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">blocksize</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">totalsize</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">msg</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;{}%</span><span style="color:#4e9a06">\r</span><span style="color:#4e9a06">&#39;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">100</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">sofar</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">blocksize</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">totalsize</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stderr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">msg</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">urllib</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">urlretrieve</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">url</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">local</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">report</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">local</span>
</code></pre></div><h2 id="dataset">Dataset</h2>
<p>we will now define some global parameters</p>
<p>First, the fingerprint dataset</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">DATASET_URL</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;https://s3.amazonaws.com/nist-srd/SD4/NISTSpecialDatabase4GrayScaleImagesofFIGS.zip&#39;</span>
<span style="color:#000">DATASET_SHA256</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;4db6a8f3f9dc14c504180cbf67cdf35167a109280f121c901be37a80ac13c449&#39;</span>
</code></pre></div><p>We&rsquo;ll define how to download the dataset. This function is general
enough that it could be used to retrieve most files, but we will default
it to use the values from previous.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">prepare_dataset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">url</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sha256</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;.&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">skip</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">url</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">url</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">DATASET_URL</span>
    <span style="color:#000">sha256</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sha256</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">DATASET_SHA256</span>
    <span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">fetch_url</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">url</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sha256</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">sha256</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dryRun</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">skip</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">skip</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Extracting&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">local</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;to&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">zipfile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ZipFile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">local</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">:</span>
            <span style="color:#204a87">zip</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">extractall</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">splitext</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">local</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">name</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">locate_paths</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">path_md5list</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">path_md5list</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">line</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">itertools</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imap</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strip</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">parts</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">line</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">split</span><span style="color:#000;font-weight:bold">()</span>
            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parts</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">continue</span>
            <span style="color:#000">md5sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">path</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">parts</span>
            <span style="color:#000">chksum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Checksum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">md5sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">kind</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;md5&#39;</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">filepath</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">path</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#204a87;font-weight:bold">yield</span> <span style="color:#000">Path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">checksum</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">chksum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">filepath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">filepath</span><span style="color:#000;font-weight:bold">)</span>


<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">locate_images</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paths</span><span style="color:#000;font-weight:bold">):</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">predicate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">path</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">splitext</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">filepath</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">ext</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;.png&#39;</span><span style="color:#000;font-weight:bold">]</span>

    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">path</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">itertools</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ifilter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">predicate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">paths</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">yield</span> <span style="color:#000">image</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">checksum</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">path</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="data-model">Data Model</h2>
<p>we will define some classes so we have a nice API for working with the
dataflow. We set <code>slots=True</code> so that the resulting objects will be more
space-efficient.</p>
<h3 id="utilities">Utilities</h3>
<h4 id="checksum">Checksum</h4>
<p>The checksum consists of the actual hash value (<code>value</code>) as well as a
string representing the hashing algorithm. The validator enforces that
the algorithm can only be one of the listed acceptable methods</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@attr.s</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slots</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Checksum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>
  <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
  <span style="color:#000">kind</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">validator</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">o</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">v</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">v</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#4e9a06">&#39;md5 sha1 sha224 sha256 sha384 sha512&#39;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">split</span><span style="color:#000;font-weight:bold">())</span>
</code></pre></div><h4 id="path">Path</h4>
<p><code>Path refers to an image's file path and associated</code>Checksum`. We get
the checksum &ldquo;for&quot;free&rdquo; since the MD5 hash is provided for each
image in the dataset.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@attr.s</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slots</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">checksum</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">filepath</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><h4 id="image">Image</h4>
<p>The start of the data pipeline is the image. An <code>image</code> has an <code>id</code> (the
md5 hash) and the path to the image.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@attr.s</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slots</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">image</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87">id</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">path</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><h3 id="mindtct">Mindtct</h3>
<p>The next step in the pipeline is to apply the <code>mindtct</code> program from
NBIS. A <code>mindtct</code> object, therefore, represents the results of applying
<code>mindtct</code> on an <code>image</code>. The <code>xyt</code> output is needed for the next step,
and the <code>image</code> attribute represents the image id.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@attr.s</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slots</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">mindtct</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">image</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">xyt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">pretty</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">d</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">pprint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">d</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>We need a way to construct a <code>mindtct</code> object from an <code>image</code> object. A
straightforward way of doing this would be to have a <code>from_image</code>
<code>@staticmethod</code> or <code>@classmethod</code>, but that doesn't work well with
<code>multiprocessing</code> as top-level functions work best as they need to be
serialized.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">mindtct_from_image</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">imgpath</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">abspath</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">filepath</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">tempdir</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">tempfile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mkdtemp</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">oroot</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;result&#39;</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">cmd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;mindtct&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">imgpath</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">oroot</span><span style="color:#000;font-weight:bold">]</span>

    <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">subprocess</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">check_call</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cmd</span><span style="color:#000;font-weight:bold">)</span>

        <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">oroot</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#39;.xyt&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">:</span>
            <span style="color:#000">xyt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">fd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">()</span>

        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mindtct</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">xyt</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">xyt</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">result</span>

    <span style="color:#204a87;font-weight:bold">finally</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">shutil</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">rmtree</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="bozorth3">Bozorth3</h3>
<p>The final step in the pipeline is running the <code>bozorth3</code> from NBIS. The
<code>bozorth3</code> class represents the match being done: tracking the ids of
the probe and gallery images as well as the match score.</p>
<p>Since we will be writing these instances out to a database, we provide
some static methods for SQL statements. While there are many
Object-Relational-Model (ORM) libraries available for Python, this
approach keeps the current implementation simple.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@attr.s</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slots</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">bozorth3</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">probe</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">gallery</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">score</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#5c35cc;font-weight:bold">@staticmethod</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">sql_stmt_create_table</span><span style="color:#000;font-weight:bold">():</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#4e9a06">&#39;CREATE TABLE IF NOT EXISTS bozorth3&#39;</span> \
             <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#39;(probe TEXT, gallery TEXT, score NUMERIC)&#39;</span>

    <span style="color:#5c35cc;font-weight:bold">@staticmethod</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">sql_prepared_stmt_insert</span><span style="color:#000;font-weight:bold">():</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#4e9a06">&#39;INSERT INTO bozorth3 VALUES (?, ?, ?)&#39;</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">sql_prepared_stmt_insert_values</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">score</span>
</code></pre></div><p>In order to work well with <code>multiprocessing</code>, we define a class
representing the input parameters to <code>bozorth3</code> and a helper function
to run <code>bozorth3</code>. This way the pipeline definition can be kept simple
to a <code>map</code> to create the input and then a <code>map</code> to run the program.</p>
<p>As NBIS <code>bozorth3</code> can be called to compare one-to-one or one-to-many,
we will also dynamically choose between these approaches depending on if
the gallery attribute is a list or a single object.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@attr.s</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">slots</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">bozorth3_input</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">object</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">probe</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">gallery</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attr</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ib</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">run</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87">isinstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mindtct</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">bozorth3_from_one_to_one</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#204a87">isinstance</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">types</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ListType</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">bozorth3_from_one_to_many</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
            <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">ValueError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Unhandled type for gallery: {}&#39;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">)))</span>
</code></pre></div><p>The next is the top-level function to running <code>bozorth3</code>. It accepts an
instance of <code>bozorth3_input</code>. The is implemented as a simple top-level
wrapper so that it can be easily passed to the <code>multiprocessing</code>
library.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">run_bozorth3</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><h4 id="running-bozorth3">Running Bozorth3</h4>
<p>There are two cases to handle: 1. One-to-one probe to gallery sets 1.
One-to-many probe to gallery sets</p>
<p>Both approaches are implemented next. The implementations follow the
same pattern: 1. Create a temporary directory within with to work 1.
Write the probe and gallery images to files in the temporary directory</p>
<ol>
<li>Call the <code>bozorth3</code> executable 1. The match score is written to
<code>stdout</code> which is captured and then parsed. 1. Return a <code>bozorth3</code>
instance for each match 1. Make sure to clean up the temporary directory</li>
</ol>
<h5 id="one-to-one">One-to-one</h5>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">bozorth3_from_one_to_one</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">tempdir</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">tempfile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mkdtemp</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">probeFile</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;probe.xyt&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">galleryFile</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;gallery.xyt&#39;</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probeFile</span><span style="color:#000;font-weight:bold">,</span>   <span style="color:#4e9a06">&#39;wb&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">fd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xyt</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">galleryFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;wb&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">fd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gallery</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xyt</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">cmd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;bozorth3&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">probeFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">galleryFile</span><span style="color:#000;font-weight:bold">]</span>

    <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">subprocess</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">check_output</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cmd</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">score</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strip</span><span style="color:#000;font-weight:bold">())</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">bozorth3</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">gallery</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">gallery</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">score</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">score</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">finally</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">shutil</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">rmtree</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h5 id="one-to-many">One-to-many</h5>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">bozorth3_from_one_to_many</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">galleryset</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">tempdir</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">tempfile</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mkdtemp</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">probeFile</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;probe.xyt&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">galleryFiles</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;gallery</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">.xyt&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span>
                    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">galleryset</span><span style="color:#000;font-weight:bold">)]</span>

    <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probeFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;wb&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">fd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xyt</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">galleryFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">gallery</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">itertools</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">izip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">galleryFiles</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">galleryset</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">galleryFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;wb&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">fd</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">fd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gallery</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xyt</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">cmd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;bozorth3&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;-p&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">probeFile</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">galleryFiles</span>

    <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">subprocess</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">check_output</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cmd</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strip</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#000">scores</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">))</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">bozorth3</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">gallery</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">gallery</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">score</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">score</span><span style="color:#000;font-weight:bold">)</span>
               <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">score</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">gallery</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scores</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">galleryset</span><span style="color:#000;font-weight:bold">)]</span>
    <span style="color:#204a87;font-weight:bold">finally</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#000">shutil</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">rmtree</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tempdir</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="plotting">Plotting</h2>
<p>For plotting, we will operate only on the database. we will select a small
number of probe images and plot the score between them and the rest of
the gallery images.</p>
<p>The <code>mk_short_labels</code> helper function will be defined next.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dbfile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">nprobes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sqlite3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dbfile</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_sql</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#4e9a06">&#34;SELECT DISTINCT probe FROM bozorth3 ORDER BY score LIMIT &#39;</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">nprobes</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">con</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">conn</span>
    <span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">shortlabels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mk_short_labels</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">figure</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">probe</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">iteritems</span><span style="color:#000;font-weight:bold">():</span>
        <span style="color:#000">stmt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;SELECT gallery, score FROM bozorth3 WHERE probe = ? ORDER BY gallery DESC&#39;</span>
        <span style="color:#000">matches</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_sql</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stmt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">params</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">,),</span> <span style="color:#000">con</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">conn</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">xs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">arange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">matches</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">dtype</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">int</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">matches</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">score</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;probe </span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">shortlabels</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ylabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Score&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xlabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Gallery&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">legend</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bbox_to_anchor</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>The image ids are long hash strings. In order to minimize the amount of
space on the figure the labels occupy, we provide a helper function to
create a short label that still uniquely identifies each probe image in
the selected sample</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">mk_short_labels</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">series</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">start</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">size</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">xrange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">series</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])):</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">series</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">size</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">series</span><span style="color:#000;font-weight:bold">))):</span>
            <span style="color:#204a87;font-weight:bold">break</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">size</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">series</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="putting-it-all-together">Putting it all Together</h2>
<p>First, set up a temporary directory in which to work:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">pool</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">multiprocessing</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Pool</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">prefix</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;/tmp/fingerprint_example/&#39;</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">exists</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">makedirs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Next, we download and extract the fingerprint images from NIST:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">%%</span><span style="color:#000">time</span>
<span style="color:#000">dataprefix</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">prepare_dataset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><pre><code>Verifying checksum Extracting
/tmp/fingerprint_example/NISTSpecialDatabase4GrayScaleImagesofFIGS.zip
to /tmp/fingerprint_example/ CPU times: user 3.34 s, sys: 645 ms,
total: 3.99 s Wall time: 4.01 s
</code></pre>
<p>Next, we will configure the location of the MD5 checksum file that
comes with the download</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">md5listpath</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;NISTSpecialDatabase4GrayScaleImagesofFIGS/sd04/sd04_md5.lst&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Load the images from the downloaded files to start the analysis pipeline</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">%%</span><span style="color:#000">time</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Loading images&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">paths</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">locate_paths</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">md5listpath</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dataprefix</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">images</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">locate_images</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paths</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">mindtcts</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pool</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mindtct_from_image</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">images</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Done&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><pre><code>Loading images Done CPU times: user 187 ms, sys: 17 ms, total: 204 ms
Wall time: 1min 21s
</code></pre>
<p>We can examine one of the loaded images. Note that <code>image</code> refers to
the MD5 checksum that came with the image and the <code>xyt</code> attribute
represents the raw image data.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mindtcts</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">image</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mindtcts</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xyt</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">])</span>
</code></pre></div><pre><code>98b15d56330cb17f1982ae79348f711d 14 146 214 6 25 238 22 37 25 51 180 20
30 332 214
</code></pre>
<p>For example purposes we will only a use a small percentage of the
database, randomly selected, for pur probe and gallery datasets.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">perc_probe</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.001</span>
<span style="color:#000">perc_gallery</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.1</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">%%</span><span style="color:#000">time</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Generating samples&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">probes</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sample</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mindtcts</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">perc_probe</span>   <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mindtcts</span><span style="color:#000;font-weight:bold">)))</span>
<span style="color:#000">gallery</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">random</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sample</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mindtcts</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">perc_gallery</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mindtcts</span><span style="color:#000;font-weight:bold">)))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;|Probes| =&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probes</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;|Gallery|=&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><pre><code>Generating samples = 4 = 400 CPU times: user 2 ms, sys: 0 ns, total: 2
ms Wall time: 993 µs
</code></pre>
<p>We can now compute the matching scores between the probe and gallery
sets. This will use all cores available on this workstation.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">%%</span><span style="color:#000">time</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Matching&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87">input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">bozorth3_input</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probe</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">gallery</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">gallery</span><span style="color:#000;font-weight:bold">)</span>
         <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">probe</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">probes</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">bozorth3s</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pool</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">run_bozorth3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><pre><code>Matching CPU times: user 19 ms, sys: 1 ms, total: 20 ms Wall time: 1.07
s
</code></pre>
<p><code>bozorth3s</code> is now a <code>list</code> of <code>lists</code> of <code>bozorth3</code> instances.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;|Probes|  =&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bozorth3s</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;|Gallery| =&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bozorth3s</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]))</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Result:&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bozorth3s</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
</code></pre></div><pre><code>= 4 = 400 Result: bozorth3(probe='caf9143b268701416fbed6a9eb2eb4cf',
gallery='22fa0f24998eaea39dea152e4a73f267', score=4)
</code></pre>
<p>Now add the results to the database</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">dbfile</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prefix</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;scores.db&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sqlite3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dbfile</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">cursor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">conn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cursor</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">execute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bozorth3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sql_stmt_create_table</span><span style="color:#000;font-weight:bold">())</span>
</code></pre></div><pre><code>&lt;sqlite3.Cursor at 0x7f8a2f677490&gt;
</code></pre>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:bold">%%</span><span style="color:#000">time</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">group</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">bozorth3s</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">vals</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">map</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bozorth3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sql_prepared_stmt_insert_values</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">group</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">executemany</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bozorth3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sql_prepared_stmt_insert</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">vals</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">conn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">commit</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Inserted results for probe&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">group</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">probe</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><pre><code>Inserted results for probe caf9143b268701416fbed6a9eb2eb4cf Inserted
results for probe 55ac57f711eba081b9302eab74dea88e Inserted results for
probe 4ed2d53db3b5ab7d6b216ea0314beb4f Inserted results for probe
20f68849ee2dad02b8fb33ecd3ece507 CPU times: user 2 ms, sys: 3 ms, total:
5 ms Wall time: 3.57 ms
</code></pre>
<p>We now plot the results. Figure 2</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dbfile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">nprobes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">probes</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/fingerprint/images/fingerprint_matching_74_0.png" alt="Figure 2: Result"></p>
<p>Figure 2: Result</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">close</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-99965c710c9d60b5429156c532c1aaf4">1.11.2 - NIST Pedestrian and Face Detection :o2:</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/no.png" alt="No"></p>
<p>No</p>
<p>Pedestrian and Face Detection uses OpenCV to identify people standing in
a picture or a video and NIST use case in this document is built with
Apache Spark and Mesos clusters on multiple compute nodes.</p>
<p>The example in this tutorial deploys software packages on OpenStack
using Ansible with its roles. See Figure 1, Figure 2, Figure 3, Figure 4</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/image03.png" alt="Figure 1: Original"></p>
<p>Figure 1: Original</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/image05.png" alt="Figure 2: Pedestrian Detected"></p>
<p>Figure 2: Pedestrian Detected</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/image06.png" alt="Figure 3: Original"></p>
<p>Figure 3: Original</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/image04.png" alt="Figure 4: Pedestrian and Face/eyes Detected"></p>
<p>Figure 4: Pedestrian and Face/eyes Detected</p>
<h3 id="introduction">Introduction</h3>
<p>Human (pedestrian) detection and face detection have been studied during
the last several years and models for them have improved along with
Histograms of Oriented Gradients (HOG) for Human Detection [1]. OpenCV
is a Computer Vision library including the SVM classifier and the HOG
object detector for pedestrian detection and INRIA Person Dataset [2]
is one of the popular samples for both training and testing purposes. In
this document, we deploy Apache Spark on Mesos clusters to train and
apply detection models from OpenCV using Python API.</p>
<h4 id="inria-person-dataset">INRIA Person Dataset</h4>
<p>This dataset contains positive and negative images for training and test
purposes with annotation files for upright persons in each image. 288
positive test images, 453 negative test images, 614 positive training
images, and 1218 negative training images are included along with
normalized 64x128 pixel formats. 970MB dataset is available to download
[3].</p>
<h4 id="hog-with-svm-model">HOG with SVM model</h4>
<p>Histogram of Oriented Gradient (HOG) and Support Vector Machine (SVM)
are used as object detectors and classifiers and built-in python
libraries from OpenCV provide these models for human detection.</p>
<h4 id="ansible-automation-tool">Ansible Automation Tool</h4>
<p>Ansible is a python tool to install/configure/manage software on
multiple machines with JSON files where system descriptions are defined.
There are reasons why we use Ansible:</p>
<ul>
<li>
<p>Expandable: Leverages Python (default) but modules can be written in
any language</p>
</li>
<li>
<p>Agentless: no setup required on a managed node</p>
</li>
<li>
<p>Security: Allows deployment from userspace; uses ssh for
authentication</p>
</li>
<li>
<p>Flexibility: only requires ssh access to privileged user</p>
</li>
<li>
<p>Transparency: YAML Based script files express the steps of
installing and configuring software</p>
</li>
<li>
<p>Modularity: Single Ansible Role (should) contain all required
commands and variables to deploy software package independently</p>
</li>
<li>
<p>Sharing and portability: roles are available from the source (GitHub,
bitbucket, GitLab, etc) or the Ansible Galaxy portal</p>
</li>
</ul>
<p>We use Ansible roles to install software packages for Human and Face
Detection which requires running OpenCV Python libraries on Apache Mesos
with a cluster configuration. Dataset is also downloaded from the web
using an ansible role.</p>
<h3 id="deployment-by-ansible">Deployment by Ansible</h3>
<p>Ansible is to deploy applications and build clusters for
batch-processing large datasets towards target machines e.g. VM
instances on OpenStack and we use Ansible roles with <em>include</em> directive
to organize layers of big data software stacks (BDSS). Ansible provides
abstractions by Playbook Roles and reusability by Include statements. We
define X application in X Ansible Role, for example, and use include
statements to combine with other applications e.g. Y or Z. The layers
exist in subdirectories (see next) to add modularity to your Ansible
deployment. For example, there are five roles used in this example that
are Apache Mesos in a scheduler layer, Apache Spark in a processing
layer, an OpenCV library in an application layer, INRIA Person Dataset in
a dataset layer, and a python script for human and face detection in an
analytics layer. If you have an additional software package to add, you
can simply add a new role in the main Ansible playbook with <em>include</em>
directive. With this, your Ansible playbook maintains simple but
flexible to add more roles without having a large single file which is
getting difficult to read when it deploys more applications on multiple
layers. The main Ansible playbook runs Ansible roles in order which look
like:</p>
<pre><code>```
include: sched/00-mesos.yml
include: proc/01-spark.yml
include: apps/02-opencv.yml
include: data/03-inria-dataset.yml
Include: anlys/04-human-face-detection.yml
```
</code></pre>
<p>Directory names e.g. sched, proc, data, or anlys indicate BDSS layers
like: - sched: scheduler layer - proc: data processing layer - apps:
application layer - data: dataset layer - anlys: analytics layer and two
digits in the filename indicate an order of roles to be run.</p>
<h3 id="cloudmesh-for-provisioning">Cloudmesh for Provisioning</h3>
<p>It is assumed that virtual machines are created by cloudmesh, the cloud
management software. For example on OpenStack,</p>
<p><code>cm cluster create -N=6</code></p>
<p>command starts a set of virtual machine instances. The number of
machines and groups for clusters e.g. namenodes and datanodes are
defined in the Ansible inventory file, a list of target machines with
groups, which will be generated once machines are ready to use by
cloudmesh. Ansible roles install software and dataset on virtual
clusters after that stage.</p>
<h3 id="roles-explained-for-installation">Roles Explained for Installation</h3>
<p>Mesos role is installed first as a scheduler layer for masters and
slaves where mesos-master runs on the masters group and mesos-slave runs
on the slaves group. Apache Zookeeper is included in the mesos role
therefore mesos slaves find an elected mesos leader for the
coordination. Spark, as a data processing layer, provides two options
for distributed job processing, batch job processing via a cluster mode
and real-time processing via a client mode. The Mesos dispatcher runs on
a masters group to accept a batch job submission and Spark interactive
shell, which is the client mode, provides real-time processing on any
node in the cluster. Either way, Spark is installed later to detect a
master (leader) host for a job submission. Other roles for OpenCV, INRIA
Person Dataset and Human and Face Detection Python applications are
followed by.</p>
<p>The following software is expected in the stacks according to the
<a href="https://github.com/futuresystems/pedestrian-and-face-detection">github</a>:</p>
<ul>
<li>
<p>mesos cluster (master, worker)</p>
</li>
<li>
<p>spark (with dispatcher for mesos cluster mode)</p>
</li>
<li>
<p>openCV</p>
</li>
<li>
<p>zookeeper</p>
</li>
<li>
<p>INRIA Person Dataset</p>
</li>
<li>
<p>Detection Analytics in Python</p>
</li>
<li>
<p>[1] Dalal, Navneet, and Bill Triggs. &ldquo;Histograms of oriented
gradients for human detection.&rdquo; 2005 IEEE Computer Society
Conference on Computer Vision and Pattern Recognition (CVPR'05).
Vol. 1. IEEE,</p>
<p>2005. [pdf]</p>
</li>
<li>
<p>[2] <a href="http://pascal.inrialpes.fr/data/human/">http://pascal.inrialpes.fr/data/human/</a></p>
</li>
<li>
<p>[3] <a href="ftp://ftp.inrialpes.fr/pub/lear/douze/data/INRIAPerson.tar">ftp://ftp.inrialpes.fr/pub/lear/douze/data/INRIAPerson.tar</a></p>
</li>
<li>
<p>[4] <a href="https://docs.python.org/2/library/configparser.html">https://docs.python.org/2/library/configparser.html</a></p>
</li>
</ul>
<h4 id="server-groups-for-mastersslaves-by-ansible-inventory">Server groups for Masters/Slaves by Ansible inventory</h4>
<p>We may separate compute nodes in two groups: masters and workers
therefore Mesos masters and zookeeper quorums manage job requests and
leaders and workers run actual tasks. Ansible needs group definitions in
their inventory therefore software installation associated with a proper
part can be completed.</p>
<p>Example of Ansible Inventory file (inventory.txt)</p>
<pre><code>[masters]
10.0.5.67
10.0.5.68
10.0.5.69
[slaves]
10.0.5.70
10.0.5.71
10.0.5.72
</code></pre>
<h3 id="instructions-for-deployment">Instructions for Deployment</h3>
<p>The following commands complete NIST Pedestrian and Face Detection
deployment on OpenStack.</p>
<h4 id="cloning-pedestrian-detection-repository-from-github">Cloning Pedestrian Detection Repository from Github</h4>
<p>Roles are included as submodules that require <code>--recursive</code> option to
checkout them all.</p>
<pre><code>$ git clone --recursive https://github.com/futuresystems/pedestrian-and-face-detection.git
</code></pre>
<p>Change the following variable with actual ip addresses:</p>
<pre><code>sample_inventory=&quot;&quot;&quot;[masters]
10.0.5.67
10.0.5.68
10.0.5.69
[slaves]
10.0.5.70
10.0.5.71
10.0.5.72&quot;&quot;&quot;
</code></pre>
<p>Create an <code>inventory.txt</code> file with the variable in your local directory.</p>
<pre><code>!printf &quot;$sample_inventory&quot; &gt; inventory.txt
!cat inventory.txt
</code></pre>
<p>Add <code>ansible.cfg</code> file with options for ssh host key checking and login
name.</p>
<pre><code>ansible_config=&quot;&quot;&quot;[defaults]
host_key_checking=false
remote_user=ubuntu&quot;&quot;&quot;
!printf &quot;$ansible_config&quot; &gt; ansible.cfg
!cat ansible.cfg
</code></pre>
<p>Check accessibility by ansible ping like:</p>
<pre><code>!ansible -m ping -i inventory.txt all
</code></pre>
<p>Make sure that you have a correct ssh key in your account otherwise you
may encounter &lsquo;FAILURE&rsquo; in the previous ping test.</p>
<h4 id="ansible-playbook">Ansible Playbook</h4>
<p>We use a main Ansible playbook to deploy software packages for NIST
Pedestrian and Face detection which includes: - mesos - spark -zookeeper</p>
<ul>
<li>
<p>opencv - INRIA Person dataset - Python script for the detection</p>
<p>!cd pedestrian-and-face-detection/ &amp;&amp; ansible-playbook -i ../inventory.txt site.yml</p>
</li>
</ul>
<p>The installation may take 30 minutes or an hour to complete.</p>
<h3 id="opencv-in-python">OpenCV in Python</h3>
<p>Before we run our code for this project, let&rsquo;s try OpenCV first to see
how it works.</p>
<h4 id="import-cv2">Import cv2</h4>
<p>Let us import opencv python module and we will use images from the online
database image-net.org to test OpenCV image recognition. See Figure 5, Figure 6</p>
<pre><code>import cv2
</code></pre>
<p>Let us download a mailbox image with a red color to see if opencv
identifies the shape with a color. The example file in this tutorial is:</p>
<pre><code>$ curl http://farm4.static.flickr.com/3061/2739199963_ee78af76ef.jpg &gt; mailbox.jpg
</code></pre>
<blockquote>
<p>100 167k 100 167k 0 0 686k 0 &ndash;:&ndash;:&ndash; &ndash;:&ndash;:&ndash; &ndash;:&ndash;:&ndash; 684k</p>
</blockquote>
<pre><code>%matplotlib inline

from IPython.display import Image
mailbox_image = &quot;mailbox.jpg&quot;
Image(filename=mailbox_image)
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_46_0.jpeg" alt="Figure 5: Mailbox image"></p>
<p>Figure 5: Mailbox image</p>
<p>You can try other images. Check out the image-net.org for mailbox
images: <a href="http://image-net.org/synset?wnid=n03710193">http://image-net.org/synset?wnid=n03710193</a></p>
<h4 id="image-detection">Image Detection</h4>
<p>Just for a test, let&rsquo;s try to detect a red color shaped mailbox using
opencv python functions.</p>
<p>There are key functions that we use: * cvtColor: to convert a color
space of an image * inRange: to detect a mailbox based on the range of
red color pixel values * np.array: to define the range of red color
using a Numpy library for better calculation * findContours: to find a
outline of the object * bitwise_and: to black-out the area of contours
found</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
    <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>

    <span style="color:#8f5902;font-style:italic"># imread for loading an image</span>
    <span style="color:#000">img</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mailbox_image</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#8f5902;font-style:italic"># cvtColor for color conversion</span>
    <span style="color:#000">hsv</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cvtColor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">COLOR_BGR2HSV</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#8f5902;font-style:italic"># define range of red color in hsv</span>
    <span style="color:#000">lower_red1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">])</span>
    <span style="color:#000">upper_red1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">])</span>
    <span style="color:#000">lower_red2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">170</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">])</span>
    <span style="color:#000">upper_red2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">180</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#8f5902;font-style:italic"># threshold the hsv image to get only red colors</span>
    <span style="color:#000">mask1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">inRange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">hsv</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">lower_red1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">upper_red1</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">mask2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">inRange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">hsv</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">lower_red2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">upper_red2</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">mask</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mask1</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">mask2</span>

    <span style="color:#8f5902;font-style:italic"># find a red color mailbox from the image</span>
    <span style="color:#000">im2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">contours</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">hierarchy</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">findContours</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mask</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">RETR_TREE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CHAIN_APPROX_SIMPLE</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#8f5902;font-style:italic"># bitwise_and to remove other areas in the image except the detected object</span>
    <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bitwise_and</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">img</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mask</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mask</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#8f5902;font-style:italic"># turn off - x, y axis bar</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">axis</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;off&#34;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#8f5902;font-style:italic"># text for the masked image</span>
    <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">putText</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">res</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;masked image&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">300</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">FONT_HERSHEY_SIMPLEX</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#8f5902;font-style:italic"># display</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cvtColor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">res</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">COLOR_BGR2RGB</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_49_0.png" alt="Figure 6: Masked image"></p>
<p>Figure 6: Masked image</p>
<p>The red color mailbox is left alone in the image which we wanted to find
in this example by OpenCV functions. You can try other images with
different colors to detect the different shape of objects using
findContours and inRange from opencv.</p>
<p>For more information, see the next useful links.</p>
<ul>
<li>
<p>contours features:
<a href="http://docs.opencv.org/3.1.0/dd/d49/tutorial/_py/_contour/_features.html">http://docs.opencv.org/3.1.0/dd/d49/tutorial/_py/_contour/_features.html</a></p>
</li>
<li>
<p>contours:
<a href="http://docs.opencv.org/3.1.0/d4/d73/tutorial/_py/_contours/_begin.html">http://docs.opencv.org/3.1.0/d4/d73/tutorial/_py/_contours/_begin.html</a></p>
</li>
<li>
<p>red color in hsv:
<a href="http://stackoverflow.com/questions/30331944/finding-red-color-using-python-opencv">http://stackoverflow.com/questions/30331944/finding-red-color-using-python-opencv</a></p>
</li>
<li>
<p>inrange:
<a href="http://docs.opencv.org/master/da/d97/tutorial/_threshold/_inRange.html">http://docs.opencv.org/master/da/d97/tutorial/_threshold/_inRange.html</a></p>
</li>
<li>
<p>inrange:
<a href="http://docs.opencv.org/3.0-beta/doc/py/_tutorials/py/_imgproc/py/_colorspaces/py/_colorspaces.html">http://docs.opencv.org/3.0-beta/doc/py/_tutorials/py/_imgproc/py/_colorspaces/py/_colorspaces.html</a></p>
</li>
<li>
<p>numpy:
<a href="http://docs.opencv.org/3.0-beta/doc/py/_tutorials/py/_core/py/_basic/_ops/py/_basic/_ops.html">http://docs.opencv.org/3.0-beta/doc/py/_tutorials/py/_core/py/_basic/_ops/py/_basic/_ops.html</a></p>
</li>
</ul>
<h3 id="human-and-face-detection-in-opencv">Human and Face Detection in OpenCV</h3>
<h4 id="inria-person-dataset-1">INRIA Person Dataset</h4>
<p>We use INRIA Person dataset to detect upright people and faces in images
in this example. Let us download it first.</p>
<pre><code>$ curl ftp://ftp.inrialpes.fr/pub/lear/douze/data/INRIAPerson.tar &gt; INRIAPerson.tar
</code></pre>
<blockquote>
<p>100 969M 100 969M 0 0 8480k 0 0:01:57 0:01:57 &ndash;:&ndash;:&ndash; 12.4M</p>
</blockquote>
<pre><code>$ tar xvf INRIAPerson.tar &gt; logfile &amp;&amp; tail logfile
</code></pre>
<h4 id="face-detection-using-haar-cascades">Face Detection using Haar Cascades</h4>
<p>This section is prepared based on the opencv-python tutorial:
<a href="http://docs.opencv.org/3.1.0/d7/d8b/tutorial/_py/_face/_detection.html#gsc.tab=0">http://docs.opencv.org/3.1.0/d7/d8b/tutorial/_py/_face/_detection.html#gsc.tab=0</a></p>
<p>There is a pre-trained classifier for face detection, download it from
here:</p>
<pre><code>$ curl https://raw.githubusercontent.com/opencv/opencv/master/data/haarcascades/haarcascade_frontalface_default.xml &gt; haarcascade_frontalface_default.xml
</code></pre>
<blockquote>
<p>100 908k 100 908k 0 0 2225k 0 &ndash;:&ndash;:&ndash; &ndash;:&ndash;:&ndash; &ndash;:&ndash;:&ndash; 2259k</p>
</blockquote>
<p>This classifier XML file will be used to detect faces in images. If you
like to create a new classifier, find out more information about
training from here:
<a href="http://docs.opencv.org/3.1.0/dc/d88/tutorial/_traincascade.html">http://docs.opencv.org/3.1.0/dc/d88/tutorial/_traincascade.html</a></p>
<h4 id="face-detection-python-code-snippet">Face Detection Python Code Snippet</h4>
<p>Now, we detect faces from the first five images using the classifier. See Figure 7, Figure 8, Figure 9, Figure 10, Figure 11, Figure 12, Figure 13, Figure 14, Figure 15, Figure 16, Figure 17</p>
<pre><code># import the necessary packages
import numpy as np
import cv2
from os import listdir
from os.path import isfile, join
import matplotlib.pyplot as plt

mypath = &quot;INRIAPerson/Test/pos/&quot;
face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')

onlyfiles = [join(mypath, f) for f in listdir(mypath) if isfile(join(mypath, f))]

cnt = 0
for filename in onlyfiles:
    image = cv2.imread(filename)
    image_grayscale = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
    faces = face_cascade.detectMultiScale(image_grayscale, 1.3, 5)
    if len(faces) == 0:
        continue

    cnt_faces = 1
    for (x,y,w,h) in faces:
        cv2.rectangle(image,(x,y),(x+w,y+h),(255,0,0),2)
        cv2.putText(image, &quot;face&quot; + str(cnt_faces), (x,y-10), cv2.FONT_HERSHEY_SIMPLEX, 1, (0,0,0), 2)
        plt.figure()
        plt.axis(&quot;off&quot;)
        plt.imshow(cv2.cvtColor(image[y:y+h, x:x+w], cv2.COLOR_BGR2RGB))
        cnt_faces += 1
    plt.figure()
    plt.axis(&quot;off&quot;)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    cnt = cnt + 1
    if cnt == 5:
        break
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_0.png" alt="Figure 7: Example"></p>
<p>Figure 7: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_1.png" alt="Figure 8: Example"></p>
<p>Figure 8: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_2.png" alt="Figure 9: Example"></p>
<p>Figure 9: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_3.png" alt="Figure 10: Example"></p>
<p>Figure 10: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_4.png" alt="Figure 11: Example"></p>
<p>Figure 11: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_5.png" alt="Figure 12: Example"></p>
<p>Figure 12: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_6.png" alt="Figure 13: Example"></p>
<p>Figure 13: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_7.png" alt="Figure 14: Example"></p>
<p>Figure 14: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_8.png" alt="Figure 15: Example"></p>
<p>Figure 15: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_9.png" alt="Figure 16: Example"></p>
<p>Figure 16: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_59_10.png" alt="Figure 17: Example"></p>
<p>Figure 17: Example</p>
<h3 id="pedestrian-detection-using-hog-descriptor">Pedestrian Detection using HOG Descriptor</h3>
<p>We will use Histogram of Oriented Gradients (HOG) to detect a upright
person from images. See Figure 18, Figure 19, Figure 20, Figure 21, Figure 22, Figure 23, Figure 24, Figure 25, Figure 26, Figure 27</p>
<h4 id="python-code-snippet">Python Code Snippet</h4>
<pre><code># initialize the HOG descriptor/person detector
hog = cv2.HOGDescriptor()
hog.setSVMDetector(cv2.HOGDescriptor_getDefaultPeopleDetector())

cnt = 0
for filename in onlyfiles:
    img = cv2.imread(filename)
    orig = img.copy()
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

    # detect people in the image
    (rects, weights) = hog.detectMultiScale(img, winStride=(8, 8),
    padding=(16, 16), scale=1.05)

    # draw the final bounding boxes
    for (x, y, w, h) in rects:
        cv2.rectangle(img, (x, y), (x + w, y + h), (0, 255, 0), 2)

    plt.figure()
    plt.axis(&quot;off&quot;)
    plt.imshow(cv2.cvtColor(orig, cv2.COLOR_BGR2RGB))
    plt.figure()
    plt.axis(&quot;off&quot;)
    plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))
    cnt = cnt + 1
    if cnt == 5:
        break
</code></pre>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_0.png" alt="Figure 18: Example"></p>
<p>Figure 18: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_1.png" alt="Figure 19: Example"></p>
<p>Figure 19: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_2.png" alt="Figure 20: Example"></p>
<p>Figure 20: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_3.png" alt="Figure 21: Example"></p>
<p>Figure 21: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_4.png" alt="Figure 22: Example"></p>
<p>Figure 22: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_5.png" alt="Figure 23: Example"></p>
<p>Figure 23: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_6.png" alt="Figure 24: Example"></p>
<p>Figure 24: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_7.png" alt="Figure 25: Example"></p>
<p>Figure 25: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_8.png" alt="Figure 26: Example"></p>
<p>Figure 26: Example</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/facedetection/images/facedetection_62_9.png" alt="Figure 27: Example"></p>
<p>Figure 27: Example</p>
<h3 id="processing-by-apache-spark">Processing by Apache Spark</h3>
<p>INRIA Person dataset provides 100+ images and Spark can be used for
image processing in parallel. We load 288 images from &ldquo;Test/pos&rdquo;
directory.</p>
<p>Spark provides a special object &lsquo;sc&rsquo; to connect between a spark cluster
and functions in python code. Therefore, we can run python functions in
parallel to detect objects in this example.</p>
<ul>
<li>
<p><em>map</em> function is used to process pedestrian and face detection per
image from the parallelize() function of &lsquo;sc&rsquo; spark context.</p>
</li>
<li>
<p><em>collect</em> function merges results in an array.</p>
<p>def apply_batch(imagePath):
import cv2
import numpy as np
# initialize the HOG descriptor/person detector
hog = cv2.HOGDescriptor()
hog.setSVMDetector(cv2.HOGDescriptor_getDefaultPeopleDetector())
image = cv2.imread(imagePath)
# detect people in the image
(rects, weights) = hog.detectMultiScale(image, winStride=(8, 8),
padding=(16, 16), scale=1.05)
# draw the final bounding boxes
for (x, y, w, h) in rects:
cv2.rectangle(image, (x, y), (x + w, y + h), (0, 255, 0), 2)
return image</p>
</li>
</ul>
<h4 id="parallelize-in-spark-context">Parallelize in Spark Context</h4>
<p>The list of image files is given to parallelize.</p>
<pre><code>pd = sc.parallelize(onlyfiles)
</code></pre>
<h4 id="map-function-apply_batch">Map Function (apply_batch)</h4>
<p>The &lsquo;apply_batch&rsquo; function that we created previously is given to map
function to process in a spark cluster.</p>
<pre><code>pdc = pd.map(apply_batch)
</code></pre>
<h4 id="collect-function">Collect Function</h4>
<p>The result of each map process is merged into an array.</p>
<pre><code>result = pdc.collect()
</code></pre>
<h3 id="results-for-100-images-by-spark-cluster">Results for 100+ images by Spark Cluster</h3>
<pre><code>for image in result:
    plt.figure()
    plt.axis(&quot;off&quot;)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))</code></pre>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8350f5dc3e9f39b8831bcc3e967f8d6a">1.12 - Libraries</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-fc85ba266f91bed5504eda946d07a10f">1.12.1 - Python Modules</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>Often you may need functionality that is not present in Python&rsquo;s
standard library. In this case, you have two option:</p>
<ul>
<li>implement the features yourself</li>
<li>use a third-party library that has the desired features.</li>
</ul>
<p>Often you can find a previous implementation of what you need. Since
this is a common situation, there is a service supporting it: the
<a href="https://pypi.python.org/pypi">Python Package Index</a> (or PyPi for
short).</p>
<p>Our task here is to install the <a href="">autopep8</a> tool from PyPi. This will
allow us to illustrate the use of virtual environments using the <code>venv</code> and installing and uninstalling PyPi packages
using pip.</p>
<h2 id="updating-pip">Updating Pip</h2>
<p>You must have the newest version of pip installed for your
version of python. Let us assume your python is registered with python and
you use venv, than you can update
pip with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install -U pip
</code></pre></div><p>without interfering with a potential system-wide installed version of pip that may be needed by the system default version of python. See
the section about venv for more details</p>
<h2 id="using-pip-to-install-packages">Using pip to Install Packages</h2>
<p>Let us now look at another important tool for Python development: the
Python Package Index, or PyPI for short. PyPI provides a large set of
third-party Python packages.</p>
<p>To install a package from PyPI, use the pip command. We can
search for PyPI for packages:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip search --trusted-host pypi.python.org autopep8 pylint
</code></pre></div><p>It appears that the top two results are what we want, thus install them:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install --trusted-host pypi.python.org autopep8 pylint
</code></pre></div><p>This will cause pip to download the packages from PyPI, extract them,
check their dependencies and install those as needed, then install the
requested packages.</p>
<h2 id="gui">GUI</h2>
<h3 id="guizero">GUIZero</h3>
<p>Install <code>guizero</code> with the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo pip install guizero
</code></pre></div><p>For a comprehensive tutorial on <code>guizero</code>, <a href="https://lawsie.github.io/guizero/howto/">click
here</a>.</p>
<h3 id="kivy">Kivy</h3>
<p>You can install Kivy on macOS as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">brew install pkg-config sdl2 sdl2_image sdl2_ttf sdl2_mixer gstreamer
pip install -U Cython
pip install kivy
pip install pygame
</code></pre></div><p>A hello world program for kivy is included in the cloudmesh.robot
repository. Which you can find here</p>
<ul>
<li><a href="https://github.com/cloudmesh/cloudmesh.robot/tree/master/projects/kivy">https://github.com/cloudmesh/cloudmesh.robot/tree/master/projects/kivy</a></li>
</ul>
<p>To run the program, please download it or execute it in cloudmesh.robot
as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">cd</span> cloudmesh.robot/projects/kivy
python swim.py
</code></pre></div><p>To create stand-alone packages with kivy, please see:</p>
<pre><code>-  https://kivy.org/docs/guide/packaging-osx.html
</code></pre>
<h2 id="formatting-and-checking-python-code">Formatting and Checking Python Code</h2>
<p>First, get the bad code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ wget --no-check-certificate http://git.io/pXqb -O bad_code_example.py
</code></pre></div><p>Examine the code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ emacs bad_code_example.py
</code></pre></div><p>As you can see, this is very dense and hard to read. Cleaning it up by
hand would be a time-consuming and error-prone process. Luckily, this is
a common problem so there exist a couple of packages to help in this
situation.</p>
<h2 id="using-autopep8">Using autopep8</h2>
<p>We can now run the bad code through autopep8 to fix formatting problems:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ autopep8 bad_code_example.py &gt;code_example_autopep8.py
</code></pre></div><p>Let us look at the result. This is considerably better than before. It
is easy to tell what the example1 and example2 functions are doing.</p>
<p>It is a good idea to develop a habit of using autopep8 in your
python-development workflow. For instance: use autopep8 to check a file,
and if it passes, make any changes in place using the <code>-i</code> flag:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ autopep8 file.py    <span style="color:#8f5902;font-style:italic"># check output to see of passes</span>
$ autopep8 -i file.py <span style="color:#8f5902;font-style:italic"># update in place</span>
</code></pre></div><p>If you use pyCharm you can use a similar function while
pressing on Inspect Code.</p>
<h2 id="writing-python-3-compatible-code">Writing Python 3 Compatible Code</h2>
<p>To write python 2 and 3 compatible code we recommend that you take a
look at: <a href="http://python-future.org/compatible_idioms.html">http://python-future.org/compatible_idioms.html</a></p>
<h2 id="using-python-on-futuresystems">Using Python on FutureSystems</h2>
<p>This is only important if you use Futuresystems resources.</p>
<p>To use Python you must log in to your FutureSystems account.
Then at the shell prompt execute the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ module load python
</code></pre></div><p>This will make the python and virtualenv commands available to you.</p>
<p>The details of what the module load command does are described in the
future lesson modules.</p>
<h2 id="ecosystem">Ecosystem</h2>
<h3 id="pypi">pypi</h3>
<p>The Python Package Index is a large repository of software for the
Python programming language containing a large number of packages,
many of which can be found on
<a href="https://pypi.python.org/pypi">pypi</a>. The nice thing about pypi is
that many packages can be installed with the program &lsquo;pip.&rsquo;</p>
<p>To do so you have to locate the &lt;package_name&gt; for example with the
search function in pypi and say on the command line:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install &lt;package_name&gt;
</code></pre></div><p>where <code>package_name</code> is the string name of the package. an example would
be the package called cloudmesh_client which you can install with:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install cloudmesh_client
</code></pre></div><p>If all goes well the package will be installed.</p>
<h3 id="alternative-installations">Alternative Installations</h3>
<p>The basic installation of python is provided by python.org. However,
others claim to have alternative environments that allow you to install
python. This includes</p>
<ul>
<li><a href="https://store.enthought.com/downloads/#default">Canopy</a></li>
<li><a href="https://www.continuum.io/downloads">Anaconda</a></li>
<li><a href="http://ironpython.net/">IronPython</a></li>
</ul>
<p>Typically they include not only the python compiler but also several
useful packages. It is fine to use such environments for the class, but
it should be noted that in both cases not every python library may be
available for install in the given environment. For example, if you need
to use cloudmesh client, it may not be available as conda or Canopy
package. This is also the case for many other cloud-related and useful
python libraries. Hence, we do recommend that if you are new to python
to use the distribution from python.org, and use pip and virtualenv.</p>
<p>Additionally, some python versions have platform-specific libraries or
dependencies. For example, coca libraries, <code>.NET</code>, or other frameworks are
examples. For the assignments and the projects, such platform-dependent
libraries are not to be used.</p>
<p>If however, you can write a platform-independent code that works on
Linux, macOS, and Windows while using the python.org version but develop it
with any of the other tools that are just fine. However, it is up to you
to guarantee that this independence is maintained and implemented. You
do have to write requirements.txt files that will install the necessary
python libraries in a platform-independent fashion. The homework
assignment PRG1 has even a requirement to do so.</p>
<p>In order to provide platform independence we have given in the class a
<em>minimal</em> python version that we have tested with hundreds of students:
python.org. If you use any other version, that is your decision.
Additionally, some students not only use python.org but have used iPython
which is fine too. However, this class is not only about python, but also
about how to have your code run on any platform. The homework is
designed so that you can identify a setup that works for you.</p>
<p>However, we have concerns if you for example wanted to use chameleon
cloud which we require you to access with cloudmesh. cloudmesh is not
available as conda, canopy, or other framework packages. Cloudmesh client
is available form pypi which is standard and should be supported by the
frameworks. We have not tested cloudmesh on any other python version
than python.org which is the open-source community standard. None of the
other versions are standard.</p>
<p>In fact, we had students over the summer using canopy on their machines
and they got confused as they now had multiple python versions and did
not know how to switch between them and activate the correct version.
Certainly, if you know how to do that, then feel free to use canopy, and
if you want to use canopy all this is up to you. However, the homework
and project require you to make your program portable to python.org. If
you know how to do that even if you use canopy, anaconda, or any other
python version that is fine. Graders will test your programs on a
python.org installation and not canopy, anaconda, ironpython while using
virtualenv. It is obvious why. If you do not know that answer you may
want to think about that every time they test a program they need to do
a new virtualenv and run vanilla python in it. If we were to run two
installs in the same system, this will not work as we do not know if one
student will cause a side effect for another. Thus we as instructors do
not just have to look at your code but code of hundreds of students with
different setups. This is a non-scalable solution as every time we test
out code from a student we would have to wipe out the OS, install it
new, install a new version of whatever python you have elected, become
familiar with that version, and so on and on. This is the reason why the
open-source community is using python.org. We follow best practices.
Using other versions is not a community best practice, but may work for
an individual.</p>
<p>We have however in regards to using other python versions additional
bonus projects such as</p>
<ul>
<li>deploy run and document cloudmesh on ironpython</li>
<li>deploy run and document cloudmesh on anaconda, develop script to
generate a conda package form github</li>
<li>deploy run and document cloudmesh on canopy, develop script to
generate a conda package form github</li>
<li>deploy run and document cloudmesh on ironpython</li>
<li>other documentation that would be useful</li>
</ul>
<h2 id="resources">Resources</h2>
<p>If you are unfamiliar with programming in Python, we also refer you to
some of the numerous online resources. You may wish to start with <a href="https://www.learnpython.org">Learn
Python</a> or the book <a href="http://learnpythonthehardway.org/book/">Learn Python the Hard
Way</a>. Other options include
<a href="http://www.tutorialspoint.com/python/">Tutorials Point</a> or <a href="http://www.codecademy.com/en/tracks/python">Code
Academy</a>, and the Python
wiki page contains a long list of <a href="https://wiki.python.org/moin/BeginnersGuide/Programmers">references for
learning</a> as
well. Additional resources include:</p>
<ul>
<li><a href="https://virtualenvwrapper.readthedocs.io">https://virtualenvwrapper.readthedocs.io</a></li>
<li><a href="https://github.com/yyuu/pyenv">https://github.com/yyuu/pyenv</a></li>
<li><a href="https://amaral.northwestern.edu/resources/guides/pyenv-tutorial">https://amaral.northwestern.edu/resources/guides/pyenv-tutorial</a></li>
<li><a href="https://godjango.com/96-django-and-python-3-how-to-setup-pyenv-for-multiple-pythons/">https://godjango.com/96-django-and-python-3-how-to-setup-pyenv-for-multiple-pythons/</a></li>
<li><a href="https://www.accelebrate.com/blog/the-many-faces-of-python-and-how-to-manage-them/">https://www.accelebrate.com/blog/the-many-faces-of-python-and-how-to-manage-them/</a></li>
<li><a href="http://ivory.idyll.org/articles/advanced-swc/">http://ivory.idyll.org/articles/advanced-swc/</a></li>
<li><a href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html">http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html</a></li>
<li><a href="http://www.youtube.com/watch?v=0vJJlVBVTFg">http://www.youtube.com/watch?v=0vJJlVBVTFg</a></li>
<li><a href="http://www.korokithakis.net/tutorials/python/">http://www.korokithakis.net/tutorials/python/</a></li>
<li><a href="http://www.afterhoursprogramming.com/tutorial/Python/Introduction/">http://www.afterhoursprogramming.com/tutorial/Python/Introduction/</a></li>
<li><a href="http://www.greenteapress.com/thinkpython/thinkCSpy.pdf">http://www.greenteapress.com/thinkpython/thinkCSpy.pdf</a></li>
<li><a href="https://docs.python.org/3.3/tutorial/modules.html">https://docs.python.org/3.3/tutorial/modules.html</a></li>
<li><a href="https://www.learnpython.org/en/Modules/_and/_Packages">https://www.learnpython.org/en/Modules/_and/_Packages</a></li>
<li><a href="https://docs.python.org/2/library/datetime.html">https://docs.python.org/2/library/datetime.html</a></li>
<li><a href="https://chrisalbon.com/python/strings/_to/_datetime.html">https://chrisalbon.com/python/strings/_to/_datetime.html</a></li>
</ul>
<p>A very long list of useful information is also available from</p>
<ul>
<li><a href="https://github.com/vinta/awesome-python">https://github.com/vinta/awesome-python</a></li>
<li><a href="https://github.com/rasbt/python_reference">https://github.com/rasbt/python_reference</a></li>
</ul>
<p>This list may be useful as it also contains links to data visualization
and manipulation libraries, and AI tools and libraries. Please note that
for this class you can reuse such libraries if not otherwise stated.</p>
<h3 id="jupyter-notebook-tutorials">Jupyter Notebook Tutorials</h3>
<p>A Short Introduction to Jupyter Notebooks and NumPy To view the
notebook, open this link in a background tab
<a href="https://nbviewer.jupyter.org/">https://nbviewer.jupyter.org/</a> and copy and paste the following link in
the URL input area
<a href="https://cloudmesh.github.io/classes/lesson/prg/Jupyter-NumPy-tutorial-I523-F2017.ipynb">https://cloudmesh.github.io/classes/lesson/prg/Jupyter-NumPy-tutorial-I523-F2017.ipynb</a>
Then hit Go.</p>
<h2 id="exercises">Exercises</h2>
<p>E.Python.Lib.1:</p>
<blockquote>
<p>Write a python program called iterate.py that accepts an integer n
from the command line. Pass this integer to a function called iterate.</p>
</blockquote>
<blockquote>
<p>The iterate function should then iterate from 1 to n. If the i-th number
is a multiple of three, print <em>multiple of 3</em>, if a multiple of 5 print
<em>multiple of 5</em>, if a multiple of both print <em>multiple of 3 and 5</em>, else
print the value.</p>
</blockquote>
<p>E:Python.Lib.2:</p>
<blockquote>
<ol>
<li>Create a pyenv or virtualenv ~/ENV</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>Modify your ~/.bashrc shell file to activate your environment upon
login.</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>Install the docopt python package using pip</li>
</ol>
</blockquote>
<blockquote>
<ol start="4">
<li>Write a program that uses docopt to define a command line program.
Hint: modify the iterate program.</li>
</ol>
</blockquote>
<blockquote>
<ol start="5">
<li>Demonstrate the program works.</li>
</ol>
</blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bb89926756a4a91092d04169d2d0e204">1.12.2 - Data Management</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>Obviously when dealing with big data we may not only be dealing with
data in one format but in many different formats. It is important that
you will be able to master such formats and seamlessly integrate in your
analysis. Thus we provide some simple examples on which different data
formats exist and how to use them.</p>
<h2 id="formats">Formats</h2>
<h3 id="pickle">Pickle</h3>
<p>Python pickle allows you to save data in a python native format into a
file that can later be read in by other programs. However, the data
format may not be portable among different python versions thus the
format is often not suitable to store information. Instead we recommend
for standard data to use either json or yaml.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pickle</span>

<span style="color:#000">flavor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;small&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;medium&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;large&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">10000</span>
    <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000">pickle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dump</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">flavor</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#4e9a06">&#34;data.p&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;wb&#34;</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>To read it back in use</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">flavor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pickle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">load</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#4e9a06">&#34;data.p&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;rb&#34;</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="text-files">Text Files</h3>
<p>To read text files into a variable called content you can use</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">content</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;filename.txt&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>You can also use the following code while using the convenient <code>with</code>
statement</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;filename.txt&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#204a87">file</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">content</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>To split up the lines of the file into an array you can do</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;filename.txt&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#204a87">file</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">lines</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">splitlines</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>This cam also be done with the build in <code>readlines</code> function</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">lines</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;filename.txt&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">readlines</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>In case the file is too big you will want to read the file line by line:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;filename.txt&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#204a87">file</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">line</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">readline</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">line</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="csv-files">CSV Files</h3>
<p>Often data is contained in comma separated values (CSV) within a file.
To read such files you can use the csv package.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">csv</span>
<span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;data.csv&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;rb&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">:</span>
   <span style="color:#000">contents</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">csv</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">reader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">row</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">content</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">row</span>
</code></pre></div><p>Using pandas you can read them as follows.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pandas</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">pd</span>
<span style="color:#000">df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read_csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;example.csv&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>There are many other modules and libraries that include CSV read
functions. In case you need to split a single line by comma, you may
also use the <code>split</code> function. However, remember it swill split at every
comma, including those contained in quotes. So this method although
looking originally convenient has limitations.</p>
<h3 id="excel-spread-sheets">Excel spread sheets</h3>
<p>Pandas contains a method to read Excel files</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pandas</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">pd</span>
<span style="color:#000">filename</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;data.xlsx&#39;</span>
<span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pd</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ExcelFile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">file</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">df</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Sheet1&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="yaml">YAML</h3>
<p>YAML is a very important format as it allows you easily to structure
data in hierarchical fields It is frequently used to coordinate programs
while using yaml as the specification for configuration files, but also
data files. To read in a yaml file the following code can be used</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">yaml</span>
<span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;data.yaml&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">content</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">yaml</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">load</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The nice part is that this code can also be used to verify if a file is
valid yaml. To write data out we can use</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;data.yml&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;w&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">yaml</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dump</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">default_flow_style</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The flow style set to false formats the data in a nice readable fashion
with indentations.</p>
<h3 id="json">JSON</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">json</span>
<span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;strings.json&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">f</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">content</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">load</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="xml">XML</h3>
<p>XML format is extensively used to transport data across the web. It has
a hierarchical data format, and can be represented in the form of a
tree.</p>
<p>A Sample XML data looks like:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#204a87;font-weight:bold">&lt;data&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;items&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;item</span> <span style="color:#c4a000">name=</span><span style="color:#4e9a06">&#34;item-1&#34;</span><span style="color:#204a87;font-weight:bold">&gt;&lt;/item&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;item</span> <span style="color:#c4a000">name=</span><span style="color:#4e9a06">&#34;item-2&#34;</span><span style="color:#204a87;font-weight:bold">&gt;&lt;/item&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;item</span> <span style="color:#c4a000">name=</span><span style="color:#4e9a06">&#34;item-3&#34;</span><span style="color:#204a87;font-weight:bold">&gt;&lt;/item&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/items&gt;</span>
<span style="color:#204a87;font-weight:bold">&lt;/data&gt;</span>
</code></pre></div><p>Python provides the ElementTree XML API to parse and create XML data.</p>
<p>Importing XML data from a file:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">xml.etree.ElementTree</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">ET</span>
<span style="color:#000">tree</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ET</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;data.xml&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">root</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">tree</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getroot</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>Reading XML data from a string directly:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">root</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ET</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fromstring</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data_as_string</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Iterating over child nodes in a root:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">child</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">root</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">child</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">tag</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">child</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">attrib</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Modifying XML data using ElementTree:</p>
<ul>
<li>
<p>Modifying text within a tag of an element using .text method:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">tag</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">text</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">new_data</span>
<span style="color:#000">tree</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;output.xml&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div></li>
<li>
<p>Adding/modifying an attribute using .set() method:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">tag</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;key&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;value&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">tree</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;output.xml&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div></li>
</ul>
<p>Other Python modules used for parsing XML data include</p>
<ul>
<li>minidom: <a href="https://docs.python.org/3/library/xml.dom.minidom.html">https://docs.python.org/3/library/xml.dom.minidom.html</a></li>
<li>BeautifulSoup: <a href="https://www.crummy.com/software/BeautifulSoup/">https://www.crummy.com/software/BeautifulSoup/</a></li>
</ul>
<h3 id="rdf">RDF</h3>
<p>To read RDF files you will need to install RDFlib with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install rdflib
</code></pre></div><p>This will than allow you to read RDF files</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">rdflib.graph</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Graph</span>
<span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Graph</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;filename.rdf&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;format&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">entry</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">:</span>
   <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">entry</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Good examples on using RDF are provided on the RDFlib Web page
at <a href="https://github.com/RDFLib/rdflib">https://github.com/RDFLib/rdflib</a></p>
<p>From the Web page we showcase also how to directly process RDF data from
the Web</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">rdflib</span>
<span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">rdflib</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Graph</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">load</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;http://dbpedia.org/resource/Semantic_Web&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">p</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">o</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span> <span style="color:#000">s</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">p</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">o</span>
</code></pre></div><h3 id="pdf">PDF</h3>
<p>The Portable Document Format (PDF) has been made available by Adobe
Inc. royalty free. This has enabled PDF to become a world wide adopted
format that also has been standardized in 2008 (ISO/IEC 32000-1:2008,
<a href="https://www.iso.org/standard/51502.html">https://www.iso.org/standard/51502.html</a>). A lot of research is
published in papers making PDF one of the de-facto standards for
publishing. However, PDF is difficult to parse and is focused on high
quality output instead of data representation. Nevertheless, tools to
manipulate PDF exist:</p>
<dl>
<dt>PDFMiner</dt>
<dd>
<p><a href="https://pypi.python.org/pypi/pdfminer/">https://pypi.python.org/pypi/pdfminer/</a> allows the simple
translation of PDF into text that than can be further mined. The
manual page helps to demonstrate some examples
<a href="http://euske.github.io/pdfminer/index.html">http://euske.github.io/pdfminer/index.html</a>.</p>
</dd>
<dt>pdf-parser.py</dt>
<dd>
<p><a href="https://blog.didierstevens.com/programs/pdf-tools/">https://blog.didierstevens.com/programs/pdf-tools/</a> parses pdf
documents and identifies some structural elements that can than be
further processed.</p>
</dd>
</dl>
<p>If you know about other tools, let us know.</p>
<h3 id="html">HTML</h3>
<p>A very powerful library to parse HTML Web pages is provided
with <a href="https://www.crummy.com/software/BeautifulSoup/">https://www.crummy.com/software/BeautifulSoup/</a></p>
<p>More details about it are provided in the documentation page
<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">https://www.crummy.com/software/BeautifulSoup/bs4/doc/</a></p>
<p>Beautiful Soup is a python library to parse, process and edit HTML
documents.</p>
<p>To install Beautiful Soup, use <code>pip</code> command as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install beautifulsoup4
</code></pre></div><p>In order to process HTML documents, a parser is required. Beautiful Soup
supports the HTML parser included in Python&rsquo;s standard library, but it
also supports a number of third-party Python parsers like the <code>lxml</code>
parser which is commonly used [@www-beautifulsoup].</p>
<p>Following command can be used to install <code>lxml</code> parser</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install lxml
</code></pre></div><p>To begin with, we import the package and instantiate an object as
follows for a html document <code>html_handle</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">bs4</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">BeautifulSoup</span>
<span style="color:#000">soup</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">BeautifulSoup</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">html_handle</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">`lxml`</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Now, we will discuss a few functions, attributes and methods of
Beautiful Soup.</p>
<p><strong>prettify function</strong></p>
<p><code>prettify()</code> method will turn a Beautiful Soup parse tree into a nicely
formatted Unicode string, with a separate line for each HTML/XML tag and
string. It is analgous to <code>pprint()</code> function. The object created above
can be viewed by printing the prettfied version of the document as
follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">soup</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">prettify</span><span style="color:#000;font-weight:bold">())</span>
</code></pre></div><p><strong>tag Object</strong></p>
<p>A <code>tag</code> object refers to tags in the HTML document. It is possible to go
down to the inner levels of the DOM tree. To access a tag <code>div</code> under
the tag <code>body</code>, it can be done as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">body_div</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">soup</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">body</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">div</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">body_div</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">prettify</span><span style="color:#000;font-weight:bold">())</span>
</code></pre></div><p>The <code>attrs</code> attribute of the tag object returns a dictionary of all the
defined attributes of the HTML tag as keys.</p>
<p><strong>has_attr() method</strong></p>
<p>To check if a <code>tag</code> object has a specific attribute, <code>has_attr()</code> method
can be used.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">body_div</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">has_attr</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;p&#39;</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The value of </span><span style="color:#4e9a06">\&#39;</span><span style="color:#4e9a06">p</span><span style="color:#4e9a06">\&#39;</span><span style="color:#4e9a06"> attribute is:&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">body_div</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;p&#39;</span><span style="color:#000;font-weight:bold">])</span>
</code></pre></div><p><strong>tag object attributes</strong></p>
<ul>
<li><code>name</code> - This attribute returns the name of the tag selected.</li>
<li><code>attrs</code> - This attribute returns a dictionary of all the defined
attributes
of the HTML tag as keys.</li>
<li><code>contents</code> - This attribute returns a list of contents enclosed within the
HTML tag</li>
<li><code>string</code> - This attribute which returns the text enclosed within the HTML
tag. This returns <code>None</code> if there are multiple children</li>
<li><code>strings</code> - This overcomes the limitation of <code>string</code> and returns a
generator of all strings enclosed within the given tag</li>
</ul>
<p>Following code showcases usage of the above discussed attributes:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">body_tag</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">soup</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">body</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Name of the tag:&#39;, body_tag.name)</span>

<span style="color:#000">attrs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">body_tag</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">attrs</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The attributes defined for body tag are:&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attrs</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The contents of </span><span style="color:#4e9a06">\&#39;</span><span style="color:#4e9a06">body</span><span style="color:#4e9a06">\&#39;</span><span style="color:#4e9a06"> tag are:</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">body_tag</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">contents</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;The string value enclosed in </span><span style="color:#4e9a06">\&#39;</span><span style="color:#4e9a06">body</span><span style="color:#4e9a06">\&#39;</span><span style="color:#4e9a06"> tag is:&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">body_tag</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">string</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">s</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">body_tag</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strings</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">repr</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">s</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p><strong>Searching the Tree</strong></p>
<ul>
<li><code>find()</code> function takes a filter expression as argument and returns
the first match found</li>
<li><code>findall()</code> function returns a list of all the matching elements</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">search_elem</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">soup</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">search_elem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">prettify</span><span style="color:#000;font-weight:bold">())</span>

<span style="color:#000">search_elems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">soup</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">find_all</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;a&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">class_</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;sample&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">pprint</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">search_elems</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><ul>
<li><code>select()</code> function can be used to search the tree using CSS selectors</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># Select `a` tag with class `sample`</span>
<span style="color:#000">a_tag_elems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">soup</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;a.sample&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a_tag_elems</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="configparser">ConfigParser</h3>
<ul>
<li><a href="https://pymotw.com/2/ConfigParser/">https://pymotw.com/2/ConfigParser/</a></li>
</ul>
<h3 id="configdict">ConfigDict</h3>
<ul>
<li><a href="https://github.com/cloudmesh/cloudmesh-common/blob/master/cloudmesh/common/ConfigDict.py">https://github.com/cloudmesh/cloudmesh-common/blob/master/cloudmesh/common/ConfigDict.py</a></li>
</ul>
<h2 id="encryption">Encryption</h2>
<p>Often we need to protect the information stored in a file. This is
achieved with encryption. There are many methods of supporting
encryption and even if a file is encrypted it may be target to attacks.
Thus it is not only important to encrypt data that you do not want
others to se but also to make sure that the system on which the data is
hosted is secure. This is especially important if we talk about big data
having a potential large effect if it gets into the wrong hands.</p>
<p>To illustrate one type of encryption that is non trivial we have chosen
to demonstrate how to encrypt a file with an ssh key. In case you have
openssl installed on your system, this can be achieved as follows.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#8f5902;font-style:italic">#! /bin/sh</span>

    <span style="color:#8f5902;font-style:italic"># Step 1. Creating a file with data</span>
    <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;Big Data is the future.&#34;</span> &gt; file.txt

    <span style="color:#8f5902;font-style:italic"># Step 2. Create the pem</span>
    openssl rsa -in ~/.ssh/id_rsa -pubout  &gt; ~/.ssh/id_rsa.pub.pem

    <span style="color:#8f5902;font-style:italic"># Step 3. look at the pem file to illustrate how it looks like (optional)</span>
    cat ~/.ssh/id_rsa.pub.pem

    <span style="color:#8f5902;font-style:italic"># Step 4. encrypt the file into secret.txt</span>
    openssl rsautl -encrypt -pubin -inkey ~/.ssh/id_rsa.pub.pem -in file.txt -out secret.txt

    <span style="color:#8f5902;font-style:italic"># Step 5. decrypt the file and print the contents to stdout</span>
    openssl rsautl -decrypt -inkey ~/.ssh/id_rsa -in secret.txt
</code></pre></div><p>Most important here are Step 4 that encrypts the file and Step 5 that
decrypts the file. Using the Python os module it is straight forward to
implement this. However, we are providing in cloudmesh a convenient
class that makes the use in python very simple.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cloudmesh.common.ssh.encrypt</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">EncryptFile</span>

<span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">EncryptFile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;file.txt&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;secret.txt&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">encrypt</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">decrypt</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>In our class we initialize it with the locations of the file that is to
be encrypted and decrypted. To initiate that action just call the
methods <code>encrypt</code> and <code>decrypt</code>.</p>
<h2 id="database-access">Database Access</h2>
<p>see: <a href="https://www.tutorialspoint.com/python/python_database_access.htm">https://www.tutorialspoint.com/python/python_database_access.htm</a></p>
<h2 id="sqlite">SQLite</h2>
<ul>
<li>
<p><a href="https://www.sqlite.org/index.html">https://www.sqlite.org/index.html</a></p>
</li>
<li>
<p><a href="https://docs.python.org/3/library/sqlite3.html">https://docs.python.org/3/library/sqlite3.html</a></p>
</li>
</ul>
<h3 id="exercises">Exercises</h3>
<p>E:Encryption.1:</p>
<blockquote>
<p>Test the shell script to replicate how this example works</p>
</blockquote>
<p>E:Encryption.2:</p>
<blockquote>
<p>Test the cloudmesh encryption class</p>
</blockquote>
<p>E:Encryption.3:</p>
<blockquote>
<p>What other encryption methods exist. Can you provide an example and
contribute to the section?</p>
</blockquote>
<p>E:Encryption.4:</p>
<blockquote>
<p>What is the issue of encryption that make it challenging for Big
Data</p>
</blockquote>
<p>E:Encryption.5:</p>
<blockquote>
<p>Given a test dataset with many files text files, how long will it
take to encrypt and decrypt them on various machines. Write a
benchmark that you test. Develop this benchmark as a group, test out
the time it takes to execute it on a variety of platforms.</p>
</blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-00b8f84dfd350b8688408537d374d4e8">1.12.3 - Plotting with matplotlib</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>A brief overview of plotting with matplotlib along with examples is
provided. First, matplotlib must be installed, which can be accomplished
with pip install as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install matplotlib
</code></pre></div><p>We will start by plotting a simple line graph using built in NumPy
functions for sine and cosine. This first step is to import the proper
libraries shown next.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>
</code></pre></div><p>Next, we will define the values for the x-axis, we do this with the
linspace option in numpy. The first two parameters are the starting and
ending points, these must be scalars. The third parameter is optional and
defines the number of samples to be generated between the starting and
ending points, this value must be an integer. Additional parameters for
the linspace utility can be found here:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">linspace</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Now we will use the sine and cosine functions in order to generate y
values, for this we will use the values of x for the argument of both
our sine and cosine functions i.e. $cos(x)$.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">cos</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cos</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">sin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>You can display the values of the three parameters we have defined by
typing them in a python shell.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">x</span>
<span style="color:#000">array</span><span style="color:#000;font-weight:bold">([</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">3.14159265</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">2.72271363</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">2.30383461</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1.88495559</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1.46607657</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1.04719755</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">0.62831853</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">0.20943951</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.20943951</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.62831853</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#0000cf;font-weight:bold">1.04719755</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.46607657</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.88495559</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2.30383461</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2.72271363</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#0000cf;font-weight:bold">3.14159265</span><span style="color:#000;font-weight:bold">])</span>
</code></pre></div><p>Having defined x and y values we can generate a line plot and since we
imported matplotlib.pyplot as plt we simply use plt.plot.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">cos</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>We can display the plot using plt.show() which will pop up a figure
displaying the plot defined.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>Additionally, we can add the sine line to outline graph by entering the
following.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sin</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Invoking plt.show() now will show a figure with both sine and cosine
lines displayed. Now that we have a figure generated it would be useful
to label the x and y-axis and provide a title. This is done by the
following three commands:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xlabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;X - label (units)&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ylabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Y - label (units)&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;A clever Title for your Figure&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Along with axis labels and a title another useful figure feature may be
a legend. In order to create a legend you must first designate a label
for the line, this label will be what shows up in the legend. The label
is defined in the initial plt.plot(x,y) instance, next is an example.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">cos</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;cosine&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Then in order to display the legend, the following command is issued:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">legend</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">loc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;upper right&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The location is specified by using upper or lower and left or right.
Naturally, all these commands can be combined and put in a file with the
.py extension and run from the command line.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>

<span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">linspace</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pi</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">cos</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cos</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">sin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">sin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">cos</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;cosine&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">sin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;sine&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xlabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;X - label (units)&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ylabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Y - label (units)&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;A clever Title for your Figure&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">legend</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">loc</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;upper right&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>:o2: link error</p>
<p>An example of a bar chart is preceded next using data from
<a href="#T:fast-cars">[T:fast-cars]</a>{reference-type=&ldquo;ref&rdquo; reference=&ldquo;T:fast-cars&rdquo;}.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>

<span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39; Toyota Prius&#39;</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#4e9a06">&#39;Tesla Roadster &#39;</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#4e9a06">&#39; Bugatti Veyron&#39;</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#4e9a06">&#39; Honda Civic &#39;</span><span style="color:#000;font-weight:bold">,</span>
     <span style="color:#4e9a06">&#39; Lamborghini Aventador &#39;</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">horse_power</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">288</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1200</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">158</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">695</span><span style="color:#000;font-weight:bold">]</span>

<span style="color:#000">x_pos</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)]</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">bar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_pos</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">horse_power</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">color</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;green&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xlabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Car Model&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ylabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Horse Power (Hp)&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Horse Power for Selected Cars&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">xticks</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_pos</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>You can customize plots further by using plt.style.use(), in python 3.
If you provide the following command inside a python command shell you
will see a list of available styles.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">style</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">available</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>An example of using a predefined style is shown next.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">style</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">use</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;seaborn&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Up to this point, we have only showcased how to display figures through
python output, however web browsers are a popular way to display
figures. One example is Bokeh, the following lines can be entered in a
python shell and the figure is outputted to a browser.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">bokeh.io</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">show</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">bokeh.plotting</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">figure</span>

<span style="color:#000">x_values</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">y_values</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">]</span>

<span style="color:#000">p</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">figure</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">p</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">circle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">x_values</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">y_values</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">show</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">p</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3ad7884805d6063c35681edcdc0d0556">1.12.4 - DocOpts</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>When we want to design command line arguments for python programs we have
many options. However, as our approach is to create documentation
first, docopts provides also a good approach for Python. The code for it is
located at</p>
<ul>
<li><a href="https://github.com/docopt/docopt">https://github.com/docopt/docopt</a></li>
</ul>
<p>It can be installed with</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ pip install docopt
</code></pre></div><p>Sample programs are located at</p>
<ul>
<li><a href="https://github.com/docopt/docopt/blob/master/examples/options_example.py">https://github.com/docopt/docopt/blob/master/examples/options_example.py</a></li>
</ul>
<p>A sample program of using doc opts for our purposes looks as follows</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#4e9a06">&#34;&#34;&#34;Cloudmesh VM management
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">Usage:
</span><span style="color:#4e9a06">  cm-go vm start NAME [--cloud=CLOUD]
</span><span style="color:#4e9a06">  cm-go vm stop NAME [--cloud=CLOUD]
</span><span style="color:#4e9a06">  cm-go set --cloud=CLOUD
</span><span style="color:#4e9a06">  cm-go -h | --help
</span><span style="color:#4e9a06">  cm-go --version
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">Options:
</span><span style="color:#4e9a06">  -h --help     Show this screen.
</span><span style="color:#4e9a06">  --version     Show version.
</span><span style="color:#4e9a06">  --cloud=CLOUD  The name of the cloud.
</span><span style="color:#4e9a06">  --moored      Moored (anchored) mine.
</span><span style="color:#4e9a06">  --drifting    Drifting mine.
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">ARGUMENTS:
</span><span style="color:#4e9a06">  NAME     The name of the VM`
</span><span style="color:#4e9a06">&#34;&#34;&#34;</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">docopt</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">docopt</span>

<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">__name__</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#39;__main__&#39;</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#000">arguments</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">docopt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">__doc__</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;1.0.0rc2&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arguments</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Another good feature of using docopts is that we can use the same
verbal description in other programming languages as showcased in this
book.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-81d109437a2c5c48b8238286df2d1e7f">1.12.5 - OpenCV</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<hr>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/learning.png" alt=""> <strong>Learning Objectives</strong></p>
<ul>
<li>Provide some simple calculations so we can test cloud services.</li>
<li>Showcase some elementary OpenCV functions</li>
<li>Show an environmental image analysis application using Secchi disks</li>
</ul>
<hr>
<p>OpenCV (Open Source Computer Vision Library) is a library of thousands
of algorithms for various applications in computer vision and machine
learning. It has C++, C, Python, Java, and MATLAB interfaces and supports
Windows, Linux, Android, and Mac OS. In this section, we will explain
the basic features of this library, including the implementation of a simple
example.</p>
<h2 id="overview">Overview</h2>
<p>OpenCV has many functions for image and video processing. The
pipeline starts with reading the images, low-level operations on pixel
values, preprocessing e.g. denoising, and then multiple steps of
higher-level operations which vary depending on the application. OpenCV
covers the whole pipeline, especially providing a large set of library
functions for high-level operations. A simpler library for image
processing in Python is Scipy&rsquo;s multi-dimensional image processing
package (scipy.ndimage).</p>
<h2 id="installation">Installation</h2>
<p>OpenCV for Python can be installed on Linux in multiple ways, namely
PyPI(Python Package Index), Linux package manager (apt-get for Ubuntu),
Conda package manager, and also building from source. You are
recommended to use PyPI. Here&rsquo;s the command that you need to run:</p>
<pre><code>$ pip install opencv-python
</code></pre>
<p>This was tested on Ubuntu 16.04 with a fresh Python 3.6 virtual
environment. In order to test, import the module in Python command line:</p>
<pre><code>import cv2
</code></pre>
<p>If it does not raise an error, it is installed correctly. Otherwise, try
to solve the error.</p>
<p>For installation on Windows, see:</p>
<ul>
<li><a href="https://docs.opencv.org/3.0-beta/doc/py_tutorials/py_setup/py_setup_in_windows/py_setup_in_windows.html#install-opencv-python-in-windows">https://docs.opencv.org/3.0-beta/doc/py_tutorials/py_setup/py_setup_in_windows/py_setup_in_windows.html#install-opencv-python-in-windows</a></li>
</ul>
<p>Note that building from source can take a long time and may not be
feasible for deploying to limited platforms such as Raspberry Pi.</p>
<h2 id="a-simple-example">A Simple Example</h2>
<p>In this example, an image is loaded. A simple processing is performed,
and the result is written to a new image.</p>
<h3 id="loading-an-image">Loading an image</h3>
<pre><code>%matplotlib inline
import cv2

img = cv2.imread('images/opencv/4.2.01.tiff')
</code></pre>
<p>The image was downloaded from USC standard database:</p>
<p><a href="http://sipi.usc.edu/database/database.php?volume=misc&amp;image=9">http://sipi.usc.edu/database/database.php?volume=misc&amp;image=9</a></p>
<h3 id="displaying-the-image">Displaying the image</h3>
<p>The image is saved in a numpy array. Each pixel is represented with 3
values (R,G,B). This provides you with access to manipulate the image at
the level of single pixels. You can display the image using imshow
function as well as Matplotlib&rsquo;s imshow function.</p>
<p>You can display the image using imshow function:</p>
<pre><code>cv2.imshow('Original',img)
cv2.waitKey(0)
cv2.destroyAllWindows()
</code></pre>
<p>or you can use Matplotlib. If you have not installed Matplotlib before,
install it using:</p>
<pre><code>$ pip install matplotlib
</code></pre>
<p>Now you can use:</p>
<pre><code>import matplotlib.pyplot as plt
plt.imshow(img)
</code></pre>
<p>which results in Figure 1</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/opencv/output_5_1.png" alt="Figure 1: Image display"></p>
<p>Figure 1: Image display</p>
<h3 id="scaling-and-rotation">Scaling and Rotation</h3>
<p>Scaling (resizing) the image relative to different axis</p>
<pre><code>res = cv2.resize(img,
                 None,
                 fx=1.2,
                 fy=0.7,
                 interpolation=cv2.INTER_CUBIC)
plt.imshow(res)
</code></pre>
<p>which results in Figure 2</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/opencv/output_7_1.png" alt="Figure 2: Scaling and rotation"></p>
<p>Figure 2: Scaling and rotation</p>
<p>Rotation of the image for an angle of t</p>
<pre><code>rows,cols,_ = img.shape
t = 45
M = cv2.getRotationMatrix2D((cols/2,rows/2),t,1)
dst = cv2.warpAffine(img,M,(cols,rows))

plt.imshow(dst)
</code></pre>
<p>which results in Figure 3</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/opencv/output_9_1.png" alt="Figure 3: image"></p>
<p>Figure 3: image</p>
<h3 id="gray-scaling">Gray-scaling</h3>
<pre><code>img2 = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
plt.imshow(img2, cmap='gray')
</code></pre>
<p>which results in +Figure 4</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/opencv/output_11_1.png" alt="Figure 4: Gray sacling"></p>
<p>Figure 4: Gray sacling</p>
<h3 id="image-thresholding">Image Thresholding</h3>
<pre><code>ret,thresh =    cv2.threshold(img2,127,255,cv2.THRESH_BINARY)
plt.subplot(1,2,1), plt.imshow(img2, cmap='gray')
plt.subplot(1,2,2), plt.imshow(thresh, cmap='gray')
</code></pre>
<p>which results in Figure 5</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/opencv/output_13_1.png" alt="Figure 5: Image Thresholding"></p>
<p>Figure 5: Image Thresholding</p>
<h3 id="edge-detection">Edge Detection</h3>
<p>Edge detection using Canny edge detection algorithm</p>
<pre><code>edges = cv2.Canny(img2,100,200)

plt.subplot(121),plt.imshow(img2,cmap = 'gray')
plt.subplot(122),plt.imshow(edges,cmap = 'gray')
</code></pre>
<p>which results in Figure 6</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/opencv/output_15_1.png" alt="Figure 6: Edge detection"></p>
<p>Figure 6: Edge detection</p>
<h2 id="additional-features">Additional Features</h2>
<p>OpenCV has implementations of many machine learning techniques such as
KMeans and Support Vector Machines can be put into use with only a
few lines of code. It also has functions especially for video analysis,
feature detection, object recognition, and many more. You can find out
more about them on their website</p>
<p><a href="#sec:opencv">OpenCV</a>(<a href="https://docs.opencv.org/3.0-beta/index.html">https://docs.opencv.org/3.0-beta/index.html</a>
was initially developed for C++ and still has a focus on that
language, but it is still one of the most valuable image processing
libraries in Python.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-638e3a65dab40f4edf73225d94be8f88">1.12.6 - Secchi Disk</h1>
    
	<p>Gregor von Laszewski (<a href="mailto:laszewski@gmail.com">laszewski@gmail.com</a>)</p>
<p>We are developing an autonomous robot boat that you can be part of
developing within this class. The robot bot is measuring
turbidity or water clarity. Traditionally this has been done with a
Secchi disk. The use of the Secchi disk is as follows:</p>
<ol>
<li>Lower the Secchi disk into the water.</li>
<li>Measure the point when you can no longer see it</li>
<li>Record the depth at various levels and plot in a geographical 3D
map</li>
</ol>
<p>One of the things we can do is take a video of the measurement instead
of a human recording them. Then we can analyze the video automatically
to see how deep a disk was lowered. This is a classical image analysis
program. You are encouraged to identify algorithms that can identify
the depth. The simplest seems to be to do a histogram at a
variety of depth steps and measure when the histogram no longer
changes significantly. The depth of that image will be the measurement
we look for.</p>
<p>Thus if we analyze the images we need to look at the image and
identify the numbers on the measuring tape, as well as the visibility
of the disk.</p>
<p>To showcase how such a disk looks like we refer to the image
showcasing different Secchi disks. For our purpose the black-white
contrast Secchi disk works well. See Figure 1</p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi-field-test/disk.png" alt="Figure 1: Secchi disk types. A marine style on the left and the freshwater version on the right wikipedia."></p>
<p>Figure 1: Secchi disk types. A marine style on the left and the freshwater version on the right wikipedia.</p>
<p>More information about Secchi Disk can be found at:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Secchi/_disk">https://en.wikipedia.org/wiki/Secchi/_disk</a></li>
</ul>
<p>We have included next a couple of examples while using some obviously
useful OpenCV methods. Surprisingly, the use of the edge detection
that comes to mind first to identify if we still can see the disk,
seems too complicated to use for analysis. We at this time believe the
histogram will be sufficient.</p>
<p>Please inspect our examples.</p>
<h2 id="setup-for-osx">Setup for OSX</h2>
<p>First lest setup the OpenCV environment for OSX. Naturally, you will
have to update the versions based on your versions of python. When we
tried the install of OpenCV on macOS, the setup was slightly more
complex than other packages. This may have changed by now and if you
have improved instructions, please let us know. However, we do not want
to install it via Anaconda out of the obvious reason that anaconda
installs too many other things.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">sys</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">os.path</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">expanduser</span>
<span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span>
<span style="color:#000">home</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expanduser</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;~&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;/usr/local/Cellar/opencv/3.3.1_1/lib/python3.6/site-packages/&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">home</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#39;/.pyenv/versions/OPENCV/lib/python3.6/site-packages/&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">cv2</span>
<span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__version__</span>
<span style="color:#a40000">!</span> <span style="color:#000">pip</span> <span style="color:#000">install</span> <span style="color:#000">numpy</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">tmp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">log</span>
<span style="color:#a40000">!</span> <span style="color:#000">pip</span> <span style="color:#000">install</span> <span style="color:#000">matplotlib</span> <span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">tmp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">log</span>
<span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">matplotlib</span> <span style="color:#000">inline</span>
</code></pre></div><h2 id="step-1-record-the-video">Step 1: Record the video</h2>
<p>Record the video on the robot</p>
<p>We have done this for you and will provide you with images
and videos if you are interested in analyzing them. See Figure 2</p>
<h2 id="step-2-analyse-the-images-from-the-video">Step 2: Analyse the images from the Video</h2>
<p>For now, we just selected 4 images from the video</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">cv2</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">matplotlib.pyplot</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">plt</span>

<span style="color:#000">img1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;secchi/secchi1.png&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">img2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;secchi/secchi2.png&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">img3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;secchi/secchi3.png&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">img4</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;secchi/secchi4.png&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">figures</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
<span style="color:#000">fig</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">figure</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">figsize</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">18</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">13</span><span style="color:#000;font-weight:bold">):</span>
  <span style="color:#000">figures</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fig</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_subplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">img</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">img1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">img2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">img3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">img4</span><span style="color:#000;font-weight:bold">]:</span>
  <span style="color:#000">figures</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">)</span>

  <span style="color:#000">color</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;g&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">col</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">color</span><span style="color:#000;font-weight:bold">):</span>
      <span style="color:#000">histr</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">calcHist</span><span style="color:#000;font-weight:bold">([</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">],[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">],</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,[</span><span style="color:#0000cf;font-weight:bold">256</span><span style="color:#000;font-weight:bold">],[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">256</span><span style="color:#000;font-weight:bold">])</span>
      <span style="color:#000">figures</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">count</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">histr</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">color</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">col</span><span style="color:#000;font-weight:bold">)</span>

  <span style="color:#000">figures</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">count</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">hist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ravel</span><span style="color:#000;font-weight:bold">(),</span><span style="color:#0000cf;font-weight:bold">256</span><span style="color:#000;font-weight:bold">,[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">256</span><span style="color:#000;font-weight:bold">])</span>

  <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">3</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Legend&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;First column = image of Secchi disk&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Second column = histogram of colors in image&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Third column = histogram of all values&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">show</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_9_1.png" alt="Figure 2: Histogram"></p>
<p>Figure 2: Histogram</p>
<h3 id="image-thresholding">Image Thresholding</h3>
<p>See Figure 3, Figure 4, Figure 5, Figure 6</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">threshold</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">):</span>
  <span style="color:#000">ret</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">thresh</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">threshold</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">150</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">255</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">THRESH_BINARY</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cmap</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;gray&#39;</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">thresh</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cmap</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;gray&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">threshold</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">threshold</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img2</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">threshold</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img3</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">threshold</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img4</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_13_0.png" alt="Figure 3: Threshold 1, threshold(img1)"></p>
<p>Figure 3: Threshold 1, <code>threshold(img1)</code></p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_14_0.png" alt="Figure 4: Threshold 2, threshold(img2)"></p>
<p>Figure 4: Threshold 2, <code>threshold(img2)</code></p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_15_0.png" alt="Figure 5: Threshold 3, threshold(img3)"></p>
<p>Figure 5: Threshold 3, <code>threshold(img3)</code></p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_16_0.png" alt="Figure 6: Threshold 4, threshold(img4)"></p>
<p>Figure 6: Threshold 4, <code>threshold(img4)</code></p>
<h3 id="edge-detection">Edge Detection</h3>
<p>See Figure 7,
Figure 8,
Figure 9,
Figure 10,
Figure 11.
Edge detection using Canny edge detection algorithm</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">find_edge</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">):</span>
  <span style="color:#000">edges</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Canny</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">200</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">121</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">cmap</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;gray&#39;</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">122</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">edges</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">cmap</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;gray&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">find_edge</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">find_edge</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img2</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">find_edge</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img3</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">find_edge</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img4</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_19_0.png" alt="Figure 7: Edge Detection 1, find_edge(img1)"></p>
<p>Figure 7: Edge Detection 1, <code>find_edge(img1)</code></p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_20_0.png" alt="Figure 8: Edge Detection 2, find_edge(img2)"></p>
<p>Figure 8: Edge Detection 2, <code>find_edge(img2)</code></p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_21_0.png" alt="Figure 9: Edge Detection 3, find_edge(img3)"></p>
<p>Figure 9: Edge Detection 3, <code>find_edge(img3)</code></p>
<p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_22_0.png" alt="Figure 10: Edge Detection 4, , find_edge(img4)"></p>
<p>Figure 10: Edge Detection 4, , <code>find_edge(img4)</code></p>
<h3 id="black-and-white">Black and white</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">bw1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cvtColor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">img1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cv2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">COLOR_BGR2GRAY</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">plt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">imshow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bw1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cmap</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;gray&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><img src="https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/opencv/images/secchi/output_26_1.png" alt="Figure 11: Back White conversion"></p>
<p>Figure 11: Back White conversion</p>

</div>



    
	
  

    
	
  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Gregor von Laszewski" aria-label="Gregor von Laszewski">
    <a class="text-white" target="_blank" rel="noopener" href="https://laszewski.github.io" aria-label="Gregor von Laszewski">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/cybertraining-dsc/cybertraining-dsc.github.io/" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 Indiana University, 2020 All Rights Reserved</small>
        
	
		<p class="mt-2"><a href="/about/">About Cybertraining</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js" integrity="sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK" crossorigin="anonymous"></script>




<script src='/js/deflate.js'></script>


 

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css" integrity="sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js" integrity="sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd" crossorigin="anonymous"></script>
 


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/mhchem.min.js" integrity="sha384-LIgAiYlGSAdpNC9+YDjDPF6JeS/RRIumtNo0CmyQERZ/+g0h9MbuYQwf/5pQ4Y4M"  crossorigin="anonymous"></script>


<script defer src='https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js' integrity='sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl' crossorigin='anonymous' onload='renderMathInElement(document.body, null);'></script>











<script src="/js/main.min.758c0b1476eb0de973b63d0030f104f41a6eb3afb9908681605af4a48eb73018.js" integrity="sha256-dYwLFHbrDelztj0AMPEE9Bpus6&#43;5kIaBYFr0pI63MBg=" crossorigin="anonymous"></script>




  </body>
</html>
