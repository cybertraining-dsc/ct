<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.79.1"><link rel=canonical type=text/html href=/docs/book/python/other/><link rel=alternate type=application/rss+xml href=/docs/book/python/other/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Other | Cybertraining</title><meta name=description content="by the Digital Science Center"><meta property="og:title" content="Other"><meta property="og:description" content="by the Digital Science Center"><meta property="og:type" content="website"><meta property="og:url" content="/docs/book/python/other/"><meta property="og:site_name" content="Cybertraining"><meta itemprop=name content="Other"><meta itemprop=description content="by the Digital Science Center"><meta name=twitter:card content="summary"><meta name=twitter:title content="Other"><meta name=twitter:description content="by the Digital Science Center"><link rel=preload href=/scss/main.min.38f7016c100fd6fe016169222c96e00ef49b4c22d4f199ee64f2dce7c9cf0d28.css as=style><link href=/scss/main.min.38f7016c100fd6fe016169222c96e00ef49b4c22d4f199ee64f2dce7c9cf0d28.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zM197.0804 232.033c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zM197.0804 177.6188c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zM197.5309 286.4723c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zM197.0804 340.5784c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Cybertraining</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><i class="fas fa-book"></i><span class=active>Content</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/cybertraining-dsc/cybertraining-dsc.github.io/ target=_blank><i class="fab fa-github"></i><span>GitHub</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="print();return false;">Click here to print</a>.</p><p><a href=/docs/book/python/other/>Return to the regular view of this page</a>.</p></div><h1 class=title>Other</h1><ul><li>1: <a href=#pg-65fbb92755467a1af78398183590e7cc>Word Count with Parallel Python</a></li><li>2: <a href=#pg-c3503067c11f7abae661dfa892030f49>NumPy</a></li><li>3: <a href=#pg-1c3b9ac7e2dbf04a9c689f2c2c4b613a>Scipy</a></li><li>4: <a href=#pg-9f03f93bd79697249709db37772032c6>Scikit-learn</a></li><li>5: <a href=#pg-0026bacb1a4e3d2e6df1d11ca44f4e6c>Dask - Random Forest Feature Detection</a></li><li>6: <a href=#pg-00a632eb98f5bea1f33d0ade7f8a8fcb>Parallel Computing in Python</a></li><li>7: <a href=#pg-dcb9354b26f1bf4c30d415d41915fbfc>Dask</a></li></ul><div class=content><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p></div></div><div class=td-content><h1 id=pg-65fbb92755467a1af78398183590e7cc>1 - Word Count with Parallel Python</h1><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p><p>We will demonstrate Python&rsquo;s <code>multiprocessing</code> API for parallel
computation by writing a program that counts how many times each word in
a collection of documents appear.</p><h2 id=generating-a-document-collection>Generating a Document Collection</h2><p>Before we begin, let us write a script that will generate document
collections by specifying the number of documents and the number of
words per document. This will make benchmarking straightforward.</p><p>To keep it simple, the vocabulary of the document collection will
consist of random numbers rather than the words of an actual language:</p><pre><code>'''Usage: generate_nums.py [-h] NUM_LISTS INTS_PER_LIST MIN_INT MAX_INT DEST_DIR

Generate random lists of integers and save them
as 1.txt, 2.txt, etc.

Arguments:
   NUM_LISTS      The number of lists to create.
   INTS_PER_LIST  The number of integers in each list.
   MIN_NUM        Each generated integer will be &gt;= MIN_NUM.
   MAX_NUM        Each generated integer will be &lt;= MAX_NUM.
   DEST_DIR       A directory where the generated numbers will be stored.

Options:
  -h --help
'''

import os, random, logging
from docopt import docopt


def generate_random_lists(num_lists,
                          ints_per_list, min_int, max_int):
    return [[random.randint(min_int, max_int) \
        for i in range(ints_per_list)] for i in range(num_lists)]


if __name__ == '__main__':
   args = docopt(__doc__)
   num_lists, ints_per_list, min_int, max_int, dest_dir = [
      int(args['NUM_LISTS']),
      int(args['INTS_PER_LIST']),
      int(args['MIN_INT']),
      int(args['MAX_INT']),
      args['DEST_DIR']
   ]

   if not os.path.exists(dest_dir):
      os.makedirs(dest_dir)

   lists = generate_random_lists(num_lists,
                                 ints_per_list,
                                 min_int,
                                 max_int)
   curr_list = 1
   for lst in lists:
      with open(os.path.join(dest_dir, '%d.txt' % curr_list), 'w') as f:
     f.write(os.linesep.join(map(str, lst)))
  curr_list += 1
   logging.debug('Numbers written.')
</code></pre><p>Notice that we are using the
<a href=https://pypi.python.org/pypi/docopt>docopt</a> module that you should be
familiar with from the Section [Python DocOpts](#s-python-docopts}
to make the script easy to run from the command line.</p><p>You can generate a document collection with this script as follows:</p><pre><code>python generate_nums.py 1000 10000 0 100 docs-1000-10000
</code></pre><h2 id=serial-implementation>Serial Implementation</h2><p>A first serial implementation of wordcount is straightforward:</p><pre><code>'''Usage: wordcount.py [-h] DATA_DIR

Read a collection of .txt documents and count how many times each word
appears in the collection.

Arguments:
  DATA_DIR  A directory with documents (.txt files).

Options:
  -h --help
'''

import os, glob, logging
from docopt import docopt

logging.basicConfig(level=logging.DEBUG)


def wordcount(files):
   counts = {}
   for filepath in files:
      with open(filepath, 'r') as f:
     words = [word.strip() for word in f.read().split()]
     for word in words:
        if word not in counts:
           counts[word] = 0
        counts[word] += 1
   return counts


if __name__ == '__main__':
   args = docopt(__doc__)
   if not os.path.exists(args['DATA_DIR']):
      raise ValueError('Invalid data directory: %s' % args['DATA_DIR'])

   counts = wordcount(glob.glob(os.path.join(args['DATA_DIR'], '*.txt')))
   logging.debug(counts)
</code></pre><h2 id=serial-implementation-using-map-and-reduce>Serial Implementation Using map and reduce</h2><p>We can improve the serial implementation in anticipation of parallelizing
the program by making use of Python&rsquo;s <code>map</code> and <code>reduce</code> functions.</p><p>In short, you can use <code>map</code> to apply the same function to the members of
a collection. For example, to convert a list of numbers to strings, you
could do:</p><pre><code>import random
nums = [random.randint(1, 2) for _ in range(10)]
print(nums)
[2, 1, 1, 1, 2, 2, 2, 2, 2, 2]
print(map(str, nums))
['2', '1', '1', '1', '2', '2', '2', '2', '2', '2']
</code></pre><p>We can use reduce to apply the same function cumulatively to the items
of a sequence. For example, to find the total of the numbers in our
list, we could use <code>reduce</code> as follows:</p><pre><code>def add(x, y):
    return x + y

print(reduce(add, nums))
17
</code></pre><p>We can simplify this even more by using a lambda function:</p><pre><code>print(reduce(lambda x, y: x + y, nums))
17
</code></pre><p>You can read more about <a href=https://docs.python.org/2.7/tutorial/controlflow.html#lambda-expressions>Python&rsquo;s lambda function in the
docs</a>.</p><p>With this in mind, we can reimplement the wordcount example as follows:</p><pre><code>'''Usage: wordcount_mapreduce.py [-h] DATA_DIR

Read a collection of .txt documents and count how
many times each word
appears in the collection.

Arguments:
   DATA_DIR  A directory with documents (.txt files).

Options:
   -h --help
'''

import os, glob, logging
from docopt import docopt

logging.basicConfig(level=logging.DEBUG)

def count_words(filepath):
   counts = {}
   with open(filepath, 'r') as f:
      words = [word.strip() for word in f.read().split()]

  for word in words:
     if word not in counts:
        counts[word] = 0
     counts[word] += 1
  return counts


def merge_counts(counts1, counts2):
   for word, count in counts2.items():
      if word not in counts1:
     counts1[word] = 0
  counts1[word] += counts2[word]
   return counts1


if __name__ == '__main__':
   args = docopt(__doc__)
   if not os.path.exists(args['DATA_DIR']):
      raise ValueError('Invalid data directory: %s' % args['DATA_DIR'])

      per_doc_counts = map(count_words,
                           glob.glob(os.path.join(args['DATA_DIR'],
                           '*.txt')))
   counts = reduce(merge_counts, [{}] + per_doc_counts)
   logging.debug(counts)
</code></pre><h2 id=parallel-implementation>Parallel Implementation</h2><p>Drawing on the previous implementation using <code>map</code> and <code>reduce</code>, we can
parallelize the implementation using Python&rsquo;s <code>multiprocessing</code> API:</p><pre><code>'''Usage: wordcount_mapreduce_parallel.py [-h] DATA_DIR NUM_PROCESSES

Read a collection of .txt documents and count, in parallel, how many
times each word appears in the collection.

Arguments:
   DATA_DIR       A directory with documents (.txt files).
   NUM_PROCESSES  The number of parallel processes to use.

Options:
   -h --help
'''

import os, glob, logging
from docopt import docopt
from wordcount_mapreduce import count_words, merge_counts
from multiprocessing import Pool

logging.basicConfig(level=logging.DEBUG)

if __name__ == '__main__':
   args = docopt(__doc__)
   if not os.path.exists(args['DATA_DIR']):
      raise ValueError('Invalid data directory: %s' % args['DATA_DIR'])
   num_processes = int(args['NUM_PROCESSES'])

   pool = Pool(processes=num_processes)

   per_doc_counts = pool.map(count_words,
                             glob.glob(os.path.join(args['DATA_DIR'],
                             '*.txt')))
   counts = reduce(merge_counts, [{}] + per_doc_counts)
   logging.debug(counts)
</code></pre><h2 id=benchmarking>Benchmarking</h2><p>To time each of the examples, enter it into its own Python file
and use Linux&rsquo;s <code>time</code> command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#204a87>time</span> python wordcount.py docs-1000-10000
</code></pre></div><p>The output contains the real run time and the user run time. real is
wall clock time - time from start to finish of the call. user is the
amount of CPU time spent in user-mode code (outside the kernel) within
the process, that is, only actual CPU time used in executing the
process.</p><h2 id=excersises>Excersises</h2><p>E.python.wordcount.1:</p><blockquote><p>Run the three different programs (serial, serial w/ map and reduce,
parallel) and answer the following questions:</p><ol><li>Is there any performance difference between the different versions
of the program?</li><li>Does user time significantly differ from real time for any of the
versions of the program?</li><li>Experiment with different numbers of processes for the parallel
example, starting with 1. What is the performance gain when you goal
from 1 to 2 processes? From 2 to 3? When do you stop seeing
improvement? (this will depend on your machine architecture)</li></ol></blockquote><h2 id=references>References</h2><ul><li><a href=http://book.pythontips.com/en/latest/map_filter.html>Map, Filter and Reduce</a></li><li><a href=https://docs.python.org/2/library/multiprocessing.html>multiprocessing API</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c3503067c11f7abae661dfa892030f49>2 - NumPy</h1><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p><p>NumPy is a popular library that is used by many other Python
packages such as Pandas, SciPy, and scikit-learn. It provides a
fast, simple-to-use way of interacting with numerical data
organized in vectors and matrices. In this section, we will
provide a short introduction to NumPy.</p><h2 id=installing-numpy>Installing NumPy</h2><p>The most common way of installing NumPy, if it wasn&rsquo;t included
with your Python installation, is to install it via pip:</p><pre><code>$ pip install numpy
</code></pre><p>If NumPy has already been installed, you can update to the most
recent version using:</p><pre><code>$ pip install -U numpy
</code></pre><p>You can verify that NumPy is installed by trying to use it in
a Python program:</p><pre><code>import numpy as np
</code></pre><p>Note that, by convention, we import NumPy using the alias &lsquo;np&rsquo; -
whenever you see &lsquo;np&rsquo; sprinkled in example Python code, it&rsquo;s a
good bet that it is using NumPy.</p><h2 id=numpy-basics>NumPy Basics</h2><p>At its core, NumPy is a container for n-dimensional data. Typically,
1-dimensional data is called an array and 2-dimensional data is called
a matrix. Beyond 2-dimensions would be considered a multidimensional
array. Examples, where you&rsquo;ll encounter these dimensions, may include:</p><ul><li>1 Dimensional: time-series data such as audio, stock prices, or a single observation in a dataset.</li><li>2 Dimensional: connectivity data between network nodes, user-product
recommendations, and database tables.</li><li>3+ Dimensional: network latency between nodes over time, video
(RGB+time), and version-controlled datasets.</li></ul><p>All of these data can be placed into NumPy&rsquo;s array object, just
with varying dimensions.</p><h2 id=data-types-the-basic-building-blocks>Data Types: The Basic Building Blocks</h2><p>Before we delve into arrays and matrices, we will start with
the most basic element of those: a single value. NumPy can
represent data utilizing many different standard datatypes such
as uint8 (an 8-bit <strong>u</strong>signed <strong>int</strong>eger), float64 (a 64-bit
float), or str (a string). An exhaustive listing can be found at:</p><ul><li><a href=https://docs.scipy.org/doc/numpy-1.15.0/user/basics.types.html>https://docs.scipy.org/doc/numpy-1.15.0/user/basics.types.html</a></li></ul><p>Before moving on, it is important to know about the tradeoff
made when using different datatypes. For example, a uint8 can
only contain values between 0 and 255. This, however, contrasts
with float64 which can express any value from +/- 1.80e+308. So
why wouldn&rsquo;t we just always use float64s? Though they allow us
to be more expressive in terms of numbers, they also consume
more memory. If we were working with a 12-megapixel image,
for example, storing that image using uint8 values would require
3000 * 4000 * 8 = 96 million bits, or 91.55 MB of memory. If we
were to store the same image utilizing float64, our image would
consume 8 times as much memory: 768 million bits or 732.42 MB.
It is important to use the right data type for the job to avoid
consuming unnecessary resources or slowing down processing.</p><p>Finally, while NumPy will conveniently convert between datatypes,
one must be aware of overflows when using smaller data types.
For example:</p><pre><code>a = np.array([6], dtype=np.uint8)
print(a)
&gt;&gt;&gt;[6]
a = a + np.array([7], dtype=np.uint8)
print(a)
&gt;&gt;&gt;[13]
a = a + np.array([245], dtype=np.uint8)
print(a)
&gt;&gt;&gt;[2]
</code></pre><p>In this example, it makes sense that 6+7=13. But how does
13+245=2? Put simply, the object type (uint8) simply ran out of
space to store the value and wrapped back around to the beginning.
An 8-bit number is only capable of storing 2^8, or 256, unique values.
An operation that results in a value above that range will &lsquo;overflow&rsquo;
and cause the value to wrap back around to zero. Likewise, anything
below that range will &lsquo;underflow&rsquo; and wrap back around to the end.
In our example, 13+245 became 258, which was too large to store in 8
bits and wrapped back around to 0 and ended up at 2.</p><p>NumPy will, generally, try to avoid this situation by dynamically
retyping to whatever datatype will support the result:</p><pre><code>a = a + 260
print(test)
&gt;&gt;&gt;[262]
</code></pre><p>Here, our addition caused our array, &lsquo;a,&rsquo; to be upscaled to use
uint16 instead of uint8. Finally, NumPy offers convenience functions
akin to Python&rsquo;s range() function to create arrays of sequential
numbers:</p><pre><code>X = np.arange(0.2,1,.1)
print(X)
&gt;&gt;&gt;array([0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9], dtype=float32)
</code></pre><p>We can use this function to also generate parameters spaces that can
be iterated on:</p><pre><code>P = 10.0 ** np.arange(-7,1,1)
print(P)

for x,p in zip(X,P):
    print('%f, %f' % (x, p))
</code></pre><h2 id=arrays-stringing-things-together>Arrays: Stringing Things Together</h2><p>With our knowledge of datatypes in hand, we can begin to explore
arrays. Simply put, arrays can be thought of as a sequence of
values (not neccesarily numbers). Arrays are 1 dimensional and can
be created and accessed simply:</p><pre><code>a = np.array([1, 2, 3])
print(type(a))
&gt;&gt;&gt;&lt;class 'numpy.ndarray'&gt;
print(a)
&gt;&gt;&gt;[1 2 3]
print(a.shape)
&gt;&gt;&gt;(3,)
a[0]
&gt;&gt;&gt;1
</code></pre><p>Arrays (and, later, matrices) are zero-indexed. This makes it
convenient when, for example, using Python&rsquo;s range() function
to iterate through an array:</p><pre><code>for i in range(3):
    print(a[i])
&gt;&gt;&gt;1
&gt;&gt;&gt;2
&gt;&gt;&gt;3
</code></pre><p>Arrays are, also, mutable and can be changed easily:</p><pre><code>a[0] = 42
print(a)
&gt;&gt;&gt;array([42, 2, 3])
</code></pre><p>NumPy also includes incredibly powerful broadcasting features. This
makes it very simple to perform mathematical operations on arrays
that also makes intuitive sense:</p><pre><code>a * 3
&gt;&gt;&gt;array([3, 6, 9])
a**2
&gt;&gt;&gt;array([1, 4, 9], dtype=int32)
</code></pre><p>Arrays can also interact with other arrays:</p><pre><code>b = np.array([2, 3, 4])
print(a * b)
&gt;&gt;&gt;array([ 2,  6, 12])
</code></pre><p>In this example, the result of multiplying together two
arrays is to take the element-wise product while multiplying by a
constant will multiply each element in the array by that constant.
NumPy supports all of the basic mathematical operations: addition,
subtraction, multiplication, division, and powers. It also includes
an extensive suite of mathematical functions, such as log() and max(),
which are covered later.</p><h2 id=matrices-an-array-of-arrays>Matrices: An Array of Arrays</h2><p>Matrices can be thought of as an extension of arrays - rather than
having one dimension, matrices have 2 (or more). Much like arrays,
matrices can be created easily within NumPy:</p><pre><code>m = np.array([[1, 2], [3, 4]])
print(m)
&gt;&gt;&gt;[[1 2]
&gt;&gt;&gt; [3 4]]
</code></pre><p>Accessing individual elements is similar to how we did it for arrays.
We simply need to pass in a number of arguments equal to the number
of dimensions:</p><pre><code>m[1][0]
&gt;&gt;&gt;3
</code></pre><p>In this example, our first index selected the row and the second selected
the column - giving us our result of 3. Matrices can be extending out
to any number of dimensions by simply using more indices to access
specific elements (though use-cases beyond 4 may be somewhat rare).</p><p>Matrices support all of the normal mathematial functions such as
+, -, *, and /. A special note: the * operator will result
in an element-wise multiplication. Using @ or np.matmul() for matrix
multiplication:</p><pre><code>print(m-m)
print(m*m)
print(m/m)
</code></pre><p>More complex mathematical functions can typically be found within
the NumPy library itself:</p><pre><code>print(np.sin(x))
print(np.sum(x))
</code></pre><p>A full listing can be found at:
<a href=https://docs.scipy.org/doc/numpy/reference/routines.math.html>https://docs.scipy.org/doc/numpy/reference/routines.math.html</a></p><h2 id=slicing-arrays-and-matrices>Slicing Arrays and Matrices</h2><p>As one can imagine, accessing elements one-at-a-time is both slow
and can potentially require many lines of code to iterate over
every dimension in the matrix. Thankfully, NumPy incorporate a very
powerful slicing engine that allows us to access ranges of elements
easily:</p><pre><code>m[1, :]
&gt;&gt;&gt;array([3, 4])
</code></pre><p>The &lsquo;:&rsquo; value tells NumPy to select all elements in the given
dimension. Here, we&rsquo;ve requested all elements in the first row. We
can also use indexing to request elements within a given range:</p><pre><code>a = np.arange(0, 10, 1)
print(a)
&gt;&gt;&gt;[0 1 2 3 4 5 6 7 8 9]
a[4:8]
&gt;&gt;&gt;array([4, 5, 6, 7])
</code></pre><p>Here, we asked NumPy to give us elements 4 through 7 (ranges in Python
are inclusive at the start and non-inclusive at the end). We can even
go backwards:</p><pre><code>a[-5:]
&gt;&gt;&gt;array([5, 6, 7, 8, 9])
</code></pre><p>In the previous example, the negative value is asking NumPy to return
the last 5 elements of the array. Had the argument been &lsquo;:-5,&rsquo; NumPy
would&rsquo;ve returned everything BUT the last five elements:</p><pre><code>a[:-5]
&gt;&gt;&gt;array([0, 1, 2, 3, 4])
</code></pre><p>Becoming more familiar with NumPy&rsquo;s accessor conventions will allow
you write more efficient, clearer code as it is easier to read a
simple one-line accessor than it is a multi-line, nested loop when
extracting values from an array or matrix.</p><h2 id=useful-functions>Useful Functions</h2><p>The NumPy library provides several convenient mathematical functions
that users can use. These functions provide several advantages
to code written by users:</p><ul><li>They are open source typically have multiple contributors checking
for errors.</li><li>Many of them utilize a C interface and will run much faster than
native Python code.</li><li>They&rsquo;re written to very flexible.</li></ul><p>NumPy arrays and matrices contain many useful aggregating functions
such as max(), min(), mean(), etc These functions are usually able
to run an order of magnitude faster than looping through the object,
so it&rsquo;s important to understand what functions are available to
avoid &lsquo;reinventing the wheel.&rsquo; In addition, many of the functions
are able to sum or average across axes, which make them extremely
useful if your data has inherent grouping. To return to a previous
example:</p><pre><code>m = np.array([[1, 2], [3, 4]])
print(m)
&gt;&gt;&gt;[[1 2]
&gt;&gt;&gt; [3 4]]
m.sum()
&gt;&gt;&gt;10
m.sum(axis=1)
&gt;&gt;&gt;[3, 7]
m.sum(axis=0)
&gt;&gt;&gt;[4, 6]
</code></pre><p>In this example, we created a 2x2 matrix containing the numbers
1 through 4. The sum of the matrix returned the element-wise addition
of the entire matrix. Summing across axis 0 (rows) returned a new array
with the element-wise addition across each row. Likewise, summing across
axis 1 (columns) returned the columnar summation.</p><h2 id=linear-algebra>Linear Algebra</h2><p>Perhaps one of the most important uses for NumPy is its robust support
for Linear Algebra functions. Like the aggregation functions described
in the previous section, these functions are optimized to be much faster
than user implementations and can utilize processesor level features to
provide very quick computations. These functions can be accessed very
easily from the NumPy package:</p><pre><code>a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])
print(np.matmul(a, b))
&gt;&gt;&gt;[[19 22]
    [43 50]]
</code></pre><p>Included in within np.linalg are functions for calculating the
Eigendecomposition of square matrices and symmetric matrices. Finally,
to give a quick example of how easy it is to implement algorithms in
NumPy, we can easily use it to calculate the cost and gradient when
using simple Mean-Squared-Error (MSE):</p><pre><code>cost = np.power(Y - np.matmul(X, weights)), 2).mean(axis=1)
gradient = np.matmul(X.T, np.matmul(X, weights) - y)
</code></pre><p>Finally, more advanced functions are easily available to users via the
linalg library of NumPy as:</p><pre><code>from numpy import linalg

A = np.diag((1,2,3))

w,v = linalg.eig(A)

print ('w =', w)
print ('v =', v)
</code></pre><h2 id=numpy-resources>NumPy Resources</h2><ul><li><a href=https://docs.scipy.org/doc/numpy>https://docs.scipy.org/doc/numpy</a></li><li><a href=http://cs231n.github.io/python-numpy-tutorial/#numpy>http://cs231n.github.io/python-numpy-tutorial/#numpy</a></li><li><a href=https://docs.scipy.org/doc/numpy-1.15.1/reference/routines.linalg.html>https://docs.scipy.org/doc/numpy-1.15.1/reference/routines.linalg.html</a></li><li><a href=https://en.wikipedia.org/wiki/Mean_squared_error>https://en.wikipedia.org/wiki/Mean_squared_error</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-1c3b9ac7e2dbf04a9c689f2c2c4b613a>3 - Scipy</h1><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p><p>SciPy is a library built around NumPy and has a number of off-the-shelf
algorithms and operations implemented. These include algorithms from
calculus (such as integration), statistics, linear algebra,
image-processing, signal processing, machine learning.</p><p>To achieve this, SciPy bundles a number of useful open-source software
for mathematics, science, and engineering. It includes the following
packages:</p><dl><dt>NumPy,</dt><dd><p>for managing N-dimensional arrays</p></dd><dt>SciPy library,</dt><dd><p>to access fundamental scientific computing capabilities</p></dd><dt>Matplotlib,</dt><dd><p>to conduct 2D plotting</p></dd><dt>IPython,</dt><dd><p>for an Interactive console (see jupyter)</p></dd><dt>Sympy,</dt><dd><p>for symbolic mathematics</p></dd><dt>pandas,</dt><dd><p>for providing data structures and analysis</p></dd></dl><h2 id=introduction>Introduction</h2><p>First, we add the usual scientific computing modules with the typical
abbreviations, including sp for scipy. We could invoke scipy&rsquo;s
statistical package as sp.stats, but for the sake of laziness, we
abbreviate that too.</p><pre><code>import numpy as np # import numpy
import scipy as sp # import scipy
from scipy import stats # refer directly to stats rather than sp.stats
import matplotlib as mpl # for visualization
from matplotlib import pyplot as plt # refer directly to pyplot
                                     # rather than mpl.pyplot
</code></pre><p>Now we create some random data to play with. We generate 100 samples
from a Gaussian distribution centered at zero.</p><pre><code>s = sp.randn(100)
</code></pre><p>How many elements are in the set?</p><pre><code>print ('There are',len(s),'elements in the set')
</code></pre><p>What is the mean (average) of the set?</p><pre><code>print ('The mean of the set is',s.mean())
</code></pre><p>What is the minimum of the set?</p><pre><code>print ('The minimum of the set is',s.min())
</code></pre><p>What is the maximum of the set?</p><pre><code>print ('The maximum of the set is',s.max())
</code></pre><p>We can use the scipy functions too. What&rsquo;s the median?</p><pre><code>print ('The median of the set is',sp.median(s))
</code></pre><p>What about the standard deviation and variance?</p><pre><code>print ('The standard deviation is',sp.std(s),
       'and the variance is',sp.var(s))
</code></pre><p>Isn&rsquo;t the variance the square of the standard deviation?</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;The square of the standard deviation is&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>std</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>How close are the measures? The differences are close as the following
calculation shows</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;The difference is&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#204a87>abs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>std</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>sp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>var</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>)))</span>

    <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;And in decimal form, the difference is </span><span style=color:#4e9a06>%0.16f</span><span style=color:#4e9a06>&#39;</span> <span style=color:#ce5c00;font-weight:700>%</span>
           <span style=color:#000;font-weight:700>(</span><span style=color:#204a87>abs</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>std</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>sp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>var</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>))))</span>
</code></pre></div><p>How does this look as a histogram? See Figure 1, Figure 2, Figure 3</p><pre><code>plt.hist(s) # yes, one line of code for a histogram
plt.show()
</code></pre><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_23_0.png alt="Figure 1: Histogram 1"></p><p>Figure 1: Histogram 1</p><p>Let us add some titles.</p><pre><code>plt.clf() # clear out the previous plot

plt.hist(s)
plt.title(&quot;Histogram Example&quot;)
plt.xlabel(&quot;Value&quot;)
plt.ylabel(&quot;Frequency&quot;)

plt.show()
</code></pre><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_25_0.png alt="Figure 2: Histogram 2"></p><p>Figure 2: Histogram 2</p><p>Typically we do not include titles when we prepare images for inclusion
in LaTeX. There we use the caption to describe what the figure is about.</p><pre><code>plt.clf() # clear out the previous plot

plt.hist(s)
plt.xlabel(&quot;Value&quot;)
plt.ylabel(&quot;Frequency&quot;)

plt.show()
</code></pre><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_27_0.png alt="Figure 3: Histogram 3"></p><p>Figure 3: Histogram 3</p><p>Let us try out some linear regression or curve fitting. See @#fig:scipy-output_30_0</p><pre><code>import random

def F(x):
    return 2*x - 2

def add_noise(x):
    return x + random.uniform(-1,1)

X = range(0,10,1)

Y = []
for i in range(len(X)):
    Y.append(add_noise(X[i]))

plt.clf() # clear out the old figure
plt.plot(X,Y,'.')
plt.show()
</code></pre><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_30_0.png alt="Figure 4: Result 1"></p><p>Figure 4: Result 1</p><p>Now let&rsquo;s try linear regression to fit the curve.</p><pre><code>m, b, r, p, est_std_err = stats.linregress(X,Y)
</code></pre><p>What is the slope and y-intercept of the fitted curve?</p><pre><code>print ('The slope is',m,'and the y-intercept is', b)

def Fprime(x): # the fitted curve
    return m*x + b
</code></pre><p>Now let&rsquo;s see how well the curve fits the data. We&rsquo;ll call the fitted
curve F'.</p><pre><code>X = range(0,10,1)

Yprime = []
for i in range(len(X)):
    Yprime.append(Fprime(X[i]))

plt.clf() # clear out the old figure

# the observed points, blue dots
plt.plot(X, Y, '.', label='observed points')

# the interpolated curve, connected red line
plt.plot(X, Yprime, 'r-', label='estimated points')

plt.title(&quot;Linear Regression Example&quot;) # title
plt.xlabel(&quot;x&quot;) # horizontal axis title
plt.ylabel(&quot;y&quot;) # vertical axis title
# legend labels to plot
plt.legend(['obsered points', 'estimated points'])

# comment out so that you can save the figure
#plt.show()
</code></pre><p>To save images into a PDF file for inclusion into LaTeX documents you
can save the images as follows. Other formats such as png are also
possible, but the quality is naturally not sufficient for inclusion in
papers and documents. For that, you certainly want to use PDF. The save
of the figure has to occur before you use the <code>show()</code> command. See Figure 5</p><pre><code>plt.savefig(&quot;regression.pdf&quot;, bbox_inches='tight')

plt.savefig('regression.png')

plt.show()
</code></pre><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/output_40_0.png alt="Figure 5: Result 2"></p><p>Figure 5: Result 2</p><h2 id=references>References</h2><p>For more information about SciPy we recommend that you visit the
following link</p><p><a href=https://www.scipy.org/getting-started.html#learning-to-work-with-scipy>https://www.scipy.org/getting-started.html#learning-to-work-with-scipy</a></p><p>Additional material and inspiration for this section are from</p><ul><li>[<img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png alt=No>] &ldquo;Getting Started guide&rdquo; <a href=https://www.scipy.org/getting-started.html>https://www.scipy.org/getting-started.html</a></li></ul><p>[![No</p><ul><li>[<img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png alt=No>] Prasanth. &ldquo;Simple statistics with SciPy.&rdquo; Comfort at 1 AU. February</li></ul><p>[![No
28, 2011.
<a href=https://oneau.wordpress.com/2011/02/28/simple-statistics-with-scipy/>https://oneau.wordpress.com/2011/02/28/simple-statistics-with-scipy/</a>.</p><ul><li>[<img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png alt=No>] SciPy Cookbook. Lasted updated: 2015.</li></ul><p>[![No
<a href=http://scipy-cookbook.readthedocs.io/>http://scipy-cookbook.readthedocs.io/</a>.</p><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scipy/images/no.png alt=No> create bibtex entries</p><p>No</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9f03f93bd79697249709db37772032c6>4 - Scikit-learn</h1><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p><hr><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/learning.png alt> <strong>Learning Objectives</strong></p><ul><li>Exploratory data analysis</li><li>Pipeline to prepare data</li><li>Full learning pipeline</li><li>Fine tune the model</li><li>Significance tests</li></ul><hr><h2 id=introduction-to-scikit-learn>Introduction to Scikit-learn</h2><p>Scikit learn is a Machine Learning specific library used in Python. Library can be used for data mining and analysis. It is built on top of NumPy, matplotlib and SciPy. Scikit Learn features Dimensionality reduction, clustering, regression and classification algorithms.
It also features model selection using grid search, cross validation and metrics.</p><p>Scikit learn also enables users to preprocess the data which can then be used for machine learning using modules like preprocessing and feature extraction.</p><p>In this section we demonstrate how simple it is to use k-means in
scikit learn.</p><h2 id=installation>Installation</h2><p>If you already have a working installation of numpy and scipy, the
easiest way to install scikit-learn is using pip</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a40000>$</span> <span style=color:#000>pip</span> <span style=color:#000>install</span> <span style=color:#000>numpy</span>
<span style=color:#a40000>$</span> <span style=color:#000>pip</span> <span style=color:#000>install</span> <span style=color:#000>scipy</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>U</span>
<span style=color:#a40000>$</span> <span style=color:#000>pip</span> <span style=color:#000>install</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>U</span> <span style=color:#000>scikit</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>learn</span>
</code></pre></div><h2 id=supervised-learning>Supervised Learning</h2><p>Supervised Learning is used in machine learning when we already know a set of output predictions based on input characteristics and based on that we need to predict the target for a new input. Training data is used to train the model which then can be used to predict the output from a bounded set.</p><p>Problems can be of two types</p><ol><li>Classification : Training data belongs to three or four classes/categories and based on the label we want to predict
the class/category for the unlabeled data.</li><li>Regression : Training data consists of vectors without any corresponding target values. Clustering can be used for
these type of datasets to determine discover groups of similar examples. Another way is density
estimation which determine the distribution of data within the input space. Histogram is the most basic form.</li></ol><h2 id=unsupervised-learning>Unsupervised Learning</h2><p>Unsupervised Learning is used in machine learning when we have the training set available but without any corresponding target. The outcome of the problem is to discover groups within the provided input. It can be done in many ways.</p><p>Few of them are listed here</p><ol><li>Clustering : Discover groups of similar characteristics.</li><li>Density Estimation : Finding the distribution of data within the provided input or changing the data from a high
dimensional space to two or three dimension.</li></ol><h2 id=building-a-end-to-end-pipeline-for-supervised-machine-learning-using-scikit-learn>Building a end to end pipeline for Supervised machine learning using Scikit-learn</h2><p>A data pipeline is a set of processing components that are sequenced to produce
meaningful data. Pipelines are commonly used in Machine learning, since there is
lot of data transformation and manipulation that needs to be applied to make
data useful for machine learning. All components are sequenced in a way that the
output of one component becomes input for the next and each of the component is
self contained. Components interact with each other using data.</p><p>Even if a component breaks, the downstream component can run normally using the
last output. Sklearn provide the ability to build pipelines that can be
transformed and modeled for machine learning.</p><h2 id=steps-for-developing-a-machine-learning-model>Steps for developing a machine learning model</h2><ol><li>Explore the domain space</li><li>Extract the problem definition</li><li>Get the data that can be used to make the system learn to solve the problem
definition.</li><li>Discover and Visualize the data to gain insights</li><li>Feature engineering and prepare the data</li><li>Fine tune your model</li><li>Evaluate your solution using metrics</li><li>Once proven launch and maintain the model.</li></ol><h2 id=exploratory-data-analysis>Exploratory Data Analysis</h2><p>Example project = Fraud detection system</p><p>First step is to load the data into a dataframe in order for a proper analysis
to be done on the attributes.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_csv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;dataset/data_file.csv&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>head</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>Perform the basic analysis on the data shape and null value information.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>shape</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>info</span><span style=color:#000;font-weight:700>())</span>
<span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>isnull</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>values</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>any</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>Here is the example of few of the visual data analysis methods.</p><h3 id=bar-plot>Bar plot</h3><p>A bar chart or graph is a graph with rectangular bars or bins that are used to plot
categorical values. Each bar in the graph represents a categorical variable and the
height of the bar is proportional to the value represented by it.</p><p>Bar graphs are used:</p><p>To make comparisons between variables
To visualize any trend in the data, i.e., they show the dependence of one variable on another
Estimate values of a variable</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ylabel</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Transactions&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>xlabel</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Type&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value_counts</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>plot</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-barplot.png alt="Figure 1: Example of scikit-learn barplots"></p><p>Figure 1: Example of scikit-learn barplots</p><h3 id=correlation-between-attributes>Correlation between attributes</h3><p>Attributes in a dataset can be related based on differnt aspects.</p><p>Examples include attributes dependent on another or could be loosely or tightly coupled. Also example includes two variables can be associated with a third one.</p><p>In order to understand the relationship between attributes, correlation represents the best visual way to get an insight. Positive correlation meaning both attributes moving into the same direction. Negative correlation refers to opposte directions. One attributes values increase results in value decrease for other. Zero correlation is when the attributes are unrelated.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># compute the correlation matrix</span>
<span style=color:#000>corr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>corr</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#8f5902;font-style:italic># generate a mask for the lower triangle</span>
<span style=color:#000>mask</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>zeros_like</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>corr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dtype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bool</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>mask</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>triu_indices_from</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>mask</span><span style=color:#000;font-weight:700>)]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>True</span>

<span style=color:#8f5902;font-style:italic># set up the matplotlib figure</span>
<span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>subplots</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>figsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>))</span>

<span style=color:#8f5902;font-style:italic># generate a custom diverging color map</span>
<span style=color:#000>cmap</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sns</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>diverging_palette</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>220</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>as_cmap</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># draw the heatmap with the mask and correct aspect ratio</span>
<span style=color:#000>sns</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>heatmap</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>corr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>mask</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>mask</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cmap</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>cmap</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>vmax</span><span style=color:#ce5c00;font-weight:700>=.</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span>
            <span style=color:#000>square</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>,</span>
            <span style=color:#000>linewidths</span><span style=color:#ce5c00;font-weight:700>=.</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cbar_kws</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;shrink&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000>ax</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>ax</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-correlationanalysis.png alt="Figure 2: scikit-learn correlation array"></p><p>Figure 2: scikit-learn correlation array</p><h3 id=histogram-analysis-of-dataset-attributes>Histogram Analysis of dataset attributes</h3><p>A histogram consists of a set of counts that represent the number of times some event occurred.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>matplotlib</span> <span style=color:#000>inline</span>
<span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>hist</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bins</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>figsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>show</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-histograms.png alt="Figure 3: scikit-learn"></p><p>Figure 3: scikit-learn</p><h3 id=box-plot-analysis>Box plot Analysis</h3><p>Box plot analysis is useful in detecting whether a distribution is skewed and detect outliers in the data.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>fig</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>axs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>subplots</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>figsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>tmp</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[(</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;TRANSFER&#39;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000;font-weight:700>:]</span>

<span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sns</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>boxplot</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;isFlaggedFraud&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;amount&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>tmp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ax</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>axs</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>][</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
<span style=color:#000>axs</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>][</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_yscale</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;log&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sns</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>boxplot</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;isFlaggedFraud&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;oldbalanceDest&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>tmp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ax</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>axs</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>][</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>])</span>
<span style=color:#000>axs</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>][</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ylim</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0.5e8</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sns</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>boxplot</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;isFlaggedFraud&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;oldbalanceOrg&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>tmp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ax</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>axs</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>][</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
<span style=color:#000>axs</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>][</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ylim</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3e7</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>d</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sns</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>regplot</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;oldbalanceOrg&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;amount&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>tmp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[(</span><span style=color:#000>tmp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>isFlaggedFraud</span> <span style=color:#ce5c00;font-weight:700>==</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000;font-weight:700>:],</span> <span style=color:#000>ax</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>axs</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>][</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>])</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>show</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-boxplot.png alt="Figure 4: scikit-learn"></p><p>Figure 4: scikit-learn</p><h3 id=scatter-plot-analysis>Scatter plot Analysis</h3><p>The scatter plot displays values of two numerical variables as Cartesian coordinates.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>figure</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>figsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>sns</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pairplot</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>[[</span><span style=color:#4e9a06>&#39;amount&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;oldbalanceOrg&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;oldbalanceDest&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;isFraud&#39;</span><span style=color:#000;font-weight:700>]],</span> <span style=color:#000>hue</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;isFraud&#39;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-scatterplot.png alt="Figure 5: scikit-learn scatter plots"></p><p>Figure 5: scikit-learn scatter plots</p><h2 id=data-cleansing---removing-outliers>Data Cleansing - Removing Outliers</h2><p>If the transaction amount is lower than 5 percent of the all the transactions
AND does not exceed USD 3000, we will exclude it from our analysis to reduce
Type 1 costs If the transaction amount is higher than 95 percent of all the
transactions AND exceeds USD 500000, we will exclude it from our analysis, and
use a blanket review process for such transactions (similar to isFlaggedFraud
column in original dataset) to reduce Type 2 costs</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>low_exclude</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>minimum</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fin_samp_data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>amount</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>quantile</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.05</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>3000</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>high_exclude</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>maximum</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fin_samp_data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>amount</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>quantile</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.95</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>500000</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic>###Updating Data to exclude records prone to Type 1 and Type 2 costs</span>
<span style=color:#000>low_data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>fin_samp_data</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>fin_samp_data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>amount</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>low_exclude</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>low_data</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>low_data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>amount</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>high_exclude</span><span style=color:#000;font-weight:700>]</span>
</code></pre></div><h2 id=pipeline-creation>Pipeline Creation</h2><p>Machine learning pipeline is used to help automate machine learning workflows. They operate by enabling a sequence of data to be transformed and correlated together in a model that can be tested and evaluated to achieve an outcome, whether positive or negative.</p><h3 id=defining-dataframeselector-to-separate-numerical-and-categorical-attributes>Defining DataFrameSelector to separate Numerical and Categorical attributes</h3><p>Sample function to seperate out Numerical and categorical attributes.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.base</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>BaseEstimator</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>TransformerMixin</span>

<span style=color:#8f5902;font-style:italic># Create a class to select numerical or categorical columns</span>
<span style=color:#8f5902;font-style:italic># since Scikit-Learn doesn&#39;t handle DataFrames yet</span>
<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DataFrameSelector</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BaseEstimator</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>TransformerMixin</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>attribute_names</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>attribute_names</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>attribute_names</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>None</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#3465a4>self</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>transform</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>[</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>attribute_names</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>values</span>
</code></pre></div><h3 id=feature-creation--additional-feature-engineering>Feature Creation / Additional Feature Engineering</h3><p>During EDA we identified that there are transactions where the balances do not
tally after the transaction is completed.We believe this could potentially be
cases where fraud is occurring. To account for this error in the transactions,
we define two new features"errorBalanceOrig" and &ldquo;errorBalanceDest,&rdquo; calculated
by adjusting the amount with the before and after balances for the Originator
and Destination accounts.</p><p>Below, we create a function that allows us to create these features in a
pipeline.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.base</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>BaseEstimator</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>TransformerMixin</span>

<span style=color:#8f5902;font-style:italic># column index</span>
<span style=color:#000>amount_ix</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>oldbalanceOrg_ix</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>newbalanceOrig_ix</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>oldbalanceDest_ix</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>newbalanceDest_ix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span>

<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>CombinedAttributesAdder</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BaseEstimator</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>TransformerMixin</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span> <span style=color:#8f5902;font-style:italic># no *args or **kargs</span>
        <span style=color:#204a87;font-weight:700>pass</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>None</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#3465a4>self</span>  <span style=color:#8f5902;font-style:italic># nothing else to do</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>transform</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>None</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>errorBalanceOrig</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>[:,</span><span style=color:#000>newbalanceOrig_ix</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>+</span>  <span style=color:#000>X</span><span style=color:#000;font-weight:700>[:,</span><span style=color:#000>amount_ix</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#000>X</span><span style=color:#000;font-weight:700>[:,</span><span style=color:#000>oldbalanceOrg_ix</span><span style=color:#000;font-weight:700>]</span>
        <span style=color:#000>errorBalanceDest</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>[:,</span><span style=color:#000>oldbalanceDest_ix</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>+</span>  <span style=color:#000>X</span><span style=color:#000;font-weight:700>[:,</span><span style=color:#000>amount_ix</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#000>X</span><span style=color:#000;font-weight:700>[:,</span><span style=color:#000>newbalanceDest_ix</span><span style=color:#000;font-weight:700>]</span>

        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>c_</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>errorBalanceOrig</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>errorBalanceDest</span><span style=color:#000;font-weight:700>]</span>
</code></pre></div><h2 id=creating-training-and-testing-datasets>Creating Training and Testing datasets</h2><p>Training set includes the set of input examples that the model will be fit into or trained on by adjusting the parameters.
Testing dataset is critical to test the generalizability of the model . By using this set, we can get the working accuracy of our model.</p><p>Testing set should not be exposed to model unless model training has not been completed. This way the results from testing will be more reliable.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.model_selection</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>train_test_split</span>
<span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>train_test_split</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>test_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0.30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>random_state</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stratify</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h2 id=creating-pipeline-for-numerical-and-categorical-attributes>Creating pipeline for numerical and categorical attributes</h2><p>Identifying columns with Numerical and Categorical characteristics.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>X_train_num</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>X_train</span><span style=color:#000;font-weight:700>[[</span><span style=color:#4e9a06>&#34;amount&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;oldbalanceOrg&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;newbalanceOrig&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;oldbalanceDest&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;newbalanceDest&#34;</span><span style=color:#000;font-weight:700>]]</span>
<span style=color:#000>X_train_cat</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>X_train</span><span style=color:#000;font-weight:700>[[</span><span style=color:#4e9a06>&#34;type&#34;</span><span style=color:#000;font-weight:700>]]</span>
<span style=color:#000>X_model_col</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;amount&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;oldbalanceOrg&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;newbalanceOrig&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;oldbalanceDest&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;newbalanceDest&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;type&#34;</span><span style=color:#000;font-weight:700>]</span>
</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.pipeline</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Pipeline</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.preprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>StandardScaler</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.preprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Imputer</span>

<span style=color:#000>num_attribs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>list</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_num</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>cat_attribs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>list</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_cat</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000>num_pipeline</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Pipeline</span><span style=color:#000;font-weight:700>([</span>
        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;selector&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>DataFrameSelector</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>num_attribs</span><span style=color:#000;font-weight:700>)),</span>
        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;attribs_adder&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CombinedAttributesAdder</span><span style=color:#000;font-weight:700>()),</span>
        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;std_scaler&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>StandardScaler</span><span style=color:#000;font-weight:700>())</span>
    <span style=color:#000;font-weight:700>])</span>

<span style=color:#000>cat_pipeline</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Pipeline</span><span style=color:#000;font-weight:700>([</span>
        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;selector&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>DataFrameSelector</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cat_attribs</span><span style=color:#000;font-weight:700>)),</span>
        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;cat_encoder&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CategoricalEncoder</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>encoding</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;onehot-dense&#34;</span><span style=color:#000;font-weight:700>))</span>
    <span style=color:#000;font-weight:700>])</span>
</code></pre></div><h2 id=selecting-the-algorithm-to-be-applied>Selecting the algorithm to be applied</h2><p>Algorithim selection primarily depends on the objective you are trying to solve and what kind of dataset is available. There are differnt type of algorithms which can be applied and we will look into few of them here.</p><h3 id=linear-regression>Linear Regression</h3><p>This algorithm can be applied when you want to compute some continuous value. To predict some future value of a process which is currently running, you can go with regression algorithm.</p><p>Examples where linear regression can used are :</p><ol><li>Predict the time taken to go from one place to another</li><li>Predict the sales for a future month</li><li>Predict sales data and improve yearly projections.</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.linear_model</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>LinearRegression</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.preprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>StandardScaler</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>time</span>
<span style=color:#000>scl</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>StandardScaler</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>X_train_std</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>scl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit_transform</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>X_test_std</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>scl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>transform</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>start</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>lin_reg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>LinearRegression</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>lin_reg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_std</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>)</span> <span style=color:#8f5902;font-style:italic>#SKLearn&#39;s linear regression</span>
<span style=color:#000>y_train_pred</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lin_reg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_std</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>train_time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>start</span>
</code></pre></div><h3 id=logistic-regression>Logistic Regression</h3><p>This algorithm can be used to perform binary classification. It can be used if you want a probabilistic framework.
Also in case you expect to receive more training data in the future that you want to be able to quickly incorporate into your model.</p><ol><li>Customer churn prediction.</li><li>Credit Scoring & Fraud Detection which is our example problem which we are trying to solve in this chapter.</li><li>Calculating the effectiveness of marketing campaigns.</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.linear_model</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>LogisticRegression</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.model_selection</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>train_test_split</span>

<span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>train_test_split</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stratify</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>train_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>subsample_rate</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>random_state</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>train_test_split</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stratify</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>train_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>subsample_rate</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>random_state</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000>model_lr_sklearn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>LogisticRegression</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>multi_class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;multinomial&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>C</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1e6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>solver</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;sag&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>max_iter</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>model_lr_sklearn</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000>y_pred_test</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>model_lr_sklearn</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>acc</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>accuracy_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred_test</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>results</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>results</span><span style=color:#000;font-weight:700>)]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;LR Sklearn&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>acc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)]</span>
<span style=color:#000>results</span>
</code></pre></div><h3 id=decision-trees>Decision trees</h3><p>Decision trees handle feature interactions and they&rsquo;re non-parametric. Doesnt support online learning and the entire tree needs to be rebuild when new traning dataset comes in. Memory consumption is very high.</p><p>Can be used for the following cases</p><ol><li>Investment decisions</li><li>Customer churn</li><li>Banks loan defaulters</li><li>Build vs Buy decisions</li><li>Sales lead qualifications</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.tree</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>DecisionTreeRegressor</span>
<span style=color:#000>dt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DecisionTreeRegressor</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>start</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>dt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_std</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>y_train_pred</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_std</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>train_time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>start</span>

<span style=color:#000>start</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>y_test_pred</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test_std</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>test_time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>start</span>
</code></pre></div><h3 id=k-means>K Means</h3><p>This algorithm is used when we are not aware of the labels and one needs to be created based on the features of objects. Example will be to divide a group of people into differnt subgroups based on common theme or attribute.</p><p>The main disadvantage of K-mean is that you need to know exactly the number of clusters or groups which is required. It takes a lot of iteration to come up with the best K.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.neighbors</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>KNeighborsClassifier</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.model_selection</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>train_test_split</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>GridSearchCV</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PredefinedSplit</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.metrics</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>accuracy_score</span>

<span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>train_test_split</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stratify</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>train_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>subsample_rate</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>random_state</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>train_test_split</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stratify</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>train_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>subsample_rate</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>random_state</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000>model_knn_sklearn</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>KNeighborsClassifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n_jobs</span><span style=color:#ce5c00;font-weight:700>=-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>model_knn_sklearn</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000>y_pred_test</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>model_knn_sklearn</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>acc</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>accuracy_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred_test</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000>results</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>results</span><span style=color:#000;font-weight:700>)]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;KNN Arbitary Sklearn&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>acc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)]</span>
<span style=color:#000>results</span>
</code></pre></div><h3 id=support-vector-machines>Support Vector Machines</h3><p>SVM is a supervised ML technique and used for pattern recognition and classification problems when your data has exactly two classes.
Its popular in text classification problems.</p><p>Few cases where SVM can be used is</p><ol><li>Detecting persons with common diseases.</li><li>Hand-written character recognition</li><li>Text categorization</li><li>Stock market price prediction</li></ol><h3 id=naive-bayes>Naive Bayes</h3><p>Naive Bayes is used for large datasets.This algoritm works well even when we have a limited CPU and memory available. This works by calculating bunch of counts. It requires less training data. The algorthim cant learn interation between features.</p><p>Naive Bayes can be used in real-world applications such as:</p><ol><li>Sentiment analysis and text classification</li><li>Recommendation systems like Netflix, Amazon</li><li>To mark an email as spam or not spam</li><li>Face recognition</li></ol><h3 id=random-forest>Random Forest</h3><p>Ranmdon forest is similar to Decision tree. Can be used for both regression and classification problems with large data sets.</p><p>Few case where it can be applied.</p><ol><li>Predict patients for high risks.</li><li>Predict parts failures in manufacturing.</li><li>Predict loan defaulters.</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.ensemble</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>RandomForestRegressor</span>
<span style=color:#000>forest</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RandomForestRegressor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n_estimators</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>400</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>criterion</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;mse&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>random_state</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_jobs</span><span style=color:#ce5c00;font-weight:700>=-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>start</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>forest</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_std</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>y_train_pred</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>forest</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train_std</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>train_time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>start</span>

<span style=color:#000>start</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>y_test_pred</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>forest</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test_std</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>test_time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>start</span>
</code></pre></div><h3 id=neural-networks>Neural networks</h3><p>Neural network works based on weights of connections between neurons. Weights are trained and based on that the neural network can be utilized to predict the class or a quantity. They are resource and memory intensive.</p><p>Few cases where it can be applied.</p><ol><li>Applied to unsupervised learning tasks, such as feature extraction.</li><li>Extracts features from raw images or speech with much less human intervention</li></ol><h3 id=deep-learning-using-keras>Deep Learning using Keras</h3><p>Keras is most powerful and easy-to-use Python libraries for developing and evaluating deep learning models. It has the efficient numerical computation libraries Theano and TensorFlow.</p><h3 id=xgboost>XGBoost</h3><p>XGBoost stands for eXtreme Gradient Boosting.
XGBoost is an implementation of gradient boosted decision trees designed for speed and performance. It is engineered for efficiency of compute time and memory resources.</p><h2 id=scikit-cheat-sheet>Scikit Cheat Sheet</h2><p>Scikit learning has put a very indepth and well explained flow chart to help you choose the right algorithm that I find very handy.</p><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-cheatsheet.png alt="Figure 6: scikit-learn"></p><p>Figure 6: scikit-learn</p><h2 id=parameter-optimization>Parameter Optimization</h2><p>Machine learning models are parameterized so that their behavior can be tuned for a given problem. These models can have many parameters and finding the best combination of parameters can be treated as a search problem.</p><p>A parameter is a configurationthat is part of the model and values can be derived from the given data.</p><ol><li>Required by the model when making predictions.</li><li>Values define the skill of the model on your problem.</li><li>Estimated or learned from data.</li><li>Often not set manually by the practitioner.</li><li>Often saved as part of the learned model.</li></ol><h3 id=hyperparameter-optimizationtuning-algorithms>Hyperparameter optimization/tuning algorithms</h3><p>Grid search is an approach to hyperparameter tuning that will methodically build and evaluate a model for each combination of algorithm parameters specified in a grid.</p><p>Random search provide a statistical distribution for each hyperparameter from which values may be randomly sampled.</p><h2 id=experiments-with-keras-deep-learning-xgboost-and-svm-svc-compared-to-logistic-regressionbaseline>Experiments with Keras (deep learning), XGBoost, and SVM (SVC) compared to Logistic Regression(Baseline)</h2><h3 id=creating-a-parameter-grid>Creating a parameter grid</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>grid_param</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
                <span style=color:#000;font-weight:700>[{</span>   <span style=color:#8f5902;font-style:italic>#LogisticRegression</span>
                   <span style=color:#4e9a06>&#39;model__penalty&#39;</span><span style=color:#000;font-weight:700>:[</span><span style=color:#4e9a06>&#39;l1&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;l2&#39;</span><span style=color:#000;font-weight:700>],</span>
                   <span style=color:#4e9a06>&#39;model__C&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0.01</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>100</span><span style=color:#000;font-weight:700>]</span>
                <span style=color:#000;font-weight:700>}],</span>

                <span style=color:#000;font-weight:700>[{</span><span style=color:#8f5902;font-style:italic>#keras</span>
                    <span style=color:#4e9a06>&#39;model__optimizer&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>optimizer</span><span style=color:#000;font-weight:700>,</span>
                    <span style=color:#4e9a06>&#39;model__loss&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>loss</span>
                <span style=color:#000;font-weight:700>}],</span>

                <span style=color:#000;font-weight:700>[{</span>  <span style=color:#8f5902;font-style:italic>#SVM</span>
                   <span style=color:#4e9a06>&#39;model__C&#39;</span> <span style=color:#000;font-weight:700>:[</span><span style=color:#0000cf;font-weight:700>0.01</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>100</span><span style=color:#000;font-weight:700>],</span>
                   <span style=color:#4e9a06>&#39;model__gamma&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span>
                   <span style=color:#4e9a06>&#39;model__max_iter&#39;</span><span style=color:#000;font-weight:700>:[</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
                <span style=color:#000;font-weight:700>}],</span>

                <span style=color:#000;font-weight:700>[{</span>   <span style=color:#8f5902;font-style:italic>#XGBClassifier</span>
                    <span style=color:#4e9a06>&#39;model__min_child_weight&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>],</span>
                    <span style=color:#4e9a06>&#39;model__gamma&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#000;font-weight:700>],</span>
                    <span style=color:#4e9a06>&#39;model__subsample&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0.6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0.8</span><span style=color:#000;font-weight:700>],</span>
                    <span style=color:#4e9a06>&#39;model__colsample_bytree&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0.6</span><span style=color:#000;font-weight:700>],</span>
                    <span style=color:#4e9a06>&#39;model__max_depth&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span>

                <span style=color:#000;font-weight:700>}]</span>
            <span style=color:#000;font-weight:700>]</span>
</code></pre></div><h3 id=implementing-grid-search-with-models-and-also-creating-metrics-from-each-of-the-model>Implementing Grid search with models and also creating metrics from each of the model.</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>Pipeline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memory</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>None</span><span style=color:#000;font-weight:700>,</span>
     <span style=color:#000>steps</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[(</span><span style=color:#4e9a06>&#39;preparation&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>FeatureUnion</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n_jobs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>None</span><span style=color:#000;font-weight:700>,</span>
       <span style=color:#000>transformer_list</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[(</span><span style=color:#4e9a06>&#39;num_pipeline&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Pipeline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memory</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>None</span><span style=color:#000;font-weight:700>,</span>
     <span style=color:#000>steps</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[(</span><span style=color:#4e9a06>&#39;selector&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>DataFrameSelector</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>attribute_names</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;amount&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;oldbalanceOrg&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;newbalanceOrig&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;oldbalanceDest&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;newbalanceDest&#39;</span><span style=color:#000;font-weight:700>])),</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;attribs_adder&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CombinedAttributesAdder</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000>penalty</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;l2&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>random_state</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>None</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>solver</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;warn&#39;</span><span style=color:#000;font-weight:700>,</span>
          <span style=color:#000>tol</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0.0001</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>verbose</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>warm_start</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>False</span><span style=color:#000;font-weight:700>))])</span>
</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.metrics</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>mean_squared_error</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.metrics</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>classification_report</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.metrics</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>f1_score</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>xgboost.sklearn</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>XGBClassifier</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.svm</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>SVC</span>

<span style=color:#000>test_scores</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
<span style=color:#8f5902;font-style:italic>#Machine Learning Algorithm (MLA) Selection and Initialization</span>
<span style=color:#000>MLA</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
        <span style=color:#000>linear_model</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>LogisticRegression</span><span style=color:#000;font-weight:700>(),</span>
        <span style=color:#000>keras_model</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#000>SVC</span><span style=color:#000;font-weight:700>(),</span>
        <span style=color:#000>XGBClassifier</span><span style=color:#000;font-weight:700>()</span>

      <span style=color:#000;font-weight:700>]</span>

<span style=color:#8f5902;font-style:italic>#create table to compare MLA metrics</span>
<span style=color:#000>MLA_columns</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;Name&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Score&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Accuracy_Score&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;ROC_AUC_score&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;final_rmse&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Classification_error&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Recall_Score&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Precision_Score&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;mean_test_score&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;mean_fit_time&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;F1_Score&#39;</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#000>MLA_compare</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DataFrame</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>columns</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>MLA_columns</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>Model_Scores</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DataFrame</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>columns</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;Name&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Score&#39;</span><span style=color:#000;font-weight:700>])</span>

<span style=color:#000>row_index</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>alg</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>MLA</span><span style=color:#000;font-weight:700>:</span>

    <span style=color:#8f5902;font-style:italic>#set name and parameters</span>
    <span style=color:#000>MLA_name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>alg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__class__</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__name__</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Name&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>MLA_name</span>
    <span style=color:#8f5902;font-style:italic>#MLA_compare.loc[row_index, &#39;Parameters&#39;] = str(alg.get_params())</span>


    <span style=color:#000>full_pipeline_with_predictor</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Pipeline</span><span style=color:#000;font-weight:700>([</span>
        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;preparation&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>full_pipeline</span><span style=color:#000;font-weight:700>),</span>  <span style=color:#8f5902;font-style:italic># combination of numerical and categorical pipelines</span>
        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;model&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>alg</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>])</span>

    <span style=color:#000>grid_search</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>GridSearchCV</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>full_pipeline_with_predictor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>grid_param</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>cv</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>verbose</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>scoring</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;f1&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>return_train_score</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>grid_search</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>X_model_col</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>y_pred</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>grid_search</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Accuracy_Score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>accuracy_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;ROC_AUC_score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>roc_auc_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>),</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>grid_search</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span><span style=color:#000;font-weight:700>),</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>negative_mse</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>grid_search</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>best_score_</span>
    <span style=color:#000>scores</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sqrt</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>negative_mse</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>final_mse</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mean_squared_error</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>final_rmse</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sqrt</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>final_mse</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;final_rmse&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>final_rmse</span>

    <span style=color:#000>confusion_matrix_var</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>confusion_matrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>TP</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>confusion_matrix_var</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>TN</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>confusion_matrix_var</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>FP</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>confusion_matrix_var</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>FN</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>confusion_matrix_var</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Classification_error&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(((</span><span style=color:#000>FP</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>FN</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#204a87>float</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>TP</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>TN</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>FP</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>FN</span><span style=color:#000;font-weight:700>)),</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Recall_Score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>recall_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Precision_Score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>precision_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;F1_Score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f1_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>)</span>


    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;mean_test_score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>grid_search</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cv_results_</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;mean_test_score&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mean</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>MLA_compare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;mean_fit_time&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>grid_search</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cv_results_</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;mean_fit_time&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mean</span><span style=color:#000;font-weight:700>()</span>

    <span style=color:#000>Model_Scores</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;MLA Name&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>MLA_name</span>
    <span style=color:#000>Model_Scores</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>loc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>row_index</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;ML Score&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>roc_auc_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_pred</span><span style=color:#000;font-weight:700>),</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic>#Collect Mean Test scores for statistical significance test</span>
    <span style=color:#000>test_scores</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>grid_search</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cv_results_</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;mean_test_score&#39;</span><span style=color:#000;font-weight:700>])</span>
    <span style=color:#000>row_index</span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#0000cf;font-weight:700>1</span>
</code></pre></div><h3 id=results-table-from-the-model-evaluation-with-metrics>Results table from the Model evaluation with metrics.</h3><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-results.png alt="Figure 7: scikit-learn"></p><p>Figure 7: scikit-learn</p><h3 id=roc-auc-score>ROC AUC Score</h3><p>AUC - ROC curve is a performance measurement for classification problem at various thresholds settings. ROC is a probability curve and AUC represents degree or measure of separability. It tells how much model is capable of distinguishing between classes. Higher the AUC, better the model is at predicting 0s as 0s and 1s as 1s.</p><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-rocauccurve.png alt="Figure 8: scikit-learn"></p><p>Figure 8: scikit-learn</p><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-rocauc.png alt="Figure 9: scikit-learn"></p><p>Figure 9: scikit-learn</p><h2 id=k-means-in-scikit-learn>K-means in scikit learn.</h2><h3 id=import>Import</h3><h2 id=k-means-algorithm>K-means Algorithm</h2><p>In this section we demonstrate how simple it is to use k-means in scikit learn.</p><h3 id=import-1>Import</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>time</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>time</span>
    <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>numpy</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>np</span>
    <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>matplotlib.pyplot</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>plt</span>
    <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>metrics</span>
    <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.cluster</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>KMeans</span>
    <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.datasets</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>load_digits</span>
    <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.decomposition</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>PCA</span>
    <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.preprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>scale</span>
</code></pre></div><h3 id=create-samples>Create samples</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>random</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>seed</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>digits</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>load_digits</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>scale</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>digits</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h3 id=create-samples-1>Create samples</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>random</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>seed</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>digits</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>load_digits</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>scale</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>digits</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>n_samples</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_features</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>shape</span>
    <span style=color:#000>n_digits</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>unique</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>digits</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>target</span><span style=color:#000;font-weight:700>))</span>
    <span style=color:#000>labels</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>digits</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>target</span>

    <span style=color:#000>sample_size</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>300</span>

    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;n_digits: </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>, </span><span style=color:#4e9a06>\t</span><span style=color:#4e9a06> n_samples </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>, </span><span style=color:#4e9a06>\t</span><span style=color:#4e9a06> n_features </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_samples</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_features</span><span style=color:#000;font-weight:700>))</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>79</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#4e9a06>&#39;_&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;</span><span style=color:#4e9a06>% 9s</span><span style=color:#4e9a06>&#39;</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#4e9a06>&#39;init&#39;</span> <span style=color:#4e9a06>&#39;    time  inertia    homo   compl  v-meas     ARI AMI  silhouette&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;n_digits: </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>, </span><span style=color:#4e9a06>\t</span><span style=color:#4e9a06> n_samples </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>, </span><span style=color:#4e9a06>\t</span><span style=color:#4e9a06> n_features </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span>
          <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_samples</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_features</span><span style=color:#000;font-weight:700>))</span>


    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>79</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#4e9a06>&#39;_&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;</span><span style=color:#4e9a06>% 9s</span><span style=color:#4e9a06>&#39;</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#4e9a06>&#39;init&#39;</span>
          <span style=color:#4e9a06>&#39;    time  inertia    homo   compl  v-meas     ARI AMI  silhouette&#39;</span><span style=color:#000;font-weight:700>)</span>


    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>bench_k_means</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>estimator</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>t0</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;</span><span style=color:#4e9a06>% 9s</span><span style=color:#4e9a06>   </span><span style=color:#4e9a06>%.2f</span><span style=color:#4e9a06>s    </span><span style=color:#4e9a06>%i</span><span style=color:#4e9a06>   </span><span style=color:#4e9a06>%.3f</span><span style=color:#4e9a06>   </span><span style=color:#4e9a06>%.3f</span><span style=color:#4e9a06>   </span><span style=color:#4e9a06>%.3f</span><span style=color:#4e9a06>   </span><span style=color:#4e9a06>%.3f</span><span style=color:#4e9a06>   </span><span style=color:#4e9a06>%.3f</span><span style=color:#4e9a06>    </span><span style=color:#4e9a06>%.3f</span><span style=color:#4e9a06>&#39;</span>
              <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>t0</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>inertia_</span><span style=color:#000;font-weight:700>,</span>
                 <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>homogeneity_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>labels</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>labels_</span><span style=color:#000;font-weight:700>),</span>
                 <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>completeness_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>labels</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>labels_</span><span style=color:#000;font-weight:700>),</span>
                 <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>v_measure_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>labels</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>labels_</span><span style=color:#000;font-weight:700>),</span>
                 <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>adjusted_rand_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>labels</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>labels_</span><span style=color:#000;font-weight:700>),</span>
                 <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>adjusted_mutual_info_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>labels</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>labels_</span><span style=color:#000;font-weight:700>),</span>

                 <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>silhouette_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>labels_</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>metric</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;euclidean&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sample_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>sample_size</span><span style=color:#000;font-weight:700>)))</span>

    <span style=color:#000>bench_k_means</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>KMeans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;k-means++&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_clusters</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;k-means++&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>bench_k_means</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>KMeans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;random&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_clusters</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;random&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>

                 <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>silhouette_score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>estimator</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>labels_</span><span style=color:#000;font-weight:700>,</span>
                                          <span style=color:#000>metric</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;euclidean&#39;</span><span style=color:#000;font-weight:700>,</span>
                                          <span style=color:#000>sample_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>sample_size</span><span style=color:#000;font-weight:700>)))</span>

    <span style=color:#000>bench_k_means</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>KMeans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;k-means++&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_clusters</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span>
                  <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;k-means++&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>bench_k_means</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>KMeans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;random&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_clusters</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span>
                  <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;random&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>


    <span style=color:#8f5902;font-style:italic># in this case the seeding of the centers is deterministic, hence we run the</span>
    <span style=color:#8f5902;font-style:italic># kmeans algorithm only once with n_init=1</span>
    <span style=color:#000>pca</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PCA</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n_components</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>bench_k_means</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>KMeans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>pca</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>components_</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>n_clusters</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;PCA-based&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>79</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#4e9a06>&#39;_&#39;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h3 id=visualize>Visualize</h3><p>See Figure 10</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#000>bench_k_means</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>KMeans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>pca</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>components_</span><span style=color:#000;font-weight:700>,</span>
                         <span style=color:#000>n_clusters</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span>
                  <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;PCA-based&#34;</span><span style=color:#000;font-weight:700>,</span>
                  <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>79</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#4e9a06>&#39;_&#39;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h3 id=visualize-1>Visualize</h3><p>See Figure 10</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#000>reduced_data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PCA</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n_components</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit_transform</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>kmeans</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>KMeans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;k-means++&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_clusters</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>n_digits</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n_init</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>kmeans</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reduced_data</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#8f5902;font-style:italic># Step size of the mesh. Decrease to increase the quality of the VQ.</span>
    <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>02</span>     <span style=color:#8f5902;font-style:italic># point in the mesh [x_min, x_max]x[y_min, y_max].</span>

    <span style=color:#8f5902;font-style:italic># Plot the decision boundary. For that, we will assign a color to each</span>
    <span style=color:#000>x_min</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x_max</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>reduced_data</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>min</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>reduced_data</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>max</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>1</span>
    <span style=color:#000>y_min</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_max</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>reduced_data</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>min</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>reduced_data</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>max</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>1</span>
    <span style=color:#000>xx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yy</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>meshgrid</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>arange</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x_min</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x_max</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>arange</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_min</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_max</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>))</span>

    <span style=color:#8f5902;font-style:italic># Obtain labels for each point in mesh. Use last trained model.</span>
    <span style=color:#000>Z</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>kmeans</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>c_</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>xx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ravel</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>yy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ravel</span><span style=color:#000;font-weight:700>()])</span>

    <span style=color:#8f5902;font-style:italic># Put the result into a color plot</span>
    <span style=color:#000>Z</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Z</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>shape</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>figure</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>clf</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>imshow</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>interpolation</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;nearest&#39;</span><span style=color:#000;font-weight:700>,</span>
               <span style=color:#000>extent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>min</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>xx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>max</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>yy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>min</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>yy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>max</span><span style=color:#000;font-weight:700>()),</span>
               <span style=color:#000>cmap</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cm</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Paired</span><span style=color:#000;font-weight:700>,</span>
               <span style=color:#000>aspect</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;auto&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>origin</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;lower&#39;</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>plot</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reduced_data</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>reduced_data</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#39;k.&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>markersize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#8f5902;font-style:italic># Plot the centroids as a white X</span>
    <span style=color:#000>centroids</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>kmeans</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cluster_centers_</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>scatter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>centroids</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>centroids</span><span style=color:#000;font-weight:700>[:,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span>
                <span style=color:#000>marker</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;x&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>s</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>169</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>linewidths</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>color</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;w&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>zorder</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>title</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;K-means clustering on the digits dataset (PCA-reduced data)</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#39;</span>
              <span style=color:#4e9a06>&#39;Centroids are marked with white cross&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>xlim</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x_min</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x_max</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ylim</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_min</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_max</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>xticks</span><span style=color:#000;font-weight:700>(())</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>yticks</span><span style=color:#000;font-weight:700>(())</span>
    <span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>show</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/scikit-learn/images/scikit-learn-k-means_10_0.png alt="Figure 10: Result"></p><p>Figure 10: Result</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0026bacb1a4e3d2e6df1d11ca44f4e6c>5 - Dask - Random Forest Feature Detection</h1><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p><h2 id=setup>Setup</h2><p>First we need our tools. pandas gives us the DataFrame, very similar
to R&rsquo;s DataFrames. The DataFrame is a structure that allows us to
work with our data more easily. It has nice features for slicing
and transformation of data, and easy ways to do basic statistics.</p><p>numpy has some very handy functions that work on DataFrames.</p><h2 id=dataset>Dataset</h2><p>We are using a dataset about the wine quality dataset, archived at UCI&rsquo;s Machine Learning Repository (<a href=http://archive.ics.uci.edu/ml/index.php)>http://archive.ics.uci.edu/ml/index.php)</a>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>pandas</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>pd</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>numpy</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>np</span>
</code></pre></div><p>Now we will load our data. pandas makes it easy!</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># red wine quality data, packed in a DataFrame</span>
<span style=color:#000>red_df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_csv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;winequality-red.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sep</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;;&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>index_col</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>False</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># white wine quality data, packed in a DataFrame</span>
<span style=color:#000>white_df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_csv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;winequality-white.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sep</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;;&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>index_col</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>False</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># rose? other fruit wines? plum wine? :(</span>
</code></pre></div><p>Like in R, there is a .describe() method that gives basic statistics for every column in the dataset.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># for red wines</span>
<span style=color:#000>red_df</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>describe</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><div><pre><code class="language-{=html}" data-lang="{=html}">&lt;style&gt;
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
&lt;/style&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr style=&quot;text-align: right;&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>fixed acidity</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>volatile acidity</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>citric acid</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>residual sugar</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>chlorides</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>free sulfur dioxide</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>total sulfur dioxide</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>density</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>pH</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>sulphates</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>alcohol</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>quality</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>count</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1599.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>mean</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.319637</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.527821</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.270976</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.538806</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.087467</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>15.874922</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>46.467792</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.996747</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.311113</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.658149</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.422983</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.636023</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>std</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.741096</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.179060</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.194801</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.409928</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.047065</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.460157</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>32.895324</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.001887</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.154386</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.169507</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.065668</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.807569</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>min</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4.600000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.120000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.900000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.012000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.990070</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.740000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.330000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.400000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>25%</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.100000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.390000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.090000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.900000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.070000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>22.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.995600</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.210000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.550000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.500000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>50%</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.900000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.520000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.260000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.200000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.079000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>38.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.996750</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.310000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.620000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.200000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>75%</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.200000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.640000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.420000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.600000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.090000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>21.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>62.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.997835</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.400000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.730000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>11.100000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>max</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>15.900000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.580000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>15.500000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.611000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>72.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>289.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.003690</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4.010000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.900000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/table&gt;
</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># for white wines</span>
<span style=color:#000>white_df</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>describe</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><div><pre><code class="language-{=html}" data-lang="{=html}">&lt;style&gt;
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
&lt;/style&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr style=&quot;text-align: right;&quot;&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>fixed acidity</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>volatile acidity</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>citric acid</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>residual sugar</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>chlorides</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>free sulfur dioxide</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>total sulfur dioxide</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>density</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>pH</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>sulphates</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>alcohol</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>quality</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/thead&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>count</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>4898.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>mean</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.854788</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.278241</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.334192</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.391415</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.045772</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>35.308085</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>138.360657</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.994027</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.188267</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.489847</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.514267</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.877909</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>std</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.843868</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.100795</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.121020</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.072058</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.021848</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>17.007137</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>42.498065</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.002991</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.151001</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.114126</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.230621</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.885639</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>min</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.800000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.080000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.600000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.009000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.987110</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>2.720000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.220000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>8.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>25%</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.300000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.210000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.270000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.700000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.036000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>23.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>108.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.991723</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.090000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.410000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.500000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>50%</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.800000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.260000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.320000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>5.200000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.043000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>34.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>134.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.993740</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.180000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.470000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>10.400000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>75%</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>7.300000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.320000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.390000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.900000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.050000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>46.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>167.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.996100</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.280000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.550000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>11.400000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>6.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;th&gt;
</code></pre><p>max</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/th&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.200000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.100000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.660000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>65.800000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>0.346000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>289.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>440.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.038980</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>3.820000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>1.080000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>14.200000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;td&gt;
</code></pre><p>9.000000</p><pre><code class="language-{=html}" data-lang="{=html}">&lt;/td&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tr&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/tbody&gt;
</code></pre><pre><code class="language-{=html}" data-lang="{=html}">&lt;/table&gt;
</code></pre></div><p>Sometimes it is easier to understand the data visually. A histogram of
the white wine quality <em>data citric</em> acid samples is shown next. You
can of course visualize other columns' data or other datasets. Just
replace the DataFrame and column name (see Figure 1).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>matplotlib.pyplot</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>plt</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>extract_col</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>df</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>col_name</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87>list</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>df</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>col_name</span><span style=color:#000;font-weight:700>])</span>

<span style=color:#000>col</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>extract_col</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>white_df</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;citric acid&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#8f5902;font-style:italic># can replace with another dataframe or column</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>hist</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>col</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic>#TODO: add axes and such to set a good example</span>

<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>show</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/random-forest/images/random-forest_11_0.png alt="Figure 1: Histogram"></p><p>Figure 1: Histogram</p><h2 id=detecting-features>Detecting Features</h2><p>Let us try out a some elementary machine learning models. These models
are not always for prediction. They are also useful to find what
features are most predictive of a variable of interest. Depending
on the classifier you use, you may need to transform the data
pertaining to that variable.</p><h3 id=data-preparation>Data Preparation</h3><p>Let us assume we want to study what features are most correlated
with pH. pH of course is real-valued, and continuous. The classifiers
we want to use usually need labeled or integer data. Hence, we will
transform the pH data, assigning wines with pH higher than average
as <code>hi</code> (more basic or alkaline) and wines with pH lower than
average as <code>lo</code> (more acidic).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># refresh to make Jupyter happy</span>
<span style=color:#000>red_df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_csv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;winequality-red.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sep</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;;&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>index_col</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>False</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>white_df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_csv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;winequality-white.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sep</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;;&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>index_col</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#3465a4>False</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic>#TODO: data cleansing functions here, e.g. replacement of NaN</span>

<span style=color:#8f5902;font-style:italic># if the variable you want to predict is continuous, you can map ranges of values</span>
<span style=color:#8f5902;font-style:italic># to integer/binary/string labels</span>

<span style=color:#8f5902;font-style:italic># for example, map the pH data to &#39;hi&#39; and &#39;lo&#39; if a pH value is more than or</span>
<span style=color:#8f5902;font-style:italic># less than the mean pH, respectively</span>
<span style=color:#000>M</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mean</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>list</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>red_df</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;pH&#39;</span><span style=color:#000;font-weight:700>]))</span> <span style=color:#8f5902;font-style:italic># expect inelegant code in these mappings</span>
<span style=color:#000>Lf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>lambda</span> <span style=color:#000>p</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>M</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#4e9a06>&#39;lo&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#000>M</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#4e9a06>&#39;hi&#39;</span> <span style=color:#8f5902;font-style:italic># some C-style hackery</span>

<span style=color:#8f5902;font-style:italic># create the new classifiable variable</span>
<span style=color:#000>red_df</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;pH-hi-lo&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Lf</span><span style=color:#000;font-weight:700>,</span><span style=color:#204a87>list</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>red_df</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;pH&#39;</span><span style=color:#000;font-weight:700>]))</span>

<span style=color:#8f5902;font-style:italic># and remove the predecessor</span>
<span style=color:#204a87;font-weight:700>del</span> <span style=color:#000>red_df</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;pH&#39;</span><span style=color:#000;font-weight:700>]</span>
</code></pre></div><p>Now we specify which dataset and variable you want to predict by
assigning vlues to <code>SELECTED_DF</code> and <code>TARGET_VAR</code>, respectively.</p><p>We like to keep a parameter file where we specify data sources
and such. This lets me create generic analytics code that is easy
to reuse.</p><p>After we have specified what dataset we want to study, we split
the training and test datasets. We then scale (normalize) the data,
which makes most classifiers run better.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.model_selection</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>train_test_split</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.preprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>StandardScaler</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>metrics</span>

<span style=color:#8f5902;font-style:italic># make selections here without digging in code</span>
<span style=color:#000>SELECTED_DF</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>red_df</span> <span style=color:#8f5902;font-style:italic># selected dataset</span>
<span style=color:#000>TARGET_VAR</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;pH-hi-lo&#39;</span> <span style=color:#8f5902;font-style:italic># the predicted variable</span>

<span style=color:#8f5902;font-style:italic># generate nameless data structures</span>
<span style=color:#000>df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>SELECTED_DF</span>
<span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>array</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>df</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>TARGET_VAR</span><span style=color:#000;font-weight:700>])</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ravel</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#204a87;font-weight:700>del</span> <span style=color:#000>df</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>TARGET_VAR</span><span style=color:#000;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic># no cheating</span>

<span style=color:#8f5902;font-style:italic>#TODO: data cleansing function calls here</span>

<span style=color:#8f5902;font-style:italic># split datasets for training and testing</span>
<span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_train</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y_test</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>train_test_split</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>df</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>target</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>test_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># set up the scaler</span>
<span style=color:#000>scaler</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>StandardScaler</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>scaler</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># apply the scaler</span>
<span style=color:#000>X_train</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>scaler</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>transform</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>X_test</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>scaler</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>transform</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>Now we pick a classifier. As you can see, there are many to try
out, and even more in scikit-learn&rsquo;s documentation and many
examples and tutorials. Random Forests are data science workhorses.
They are the go-to method for most data scientists. Be careful
relying on them though&ndash;they tend to overfit. We try to avoid
overfitting by separating the training and test datasets.</p><h2 id=random-forest>Random Forest</h2><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># pick a classifier</span>

<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.tree</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>DecisionTreeClassifier</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>DecisionTreeRegressor</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>ExtraTreeClassifier</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>ExtraTreeRegressor</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>sklearn.ensemble</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>RandomForestClassifier</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>ExtraTreesClassifier</span>

<span style=color:#000>clf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RandomForestClassifier</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>Now we will test it out with the default parameters.</p><p>Note that this code is boilerplate. You can use it interchangeably for most scikit-learn models.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># test it out</span>

<span style=color:#000>model</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>clf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_train</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>y_train</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>pred</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>clf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>predict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>conf_matrix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>metrics</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>confusion_matrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>pred</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000>var_score</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>clf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>score</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X_test</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>y_test</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># the results</span>
<span style=color:#000>importances</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>clf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>feature_importances_</span>
<span style=color:#000>indices</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argsort</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>importances</span><span style=color:#000;font-weight:700>)[::</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
</code></pre></div><p>Now output the results. For Random Forests, we get a feature ranking.
Relative importances usually exponentially decay. The first few
highly-ranked features are usually the most important.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># for the sake of clarity</span>
<span style=color:#000>num_features</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>X_train</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>shape</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#000>features</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>lambda</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>df</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>columns</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>],</span><span style=color:#000>indices</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>feature_importances</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>lambda</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>importances</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>],</span><span style=color:#000>indices</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>print</span> <span style=color:#4e9a06>&#39;Feature ranking:</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#39;</span>

<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>num_features</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>feature_name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>features</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>feature_importance</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>feature_importances</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#204a87;font-weight:700>print</span> <span style=color:#4e9a06>&#39;</span><span style=color:#4e9a06>%s%f</span><span style=color:#4e9a06>&#39;</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>feature_name</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ljust</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>feature_importance</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><pre><code>Feature ranking:

fixed acidity                 0.269778
citric acid                   0.171337
density                       0.089660
volatile acidity              0.088965
chlorides                     0.082945
alcohol                       0.080437
total sulfur dioxide          0.067832
sulphates                     0.047786
free sulfur dioxide           0.042727
residual sugar                0.037459
quality                       0.021075
</code></pre><p>Sometimes it&rsquo;s easier to visualize. We&rsquo;ll use a bar chart. See Figure 2</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>clf</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>num_features</span><span style=color:#000;font-weight:700>),</span><span style=color:#000>feature_importances</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>xticks</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>num_features</span><span style=color:#000;font-weight:700>),</span><span style=color:#000>features</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>rotation</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>90</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ylabel</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;relative importance (a.u.)&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>title</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Relative importances of most predictive features&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>plt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>show</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><img src=https://github.com/cloudmesh-community/book/raw/main/chapters/prg/python/random-forest/images/random-forest_26_0.png alt="Figure 2: Result"></p><p>Figure 2: Result</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>dask.dataframe</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>dd</span>

<span style=color:#000>red_df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_csv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;winequality-red.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sep</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;;&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>white_df</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read_csv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;winequality-white.csv&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>sep</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;;&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>header</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h2 id=acknowledgement>Acknowledgement</h2><p>This notebook was developed by Juliette Zerick and Gregor von Laszewski</p></div><div class=td-content style=page-break-before:always><h1 id=pg-00a632eb98f5bea1f33d0ade7f8a8fcb>6 - Parallel Computing in Python</h1><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p><p>In this module, we will review the available Python modules that can be
used for parallel computing. Parallel computing can be in the form of
either multi-threading or multi-processing. In multi-threading
approach, the threads run in the same shared memory heap whereas in
case of multi-processing, the memory heaps of processes are separate
and independent, therefore the communication between the processes are
a little bit more complex.</p><h2 id=multi-threading-in-python>Multi-threading in Python</h2><p>Threading in Python is perfect for I/O operations where the process is
expected to be idle regularly, e.g. web scraping. This is a very
useful feature because several applications and scripts might spend the
majority of their runtime waiting for network or data I/O. In
several cases, e.g. web scraping, the resources, i.e. downloading from
different websites, are most of the time-independent. Therefore the
processor can download in parallel and join the result at the end.</p><h3 id=thread-vs-threading><code>Thread</code> vs <code>Threading</code></h3><p>There are two built-in modules in Python that are related to
threading, namely <code>thread</code> and <code>threading</code>. The former module is
deprecated for some time in <code>Python 2</code>, and in <code>Python 3</code> it is renamed
to <code>_thread</code> for the sake of backward incompatibilities. The
<code>_thread</code> module provides low-level threading API for multi-threading
in Python, whereas the module <code>threading</code> builds a high-level
threading interface on top of it.</p><p>The <code>Thread()</code> is the main method of the <code>threading</code> module, the two
important arguments of which are <code>target</code>, for specifying the callable
object, and <code>args</code> to pass the arguments for the target callable. We
illustrate these in the following example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>threading</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>hello_thread</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>thread_num</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Hello from Thread &#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>thread_num</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>thread_num</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>t</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>hello_thread</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>arg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>thread_num</span><span style=color:#000;font-weight:700>,))</span>
        <span style=color:#000>t</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>This is the output of the previous example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>In</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]:</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>run</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>py</span>
<span style=color:#000>Hello</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>Thread</span>  <span style=color:#0000cf;font-weight:700>0</span>
<span style=color:#000>Hello</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>Thread</span>  <span style=color:#0000cf;font-weight:700>1</span>
<span style=color:#000>Hello</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>Thread</span>  <span style=color:#0000cf;font-weight:700>2</span>
<span style=color:#000>Hello</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>Thread</span>  <span style=color:#0000cf;font-weight:700>3</span>
<span style=color:#000>Hello</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>Thread</span>  <span style=color:#0000cf;font-weight:700>4</span>
</code></pre></div><p>In case you are not familiar with the <code>if __name__ == '__main__:'</code>
statement, what it does is making sure that the code nested
under this condition will be run only if you run your module as a
program and it will not run in case your module is imported into another
file.</p><h3 id=locks>Locks</h3><p>As mentioned prior, the memory space is shared between the
threads. This is at the same time beneficial and problematic: it is
beneficial in a sense that the communication between the threads
becomes easy, however, you might experience a strange outcome if you let
several threads change the same variable without caution, e.g. thread 2
changes variable <code>x</code> while thread 1 is working with it. This is when
<code>lock</code> comes into play. Using <code>lock</code>, you can allow only one thread to
work with a variable. In other words, only a single thread can hold
the <code>lock</code>. If the other threads need to work with that variable, they
have to wait until the other thread is done and the variable is
&ldquo;unlocked.&rdquo;</p><p>We illustrate this with a simple example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>threading</span>

<span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
<span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>():</span>
    <span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter 1 incremented the counter by 1&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Counter is </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer2</span><span style=color:#000;font-weight:700>():</span>
    <span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter 2 incremented the counter by 1&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Counter is now </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>)</span>


<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>t1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>t2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer2</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>t1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>t2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>Suppose we want to print multiples of 3 between 1 and 12, i.e. 3, 6, 9
and 12. For the sake of argument, we try to do this using 2 threads
and a nested for loop. Then we create a global variable called counter
and we initialize it with 0. Then whenever each of the <code>incrementer1</code>
or <code>incrementer2</code> functions are called, the <code>counter</code> is incremented
by 3 twice (counter is incremented by 6 in each function call). If you
run the previous code, you should be really lucky if you get the
following as part of your output:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Counter is now <span style=color:#0000cf;font-weight:700>3</span>
Counter is now <span style=color:#0000cf;font-weight:700>6</span>
Counter is now <span style=color:#0000cf;font-weight:700>9</span>
Counter is now <span style=color:#0000cf;font-weight:700>12</span>
</code></pre></div><p>The reason is the conflict that happens between threads
while incrementing the <code>counter</code> in the nested for loop. As you
probably noticed, the first level for loop is equivalent to adding 3
to the counter and the conflict that might happen is not effective on
that level but the nested for loop. Accordingly, the output of the
previous code is different in every run. This is an example output:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3 lock_example.py
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>4</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>8</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>10</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>12</span>
</code></pre></div><p>We can fix this issue using a <code>lock</code>: whenever one of the function is
going to increment the value by 3, it will <code>acquire()</code> the lock and
when it is done the function will <code>release()</code> the lock. This mechanism
is illustrated in the following code:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>threading</span>

<span style=color:#000>increment_by_3_lock</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Lock</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
<span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>():</span>
    <span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter 1 incremented the counter by 1&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Counter is </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer2</span><span style=color:#000;font-weight:700>():</span>
    <span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter 2 incremented the counter by 1&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Counter is </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>t1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>t2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>threading</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer2</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#000>t1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>t2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>No matter how many times you run this code, the output would always be
in the correct order:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3 lock_example.py
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>3</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>1</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>6</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>9</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Greeter <span style=color:#0000cf;font-weight:700>2</span> incremented the counter by <span style=color:#0000cf;font-weight:700>1</span>
Counter is <span style=color:#0000cf;font-weight:700>12</span>
</code></pre></div><p>Using the <code>Threading</code> module increases both the overhead associated
with thread management as well as the complexity of the program and
that is why in many situations, employing <code>multiprocessing</code> module
might be a better approach.</p><h2 id=multi-processing-in-python>Multi-processing in Python</h2><p>We already mentioned that multi-threading might not be sufficient in
many applications and we might need to use <code>multiprocessing</code> sometimes,
or better to say most of the time. That is why we are dedicating this
subsection to this particular module. This module provides you with an
API for spawning processes the way you spawn threads using <code>threading</code>
module. Moreover, some functionalities are not even
available in <code>threading</code> module, e.g. the <code>Pool</code> class which allows
you to run a batch of jobs using a <em>pool</em> of worker processes.</p><h3 id=process>Process</h3><p>Similar to <code>threading</code> module which was employing <code>thread</code> (aka
<code>_thread</code>) under the hood, <code>multiprocessing</code> employs the <code>Process</code>
class. Consider the following example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>multiprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Process</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>os</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>greeter</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>proc_idx</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>os</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>getpid</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Process {0}: Hello {1}!&#34;</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>format</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>proc_idx</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>))</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>name_list</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;Harry&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;George&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Dirk&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;David&#39;</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>process_list</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>name_idx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>name</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>enumerate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name_list</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>current_process</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>greeter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,))</span>
        <span style=color:#000>process_list</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>current_process</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>current_process</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>process</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>process_list</span><span style=color:#000;font-weight:700>:</span>
        <span style=color:#000>process</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>join</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>In this example, after importing the <code>Process</code> module we created a
<code>greeter()</code> function that takes a <code>name</code> and greets that person. It
also prints the <code>pid</code> (process identifier) of the process that is
running it. Note that we used the <code>os</code> module to get the <code>pid</code>. In the
bottom of the code after checking the <code>__name__='__main__'</code> condition,
we create a series of <code>Process</code>es and <code>start</code> them. Finally in the
last for loop and using the <code>join</code> method, we tell Python to wait for
the processes to terminate. This is one of the possible outputs of the
code:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3 process_example.py
Process 23451: Hello Harry!
Process 23452: Hello George!
Process 23453: Hello Dirk!
Process 23454: Hello David!
</code></pre></div><h3 id=pool>Pool</h3><p>Consider the <code>Pool</code> class as a pool of worker processes. There are
several ways for assigning jobs to the <code>Pool</code> class and we will
introduce the most important ones in this section. These methods are
categorized as <code>blocking</code> or <code>non-blocking. The former means that after calling the API, it blocks the thread/process until it has the result or answer ready and the control returns only when the call completes. In the</code>non-blockin` on the other hand, the control returns
immediately.</p><h4 id=synchronous-poolmap>Synchronous <code>Pool.map()</code></h4><p>We illustrate the <code>Pool.map</code> method by re-implementing our previous
greeter example using <code>Pool.map</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>multiprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Pool</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>os</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>greeter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>pid</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>os</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>getpid</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Process {0}: Hello {1}!&#34;</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>format</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pid</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>))</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>names</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;Jenna&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;David&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Marry&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Ted&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Jerry&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Tom&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Justin&#39;</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>pool</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Pool</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>processes</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>sync_map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pool</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>greeter</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>names</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Done!&#34;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>As you can see, we have seven names here but we do not want to
dedicate each greeting to a separate process. Instead, we do the whole
job of &ldquo;greeting seven people&rdquo; using &ldquo;two processes.&rdquo; We create a pool
of 3 processes with <code>Pool(processes=3)</code> syntax and then we map an
iterable called <code>names</code> to the <code>greeter</code> function using
<code>pool.map(greeter,names)</code>. As we expected, the greetings in the
output will be printed from three different processes:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python poolmap_example.py
Process 30585: Hello Jenna!
Process 30586: Hello David!
Process 30587: Hello Marry!
Process 30585: Hello Ted!
Process 30585: Hello Jerry!
Process 30587: Hello Tom!
Process 30585: Hello Justin!
Done!
</code></pre></div><p>Note that <code>Pool.map()</code> is in <code>blocking</code> category and does not return
the control to your script until it is done calculating the
results. That is why <code>Done!</code> is printed after all of the greetings are
over.</p><h4 id=asynchronous-poolmap_async>Asynchronous <code>Pool.map_async()</code></h4><p>As the name implies, you can use the <code>map_async</code> method, when you want
assign many function calls to a pool of worker processes
asynchronously. Note that unlike <code>map</code>, the order of the results is
not guaranteed (as oppose to <code>map</code>) and the control is returned
immediately. We now implement the previous example using <code>map_async</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>multiprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Pool</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>os</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>greeter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>pid</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>os</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>getpid</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Process {0}: Hello {1}!&#34;</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>format</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pid</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>))</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>names</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;Jenna&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;David&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Marry&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Ted&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Jerry&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Tom&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Justin&#39;</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>pool</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Pool</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>processes</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>async_map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pool</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>map_async</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>greeter</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>names</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Done!&#34;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>async_map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>wait</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>As you probably noticed, the only difference (clearly apart from the
<code>map_async</code> method name) is calling the <code>wait()</code> method in the last
line. The <code>wait()</code> method tells your script to wait for the result of
<code>map_async</code> before terminating:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python poolmap_example.py
Done!
Process 30740: Hello Jenna!
Process 30741: Hello David!
Process 30740: Hello Ted!
Process 30742: Hello Marry!
Process 30740: Hello Jerry!
Process 30741: Hello Tom!
Process 30742: Hello Justin!
</code></pre></div><p>Note that the order of the results are not preserved. Moreover,
<code>Done!</code> is printer before any of the results, meaning that if we do
not use the <code>wait()</code> method, you probably will not see the result at
all.</p><h3 id=locks-1>Locks</h3><p>The way <code>multiprocessing</code> module implements locks is almost identical
to the way the <code>threading</code> module does. After importing <code>Lock</code> from
<code>multiprocessing</code> all you need to do is to <code>acquire</code> it, do some
computation and then <code>release</code> the lock. We will clarify the use of
<code>Lock</code> by providing an example in next section about process
communication.</p><h3 id=process-communication>Process Communication</h3><p>Process communication in <code>multiprocessing</code> is one of the most
important, yet complicated, features for better use of this module. As
oppose to <code>threading</code>, the <code>Process</code> objects will not have access to
any shared variable by default, i.e. no shared memory space between
the processes by default. This effect is illustrated in the following
example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>multiprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Lock</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Value</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>time</span>

<span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
<span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>():</span>
    <span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter1: Counter is </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer2</span><span style=color:#000;font-weight:700>():</span>
    <span style=color:#204a87;font-weight:700>global</span> <span style=color:#000>counter</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter2: Counter is </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>)</span>


<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>

    <span style=color:#000>t1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer1</span> <span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>t2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer2</span> <span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>t1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>t2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>Probably you already noticed that this is almost identical to our
example in <code>threading</code> section. Now, take a look at the strange
output:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python communication_example.py
Greeter1: Counter is <span style=color:#0000cf;font-weight:700>3</span>
Greeter1: Counter is <span style=color:#0000cf;font-weight:700>6</span>
Greeter2: Counter is <span style=color:#0000cf;font-weight:700>3</span>
Greeter2: Counter is <span style=color:#0000cf;font-weight:700>6</span>
</code></pre></div><p>As you can see, it is as if the processes does not see each
other. Instead of having two processes one counting to 6 and the other
counting from 6 to 12, we have two processes counting to 6.</p><p>Nevertheless, there are several ways that <code>Process</code>es from
<code>multiprocessing</code> can communicate with each other, including <code>Pipe</code>,
<code>Queue</code>, <code>Value</code>, <code>Array</code> and <code>Manager</code>. <code>Pipe</code> and <code>Queue</code> are
appropriate for inter-process message passing. To be more specific,
<code>Pipe</code> is useful for process-to-process scenarios while <code>Queue</code> is
more appropriate for process<strong>es</strong>-toprocess<strong>es</strong> ones. <code>Value</code> and
<code>Array</code> are both used to provide synchronized access to a shared
data (very much like shared memory) and <code>Managers</code> can be used on
different data types. In the following sub-sections, we cover both
<code>Value</code> and <code>Array</code> since they are both lightweight, yet useful,
approach.</p><h4 id=value>Value</h4><p>The following example re-implements the broken example in the previous
section. We fix the strange output, by using both <code>Lock</code> and <code>Value</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>multiprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Lock</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Value</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>time</span>

<span style=color:#000>increment_by_3_lock</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Lock</span><span style=color:#000;font-weight:700>()</span>


<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.1</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter1: Counter is </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer2</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.05</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter2: Counter is </span><span style=color:#4e9a06>%d</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>


<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>

    <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Value</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;i&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>t1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>,))</span>
    <span style=color:#000>t2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer2</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>,))</span>
    <span style=color:#000>t2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>t1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>The usage of <code>Lock</code> object in this example is identical to the example
in <code>threading</code> section. The usage of <code>counter</code> is on the other hand
the novel part. First, note that counter is not a global variable
anymore and instead it is a <code>Value</code> which returns a <code>ctypes</code> object
allocated from a shared memory between the processes. The first
argument <code>'i'</code> indicates a signed integer, and the second argument
defines the initialization value. In this case we are assigning a
signed integer in the shared memory initialized to size 0 to the
<code>counter</code> variable. We then modified our two functions and pass this
<em>shared</em> variable as an argument. Finally, we change the way we
increment the <code>counter</code> since the counter is not a Python integer anymore
but a <code>ctypes</code> signed integer where we can access its value using the
<code>value</code> attribute. The output of the code is now as we expected:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python mp_lock_example.py
Greeter2: Counter is <span style=color:#0000cf;font-weight:700>3</span>
Greeter2: Counter is <span style=color:#0000cf;font-weight:700>6</span>
Greeter1: Counter is <span style=color:#0000cf;font-weight:700>9</span>
Greeter1: Counter is <span style=color:#0000cf;font-weight:700>12</span>
</code></pre></div><p>The last example related to parallel processing, illustrates the use
of both <code>Value</code> and <code>Array</code>, as well as a technique to pass multiple
arguments to a function. Note that the <code>Process</code> object does not
accept multiple arguments for a function and therefore we need this or
similar techniques for passing multiple arguments. Also, this
technique can also be used when you want to pass multiple arguments to
<code>map</code> or <code>map_async</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>multiprocessing</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Lock</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Value</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Array</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>time</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>ctypes</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>c_char_p</span>


<span style=color:#000>increment_by_3_lock</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Lock</span><span style=color:#000;font-weight:700>()</span>


<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>counter_and_names</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>=</span>  <span style=color:#000>counter_and_names</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>names</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>counter_and_names</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.1</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>name_idx</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>//</span><span style=color:#0000cf;font-weight:700>3</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter1: Greeting {0}! Counter is {1}&#34;</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>format</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>names</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>name_idx</span><span style=color:#000;font-weight:700>],</span><span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>incrementer2</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>counter_and_names</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>=</span>  <span style=color:#000>counter_and_names</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>names</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>counter_and_names</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>j</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>acquire</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>):</span>
            <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
            <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.05</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>name_idx</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>//</span><span style=color:#0000cf;font-weight:700>3</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span>
        <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Greeter2: Greeting {0}! Counter is {1}&#34;</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>format</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>names</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>name_idx</span><span style=color:#000;font-weight:700>],</span><span style=color:#000>counter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#000>increment_by_3_lock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>()</span>


<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;__main__&#39;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>counter</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Value</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;i&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>names</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Array</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>c_char_p</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>names</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;James&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Tom&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Sam&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;Larry&#39;</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>t1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>names</span><span style=color:#000;font-weight:700>),))</span>
    <span style=color:#000>t2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>incrementer2</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>counter</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>names</span><span style=color:#000;font-weight:700>),))</span>
    <span style=color:#000>t2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>t1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>In this example, we created a <code>multiprocessing.Array()</code> object and
assigned it to a variable called <code>names</code>. As we mentioned before, the
first argument is the <code>ctype</code> data type and since we want to create an
array of strings with a length of 4 (second argument), we imported the
<code>c_char_p</code> and passed it as the first argument.</p><p>Instead of passing the arguments separately, we merged both the
<code>Value</code> and <code>Array</code> objects in a tuple and passed the tuple to the
functions. We then modified the functions to unpack the objects in the
first two lines in both functions. Finally, we changed the print
statement in a way that each process greets a particular name. The
output of the example is:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3 mp_lock_example.py
Greeter2: Greeting James! Counter is <span style=color:#0000cf;font-weight:700>3</span>
Greeter2: Greeting Tom! Counter is <span style=color:#0000cf;font-weight:700>6</span>
Greeter1: Greeting Sam! Counter is <span style=color:#0000cf;font-weight:700>9</span>
Greeter1: Greeting Larry! Counter is <span style=color:#0000cf;font-weight:700>12</span>
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-dcb9354b26f1bf4c30d415d41915fbfc>7 - Dask</h1><p>Gregor von Laszewski (<a href=mailto:laszewski@gmail.com>laszewski@gmail.com</a>)</p><p>Dask is a python-based parallel computing library for
analytics. Parallel computing is a type of computation in which many
calculations or the execution of processes are carried out
simultaneously. Large problems can often be divided into smaller ones,
which can then be solved concurrently.</p><p>Dask is composed of two components:</p><ol><li><em>Dynamic task scheduling optimized for computation.</em> This is similar to Airflow, Luigi, Celery, or Make, but optimized for interactive computational workloads.</li><li><em>Big Data collections</em> like parallel arrays, dataframes, and lists that extend common interfaces like NumPy, Pandas, or Python iterators to larger-than-memory or distributed environments. These
parallel collections run on top of the dynamic task schedulers.</li></ol><p>Dask emphasizes the following virtues:</p><ul><li><em>Familiar</em>: Provides parallelized NumPy array and Pandas DataFrame
objects.</li><li><em>Flexible</em>: Provides a task scheduling interface for more custom
workloads and integration with other projects.</li><li><em>Native</em>: Enables distributed computing in Pure Python with access
to the PyData stack.</li><li><em>Fast</em>: Operates with low overhead, low latency, and minimal
serialization necessary for fast numerical algorithms</li><li><em>Scales up</em>: Runs resiliently on clusters with 1000s of cores</li><li><em>Scales down</em>: Trivial to set up and run on a laptop in a single
process</li><li><em>Responsive</em>: Designed with interactive computing in mind it
provides rapid feedback and diagnostics to aid humans</li></ul><p>The section is structured in a number of subsections addressing the
following topics:</p><dl><dt>Foundations:</dt><dd><p>an explanation of what Dask is, how it works, and how to use lower
level primitives to set up computations. Casual users may wish to
skip this section, although we consider it useful knowledge for all
users.</p></dd><dt>Distributed Features:</dt><dd><p>information on running Dask on the distributed scheduler, which
enables scale-up to distributed settings and enhanced monitoring of
task operations. The distributed scheduler is now generally the
recommended engine for executing task work, even on single
workstations or laptops.</p></dd><dt>Collections:</dt><dd><p>convenient abstractions giving a familiar feel to big data.</p></dd><dt>Bags:</dt><dd><p>Python iterators with a functional paradigm, such as found in
func/iter-tools and toolz - generalize lists/generators to big data;
this will seem very familiar to users of PySpark&rsquo;s RDD</p></dd><dt>Array:</dt><dd><p>massive multi-dimensional numerical data, with Numpy functionality</p></dd><dt>Dataframe:</dt><dd><p>massive tabular data, with Pandas functionality</p></dd></dl><h2 id=how-dask-works>How Dask Works</h2><p>Dask is a computation tool for larger-than-memory datasets, parallel
execution or delayed/background execution.</p><p>We can summarize the basics of Dask as follows:</p><ul><li>process data that does not fit into memory by breaking it into
blocks and specifying task chains</li><li>parallelize execution of tasks across cores and even nodes of a
cluster</li><li>move computation to the data rather than the other way around, to
minimize communication overheads</li></ul><p>We use for-loops to build basic tasks, Python iterators, and the Numpy
(array) and Pandas (dataframe) functions for multi-dimensional or
tabular data, respectively.</p><p>Dask allows us to construct a prescription for the calculation we want
to carry out. A module named Dask.delayed lets us parallelize custom
code. It is useful whenever our problem doesn&rsquo;t quite fit a high-level
parallel object like dask.array or dask.dataframe but could still
benefit from parallelism. Dask.delayed works by delaying our function
evaluations and putting them into a dask graph. Here is a small
example:</p><pre><code>from dask import delayed

@delayed
def inc(x):
    return x + 1

@delayed
def add(x, y):
    return x + y
</code></pre><p>Here we have used the delayed annotation to show that we want these
functions to operate lazily - to save the set of inputs and execute
only on demand.</p><h2 id=dask-bag>Dask Bag</h2><p>Dask-bag excels in processing data that can be represented as a
sequence of arbitrary inputs. We&rsquo;ll refer to this as &ldquo;messy&rdquo; data,
because it can contain complex nested structures, missing fields,
mixtures of data types, etc. The functional programming style fits
very nicely with standard Python iteration, such as can be found in
the itertools module.</p><p>Messy data is often encountered at the beginning of data processing
pipelines when large volumes of raw data are first consumed. The
initial set of data might be JSON, CSV, XML, or any other format that
does not enforce strict structure and datatypes. For this reason, the
initial data massaging and processing is often done with Python lists,
dicts, and sets.</p><p>These core data structures are optimized for general-purpose storage
and processing. Adding streaming computation with iterators/generator
expressions or libraries like itertools or toolz let us process large
volumes in a small space. If we combine this with parallel processing
then we can churn through a fair amount of data.</p><p>Dask.bag is a high level Dask collection to automate common workloads
of this form. In a nutshell</p><pre><code>dask.bag = map, filter, toolz + parallel execution
</code></pre><p>You can create a Bag from a Python sequence, from files, from data on
S3, etc.</p><pre><code># each element is an integer
import dask.bag as db
b = db.from_sequence([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])

# each element is a text file of JSON lines
import os
b = db.read_text(os.path.join('data', 'accounts.*.json.gz'))

# Requires `s3fs` library
# each element is a remote CSV text file
b = db.read_text('s3://dask-data/nyc-taxi/2015/yellow_tripdata_2015-01.csv')
</code></pre><p>Bag objects hold the standard functional API found in projects like
the Python standard library, toolz, or pyspark, including map, filter,
groupby, etc.</p><p>As with Array and DataFrame objects, operations on Bag objects create
new bags. Call the .compute() method to trigger execution.</p><pre><code>def is_even(n):
    return n % 2 == 0

b = db.from_sequence([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
c = b.filter(is_even).map(lambda x: x ** 2)
c

# blocking form: wait for completion (which is very fast in this case)
c.compute()
</code></pre><p>For more details on Dask Bag check <a href=https://dask.pydata.org/en/latest/bag.html>https://dask.pydata.org/en/latest/bag.html</a></p><h2 id=concurrency-features>Concurrency Features</h2><p>Dask supports a real-time task framework that extends Python&rsquo;s
concurrent.futures interface. This interface is good for arbitrary
task scheduling, like dask.delayed, but is immediate rather than lazy,
which provides some more flexibility in situations where the
computations may evolve. These features depend on the second-generation task scheduler found in dask.distributed (which, despite
its name, runs very well on a single machine).</p><p>Dask allows us to simply construct graphs of tasks with
dependencies. We can find that graphs can also be created
automatically for us using functional, Numpy, or Pandas syntax on data
collections. None of this would be very useful if there weren&rsquo;t also
a way to execute these graphs, in a parallel and memory-aware
way. Dask comes with four available schedulers:</p><ul><li><code>dask.threaded.get</code>: a scheduler backed by a thread pool</li><li><code>dask.multiprocessing.get</code>: a scheduler backed by a process pool</li><li><code>dask.async.get_sync</code>: a synchronous scheduler, good for debugging</li><li><code>distributed.Client.get</code>: a distributed scheduler for executing graphs on multiple machines.</li></ul><p>Here is a simple program for dask.distributed library:</p><pre><code>from dask.distributed import Client
client = Client('scheduler:port')

futures = []
for fn in filenames:
    future = client.submit(load, fn)
    futures.append(future)

summary = client.submit(summarize, futures)
summary.result()
</code></pre><p>For more details on Concurrent Features by Dask check
<a href=https://dask.pydata.org/en/latest/futures.html>https://dask.pydata.org/en/latest/futures.html</a></p><h2 id=dask-array>Dask Array</h2><p>Dask arrays implement a subset of the NumPy interface on large arrays
using blocked algorithms and task scheduling. These behave like numpy
arrays, but break a massive job into tasks that are then executed by a
scheduler. The default scheduler uses threading but you can also use
multiprocessing or distributed or even serial processing (mainly for
debugging). You can tell the dask array how to break the data into
chunks for processing.</p><pre><code>import dask.array as da
f = h5py.File('myfile.hdf5')
x = da.from_array(f['/big-data'], chunks=(1000, 1000))
x - x.mean(axis=1).compute()
</code></pre><p>For more details on Dask Array check <a href=https://dask.pydata.org/en/latest/array.html>https://dask.pydata.org/en/latest/array.html</a></p><h2 id=dask-dataframe>Dask DataFrame</h2><p>A Dask DataFrame is a large parallel dataframe composed of many
smaller Pandas dataframes, split along the index. These pandas
dataframes may live on disk for larger-than-memory computing on a
single machine, or on many different machines in a
cluster. Dask.dataframe implements a commonly used subset of the
Pandas interface including elementwise operations, reductions,
grouping operations, joins, timeseries algorithms, and more. It copies
the Pandas interface for these operations exactly and so should be
very familiar to Pandas users. Because Dask.dataframe operations
merely coordinate Pandas operations they usually exhibit similar
performance characteristics as are found in Pandas. To run the
following code, save &lsquo;student.csv&rsquo; file in your machine.</p><pre><code>import pandas as pd
df = pd.read_csv('student.csv')
d = df.groupby(df.HID).Serial_No.mean()
print(d)

ID
101     1
102     2
104     3
105     4
106     5
107     6
109     7
111     8
201     9
202    10
Name: Serial_No, dtype: int64

import dask.dataframe as dd
df = dd.read_csv('student.csv')
dt = df.groupby(df.HID).Serial_No.mean().compute()
print (dt)

ID
101     1.0
102     2.0
104     3.0
105     4.0
106     5.0
107     6.0
109     7.0
111     8.0
201     9.0
202    10.0
Name: Serial_No, dtype: float64
</code></pre><p>For more details on Dask DataFrame check <a href=https://dask.pydata.org/en/latest/dataframe.html>https://dask.pydata.org/en/latest/dataframe.html</a></p><h2 id=dask-dataframe-storage>Dask DataFrame Storage</h2><p>Efficient storage can dramatically improve performance, particularly
when operating repeatedly from disk.</p><p>Decompressing text and parsing CSV files is expensive. One of the most
effective strategies with medium data is to use a binary storage
format like HDF5.</p><pre><code># be sure to shut down other kernels running distributed clients
from dask.distributed import Client
client = Client()
</code></pre><p>Create data if we don&rsquo;t have any</p><pre><code>from prep import accounts_csvs
accounts_csvs(3, 1000000, 500)
</code></pre><p>First we read our csv data as before.</p><p>CSV and other text-based file formats are the most common storage for
data from many sources, because they require minimal pre-processing,
can be written line-by-line and are human-readable. Since Pandas'
read_csv is well-optimized, CSVs are a reasonable input, but far from
optimized, since reading required extensive text parsing.</p><pre><code>import os
filename = os.path.join('data', 'accounts.*.csv')
filename

import dask.dataframe as dd
df_csv = dd.read_csv(filename)
df_csv.head()
</code></pre><p>HDF5 and netCDF are binary array formats very commonly used in the
scientific realm.</p><p>Pandas contains a specialized HDF5 format, HDFStore. The
dd.DataFrame.to_hdf method works exactly like the pd.DataFrame.to_hdf
method.</p><pre><code>target = os.path.join('data', 'accounts.h5')
target

%time df_csv.to_hdf(target, '/data')

df_hdf = dd.read_hdf(target, '/data')
df_hdf.head()
</code></pre><p>For more information on Dask DataFrame Storage, click <a href=http://dask.pydata.org/en/latest/dataframe-create.html>http://dask.pydata.org/en/latest/dataframe-create.html</a></p><h2 id=links>Links</h2><ul><li><a href=https://dask.pydata.org/en/latest/>https://dask.pydata.org/en/latest/</a></li><li><a href=http://matthewrocklin.com/blog/work/2017/10/16/streaming-dataframes-1>http://matthewrocklin.com/blog/work/2017/10/16/streaming-dataframes-1</a></li><li><a href=http://people.duke.edu/~ccc14/sta-663-2017/18A_Dask.html>http://people.duke.edu/~ccc14/sta-663-2017/18A_Dask.html</a></li><li><a href=https://www.kdnuggets.com/2016/09/introducing-dask-parallel-programming.html>https://www.kdnuggets.com/2016/09/introducing-dask-parallel-programming.html</a></li><li><a href=https://pypi.python.org/pypi/dask/>https://pypi.python.org/pypi/dask/</a></li><li><a href=https://www.hdfgroup.org/2015/03/hdf5-as-a-zero-configuration-ad-hoc-scientific-database-for-python/>https://www.hdfgroup.org/2015/03/hdf5-as-a-zero-configuration-ad-hoc-scientific-database-for-python/</a></li><li><a href=https://github.com/dask/dask-tutorial>https://github.com/dask/dask-tutorial</a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Gregor von Laszewski" aria-label="Gregor von Laszewski"><a class=text-white target=_blank rel=noopener href=https://laszewski.github.io aria-label="Gregor von Laszewski"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/cybertraining-dsc/cybertraining-dsc.github.io/ aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Indiana University, 2020 All Rights Reserved</small><p class=mt-2><a href=/about/>About Cybertraining</a></p></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js integrity=sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK crossorigin=anonymous></script><script src=/js/deflate.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css integrity=sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js integrity=sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/mhchem.min.js integrity=sha384-LIgAiYlGSAdpNC9+YDjDPF6JeS/RRIumtNo0CmyQERZ/+g0h9MbuYQwf/5pQ4Y4M crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body,null);></script><script src=/js/main.min.24fdf50398b189e91e0fc406ea4341e93f56846c34eecd790e12aab363ef5e3c.js integrity="sha256-JP31A5ixiekeD8QG6kNB6T9WhGw07s15DhKqs2PvXjw=" crossorigin=anonymous></script></body></html>